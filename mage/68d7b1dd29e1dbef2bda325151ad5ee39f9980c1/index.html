<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Harbor安装和配置学习笔记 | 马哥私房菜</title><meta name="author" content="mage"><meta name="copyright" content="mage"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Harbor Installation and Configuration 版本 2.8.0 https:&#x2F;&#x2F;goharbor.io&#x2F;docs&#x2F;2.0.0&#x2F;install-config&#x2F; harbor 安装条件硬件条件 Hardware下面列出了 需要的硬件资源， cpu ，内存，磁盘等： Resource 	Minimum 	Recommended CPU 	    2 CPU 	    4 C">
<meta property="og:type" content="article">
<meta property="og:title" content="Harbor安装和配置学习笔记">
<meta property="og:url" content="https://magesfc.github.io/mage/68d7b1dd29e1dbef2bda325151ad5ee39f9980c1/">
<meta property="og:site_name" content="马哥私房菜">
<meta property="og:description" content="Harbor Installation and Configuration 版本 2.8.0 https:&#x2F;&#x2F;goharbor.io&#x2F;docs&#x2F;2.0.0&#x2F;install-config&#x2F; harbor 安装条件硬件条件 Hardware下面列出了 需要的硬件资源， cpu ，内存，磁盘等： Resource 	Minimum 	Recommended CPU 	    2 CPU 	    4 C">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://t.mwm.moe/fj/">
<meta property="article:published_time" content="2023-07-13T08:07:37.000Z">
<meta property="article:modified_time" content="2023-07-13T09:51:43.000Z">
<meta property="article:author" content="mage">
<meta property="article:tag" content="harbor">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://t.mwm.moe/fj/"><link rel="shortcut icon" href="https://www.zeekrlife.com/favicon.png"><link rel="canonical" href="https://magesfc.github.io/mage/68d7b1dd29e1dbef2bda325151ad5ee39f9980c1/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: mage","link":"链接: ","source":"来源: 马哥私房菜","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Harbor安装和配置学习笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-07-13 17:51:43'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><style type="text/css">.card-announcement .social-button{margin:.6rem 0 0 0;text-align:center}.card-announcement .social-button a{display:block;background-color:var(--btn-bg);color:var(--btn-color);text-align:center;line-height:2.4;margin:4px 0}.card-announcement .social-button a:hover{background-color:var(--btn-hover-color)}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">217</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">233</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">40</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 精选文档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/21cfbf15/"><span> 🚀 快速开始</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/dc584b87/"><span> 📑 主题页面</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4aa8abbe/"><span> 🛠 主题配置-1</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/ceeb73f/"><span> 🛠 主题配置-2</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/98d20436/"><span> ❓ 主题问答</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4073eda/"><span> ⚡️ 进阶教程</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/198a4240/"><span> ✨ 更新日志</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://butterfly.js.org/link/"><i class="fa-fw fas fa-thumbs-up"></i><span> 其他示例</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://t.mwm.moe/fj/')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">马哥私房菜</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 精选文档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/21cfbf15/"><span> 🚀 快速开始</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/dc584b87/"><span> 📑 主题页面</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4aa8abbe/"><span> 🛠 主题配置-1</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/ceeb73f/"><span> 🛠 主题配置-2</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/98d20436/"><span> ❓ 主题问答</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4073eda/"><span> ⚡️ 进阶教程</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/198a4240/"><span> ✨ 更新日志</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://butterfly.js.org/link/"><i class="fa-fw fas fa-thumbs-up"></i><span> 其他示例</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Harbor安装和配置学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-07-13T08:07:37.000Z" title="发表于 2023-07-13 16:07:37">2023-07-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-07-13T09:51:43.000Z" title="更新于 2023-07-13 17:51:43">2023-07-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/harbor/">harbor</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Harbor安装和配置学习笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Harbor-Installation-and-Configuration"><a href="#Harbor-Installation-and-Configuration" class="headerlink" title="Harbor Installation and Configuration "></a>Harbor Installation and Configuration </h1><p>版本 2.8.0</p>
<p><a target="_blank" rel="noopener" href="https://goharbor.io/docs/2.0.0/install-config/">https://goharbor.io/docs/2.0.0/install-config/</a></p>
<h1 id="harbor-安装条件"><a href="#harbor-安装条件" class="headerlink" title="harbor 安装条件"></a>harbor 安装条件</h1><h2 id="硬件条件-Hardware"><a href="#硬件条件-Hardware" class="headerlink" title="硬件条件 Hardware"></a>硬件条件 Hardware</h2><p>下面列出了 需要的硬件资源， cpu ，内存，磁盘等：</p>
<pre><code>Resource 	Minimum 	Recommended
CPU 	    2 CPU 	    4 CPU
Mem 	    4 GB 	    8 GB
Disk 	    40 GB 	    160 GB
</code></pre>
<h2 id="软件条件-Software"><a href="#软件条件-Software" class="headerlink" title="软件条件 Software"></a>软件条件 Software</h2><p>安装harbor前需要提前安装，准备的软件环境，例如docker，docker-compose， openssl</p>
<pre><code>Software 	    Version 	                    Description
Docker engine 	Version 17.06.0-ce+ or higher 	参考文档 https://docs.docker.com/engine/installation/
Docker Compose 	Version 1.18.0 or higher 	    参考文档 https://docs.docker.com/compose/install/
Openssl 	    Latest is preferred 	        Used to generate certificate and keys for Harbor
</code></pre>
<h2 id="网络端口条件-Network-ports"><a href="#网络端口条件-Network-ports" class="headerlink" title="网络端口条件 Network ports"></a>网络端口条件 Network ports</h2><p>harbor 服务 需要如下的几个 网络端口，端口都是可以改的，不过默认，习惯 用下面的几个端口。</p>
<pre><code>Port 	Protocol 	Description
443 	HTTPS 	    Harbor portal and core API accept HTTPS requests on this port. You can change this port in the configuration file.
80 	    HTTP 	    Harbor portal and core API accept HTTP  requests on this port. You can change this port in the configuration file.
4443 	HTTPS 	    Connections to the Docker Content Trust service for Harbor. Only required if Notary is enabled. You can change this port in the configuration file.
</code></pre>
<h1 id="下载-Harbor-Installer"><a href="#下载-Harbor-Installer" class="headerlink" title="下载 Harbor Installer"></a>下载 Harbor Installer</h1><p>可以从官方发布页面下载Harbor安装程序。下载 联机安装程序 或 脱机安装程序。 </p>
<pre><code>Online installer: 在线安装包很小，就是一个执行脚本加上几个配置文件 .

Offline installer: 离线安装包很多，其中多了镜像文件.
</code></pre>
<p>下面可以看到 安装 包大小，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">harbor-offline-installer-v2.8.2.tgz 579 MB </span><br><span class="line"></span><br><span class="line">harbor-offline-installer-v2.8.2.tgz.asc 833 Bytes   这个文件是 验证安装包文件是否是官方的，类似签名验证 ，检测文件真假的，是否是被篡改过的。</span><br><span class="line"></span><br><span class="line">harbor-online-installer-v2.8.2.tgz 10.8 KB </span><br><span class="line"></span><br><span class="line">harbor-online-installer-v2.8.2.tgz.asc 833 Bytes</span><br></pre></td></tr></table></figure>
<p>然后选择需要的包，从 github 上下载 <a target="_blank" rel="noopener" href="https://github.com/goharbor/harbor/releases">https://github.com/goharbor/harbor/releases</a></p>
<p>利用 wget 命令下载 文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/goharbor/harbor/releases/download/v2.8.2/harbor-offline-installer-v2.8.2.tgz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wget https://github.com/goharbor/harbor/releases/download/v2.8.2/harbor-online-installer-v2.8.2.tgz</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>文件正版验证：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gpg -v --keyserver hkps://keyserver.ubuntu.com --verify harbor-online-installer-version.tgz.asc</span><br><span class="line"></span><br><span class="line">gpg -v --keyserver hkps://keyserver.ubuntu.com --verify harbor-offline-installer-version.tgz.asc</span><br></pre></td></tr></table></figure>


<p>解压文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ tar -xvzf harbor-online-installer-v2.8.2.tgz</span><br><span class="line">harbor/prepare</span><br><span class="line">harbor/LICENSE</span><br><span class="line">harbor/install.sh</span><br><span class="line">harbor/common.sh</span><br><span class="line">harbor/harbor.yml.tmpl</span><br><span class="line"></span><br><span class="line"># 可以看到解压后文件内容：</span><br><span class="line">tree</span><br><span class="line">├── harbor</span><br><span class="line">│   ├── common.sh</span><br><span class="line">│   ├── harbor.yml.tmpl</span><br><span class="line">│   ├── install.sh</span><br><span class="line">│   ├── LICENSE</span><br><span class="line">│   └── prepare</span><br><span class="line">├── harbor-offline-installer-v2.8.2.tgz</span><br><span class="line">└── harbor-online-installer-v2.8.2.tgz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="配置-HTTPS-去访问-Harbor"><a href="#配置-HTTPS-去访问-Harbor" class="headerlink" title="配置 HTTPS 去访问 Harbor"></a>配置 HTTPS 去访问 Harbor</h1><p>若要配置HTTPS，必须创建SSL证书。您可以使用由受信任的第三方CA签名的证书，也可以使用自签名证书。本节介绍如何使用OpenSSL创建CA，以及如何使用CA对服务器证书和客户端证书进行签名。您可以使用其他CA提供程序，例如Let’s Encrypt。</p>
<h2 id="生成证书"><a href="#生成证书" class="headerlink" title="生成证书"></a>生成证书</h2><pre><code>在生产环境中，您应该从CA获得证书。在测试或开发环境中，可以生成自己的CA。若要生成CA证书，请运行以下命令。 
</code></pre>
<p>Generate a CA certificate private key.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out ca.key 4096</span><br></pre></td></tr></table></figure>


<p>Generate the CA certificate.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssl req -x509 -new -nodes -sha512 -days 3650 \</span><br><span class="line"> -subj &quot;/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=yourdomain.com&quot; \</span><br><span class="line"> -key ca.key \</span><br><span class="line"> -out ca.crt</span><br></pre></td></tr></table></figure>


<h2 id="生成服务器证书"><a href="#生成服务器证书" class="headerlink" title="生成服务器证书"></a>生成服务器证书</h2><pre><code> 证书通常包含.crt文件和.key文件，例如yourdomain.com.crt和yourdomain.com.key。 
</code></pre>
<p>生成私钥文件 Generate a private key.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out yourdomain.com.key 4096</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>生成 csr 文件 Generate a certificate signing request (CSR).</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">openssl req -sha512 -new \</span><br><span class="line">    -subj &quot;/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=yourdomain.com&quot; \</span><br><span class="line">    -key yourdomain.com.key \</span><br><span class="line">    -out yourdomain.com.csr</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>生成 x509 v3 文件</p>
<p>Generate an x509 v3 extension file.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; v3.ext &lt;&lt;-EOF</span><br><span class="line">authorityKeyIdentifier=keyid,issuer</span><br><span class="line">basicConstraints=CA:FALSE</span><br><span class="line">keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</span><br><span class="line">extendedKeyUsage = serverAuth</span><br><span class="line">subjectAltName = @alt_names</span><br><span class="line"></span><br><span class="line">[alt_names]</span><br><span class="line">DNS.1=yourdomain.com</span><br><span class="line">DNS.2=yourdomain</span><br><span class="line">DNS.3=hostname</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>生成 crt 文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -sha512 -days 3650 \</span><br><span class="line">    -extfile v3.ext \</span><br><span class="line">    -CA ca.crt -CAkey ca.key -CAcreateserial \</span><br><span class="line">    -in yourdomain.com.csr \</span><br><span class="line">    -out yourdomain.com.crt</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="配置证书到服务器上"><a href="#配置证书到服务器上" class="headerlink" title="配置证书到服务器上"></a>配置证书到服务器上</h2><p>需要 ca.crt, yourdomain.com.crt, and yourdomain.com.key 文件到 harbor，docker 等上</p>
<p>复制 crt， key 文件到 harbor 服务器上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp yourdomain.com.crt /data/cert/</span><br><span class="line">cp yourdomain.com.key /data/cert/</span><br></pre></td></tr></table></figure>

<p>转换生成 cert 文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -inform PEM -in yourdomain.com.crt -out yourdomain.com.cert</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<pre><code>将您的domain.com.crt转换为yourdomain.com.cert，供Docker使用。
Docker守护进程将.crt文件解释为CA证书，将.cert文件解释为客户端证书。
</code></pre>
<p>复制 cert， key， ca.crt 文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp yourdomain.com.cert /etc/docker/certs.d/yourdomain.com/</span><br><span class="line">cp yourdomain.com.key /etc/docker/certs.d/yourdomain.com/</span><br><span class="line">cp ca.crt /etc/docker/certs.d/yourdomain.com/</span><br></pre></td></tr></table></figure>


<pre><code>如果 默认的nginx端口443映射到不同的端口，
请创建文件夹/etc/docker/certs.d/yourdomain.com:port
或/etc/docker/certs.d/harbor_IP:port。 
</code></pre>
<p>重启 docker 服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/etc/docker/certs.d/</span><br><span class="line">    └── yourdomain.com:port</span><br><span class="line">       ├── yourdomain.com.cert  &lt;-- Server certificate signed by CA</span><br><span class="line">       ├── yourdomain.com.key   &lt;-- Server key signed by CA</span><br><span class="line">       └── ca.crt               &lt;-- Certificate authority that signed the registry certificate</span><br></pre></td></tr></table></figure>


<h2 id="重新部署或者重新配置-harbor的情况"><a href="#重新部署或者重新配置-harbor的情况" class="headerlink" title="重新部署或者重新配置 harbor的情况"></a>重新部署或者重新配置 harbor的情况</h2><p>如果你已经部署了harbor，但是采用的http协议的，需要如下操作</p>
<p>重新执行  prepare 脚本，去开启 https 配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./prepare</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果harbor 正在运行，需要关闭掉，移除掉</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose down -v</span><br></pre></td></tr></table></figure>

<p>重启 harbor</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<h2 id="确认https是否可以正常访问"><a href="#确认https是否可以正常访问" class="headerlink" title="确认https是否可以正常访问"></a>确认https是否可以正常访问</h2><p>浏览器 打开 <a target="_blank" rel="noopener" href="https://yourdomain.com,如果能正常访问说明配置没问题了./">https://yourdomain.com，如果能正常访问说明配置没问题了。</a></p>
<p>查看其他docker实例机器上&#x2F;etc&#x2F;docker&#x2F;daemon.json文件 没有配置上 -insecure-registry   <a target="_blank" rel="noopener" href="https://yourdomain.com.,/">https://yourdomain.com.，</a> 并且 docker login yourdomain.com 可以正常登录，这样说明配置没问题了。</p>
<p>如果你的https端口默认不是 443 ，使用 docker login yourdomain.com:port 登录。</p>
<h1 id="配置-Harbor-YML-文件"><a href="#配置-Harbor-YML-文件" class="headerlink" title="配置 Harbor YML 文件"></a>配置 Harbor YML 文件</h1><p>主要配置 如下 几个地方</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">域名</span><br><span class="line">hostname: reg.mydomain.com</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">证书</span><br><span class="line">certificate: /your/certificate/path</span><br><span class="line">private_key: /your/private/key/path </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">管理员密码，</span><br><span class="line">harbor_admin_password</span><br><span class="line"></span><br><span class="line">数据存储的位置 </span><br><span class="line">data_volume: /data</span><br></pre></td></tr></table></figure>

<h1 id="配置harbor内部组件之间通信使用-tls"><a href="#配置harbor内部组件之间通信使用-tls" class="headerlink" title="配置harbor内部组件之间通信使用 tls"></a>配置harbor内部组件之间通信使用 tls</h1><h1 id="执行安装脚本"><a href="#执行安装脚本" class="headerlink" title="执行安装脚本"></a>执行安装脚本</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Harbor安装环境预处理</span><br><span class="line">./prepare</span><br><span class="line"></span><br><span class="line"># 安装并启动Harbor</span><br><span class="line">./install.sh</span><br><span class="line"></span><br><span class="line"># 检查是否安装成功（应该是启动9个容器）要在harbor目录下操作，否则docker-compose会又问题；</span><br><span class="line">docker-compose ps</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="其他参考"><a href="#其他参考" class="headerlink" title="其他参考"></a>其他参考</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/kevingrace/p/6547616.html">https://www.cnblogs.com/kevingrace/p/6547616.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.qikqiak.com/post/harbor-code-analysis/">https://www.qikqiak.com/post/harbor-code-analysis/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/leffss/p/15621165.html">https://www.cnblogs.com/leffss/p/15621165.html</a></p>
<p><a target="_blank" rel="noopener" href="https://xie.infoq.cn/article/faa9ee456452891828cc080b8">https://xie.infoq.cn/article/faa9ee456452891828cc080b8</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://magesfc.github.io">mage</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://magesfc.github.io/mage/68d7b1dd29e1dbef2bda325151ad5ee39f9980c1/">https://magesfc.github.io/mage/68d7b1dd29e1dbef2bda325151ad5ee39f9980c1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://magesfc.github.io" target="_blank">马哥私房菜</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/harbor/">harbor</a></div><div class="post_share"><div class="social-share" data-image="https://t.mwm.moe/fj/" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/null" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/null" alt="支付寶"/></a><div class="post-qr-code-desc">支付寶</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/mage/64aa5aff5028b66fde1c4d99fabd89113f42a31a/"><img class="prev-cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Docker学习之安装docker</div></div></a></div><div class="next-post pull-right"><a href="/mage/59f7e0dd63137ba3f746fd695ac41ce6ff273a8e/"><img class="next-cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Vue学习之vue3快速上手（尚硅谷）</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">mage</div><div class="author-info__description"> 这里是 马哥 的个人博客 </div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">217</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">233</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">40</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mamh2021"><i class="fab fa-github"></i><span>GitHub</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/mamh2021" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Harbor-Installation-and-Configuration"><span class="toc-number">1.</span> <span class="toc-text">Harbor Installation and Configuration </span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#harbor-%E5%AE%89%E8%A3%85%E6%9D%A1%E4%BB%B6"><span class="toc-number">2.</span> <span class="toc-text">harbor 安装条件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E6%9D%A1%E4%BB%B6-Hardware"><span class="toc-number">2.1.</span> <span class="toc-text">硬件条件 Hardware</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E6%9D%A1%E4%BB%B6-Software"><span class="toc-number">2.2.</span> <span class="toc-text">软件条件 Software</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%AB%AF%E5%8F%A3%E6%9D%A1%E4%BB%B6-Network-ports"><span class="toc-number">2.3.</span> <span class="toc-text">网络端口条件 Network ports</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD-Harbor-Installer"><span class="toc-number">3.</span> <span class="toc-text">下载 Harbor Installer</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-HTTPS-%E5%8E%BB%E8%AE%BF%E9%97%AE-Harbor"><span class="toc-number">4.</span> <span class="toc-text">配置 HTTPS 去访问 Harbor</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E8%AF%81%E4%B9%A6"><span class="toc-number">4.1.</span> <span class="toc-text">生成证书</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%AF%81%E4%B9%A6"><span class="toc-number">4.2.</span> <span class="toc-text">生成服务器证书</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%AF%81%E4%B9%A6%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A"><span class="toc-number">4.3.</span> <span class="toc-text">配置证书到服务器上</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E6%96%B0%E9%83%A8%E7%BD%B2%E6%88%96%E8%80%85%E9%87%8D%E6%96%B0%E9%85%8D%E7%BD%AE-harbor%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-number">4.4.</span> <span class="toc-text">重新部署或者重新配置 harbor的情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AE%E8%AE%A4https%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E6%AD%A3%E5%B8%B8%E8%AE%BF%E9%97%AE"><span class="toc-number">4.5.</span> <span class="toc-text">确认https是否可以正常访问</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-Harbor-YML-%E6%96%87%E4%BB%B6"><span class="toc-number">5.</span> <span class="toc-text">配置 Harbor YML 文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEharbor%E5%86%85%E9%83%A8%E7%BB%84%E4%BB%B6%E4%B9%8B%E9%97%B4%E9%80%9A%E4%BF%A1%E4%BD%BF%E7%94%A8-tls"><span class="toc-number">6.</span> <span class="toc-text">配置harbor内部组件之间通信使用 tls</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%AE%89%E8%A3%85%E8%84%9A%E6%9C%AC"><span class="toc-number">7.</span> <span class="toc-text">执行安装脚本</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%8F%82%E8%80%83"><span class="toc-number">8.</span> <span class="toc-text">其他参考</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/mage/ee6e53b9fbe2f10991d150675f0b88ed427b1150/" title="Android下的配置管理之道之repo-diffmanifests源码分析"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android下的配置管理之道之repo-diffmanifests源码分析"/></a><div class="content"><a class="title" href="/mage/ee6e53b9fbe2f10991d150675f0b88ed427b1150/" title="Android下的配置管理之道之repo-diffmanifests源码分析">Android下的配置管理之道之repo-diffmanifests源码分析</a><time datetime="2024-05-18T12:32:43.000Z" title="更新于 2024-05-18 20:32:43">2024-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/a52bd2f9ab320c603de205368472b5caa19b7207/" title="Android下的配置管理之道之repo-sync源码分析"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Android下的配置管理之道之repo-sync源码分析"/></a><div class="content"><a class="title" href="/mage/a52bd2f9ab320c603de205368472b5caa19b7207/" title="Android下的配置管理之道之repo-sync源码分析">Android下的配置管理之道之repo-sync源码分析</a><time datetime="2024-05-18T02:15:08.000Z" title="更新于 2024-05-18 10:15:08">2024-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/0bd8125569ad5e0222f4ca4e90e626be2ee24c26/" title="Jenkins学习之DataBoundConstructor和DataBoundSetter"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Jenkins学习之DataBoundConstructor和DataBoundSetter"/></a><div class="content"><a class="title" href="/mage/0bd8125569ad5e0222f4ca4e90e626be2ee24c26/" title="Jenkins学习之DataBoundConstructor和DataBoundSetter">Jenkins学习之DataBoundConstructor和DataBoundSetter</a><time datetime="2024-03-31T06:28:23.000Z" title="更新于 2024-03-31 14:28:23">2024-03-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/4b00a873b39948044a79c7e53eedd63d7af0bfa6/" title="Docker学习之安装docker-swarm集群"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker学习之安装docker-swarm集群"/></a><div class="content"><a class="title" href="/mage/4b00a873b39948044a79c7e53eedd63d7af0bfa6/" title="Docker学习之安装docker-swarm集群">Docker学习之安装docker-swarm集群</a><time datetime="2024-03-31T06:28:19.000Z" title="更新于 2024-03-31 14:28:19">2024-03-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/44f033ce59a71a67f64e3c2e330151f82f8754f4/" title="Jenkins学习之master服务器安装使用docker安装"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Jenkins学习之master服务器安装使用docker安装"/></a><div class="content"><a class="title" href="/mage/44f033ce59a71a67f64e3c2e330151f82f8754f4/" title="Jenkins学习之master服务器安装使用docker安装">Jenkins学习之master服务器安装使用docker安装</a><time datetime="2024-03-24T03:25:01.000Z" title="更新于 2024-03-24 11:25:01">2024-03-24</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://t.mwm.moe/fj/')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2024 By mage</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>