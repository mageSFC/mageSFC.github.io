<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Ubuntu学习笔记之调试Samba | 马哥私房菜</title><meta name="author" content="mage"><meta name="copyright" content="mage"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="调试samba前言我们工作中经常的会使用samba。 但是出现一个棘手的问题我们应该怎么办呢？网上查资料查解决方案？ 还是自己下一套samba的源码分析一番呢？  本文介绍了工作中遇到的一个问题。 然后通过查看源码来分析为什么会出这个错误。 以及最后应该怎么解决这个错误。   参考https:&#x2F;&#x2F;wiki.ubuntu.com&#x2F;DebuggingSamba这个。 我们先看看这个wiki上介绍的怎么">
<meta property="og:type" content="article">
<meta property="og:title" content="Ubuntu学习笔记之调试Samba">
<meta property="og:url" content="https://magesfc.github.io/mage/0f82a538ae2222b1e1f51fa097614ce2767185b6/">
<meta property="og:site_name" content="马哥私房菜">
<meta property="og:description" content="调试samba前言我们工作中经常的会使用samba。 但是出现一个棘手的问题我们应该怎么办呢？网上查资料查解决方案？ 还是自己下一套samba的源码分析一番呢？  本文介绍了工作中遇到的一个问题。 然后通过查看源码来分析为什么会出这个错误。 以及最后应该怎么解决这个错误。   参考https:&#x2F;&#x2F;wiki.ubuntu.com&#x2F;DebuggingSamba这个。 我们先看看这个wiki上介绍的怎么">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg">
<meta property="article:published_time" content="2022-02-23T09:47:22.000Z">
<meta property="article:modified_time" content="2022-11-08T06:12:35.000Z">
<meta property="article:author" content="mage">
<meta property="article:tag" content="ubuntu">
<meta property="article:tag" content="samba">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg"><link rel="shortcut icon" href="http://www.blackshark.com/favicon.ico"><link rel="canonical" href="https://magesfc.github.io/mage/0f82a538ae2222b1e1f51fa097614ce2767185b6/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: mage","link":"链接: ","source":"来源: 马哥私房菜","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Ubuntu学习笔记之调试Samba',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-08 14:12:35'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><style type="text/css">.card-announcement .social-button{margin:.6rem 0 0 0;text-align:center}.card-announcement .social-button a{display:block;background-color:var(--btn-bg);color:var(--btn-color);text-align:center;line-height:2.4;margin:4px 0}.card-announcement .social-button a:hover{background-color:var(--btn-hover-color)}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">167</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">185</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">34</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 精选文档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/21cfbf15/"><span> 🚀 快速开始</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/dc584b87/"><span> 📑 主题页面</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4aa8abbe/"><span> 🛠 主题配置-1</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/ceeb73f/"><span> 🛠 主题配置-2</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/98d20436/"><span> ❓ 主题问答</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4073eda/"><span> ⚡️ 进阶教程</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/198a4240/"><span> ✨ 更新日志</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://butterfly.js.org/link/"><i class="fa-fw fas fa-thumbs-up"></i><span> 其他示例</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">马哥私房菜</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 精选文档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/21cfbf15/"><span> 🚀 快速开始</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/dc584b87/"><span> 📑 主题页面</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4aa8abbe/"><span> 🛠 主题配置-1</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/ceeb73f/"><span> 🛠 主题配置-2</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/98d20436/"><span> ❓ 主题问答</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4073eda/"><span> ⚡️ 进阶教程</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/198a4240/"><span> ✨ 更新日志</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://butterfly.js.org/link/"><i class="fa-fw fas fa-thumbs-up"></i><span> 其他示例</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Ubuntu学习笔记之调试Samba</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-02-23T09:47:22.000Z" title="发表于 2022-02-23 17:47:22">2022-02-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-08T06:12:35.000Z" title="更新于 2022-11-08 14:12:35">2022-11-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ubuntu/">ubuntu</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Ubuntu学习笔记之调试Samba"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="调试samba"><a href="#调试samba" class="headerlink" title="调试samba"></a>调试samba</h1><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><pre><code>我们工作中经常的会使用samba。
但是出现一个棘手的问题我们应该怎么办呢？网上查资料查解决方案？
还是自己下一套samba的源码分析一番呢？

本文介绍了工作中遇到的一个问题。
然后通过查看源码来分析为什么会出这个错误。
以及最后应该怎么解决这个错误。


参考https://wiki.ubuntu.com/DebuggingSamba这个。
我们先看看这个wiki上介绍的怎么调试samba的吧
</code></pre>
<h1 id="Introduction（介绍）"><a href="#Introduction（介绍）" class="headerlink" title="Introduction（介绍）"></a>Introduction（介绍）</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Samba is a complex package, because it covers a wide range of use cases and provides lots of different binary packages.</span><br><span class="line"></span><br><span class="line">Bugs relating to the samba source package typically fall into one of the following categories:（一般分为下面几种场景）</span><br><span class="line"></span><br><span class="line">1.User cannot connect to (or properly access files on) a remote share from his Ubuntu system. This falls under the category of samba as a client.</span><br><span class="line"></span><br><span class="line">2.Other systems cannot connect to (or properly access files on) an Ubuntu system providing samba shares. This may be an issue with samba as a server.</span><br><span class="line"></span><br><span class="line">3.Install/upgrade failures of the samba packages.</span><br><span class="line"></span><br><span class="line">4.libpam-smbpass specific issues. Sharing a folder from the GUI installs libpam-smbpass, which stacks a PAM module that maintains sync between system and samba passwords. Failure in libpam-smbpass may result in inability to login on the system.</span><br><span class="line"></span><br><span class="line">5.winbind specific issues. Winbind allows to get user/group info from a Windows DC. It is sometimes installed by unsuspecting users as a recommended package from Wine.</span><br><span class="line"></span><br><span class="line">Also, it is a very good idea to have a look at the official Samba HOWTO. You will find there not only a how-to, but also common errors.</span><br></pre></td></tr></table></figure>


<h1 id="How-to-file（如何定位哪个）"><a href="#How-to-file（如何定位哪个）" class="headerlink" title="How to file（如何定位哪个）"></a>How to file（如何定位哪个）</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">First figure out if the bug falls under one of the generic categories:</span><br><span class="line"></span><br><span class="line">1.samba as a client</span><br><span class="line"></span><br><span class="line">2.samba as a server</span><br><span class="line"></span><br><span class="line">3.install/upgrade failure</span><br><span class="line"></span><br><span class="line">4.libpam-smbpass related</span><br><span class="line"></span><br><span class="line">5.winbind related</span><br></pre></td></tr></table></figure>

<h1 id="Samba-as-a-client（samba作为客户端来使用）"><a href="#Samba-as-a-client（samba作为客户端来使用）" class="headerlink" title="Samba as a client（samba作为客户端来使用）"></a>Samba as a client（samba作为客户端来使用）</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">IS IT A REGRESSION ?</span><br><span class="line">Did this use to work properly with a previous release ?</span><br><span class="line"></span><br><span class="line">WHAT VERSION OF SAMBA PACKAGES ARE USED ?</span><br><span class="line">Please give the output of:</span><br><span class="line"></span><br><span class="line">dpkg-query -W -f=&#x27;$&#123;Package&#125; $&#123;Version&#125; $&#123;Source&#125; $&#123;Status&#125;\n&#x27; | grep samba</span><br><span class="line">HOW IS THE REMOTE SHARE ACCESSED FROM THE UBUNTU SYSTEM?</span><br><span class="line">nautilus (or other GUI client)</span><br><span class="line">smbclient (from the command line)</span><br><span class="line">cifs filesystem mount (from /etc/fstab or a mount command)</span><br><span class="line">IF NAUTILUS (OR ANOTHER GUI CLIENT) IS USED TO ACCESS THE REMOTE SHARE, CAN THE SHARE BE ACCESSED WITH THE SMBCLIENT COMMAND LINE UTILITY ?</span><br><span class="line">To test:</span><br><span class="line"></span><br><span class="line">install the samba-client package</span><br><span class="line">try to connect to the remote system from the command line:</span><br><span class="line"></span><br><span class="line">smbclient //remote_system/share_name</span><br><span class="line">If the share requires a specific username/password, try using the &quot;-U&quot; parameter (for example, use &quot;-U ntdomain\\user&quot;).</span><br><span class="line"></span><br><span class="line">IF A CIFS MOUNT IS USED</span><br><span class="line">In that case please also provide:</span><br><span class="line"></span><br><span class="line">the content of the file /etc/fstab, or the command line used to mount the remote share if the share is manually mounted.</span><br><span class="line"></span><br><span class="line">the content of the file /proc/fs/cifs/DebugData</span><br><span class="line"></span><br><span class="line">WHAT IS THE REMOTE SERVER ?</span><br><span class="line">In all cases, please include the output of the following smbclient command:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">smbclient -L //remote_system</span><br><span class="line">This should give us the remote server version. Also include on what kind of machine the share is located (Windows 2003 Server, Ubuntu 8.04, NAS box model...)</span><br></pre></td></tr></table></figure>

<h1 id="Samba-as-a-server（samba作为服务端来使用）"><a href="#Samba-as-a-server（samba作为服务端来使用）" class="headerlink" title="Samba as a server（samba作为服务端来使用）"></a>Samba as a server（samba作为服务端来使用）</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">IS IT A REGRESSION ?</span><br><span class="line">Did this use to work properly with a previous release ?</span><br><span class="line"></span><br><span class="line">WHAT VERSION OF SAMBA PACKAGES ARE USED ?</span><br><span class="line">Please give the output of:</span><br><span class="line"></span><br><span class="line">dpkg-query -W -f=&#x27;$&#123;Package&#125; $&#123;Version&#125; $&#123;Source&#125; $&#123;Status&#125;\n&#x27; | grep samba</span><br><span class="line">WHICH CLIENTS ARE FAILING TO CONNECT?</span><br><span class="line">Include the operating system (Windows, Ubuntu) and version (XP, Vista, 8.04) of the client systems failing to connect to the share.</span><br><span class="line"></span><br><span class="line">WHAT IS THE ERROR MESSAGE PRODUCED ON THE CLIENT?</span><br><span class="line">OTHER INFORMATION TO INCLUDE</span><br><span class="line">the content of the /etc/samba/smb.conf file</span><br><span class="line"></span><br><span class="line">log files found in /var/log/samba/</span><br><span class="line"></span><br><span class="line">the output of the smbclient -L //server/</span><br><span class="line"></span><br><span class="line">the output of testparm -s</span><br></pre></td></tr></table></figure>

<h1 id="Install-x2F-upgrade-failure（安装、升级时候报错）"><a href="#Install-x2F-upgrade-failure（安装、升级时候报错）" class="headerlink" title="Install&#x2F;upgrade failure（安装、升级时候报错）"></a>Install&#x2F;upgrade failure（安装、升级时候报错）</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">STATUS OF SAMBA PACKAGES ON THE SYSTEM</span><br><span class="line">Please give the output of:</span><br><span class="line"></span><br><span class="line">dpkg-query -W -f=&#x27;$&#123;Package&#125; $&#123;Version&#125; $&#123;Source&#125; $&#123;Status&#125;\n&#x27; | grep samba</span><br><span class="line">OTHER INFORMATION TO INCLUDE</span><br><span class="line">apt and dpkg log files: /var/log/dpkg.log and /var/log/apt/term.log.</span><br><span class="line"></span><br><span class="line">/etc/samba/smb.conf (or absence thereof)</span><br><span class="line"></span><br><span class="line">In the case of an upgrade was there a prompt for a modified configuration file? If so what steps were taken.</span><br></pre></td></tr></table></figure>


<h1 id="How-to-Triage（如何识别错误分类）"><a href="#How-to-Triage（如何识别错误分类）" class="headerlink" title="How to Triage（如何识别错误分类）"></a>How to Triage（如何识别错误分类）</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Identify if the bug falls in one of the generic categories above. If so make sure that the relevant information is available. If not ask for it using one of the stock replies.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Samba as a client</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">If nautilus fails to connect but smbclient can successfully connect, the bug is related to nautilus. Mark the samba task Invalid and open a new task for nautilus.</span><br><span class="line"></span><br><span class="line">If both nautilus and smbclient can not connect, the bug is related to samba.</span><br><span class="line"></span><br><span class="line">If cifs cannot connect the bug might be related to CIFS kernelspace (package linux) or userspace (package samba). In doubt, leave it in samba.</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="Stock-Reply（回复）"><a href="#Stock-Reply（回复）" class="headerlink" title="Stock Reply（回复）"></a>Stock Reply（回复）</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">SAMBA AS A CLIENT</span><br><span class="line">Use this reply if an Ubuntu system cannot access a remote samba/windows share.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Thank you for taking the time to report this bug and helping to make Ubuntu better. Unfortunately we can&#x27;t fix it without more information. </span><br><span class="line"></span><br><span class="line">Please include the information requested at https://wiki.ubuntu.com/DebuggingSamba#samba-client.</span><br><span class="line">SAMBA AS A SERVER</span><br><span class="line">Use this reply if remote clients cannot access a share provided by an Ubuntu system.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Thank you for taking the time to report this bug and helping to make Ubuntu better. Unfortunately we can&#x27;t fix it without more information. </span><br><span class="line"></span><br><span class="line">Please include the information requested at https://wiki.ubuntu.com/DebuggingSamba#samba-server.</span><br><span class="line">INSTALL/UPGRADE FAILURE</span><br><span class="line">Use this reply if there is a package installation/upgrade failure on the Ubuntu system.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Thank you for taking the time to report this bug and helping to make Ubuntu better. Unfortunately we can&#x27;t fix it without more information. </span><br><span class="line"></span><br><span class="line">Please include the information requested at https://wiki.ubuntu.com/DebuggingSamba#samba-pkg-fail.</span><br></pre></td></tr></table></figure>










<h1 id="Non-bugs（没有bug？）"><a href="#Non-bugs（没有bug？）" class="headerlink" title="Non-bugs（没有bug？）"></a>Non-bugs（没有bug？）</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Install/upgrade failure due to missing /etc/samba/smb.conf file</span><br><span class="line">HOW TO RECOGNIZE IT</span><br><span class="line">This is a case of install/upgrade failure that results in the following error message (potentially translated):</span><br><span class="line"></span><br><span class="line">package samba-common &lt;version&gt; failed to install/upgrade: subprocess post-installation script returned error exit status 1</span><br><span class="line">The DpkgTerminalLog.gz (or /var/log/apt/term.log) contains the following message:</span><br><span class="line"></span><br><span class="line">Not replacing deleted config file /etc/samba/smb.conf</span><br><span class="line">chmod: cannot access `/etc/samba/smb.conf&#x27;: No such file or directory</span><br><span class="line">The user should not be able to provide any /etc/samba/smb.conf file, since it is missing.</span><br><span class="line"></span><br><span class="line">STOCK ANSWER</span><br><span class="line"></span><br><span class="line">Thank you for taking the time to report this bug and helping to make Ubuntu better.</span><br><span class="line"></span><br><span class="line">It looks like you manually removed /etc/samba/smb.conf before reinstalling/upgrading samba packages. Configuration files are special files that should be purged by running &quot;apt-get purge&quot;, not manually removed.</span><br><span class="line"></span><br><span class="line">You can recover from this situation by restoring /etc/samba/smb.conf and restart pending package configuration:</span><br><span class="line">$ sudo cp /usr/share/samba/smb.conf /etc/samba/smb.conf</span><br><span class="line">$ sudo dpkg --configure -a</span><br><span class="line"></span><br><span class="line">Alternatively, you can purge samba-common completely and attempt the install/upgrade again:</span><br><span class="line">$ sudo apt-get purge samba-common</span><br><span class="line"></span><br><span class="line">This bug will be marked as Invalid: please reopen it if the above steps do not resolve the situation for you. To reopen the bug report you can click on the current status, under the Status column, and change the Status back to &quot;New&quot;. Thanks again!</span><br><span class="line">Close the bug report as Invalid.</span><br></pre></td></tr></table></figure>

<h1 id="报错日志"><a href="#报错日志" class="headerlink" title="报错日志"></a>报错日志</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">log.commu-pc:[2020/03/04 15:14:02.169275,  0] ../source3/auth/auth_domain.c:226(domain_client_validate)</span><br><span class="line">log.commu-pc:  domain_client_validate: unable to validate password for user xxx in domain xxx to Domain controller AD-03.XXXX.COM. Error was NT_STATUS_ACCESS_DENIED.</span><br><span class="line">log.commu-pc:[2020/03/04 15:14:09.504618,  0] ../source3/auth/auth_domain.c:226(domain_client_validate)</span><br><span class="line">log.commu-pc:  domain_client_validate: unable to validate password for user xxx in domain xxx to Domain controller AD-03.XXXX.COM. Error was NT_STATUS_ACCESS_DENIED.</span><br><span class="line">log.commu-pc:[2020/03/04 15:14:10.669048,  0] ../source3/auth/auth_domain.c:226(domain_client_validate)</span><br><span class="line">log.commu-pc:  domain_client_validate: unable to validate password for user xxx in domain xxx to Domain controller AD-03.XXXX.COM. Error was NT_STATUS_ACCESS_DENIED.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="分析："><a href="#分析：" class="headerlink" title="分析："></a>分析：</h2><pre><code>通过日志分析发现 都是 说 某个 user 在 domain controller ad-03 里面 验证密码时候出错。
报这个错误的时候也就是不能 访问 共享目录的时候。
不过这个错误 有时候出现，有时候就能访问共享。

我们的 samba 在Ubuntu上搭建，ubuntu 使用sssd 加入到 AD 域控里面了，
在 windows 上 直接访问 个人账号下面的共享目录是不需要输入密码直接打开的。
</code></pre>
<h2 id="确定samba的版本"><a href="#确定samba的版本" class="headerlink" title="确定samba的版本"></a>确定samba的版本</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> samba -V</span><br><span class="line">Version 4.7.6-Ubuntu</span><br></pre></td></tr></table></figure>

<h2 id="取得samba的源码的版本号"><a href="#取得samba的源码的版本号" class="headerlink" title="取得samba的源码的版本号"></a>取得samba的源码的版本号</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$  dpkg-query -W -f=&#x27;$&#123;Package&#125; $&#123;Version&#125; $&#123;Source&#125; $&#123;Status&#125;\n&#x27; | grep samba</span><br><span class="line"></span><br><span class="line">libsmbclient 2:4.7.6+dfsg~ubuntu-0ubuntu2.11 samba install ok installed</span><br><span class="line">libwbclient0 2:4.7.6+dfsg~ubuntu-0ubuntu2.11 samba install ok installed</span><br><span class="line">python-samba 2:4.7.6+dfsg~ubuntu-0ubuntu2.11 samba install ok installed</span><br><span class="line">samba 2:4.7.6+dfsg~ubuntu-0ubuntu2.11  install ok installed</span><br><span class="line">samba-common 2:4.7.6+dfsg~ubuntu-0ubuntu2.11 samba install ok installed</span><br><span class="line">samba-common-bin 2:4.7.6+dfsg~ubuntu-0ubuntu2.11 samba install ok installed</span><br><span class="line">samba-dsdb-modules 2:4.7.6+dfsg~ubuntu-0ubuntu2.11 samba install ok installed</span><br><span class="line">samba-libs 2:4.7.6+dfsg~ubuntu-0ubuntu2.11 samba install ok installed</span><br><span class="line">samba-vfs-modules 2:4.7.6+dfsg~ubuntu-0ubuntu2.11 samba install ok installed</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="下载源代码"><a href="#下载源代码" class="headerlink" title="下载源代码"></a>下载源代码</h2><p>克隆ubuntu上面的samba软件源代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git clone	https://git.launchpad.net/ubuntu/+source/samba (fetch)</span><br></pre></td></tr></table></figure>

<p>检出对应的tag的代码。这个tag就是通过上面的dpkg-query命令查出来的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git for-each-ref |grep &#x27;4.7.6.*2.11&#x27;</span><br><span class="line">5b83ed324fba2d49685a5527838ff1bfc8c387bd tag	refs/tags/import/2%4.7.6+dfsg_ubuntu-0ubuntu2.11</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="找到对应的报错日志行的代码-source3-x2F-auth-x2F-auth-domain-c"><a href="#找到对应的报错日志行的代码-source3-x2F-auth-x2F-auth-domain-c" class="headerlink" title="找到对应的报错日志行的代码 source3&#x2F;auth&#x2F;auth_domain.c"></a>找到对应的报错日志行的代码 source3&#x2F;auth&#x2F;auth_domain.c</h2><p>错误定位到domain_client_validate 这个方法里面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if (!NT_STATUS_IS_OK(nt_status)) &#123;</span><br><span class="line">	DEBUG(0,(&quot;domain_client_validate: unable to validate password &quot;</span><br><span class="line">                        &quot;for user %s in domain %s to Domain controller %s. &quot;</span><br><span class="line">                        &quot;Error was %s.\n&quot;, user_info-&gt;client.account_name,</span><br><span class="line">                        user_info-&gt;client.domain_name, dc_name,</span><br><span class="line">                        nt_errstr(nt_status)));</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>我们返现 ad-03 是 来自 dc_name 这个变量，</p>
<p>下面我们分析这个dc_name 是怎么来的，dc 估计就是 domain controller的缩写吧。</p>
<p>domain_client_validate 方法是在  check_trustdomain_security 中被调用了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">	fstring dc_name;</span><br><span class="line">	nt_status = domain_client_validate(mem_ctx,</span><br><span class="line">					   user_info,</span><br><span class="line">					   user_info-&gt;mapped.domain_name,</span><br><span class="line">					   (uchar *)auth_context-&gt;challenge.data,</span><br><span class="line">					   server_info,</span><br><span class="line">					   dc_name,</span><br><span class="line">					   &amp;dc_ss);</span><br><span class="line">其中的 dc_name 就是由 		get_dc_name 方法获得。dc_name 变量在方法开始 定义的。</span><br><span class="line">		if ( !get_dc_name(user_info-&gt;mapped.domain_name, NULL, dc_name, &amp;dc_ss) ) &#123;</span><br><span class="line">		DEBUG(5,(&quot;check_trustdomain_security: unable to locate a DC for domain %s\n&quot;,</span><br><span class="line">			user_info-&gt;mapped.domain_name));</span><br><span class="line">		return NT_STATUS_NO_LOGON_SERVERS;</span><br><span class="line">	&#125;</span><br><span class="line">		   </span><br></pre></td></tr></table></figure>

<h2 id="分析-get-dc-name-方法-source3-x2F-libsmb-x2F-namequery-dc-c"><a href="#分析-get-dc-name-方法-source3-x2F-libsmb-x2F-namequery-dc-c" class="headerlink" title="分析 get_dc_name 方法 source3&#x2F;libsmb&#x2F;namequery_dc.c"></a>分析 get_dc_name 方法 source3&#x2F;libsmb&#x2F;namequery_dc.c</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">bool get_dc_name(const char *domain,		const char *realm,		fstring srv_name,		struct sockaddr_storage *ss_out)</span><br><span class="line">&#123;</span><br><span class="line">	struct sockaddr_storage dc_ss;</span><br><span class="line">	bool ret;</span><br><span class="line">	bool our_domain = False;</span><br><span class="line"></span><br><span class="line">	zero_sockaddr(&amp;dc_ss);</span><br><span class="line"></span><br><span class="line">	ret = False;</span><br><span class="line"></span><br><span class="line">	if ( strequal(lp_workgroup(), domain) || strequal(lp_realm(), realm) )</span><br><span class="line">		our_domain = True;</span><br><span class="line"></span><br><span class="line">	/* always try to obey what the admin specified in smb.conf</span><br><span class="line">	   (for the local domain) */</span><br><span class="line"></span><br><span class="line">	if ( (our_domain &amp;&amp; lp_security()==SEC_ADS) || realm ) &#123;</span><br><span class="line">		ret = ads_dc_name(domain, realm, &amp;dc_ss, srv_name); // 走到这里调用了</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if (!domain) &#123;</span><br><span class="line">		/* if we have only the realm we can&#x27;t do anything else */</span><br><span class="line">		return False;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if (!ret) &#123;</span><br><span class="line">		/* fall back on rpc methods if the ADS methods fail */</span><br><span class="line">		ret = rpc_dc_name(domain, srv_name, &amp;dc_ss);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	*ss_out = dc_ss;</span><br><span class="line"></span><br><span class="line">	return ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">其中该方法的第1个参数 domain=xxxxx 。是通过下面的 log 打印推测出来的。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="ads-dc-name方法-source3-x2F-libsmb-x2F-namequery-dc-c"><a href="#ads-dc-name方法-source3-x2F-libsmb-x2F-namequery-dc-c" class="headerlink" title="ads_dc_name方法 source3&#x2F;libsmb&#x2F;namequery_dc.c"></a>ads_dc_name方法 source3&#x2F;libsmb&#x2F;namequery_dc.c</h2><p>再附加一段搜 dc-name的日志。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">./log.old:8332:[2020/03/09 14:49:11.416584,  4] ../source3/libsmb/namequery_dc.c:77(ads_dc_name)</span><br><span class="line">./log.old:8333:  ads_dc_name: domain=xxxxx</span><br><span class="line">./log.old:8422:[2020/03/09 14:49:11.477957,  4] ../source3/libsmb/namequery_dc.c:151(ads_dc_name)</span><br><span class="line">./log.old:8423:  ads_dc_name: using server=&#x27;DC01.xxxxx.COM&#x27; IP=192.168.151</span><br><span class="line">grep: ./cores: Permission denied</span><br><span class="line">./log:6136:[2020/03/09 15:26:59.059731,  4] ../source3/libsmb/namequery_dc.c:77(ads_dc_name)</span><br><span class="line">./log:6137:  ads_dc_name: domain=xxxxx</span><br><span class="line">./log:6234:[2020/03/09 15:26:59.226280,  4] ../source3/libsmb/namequery_dc.c:151(ads_dc_name)</span><br><span class="line">./log:6235:  ads_dc_name: using server=&#x27;NJDC.xxxxx.COM&#x27; IP=192.168.152</span><br><span class="line">$ grep dc_name -rni .</span><br><span class="line">./log.old:8332:[2020/03/09 14:49:11.416584,  4] ../source3/libsmb/namequery_dc.c:77(ads_dc_name)</span><br><span class="line">./log.old:8333:  ads_dc_name: domain=xxxxx</span><br><span class="line">./log.old:8422:[2020/03/09 14:49:11.477957,  4] ../source3/libsmb/namequery_dc.c:151(ads_dc_name)</span><br><span class="line">./log.old:8423:  ads_dc_name: using server=&#x27;DC01.xxxxx.COM&#x27; IP=192.168.151</span><br><span class="line">grep: ./cores: Permission denied</span><br><span class="line">./log:6136:[2020/03/09 15:26:59.059731,  4] ../source3/libsmb/namequery_dc.c:77(ads_dc_name)</span><br><span class="line">./log:6137:  ads_dc_name: domain=xxxxx</span><br><span class="line">./log:6234:[2020/03/09 15:26:59.226280,  4] ../source3/libsmb/namequery_dc.c:151(ads_dc_name)</span><br><span class="line">./log:6235:  ads_dc_name: using server=&#x27;NJDC.xxxxx.COM&#x27; IP=192.168.152</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>通过上面新增的日志我们看ads_dc_name方法。source3&#x2F;libsmb&#x2F;namequery_dc.c</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**********************************************************************</span><br><span class="line"> Is this our primary domain ?</span><br><span class="line">**********************************************************************/</span><br><span class="line"></span><br><span class="line">#ifdef HAVE_KRB5</span><br><span class="line">static bool is_our_primary_domain(const char *domain)</span><br><span class="line">&#123;</span><br><span class="line">	int role = lp_server_role();</span><br><span class="line"></span><br><span class="line">	if ((role == ROLE_DOMAIN_MEMBER) &amp;&amp; strequal(lp_workgroup(), domain)) &#123;</span><br><span class="line">		return True;</span><br><span class="line">	&#125; else if (strequal(get_global_sam_name(), domain)) &#123;</span><br><span class="line">		return True;</span><br><span class="line">	&#125;</span><br><span class="line">	return False;</span><br><span class="line">&#125;</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure>


<p>通过上面新增的日志我们看ads_dc_name方法。source3&#x2F;libsmb&#x2F;namequery_dc.c</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">/**************************************************************************</span><br><span class="line"> Find the name and IP address for a server in the realm/domain</span><br><span class="line"> *************************************************************************/</span><br><span class="line">其中该方法的第1个参数 domain=xxxxx 。是通过上面的 log 打印推测出来的。</span><br><span class="line">static bool ads_dc_name(const char *domain,			const char *realm,			struct sockaddr_storage *dc_ss,			fstring srv_name)</span><br><span class="line">&#123;</span><br><span class="line">	ADS_STRUCT *ads;</span><br><span class="line">	char *sitename;</span><br><span class="line">	int i;</span><br><span class="line">	char addr[INET6_ADDRSTRLEN];</span><br><span class="line"></span><br><span class="line">	if (!realm &amp;&amp; strequal(domain, lp_workgroup())) &#123;</span><br><span class="line">		realm = lp_realm();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	sitename = sitename_fetch(talloc_tos(), realm);</span><br><span class="line"></span><br><span class="line">	/* Try this 3 times then give up. */</span><br><span class="line">	for( i =0 ; i &lt; 3; i++) &#123;</span><br><span class="line">		ads = ads_init(realm, domain, NULL);</span><br><span class="line">		if (!ads) &#123;</span><br><span class="line">			TALLOC_FREE(sitename);</span><br><span class="line">			return False;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		DEBUG(4,(&quot;ads_dc_name: domain=%s\n&quot;, domain));</span><br><span class="line"></span><br><span class="line">#ifdef HAVE_ADS</span><br><span class="line">		/* we don&#x27;t need to bind, just connect */</span><br><span class="line">		ads-&gt;auth.flags |= ADS_AUTH_NO_BIND;</span><br><span class="line">		ads_connect(ads);</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">		if (!ads-&gt;config.realm) &#123;</span><br><span class="line">			TALLOC_FREE(sitename);</span><br><span class="line">			ads_destroy(&amp;ads);</span><br><span class="line">			return False;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		/* Now we&#x27;ve found a server, see if our sitename</span><br><span class="line">		   has changed. If so, we need to re-do the DNS query</span><br><span class="line">		   to ensure we only find servers in our site. */</span><br><span class="line"></span><br><span class="line">		if (stored_sitename_changed(realm, sitename)) &#123;</span><br><span class="line">			TALLOC_FREE(sitename);</span><br><span class="line">			sitename = sitename_fetch(talloc_tos(), realm);</span><br><span class="line">			ads_destroy(&amp;ads);</span><br><span class="line">			/* Ensure we don&#x27;t cache the DC we just connected to. */</span><br><span class="line">			namecache_delete(realm, 0x1C);</span><br><span class="line">			namecache_delete(domain, 0x1C);</span><br><span class="line">			continue;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">#ifdef HAVE_ADS</span><br><span class="line">		if (is_our_primary_domain(domain) &amp;&amp; (ads-&gt;config.flags &amp; NBT_SERVER_KDC)) &#123;</span><br><span class="line">			if (ads_closest_dc(ads)) &#123;</span><br><span class="line">				/* We&#x27;re going to use this KDC for this realm/domain.</span><br><span class="line">				   If we are using sites, then force the krb5 libs</span><br><span class="line">				   to use this KDC. */</span><br><span class="line"></span><br><span class="line">				create_local_private_krb5_conf_for_domain(realm,</span><br><span class="line">									domain,</span><br><span class="line">									sitename,</span><br><span class="line">									&amp;ads-&gt;ldap.ss);</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				create_local_private_krb5_conf_for_domain(realm,</span><br><span class="line">									domain,</span><br><span class="line">									NULL,</span><br><span class="line">									&amp;ads-&gt;ldap.ss);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">#endif</span><br><span class="line">		break;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if (i == 3) &#123;</span><br><span class="line">		DEBUG(1,(&quot;ads_dc_name: sitename (now \&quot;%s\&quot;) keeps changing ???\n&quot;,</span><br><span class="line">			sitename ? sitename : &quot;&quot;));</span><br><span class="line">		TALLOC_FREE(sitename);</span><br><span class="line">		ads_destroy(&amp;ads);</span><br><span class="line">		return False;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	TALLOC_FREE(sitename);</span><br><span class="line"></span><br><span class="line">	fstrcpy(srv_name, ads-&gt;config.ldap_server_name); // srv_name 这里从 ads-&gt;config.ldap_server_name 复制过去的一个字符串。</span><br><span class="line">	if (!strupper_m(srv_name)) &#123;</span><br><span class="line">		ads_destroy(&amp;ads);</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line">#ifdef HAVE_ADS</span><br><span class="line">	*dc_ss = ads-&gt;ldap.ss;</span><br><span class="line">#else</span><br><span class="line">	zero_sockaddr(dc_ss);</span><br><span class="line">#endif</span><br><span class="line">	ads_destroy(&amp;ads);</span><br><span class="line"></span><br><span class="line">	print_sockaddr(addr, sizeof(addr), dc_ss);</span><br><span class="line">	DEBUG(4,(&quot;ads_dc_name: using server=&#x27;%s&#x27; IP=%s\n&quot;,</span><br><span class="line">		 srv_name, addr));</span><br><span class="line"></span><br><span class="line">	return True;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="rpc-dc-name"><a href="#rpc-dc-name" class="headerlink" title="rpc_dc_name"></a>rpc_dc_name</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">/****************************************************************************</span><br><span class="line"> Utility function to return the name of a DC. The name is guaranteed to be</span><br><span class="line"> valid since we have already done a name_status_find on it</span><br><span class="line"> ***************************************************************************/</span><br><span class="line"></span><br><span class="line">static bool rpc_dc_name(const char *domain,</span><br><span class="line">			fstring srv_name,</span><br><span class="line">			struct sockaddr_storage *ss_out)</span><br><span class="line">&#123;</span><br><span class="line">	struct ip_service *ip_list = NULL;</span><br><span class="line">	struct sockaddr_storage dc_ss;</span><br><span class="line">	int count, i;</span><br><span class="line">	NTSTATUS result;</span><br><span class="line">	char addr[INET6_ADDRSTRLEN];</span><br><span class="line"></span><br><span class="line">	/* get a list of all domain controllers */</span><br><span class="line"></span><br><span class="line">	if (!NT_STATUS_IS_OK(get_sorted_dc_list(domain, NULL, &amp;ip_list, &amp;count,</span><br><span class="line">						False))) &#123;</span><br><span class="line">		DEBUG(3, (&quot;Could not look up dc&#x27;s for domain %s\n&quot;, domain));</span><br><span class="line">		return False;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/* Remove the entry we&#x27;ve already failed with (should be the PDC). */</span><br><span class="line"></span><br><span class="line">	for (i = 0; i &lt; count; i++) &#123;</span><br><span class="line">		if (is_zero_addr(&amp;ip_list[i].ss))</span><br><span class="line">			continue;</span><br><span class="line"></span><br><span class="line">		if (name_status_find(domain, 0x1c, 0x20, &amp;ip_list[i].ss, srv_name)) &#123;</span><br><span class="line">			result = check_negative_conn_cache( domain, srv_name );</span><br><span class="line">			if ( NT_STATUS_IS_OK(result) ) &#123;</span><br><span class="line">				dc_ss = ip_list[i].ss;</span><br><span class="line">				goto done;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	SAFE_FREE(ip_list);</span><br><span class="line"></span><br><span class="line">	/* No-one to talk to )-: */</span><br><span class="line">	return False;		/* Boo-hoo */</span><br><span class="line"></span><br><span class="line"> done:</span><br><span class="line">	/* We have the netbios name and IP address of a domain controller.</span><br><span class="line">	   Ideally we should sent a SAMLOGON request to determine whether</span><br><span class="line">	   the DC is alive and kicking.  If we can catch a dead DC before</span><br><span class="line">	   performing a cli_connect() we can avoid a 30-second timeout. */</span><br><span class="line"></span><br><span class="line">	print_sockaddr(addr, sizeof(addr), &amp;dc_ss);</span><br><span class="line">	DEBUG(3, (&quot;rpc_dc_name: Returning DC %s (%s) for domain %s\n&quot;, srv_name,</span><br><span class="line">		  addr, domain));</span><br><span class="line"></span><br><span class="line">	*ss_out = dc_ss;</span><br><span class="line">	SAFE_FREE(ip_list);</span><br><span class="line"></span><br><span class="line">	return True;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="debug-level-还可以大于11"><a href="#debug-level-还可以大于11" class="headerlink" title="debug level 还可以大于11"></a>debug level 还可以大于11</h2><p>发现debug level 还可以大于11呢。于是直接调到了20.输出如下日志。</p>
<p>ADS_STATUS ads_connect(ADS_STRUCT *ads) 方法中的一个调试输出。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">	if (DEBUGLEVEL &gt;= 11) &#123;</span><br><span class="line">		char *s = NDR_PRINT_STRUCT_STRING(talloc_tos(), ads_struct, ads);</span><br><span class="line">		DEBUG(11,(&quot;ads_connect: entering\n&quot;));</span><br><span class="line">		DEBUGADD(11,(&quot;%s\n&quot;, s));</span><br><span class="line">		TALLOC_FREE(s);</span><br><span class="line">	&#125;</span><br><span class="line">	通过代码发现 是 直接 dump出来了整个 ads_struct 结构体。</span><br><span class="line">log.old:  ads_connect: entering</span><br><span class="line">log.old-      ads: struct ads_struct</span><br><span class="line">log.old-          is_mine                  : true</span><br><span class="line">log.old-          ads: struct server</span><br><span class="line">log.old-              realm                    : &#x27;xxxx.COM&#x27;</span><br><span class="line">log.old-              workgroup                : &#x27;xxxxxx&#x27;</span><br><span class="line">log.old-              ldap_server              : NULL</span><br><span class="line">log.old-          ads: struct auth</span><br><span class="line">log.old-              realm                    : NULL</span><br><span class="line">log.old-              password                 : &#x27;(PASSWORD omitted)&#x27;</span><br><span class="line">log.old-              user_name                : NULL</span><br><span class="line">log.old-              kdc_server               : NULL</span><br><span class="line">log.old-              flags                    : 0x00000022 (34)</span><br><span class="line">log.old-                     0: ADS_AUTH_DISABLE_KERBEROS</span><br><span class="line">log.old-                     1: ADS_AUTH_NO_BIND         </span><br><span class="line">log.old-                     0: ADS_AUTH_ANON_BIND       </span><br><span class="line">log.old-                     0: ADS_AUTH_SIMPLE_BIND     </span><br><span class="line">log.old-                     0: ADS_AUTH_ALLOW_NTLMSSP   </span><br><span class="line">log.old-                     1: ADS_AUTH_SASL_SIGN       </span><br><span class="line">log.old-                     0: ADS_AUTH_SASL_SEAL       </span><br><span class="line">log.old-                     0: ADS_AUTH_SASL_FORCE      </span><br><span class="line">log.old-                     0: ADS_AUTH_USER_CREDS      </span><br><span class="line">log.old-              time_offset              : 0x00000000 (0)</span><br><span class="line">log.old-              tgt_expire               : (time_t)0</span><br><span class="line">log.old-              tgs_expire               : (time_t)0</span><br><span class="line">log.old-              renewable                : (time_t)0</span><br><span class="line">log.old-          ads: struct config</span><br><span class="line">log.old-              flags                    : 0x00000000 (0)</span><br><span class="line">log.old-                     0: DS_SERVER_PDC            </span><br><span class="line">log.old-                     0: DS_SERVER_GC             </span><br><span class="line">log.old-                     0: DS_SERVER_LDAP           </span><br><span class="line">log.old-                     0: DS_SERVER_DS             </span><br><span class="line">log.old-                     0: DS_SERVER_KDC            </span><br><span class="line">log.old-                     0: DS_SERVER_TIMESERV       </span><br><span class="line">log.old-                     0: DS_SERVER_CLOSEST        </span><br><span class="line">log.old-                     0: DS_SERVER_WRITABLE       </span><br><span class="line">log.old-                     0: DS_SERVER_GOOD_TIMESERV  </span><br><span class="line">log.old-                     0: DS_SERVER_NDNC           </span><br><span class="line">log.old-                     0: DS_SERVER_SELECT_SECRET_DOMAIN_6</span><br><span class="line">log.old-                     0: DS_SERVER_FULL_SECRET_DOMAIN_6</span><br><span class="line">log.old-                     0: DS_SERVER_WEBSERV        </span><br><span class="line">log.old-                     0: DS_SERVER_DS_8           </span><br><span class="line">log.old-                     0: DS_DNS_CONTROLLER        </span><br><span class="line">log.old-                     0: DS_DNS_DOMAIN            </span><br><span class="line">log.old-                     0: DS_DNS_FOREST_ROOT       </span><br><span class="line">log.old-              realm                    : NULL</span><br><span class="line">log.old-              bind_path                : NULL</span><br><span class="line">log.old-              ldap_server_name         : NULL</span><br><span class="line">log.old-              server_site_name         : NULL</span><br><span class="line">log.old-              client_site_name         : NULL</span><br><span class="line">log.old-              current_time             : (time_t)0</span><br><span class="line">log.old-              schema_path              : NULL</span><br><span class="line">log.old-              config_path              : NULL</span><br><span class="line">log.old-          ads: struct ldap</span><br><span class="line">log.old-              ld                       : NULL</span><br><span class="line">log.old-              ss                       : </span><br><span class="line">log.old-              last_attempt             : Tue Jan  6 07:57:53 AM 1970 CST</span><br><span class="line">log.old-              port                     : 0x00000000 (0)</span><br><span class="line">log.old-              saslwrap: struct saslwrap</span><br><span class="line">log.old-                  wrap_type                : 0x0001 (1)</span><br><span class="line">log.old-                  sbiod                    : NULL</span><br><span class="line">log.old-                  mem_ctx                  : NULL</span><br><span class="line">log.old-                  wrap_ops                 : NULL</span><br><span class="line">log.old-                  wrap_private_data        : NULL</span><br><span class="line">log.old-                  saslwrap: struct in</span><br><span class="line">log.old-                      ofs                      : 0x00000000 (0)</span><br><span class="line">log.old-                      needed                   : 0x00000000 (0)</span><br><span class="line">log.old-                      left                     : 0x00000000 (0)</span><br><span class="line">log.old-                      max_wrapped              : 0x00000000 (0)</span><br><span class="line">log.old-                      min_wrapped              : 0x00000000 (0)</span><br><span class="line">log.old-                      size                     : 0x00000000 (0)</span><br><span class="line">log.old-                      buf: ARRAY(0) : NULL</span><br><span class="line">log.old-                  saslwrap: struct out</span><br><span class="line">log.old-                      ofs                      : 0x00000000 (0)</span><br><span class="line">log.old-                      left                     : 0x00000000 (0)</span><br><span class="line">log.old-                      max_unwrapped            : 0x00000000 (0)</span><br><span class="line">log.old-                      sig_size                 : 0x00000000 (0)</span><br><span class="line">log.old-                      size                     : 0x00000000 (0)</span><br><span class="line">log.old-                      buf: ARRAY(0) : NULL</span><br><span class="line">log.old-  </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="再次分析到-resolve-and-ping-dns方法中"><a href="#再次分析到-resolve-and-ping-dns方法中" class="headerlink" title="再次分析到 resolve_and_ping_dns方法中"></a>再次分析到 resolve_and_ping_dns方法中</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">static NTSTATUS resolve_and_ping_dns(ADS_STRUCT *ads, const char *sitename,	 const char *realm)</span><br><span class="line">				     </span><br><span class="line">$ grep resolve_and_ping_dns log*</span><br><span class="line">log.old:[2020/03/09 17:33:45.894215,  6, pid=8229, effective(0, 0), real(0, 0)] ../source3/libads/ldap.c:419(resolve_and_ping_dns)</span><br><span class="line">log.old:  resolve_and_ping_dns: (cldap) looking for realm &#x27;xxx.COM&#x27;</span><br><span class="line">log.old:[2020/03/09 17:33:46.611538,  6, pid=8230, effective(0, 0), real(0, 0)] ../source3/libads/ldap.c:419(resolve_and_ping_dns)</span><br><span class="line">log.old:  resolve_and_ping_dns: (cldap) looking for realm &#x27;xxxx.COM&#x27;</span><br><span class="line">log.old:[2020/03/09 17:33:47.319183,  6, pid=8231, effective(0, 0), real(0, 0)] ../source3/libads/ldap.c:419(resolve_and_ping_dns)</span><br><span class="line">log.old:  resolve_and_ping_dns: (cldap) looking for realm &#x27;xxxxxxxx.COM&#x27;</span><br><span class="line">log.old:[2020/03/09 17:33:48.092824,  6, pid=8233, effective(0, 0), real(0, 0)] ../source3/libads/ldap.c:419(resolve_and_ping_dns)</span><br><span class="line">log.old:  resolve_and_ping_dns: (cldap) looking for realm &#x27;xxxx.COM&#x27;</span><br><span class="line">log.old:[2020/03/09 17:33:48.814634,  6, pid=8235, effective(0, 0), real(0, 0)] ../source3/libads/ldap.c:419(resolve_and_ping_dns)</span><br><span class="line">log.old:  resolve_and_ping_dns: (cldap) looking for realm &#x27;xxx.COM&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="再次分析，得到-get-sorted-dc-list-方法"><a href="#再次分析，得到-get-sorted-dc-list-方法" class="headerlink" title="再次分析，得到 get_sorted_dc_list 方法"></a>再次分析，得到 get_sorted_dc_list 方法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/*********************************************************************</span><br><span class="line"> Small wrapper function to get the DC list and sort it if neccessary.</span><br><span class="line">*********************************************************************/</span><br><span class="line"></span><br><span class="line">NTSTATUS get_sorted_dc_list( const char *domain,</span><br><span class="line">			const char *sitename,</span><br><span class="line">			struct ip_service **ip_list,</span><br><span class="line">			int *count,</span><br><span class="line">			bool ads_only )</span><br><span class="line">			</span><br><span class="line">$ grep get_sorted_dc_list log*</span><br><span class="line">log:[2020/03/09 17:41:53.921164,  8, pid=8313, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3355(get_sorted_dc_list)</span><br><span class="line">log:  get_sorted_dc_list: attempting lookup for name xxx.COM (sitename Default-First-Site-Name)</span><br><span class="line">log.old:[2020/03/09 17:41:49.792818,  8, pid=8308, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3355(get_sorted_dc_list)</span><br><span class="line">log.old:  get_sorted_dc_list: attempting lookup for name xxx.COM (sitename Default-First-Site-Name)</span><br><span class="line">log.old:[2020/03/09 17:41:50.510170,  8, pid=8309, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3355(get_sorted_dc_list)</span><br><span class="line">log.old:  get_sorted_dc_list: attempting lookup for name xxx.COM (sitename Default-First-Site-Name)</span><br><span class="line">log.old:[2020/03/09 17:41:51.499312,  8, pid=8310, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3355(get_sorted_dc_list)</span><br><span class="line">log.old:  get_sorted_dc_list: attempting lookup for name xxx.COM (sitename Default-First-Site-Name)</span><br><span class="line">log.old:[2020/03/09 17:41:52.207439,  8, pid=8311, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3355(get_sorted_dc_list)</span><br><span class="line">log.old:  get_sorted_dc_list: attempting lookup for name xxx.COM (sitename Default-First-Site-Name)</span><br><span class="line">log.old:[2020/03/09 17:41:52.914030,  8, pid=8312, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3355(get_sorted_dc_list)</span><br><span class="line">log.old:  get_sorted_dc_list: attempting lookup for name xxx.COM (sitename Default-First-Site-Name)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="下面走到get-dc-list-方法。"><a href="#下面走到get-dc-list-方法。" class="headerlink" title="下面走到get_dc_list 方法。"></a>下面走到get_dc_list 方法。</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></td><td class="code"><pre><span class="line">/********************************************************</span><br><span class="line"> Get the IP address list of the domain controllers for</span><br><span class="line"> a domain.</span><br><span class="line">*********************************************************/</span><br><span class="line"></span><br><span class="line">static NTSTATUS get_dc_list(const char *domain,</span><br><span class="line">			const char *sitename,</span><br><span class="line">			struct ip_service **ip_list,</span><br><span class="line">			int *count,</span><br><span class="line">			enum dc_lookup_type lookup_type,</span><br><span class="line">			bool *ordered)</span><br><span class="line">$ grep get_dc_list log*</span><br><span class="line">log:[2020/03/09 17:43:16.029160,  3, pid=8328, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log:[2020/03/09 17:43:16.029280,  8, pid=8328, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log:[2020/03/09 17:43:16.030213,  4, pid=8328, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log:[2020/03/09 17:43:16.030235,  4, pid=8328, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log:  get_dc_list: 192.168.17.228:389 192.168.13.251:389 192.168.31.251:389 192.168.13.252:389 </span><br><span class="line">log:[2020/03/09 17:43:16.063366,  3, pid=8328, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log:[2020/03/09 17:43:16.065864,  8, pid=8328, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log:[2020/03/09 17:43:16.066247,  4, pid=8328, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log:[2020/03/09 17:43:16.066276,  4, pid=8328, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log:  get_dc_list: 192.168.17.228:88 192.168.13.252:88 192.168.31.251:88 192.168.13.251:88 </span><br><span class="line">log:[2020/03/09 17:43:16.066381,  3, pid=8328, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log:[2020/03/09 17:43:16.068330,  8, pid=8328, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log:[2020/03/09 17:43:16.068704,  4, pid=8328, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log:[2020/03/09 17:43:16.068732,  4, pid=8328, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log:  get_dc_list: 192.168.17.228:88 192.168.13.252:88 192.168.13.251:88 192.168.31.251:88 </span><br><span class="line">log:[2020/03/09 17:43:16.700775,  3, pid=8329, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log:[2020/03/09 17:43:16.700859,  8, pid=8329, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log:[2020/03/09 17:43:16.701415,  4, pid=8329, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log:[2020/03/09 17:43:16.701430,  4, pid=8329, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log:  get_dc_list: 192.168.17.228:389 192.168.13.251:389 192.168.31.251:389 192.168.13.252:389 </span><br><span class="line">log:[2020/03/09 17:43:16.733917,  3, pid=8329, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log:[2020/03/09 17:43:16.736368,  8, pid=8329, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log:[2020/03/09 17:43:16.736750,  4, pid=8329, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log:[2020/03/09 17:43:16.736779,  4, pid=8329, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log:  get_dc_list: 192.168.17.228:88 192.168.13.252:88 192.168.31.251:88 192.168.13.251:88 </span><br><span class="line">log:[2020/03/09 17:43:16.736901,  3, pid=8329, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log:[2020/03/09 17:43:16.739348,  8, pid=8329, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log:[2020/03/09 17:43:16.739741,  4, pid=8329, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log:[2020/03/09 17:43:16.739770,  4, pid=8329, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log:  get_dc_list: 192.168.17.228:88 192.168.13.251:88 192.168.31.251:88 192.168.13.252:88 </span><br><span class="line">log:[2020/03/09 17:43:17.368729,  3, pid=8330, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log:[2020/03/09 17:43:17.368867,  8, pid=8330, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log:[2020/03/09 17:43:17.369858,  4, pid=8330, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log:[2020/03/09 17:43:17.369881,  4, pid=8330, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log:  get_dc_list: 192.168.17.228:389 192.168.13.251:389 192.168.31.251:389 192.168.13.252:389 </span><br><span class="line">log:[2020/03/09 17:43:17.402505,  3, pid=8330, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log:[2020/03/09 17:43:17.406303,  8, pid=8330, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log:[2020/03/09 17:43:17.406739,  4, pid=8330, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log:[2020/03/09 17:43:17.406769,  4, pid=8330, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log:  get_dc_list: 192.168.17.228:88 192.168.13.252:88 192.168.31.251:88 192.168.13.251:88 </span><br><span class="line">log:[2020/03/09 17:43:17.406876,  3, pid=8330, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log:[2020/03/09 17:43:17.410338,  8, pid=8330, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log:[2020/03/09 17:43:17.410751,  4, pid=8330, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log:[2020/03/09 17:43:17.410780,  4, pid=8330, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log:  get_dc_list: 192.168.17.228:88 192.168.31.251:88 192.168.13.252:88 192.168.13.251:88 </span><br><span class="line">log:[2020/03/09 17:43:37.768653,  3, pid=8334, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log:[2020/03/09 17:43:37.768814,  8, pid=8334, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log:[2020/03/09 17:43:37.769616,  4, pid=8334, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log:[2020/03/09 17:43:37.769634,  4, pid=8334, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log:  get_dc_list: 192.168.17.228:389 192.168.13.251:389 192.168.31.251:389 192.168.13.252:389 </span><br><span class="line">log:[2020/03/09 17:43:37.802598,  3, pid=8334, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log:[2020/03/09 17:43:37.804922,  8, pid=8334, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log:[2020/03/09 17:43:37.805329,  4, pid=8334, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log:[2020/03/09 17:43:37.805358,  4, pid=8334, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log:  get_dc_list: 192.168.17.228:88 192.168.31.251:88 192.168.13.251:88 192.168.13.252:88 </span><br><span class="line">log:[2020/03/09 17:43:37.805464,  3, pid=8334, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log:[2020/03/09 17:43:37.807314,  8, pid=8334, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log:[2020/03/09 17:43:37.807684,  4, pid=8334, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log:[2020/03/09 17:43:37.807712,  4, pid=8334, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log:  get_dc_list: 192.168.17.228:88 192.168.31.251:88 192.168.13.252:88 192.168.13.251:88 </span><br><span class="line">log.old:[2020/03/09 17:43:05.751178,  3, pid=8324, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log.old:[2020/03/09 17:43:05.751318,  8, pid=8324, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log.old:[2020/03/09 17:43:05.752314,  4, pid=8324, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log.old:[2020/03/09 17:43:05.752332,  4, pid=8324, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: 192.168.17.228:389 192.168.13.251:389 192.168.31.251:389 192.168.13.252:389 </span><br><span class="line">log.old:[2020/03/09 17:43:05.786412,  3, pid=8324, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log.old:[2020/03/09 17:43:05.791044,  8, pid=8324, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log.old:[2020/03/09 17:43:05.791442,  4, pid=8324, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log.old:[2020/03/09 17:43:05.791471,  4, pid=8324, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: 192.168.17.228:88 192.168.13.252:88 192.168.31.251:88 192.168.13.251:88 </span><br><span class="line">log.old:[2020/03/09 17:43:05.791576,  3, pid=8324, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log.old:[2020/03/09 17:43:05.794197,  8, pid=8324, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log.old:[2020/03/09 17:43:05.794579,  4, pid=8324, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log.old:[2020/03/09 17:43:05.794608,  4, pid=8324, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: 192.168.17.228:88 192.168.13.251:88 192.168.31.251:88 192.168.13.252:88 </span><br><span class="line">log.old:[2020/03/09 17:43:13.692054,  3, pid=8325, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log.old:[2020/03/09 17:43:13.692174,  8, pid=8325, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log.old:[2020/03/09 17:43:13.693051,  4, pid=8325, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log.old:[2020/03/09 17:43:13.693073,  4, pid=8325, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: 192.168.17.228:389 192.168.13.251:389 192.168.31.251:389 192.168.13.252:389 </span><br><span class="line">log.old:[2020/03/09 17:43:13.725263,  3, pid=8325, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log.old:[2020/03/09 17:43:13.727528,  8, pid=8325, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log.old:[2020/03/09 17:43:13.727913,  4, pid=8325, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log.old:[2020/03/09 17:43:13.727942,  4, pid=8325, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: 192.168.17.228:88 192.168.13.252:88 192.168.31.251:88 192.168.13.251:88 </span><br><span class="line">log.old:[2020/03/09 17:43:13.728049,  3, pid=8325, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log.old:[2020/03/09 17:43:13.729936,  8, pid=8325, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log.old:[2020/03/09 17:43:13.730305,  4, pid=8325, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log.old:[2020/03/09 17:43:13.730334,  4, pid=8325, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: 192.168.17.228:88 192.168.31.251:88 192.168.13.252:88 192.168.13.251:88 </span><br><span class="line">log.old:[2020/03/09 17:43:14.659077,  3, pid=8326, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log.old:[2020/03/09 17:43:14.659178,  8, pid=8326, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log.old:[2020/03/09 17:43:14.660000,  4, pid=8326, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log.old:[2020/03/09 17:43:14.660018,  4, pid=8326, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: 192.168.17.228:389 192.168.13.251:389 192.168.31.251:389 192.168.13.252:389 </span><br><span class="line">log.old:[2020/03/09 17:43:14.692762,  3, pid=8326, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log.old:[2020/03/09 17:43:14.695040,  8, pid=8326, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log.old:[2020/03/09 17:43:14.695438,  4, pid=8326, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log.old:[2020/03/09 17:43:14.695467,  4, pid=8326, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: 192.168.17.228:88 192.168.31.251:88 192.168.13.251:88 192.168.13.252:88 </span><br><span class="line">log.old:[2020/03/09 17:43:14.695573,  3, pid=8326, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log.old:[2020/03/09 17:43:14.703135,  8, pid=8326, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log.old:[2020/03/09 17:43:14.703515,  4, pid=8326, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log.old:[2020/03/09 17:43:14.703544,  4, pid=8326, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: 192.168.17.228:88 192.168.31.251:88 192.168.13.252:88 192.168.13.251:88 </span><br><span class="line">log.old:[2020/03/09 17:43:15.350163,  3, pid=8327, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log.old:[2020/03/09 17:43:15.350251,  8, pid=8327, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log.old:[2020/03/09 17:43:15.350999,  4, pid=8327, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log.old:[2020/03/09 17:43:15.351014,  4, pid=8327, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: 192.168.17.228:389 192.168.13.251:389 192.168.31.251:389 192.168.13.252:389 </span><br><span class="line">log.old:[2020/03/09 17:43:15.383322,  3, pid=8327, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log.old:[2020/03/09 17:43:15.385822,  8, pid=8327, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log.old:[2020/03/09 17:43:15.386205,  4, pid=8327, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log.old:[2020/03/09 17:43:15.386234,  4, pid=8327, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: 192.168.17.228:88 192.168.13.251:88 192.168.13.252:88 192.168.31.251:88 </span><br><span class="line">log.old:[2020/03/09 17:43:15.386341,  3, pid=8327, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3160(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: preferred server list: &quot;AD-SZ.example.com, *&quot;</span><br><span class="line">log.old:[2020/03/09 17:43:15.391064,  8, pid=8327, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3182(get_dc_list)</span><br><span class="line">log.old:[2020/03/09 17:43:15.391461,  4, pid=8327, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3305(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: returning 4 ip addresses in an ordered list</span><br><span class="line">log.old:[2020/03/09 17:43:15.391490,  4, pid=8327, effective(0, 0), real(0, 0)] ../source3/libsmb/namequery.c:3306(get_dc_list)</span><br><span class="line">log.old:  get_dc_list: 192.168.17.228:88 192.168.13.252:88 192.168.13.251:88 192.168.31.251:88 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br></pre></td><td class="code"><pre><span class="line">  no entry for trusted domain magesfc found.</span><br><span class="line">[2022/11/08 12:38:14.907006,  5, pid=94605, effective(0, 0), real(0, 0), class=auth] ../source3/auth/user_info.c:62(make_user_info)</span><br><span class="line">  attempting to make a user_info for magesfc (magesfc)</span><br><span class="line">[2022/11/08 12:38:14.907022,  5, pid=94605, effective(0, 0), real(0, 0), class=auth] ../source3/auth/user_info.c:70(make_user_info)</span><br><span class="line">  making strings for magesfc&#x27;s user_info struct</span><br><span class="line">[2022/11/08 12:38:14.907039,  5, pid=94605, effective(0, 0), real(0, 0), class=auth] ../source3/auth/user_info.c:108(make_user_info)</span><br><span class="line">  making blobs for magesfc&#x27;s user_info struct</span><br><span class="line">[2022/11/08 12:38:14.907053, 10, pid=94605, effective(0, 0), real(0, 0), class=auth] ../source3/auth/user_info.c:159(make_user_info)</span><br><span class="line">  made a user_info for magesfc (magesfc)</span><br><span class="line">[2022/11/08 12:38:14.907067,  3, pid=94605, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:178(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password:  Checking password for unmapped user [magesfc]\[magesfc]@[magesfc-ma] with the new password interface</span><br><span class="line">[2022/11/08 12:38:14.907082,  3, pid=94605, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:181(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password:  mapped user is: [magesfc]\[magesfc]@[magesfc-ma]</span><br><span class="line">[2022/11/08 12:38:14.907096, 10, pid=94605, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:190(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password: auth_context challenge created by random</span><br><span class="line">--</span><br><span class="line">  [0000] BD AB 52 70 22 63 0E 28                             ..Rp&quot;c.( </span><br><span class="line">[2022/11/08 12:38:14.907150, 10, pid=94605, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_builtin.c:41(check_guest_security)</span><br><span class="line">  Check auth for: [magesfc]</span><br><span class="line">[2022/11/08 12:38:14.907164, 10, pid=94605, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:233(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password: guest had nothing to say</span><br><span class="line">[2022/11/08 12:38:14.907178, 10, pid=94605, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_sam.c:75(auth_samstrict_auth)</span><br><span class="line">  Check auth for: [magesfc]</span><br><span class="line">[2022/11/08 12:38:14.907203,  8, pid=94605, effective(0, 0), real(0, 0)] ../source3/lib/util.c:1206(is_myname)</span><br><span class="line">  is_myname(&quot;magesfc&quot;) returns 0</span><br><span class="line">--</span><br><span class="line">  check_ntlm_password: sam had nothing to say</span><br><span class="line">[2022/11/08 12:38:14.907245, 10, pid=94605, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_winbind.c:50(check_winbind_security)</span><br><span class="line">  Check auth for: [magesfc]</span><br><span class="line">[2022/11/08 12:38:14.907261,  4, pid=94605, effective(0, 0), real(0, 0)] ../source3/smbd/sec_ctx.c:217(push_sec_ctx)</span><br><span class="line">  push_sec_ctx(0, 0) : sec_ctx_stack_ndx = 1</span><br><span class="line">--</span><br><span class="line">  check_winbind_security: wbcAuthenticateUserEx failed: WBC_ERR_WINBIND_NOT_AVAILABLE</span><br><span class="line">[2022/11/08 12:38:14.907397, 10, pid=94605, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_domain.c:280(check_ntdomain_security)</span><br><span class="line">  Check auth for: [magesfc]</span><br><span class="line">[2022/11/08 12:38:14.907427,  5, pid=94605, effective(0, 0), real(0, 0)] ../source3/libads/sitename_cache.c:105(sitename_fetch)</span><br><span class="line">  sitename_fetch: Returning sitename for magesfc.COM: &quot;Default-First-Site-Name&quot;</span><br><span class="line">--</span><br><span class="line">                                  size                     : 0x0012 (18)</span><br><span class="line">                                  string                   : *</span><br><span class="line">                                      string                   : &#x27;magesfc&#x27;</span><br><span class="line">                              workstation: struct lsa_String</span><br><span class="line">                                  length                   : 0x0016 (22)</span><br><span class="line">--</span><br><span class="line">              result                   : NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:15.398514,  0, pid=94605, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_domain.c:225(domain_client_validate)</span><br><span class="line">  domain_client_validate: unable to validate password for user magesfc in domain magesfc to Domain controller zzew.magesfc.COM. Error was NT_STATUS_ACCESS_DENIED.</span><br><span class="line">[2022/11/08 12:38:15.427625,  5, pid=94605, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:252(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password: winbind authentication for user [magesfc] FAILED with error NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:15.427668,  2, pid=94605, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:315(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password:  Authentication for user [magesfc] -&gt; [magesfc] FAILED with error NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:15.427686,  5, pid=94605, effective(0, 0), real(0, 0)] ../source3/auth/auth_ntlmssp.c:188(auth3_check_password)</span><br><span class="line">  Checking NTLMSSP password for magesfc\magesfc failed: NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:15.427704,  5, pid=94605, effective(0, 0), real(0, 0)] ../auth/ntlmssp/ntlmssp_server.c:737(ntlmssp_server_check_password)</span><br><span class="line">  ../auth/ntlmssp/ntlmssp_server.c:737: Checking NTLMSSP password for magesfc\magesfc failed: NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:15.427722,  2, pid=94605, effective(0, 0), real(0, 0)] ../auth/gensec/spnego.c:716(gensec_spnego_server_negTokenTarg)</span><br><span class="line">  SPNEGO login failed: NT_STATUS_ACCESS_DENIED</span><br><span class="line">--</span><br><span class="line">          UserNameMaxLen           : 0x0012 (18)</span><br><span class="line">          UserName                 : *</span><br><span class="line">              UserName                 : &#x27;magesfc&#x27;</span><br><span class="line">          WorkstationLen           : 0x0012 (18)</span><br><span class="line">          WorkstationMaxLen        : 0x0012 (18)</span><br><span class="line">--</span><br><span class="line">              NTLMRevisionCurrent      : NTLMSSP_REVISION_W2K3 (15)</span><br><span class="line">[2022/11/08 12:38:15.500173,  3, pid=94608, effective(0, 0), real(0, 0)] ../auth/ntlmssp/ntlmssp_server.c:452(ntlmssp_server_preauth)</span><br><span class="line">  Got user=[magesfc] domain=[magesfc] workstation=[magesfc-ma] len1=24 len2=242</span><br><span class="line">[2022/11/08 12:38:15.500194,  6, pid=94608, effective(0, 0), real(0, 0)] ../librpc/ndr/ndr_string.c:171(ndr_pull_string)</span><br><span class="line">  short string &#x27;&#x27;, sent with NULL termination despite NOTERM flag in IDL</span><br><span class="line">--</span><br><span class="line">  adding IPC service</span><br><span class="line">[2022/11/08 12:38:15.501734,  5, pid=94608, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_util.c:117(make_user_info_map)</span><br><span class="line">  Mapping user [magesfc]\[magesfc] from workstation [magesfc-ma]</span><br><span class="line">[2022/11/08 12:38:15.501770, 10, pid=94608, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_util.c:1563(is_trusted_domain)</span><br><span class="line">  wb_is_trusted_domain returned error: WBC_ERR_WINBIND_NOT_AVAILABLE</span><br><span class="line">--</span><br><span class="line">  no entry for trusted domain magesfc found.</span><br><span class="line">[2022/11/08 12:38:15.962093,  5, pid=94608, effective(0, 0), real(0, 0), class=auth] ../source3/auth/user_info.c:62(make_user_info)</span><br><span class="line">  attempting to make a user_info for magesfc (magesfc)</span><br><span class="line">[2022/11/08 12:38:15.962108,  5, pid=94608, effective(0, 0), real(0, 0), class=auth] ../source3/auth/user_info.c:70(make_user_info)</span><br><span class="line">  making strings for magesfc&#x27;s user_info struct</span><br><span class="line">[2022/11/08 12:38:15.962125,  5, pid=94608, effective(0, 0), real(0, 0), class=auth] ../source3/auth/user_info.c:108(make_user_info)</span><br><span class="line">  making blobs for magesfc&#x27;s user_info struct</span><br><span class="line">[2022/11/08 12:38:15.962139, 10, pid=94608, effective(0, 0), real(0, 0), class=auth] ../source3/auth/user_info.c:159(make_user_info)</span><br><span class="line">  made a user_info for magesfc (magesfc)</span><br><span class="line">[2022/11/08 12:38:15.962153,  3, pid=94608, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:178(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password:  Checking password for unmapped user [magesfc]\[magesfc]@[magesfc-ma] with the new password interface</span><br><span class="line">[2022/11/08 12:38:15.962167,  3, pid=94608, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:181(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password:  mapped user is: [magesfc]\[magesfc]@[magesfc-ma]</span><br><span class="line">[2022/11/08 12:38:15.962181, 10, pid=94608, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:190(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password: auth_context challenge created by random</span><br><span class="line">--</span><br><span class="line">  [0000] 7D FB 98 C1 66 BC 9D A8                             &#125;...f... </span><br><span class="line">[2022/11/08 12:38:15.962243, 10, pid=94608, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_builtin.c:41(check_guest_security)</span><br><span class="line">  Check auth for: [magesfc]</span><br><span class="line">[2022/11/08 12:38:15.962258, 10, pid=94608, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:233(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password: guest had nothing to say</span><br><span class="line">[2022/11/08 12:38:15.962273, 10, pid=94608, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_sam.c:75(auth_samstrict_auth)</span><br><span class="line">  Check auth for: [magesfc]</span><br><span class="line">[2022/11/08 12:38:15.962287,  8, pid=94608, effective(0, 0), real(0, 0)] ../source3/lib/util.c:1206(is_myname)</span><br><span class="line">  is_myname(&quot;magesfc&quot;) returns 0</span><br><span class="line">--</span><br><span class="line">  check_ntlm_password: sam had nothing to say</span><br><span class="line">[2022/11/08 12:38:15.962329, 10, pid=94608, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_winbind.c:50(check_winbind_security)</span><br><span class="line">  Check auth for: [magesfc]</span><br><span class="line">[2022/11/08 12:38:15.962343,  4, pid=94608, effective(0, 0), real(0, 0)] ../source3/smbd/sec_ctx.c:217(push_sec_ctx)</span><br><span class="line">  push_sec_ctx(0, 0) : sec_ctx_stack_ndx = 1</span><br><span class="line">--</span><br><span class="line">  check_winbind_security: wbcAuthenticateUserEx failed: WBC_ERR_WINBIND_NOT_AVAILABLE</span><br><span class="line">[2022/11/08 12:38:15.962472, 10, pid=94608, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_domain.c:280(check_ntdomain_security)</span><br><span class="line">  Check auth for: [magesfc]</span><br><span class="line">[2022/11/08 12:38:15.962499,  5, pid=94608, effective(0, 0), real(0, 0)] ../source3/libads/sitename_cache.c:105(sitename_fetch)</span><br><span class="line">  sitename_fetch: Returning sitename for magesfc.COM: &quot;Default-First-Site-Name&quot;</span><br><span class="line">--</span><br><span class="line">                                  size                     : 0x0012 (18)</span><br><span class="line">                                  string                   : *</span><br><span class="line">                                      string                   : &#x27;magesfc&#x27;</span><br><span class="line">                              workstation: struct lsa_String</span><br><span class="line">                                  length                   : 0x0016 (22)</span><br><span class="line">--</span><br><span class="line">              result                   : NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:16.351944,  0, pid=94608, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_domain.c:225(domain_client_validate)</span><br><span class="line">  domain_client_validate: unable to validate password for user magesfc in domain magesfc to Domain controller zzew.magesfc.COM. Error was NT_STATUS_ACCESS_DENIED.</span><br><span class="line">[2022/11/08 12:38:16.380998,  5, pid=94608, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:252(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password: winbind authentication for user [magesfc] FAILED with error NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:16.381041,  2, pid=94608, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:315(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password:  Authentication for user [magesfc] -&gt; [magesfc] FAILED with error NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:16.381058,  5, pid=94608, effective(0, 0), real(0, 0)] ../source3/auth/auth_ntlmssp.c:188(auth3_check_password)</span><br><span class="line">  Checking NTLMSSP password for magesfc\magesfc failed: NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:16.381075,  5, pid=94608, effective(0, 0), real(0, 0)] ../auth/ntlmssp/ntlmssp_server.c:737(ntlmssp_server_check_password)</span><br><span class="line">  ../auth/ntlmssp/ntlmssp_server.c:737: Checking NTLMSSP password for magesfc\magesfc failed: NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:16.381091,  2, pid=94608, effective(0, 0), real(0, 0)] ../auth/gensec/spnego.c:716(gensec_spnego_server_negTokenTarg)</span><br><span class="line">  SPNEGO login failed: NT_STATUS_ACCESS_DENIED</span><br><span class="line">--</span><br><span class="line">          UserNameMaxLen           : 0x0012 (18)</span><br><span class="line">          UserName                 : *</span><br><span class="line">              UserName                 : &#x27;magesfc&#x27;</span><br><span class="line">          WorkstationLen           : 0x0012 (18)</span><br><span class="line">          WorkstationMaxLen        : 0x0012 (18)</span><br><span class="line">--</span><br><span class="line">              NTLMRevisionCurrent      : NTLMSSP_REVISION_W2K3 (15)</span><br><span class="line">[2022/11/08 12:38:16.453433,  3, pid=94609, effective(0, 0), real(0, 0)] ../auth/ntlmssp/ntlmssp_server.c:452(ntlmssp_server_preauth)</span><br><span class="line">  Got user=[magesfc] domain=[magesfc] workstation=[magesfc-ma] len1=24 len2=242</span><br><span class="line">[2022/11/08 12:38:16.453458,  6, pid=94609, effective(0, 0), real(0, 0)] ../librpc/ndr/ndr_string.c:171(ndr_pull_string)</span><br><span class="line">  short string &#x27;&#x27;, sent with NULL termination despite NOTERM flag in IDL</span><br><span class="line">--</span><br><span class="line">  adding IPC service</span><br><span class="line">[2022/11/08 12:38:16.455200,  5, pid=94609, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_util.c:117(make_user_info_map)</span><br><span class="line">  Mapping user [magesfc]\[magesfc] from workstation [magesfc-ma]</span><br><span class="line">[2022/11/08 12:38:16.455248, 10, pid=94609, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_util.c:1563(is_trusted_domain)</span><br><span class="line">  wb_is_trusted_domain returned error: WBC_ERR_WINBIND_NOT_AVAILABLE</span><br><span class="line">--</span><br><span class="line">  no entry for trusted domain magesfc found.</span><br><span class="line">[2022/11/08 12:38:16.842716,  5, pid=94609, effective(0, 0), real(0, 0), class=auth] ../source3/auth/user_info.c:62(make_user_info)</span><br><span class="line">  attempting to make a user_info for magesfc (magesfc)</span><br><span class="line">[2022/11/08 12:38:16.842732,  5, pid=94609, effective(0, 0), real(0, 0), class=auth] ../source3/auth/user_info.c:70(make_user_info)</span><br><span class="line">  making strings for magesfc&#x27;s user_info struct</span><br><span class="line">[2022/11/08 12:38:16.842748,  5, pid=94609, effective(0, 0), real(0, 0), class=auth] ../source3/auth/user_info.c:108(make_user_info)</span><br><span class="line">  making blobs for magesfc&#x27;s user_info struct</span><br><span class="line">[2022/11/08 12:38:16.842763, 10, pid=94609, effective(0, 0), real(0, 0), class=auth] ../source3/auth/user_info.c:159(make_user_info)</span><br><span class="line">  made a user_info for magesfc (magesfc)</span><br><span class="line">[2022/11/08 12:38:16.842776,  3, pid=94609, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:178(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password:  Checking password for unmapped user [magesfc]\[magesfc]@[magesfc-ma] with the new password interface</span><br><span class="line">[2022/11/08 12:38:16.842791,  3, pid=94609, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:181(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password:  mapped user is: [magesfc]\[magesfc]@[magesfc-ma]</span><br><span class="line">[2022/11/08 12:38:16.842804, 10, pid=94609, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:190(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password: auth_context challenge created by random</span><br><span class="line">--</span><br><span class="line">  [0000] 9F 03 84 48 80 27 93 DD                             ...H.&#x27;.. </span><br><span class="line">[2022/11/08 12:38:16.842859, 10, pid=94609, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_builtin.c:41(check_guest_security)</span><br><span class="line">  Check auth for: [magesfc]</span><br><span class="line">[2022/11/08 12:38:16.842873, 10, pid=94609, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:233(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password: guest had nothing to say</span><br><span class="line">[2022/11/08 12:38:16.842888, 10, pid=94609, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_sam.c:75(auth_samstrict_auth)</span><br><span class="line">  Check auth for: [magesfc]</span><br><span class="line">[2022/11/08 12:38:16.842902,  8, pid=94609, effective(0, 0), real(0, 0)] ../source3/lib/util.c:1206(is_myname)</span><br><span class="line">  is_myname(&quot;magesfc&quot;) returns 0</span><br><span class="line">--</span><br><span class="line">  check_ntlm_password: sam had nothing to say</span><br><span class="line">[2022/11/08 12:38:16.842943, 10, pid=94609, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_winbind.c:50(check_winbind_security)</span><br><span class="line">  Check auth for: [magesfc]</span><br><span class="line">[2022/11/08 12:38:16.842958,  4, pid=94609, effective(0, 0), real(0, 0)] ../source3/smbd/sec_ctx.c:217(push_sec_ctx)</span><br><span class="line">  push_sec_ctx(0, 0) : sec_ctx_stack_ndx = 1</span><br><span class="line">--</span><br><span class="line">  check_winbind_security: wbcAuthenticateUserEx failed: WBC_ERR_WINBIND_NOT_AVAILABLE</span><br><span class="line">[2022/11/08 12:38:16.843098, 10, pid=94609, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_domain.c:280(check_ntdomain_security)</span><br><span class="line">  Check auth for: [magesfc]</span><br><span class="line">[2022/11/08 12:38:16.843126,  5, pid=94609, effective(0, 0), real(0, 0)] ../source3/libads/sitename_cache.c:105(sitename_fetch)</span><br><span class="line">  sitename_fetch: Returning sitename for magesfc.COM: &quot;Default-First-Site-Name&quot;</span><br><span class="line">--</span><br><span class="line">                                  size                     : 0x0012 (18)</span><br><span class="line">                                  string                   : *</span><br><span class="line">                                      string                   : &#x27;magesfc&#x27;</span><br><span class="line">                              workstation: struct lsa_String</span><br><span class="line">                                  length                   : 0x0016 (22)</span><br><span class="line">--</span><br><span class="line">              result                   : NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:17.300301,  0, pid=94609, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_domain.c:225(domain_client_validate)</span><br><span class="line">  domain_client_validate: unable to validate password for user magesfc in domain magesfc to Domain controller zzew.magesfc.COM. Error was NT_STATUS_ACCESS_DENIED.</span><br><span class="line">[2022/11/08 12:38:17.329385,  5, pid=94609, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:252(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password: winbind authentication for user [magesfc] FAILED with error NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:17.329429,  2, pid=94609, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:315(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password:  Authentication for user [magesfc] -&gt; [magesfc] FAILED with error NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:17.329456,  5, pid=94609, effective(0, 0), real(0, 0)] ../source3/auth/auth_ntlmssp.c:188(auth3_check_password)</span><br><span class="line">  Checking NTLMSSP password for magesfc\magesfc failed: NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:17.329474,  5, pid=94609, effective(0, 0), real(0, 0)] ../auth/ntlmssp/ntlmssp_server.c:737(ntlmssp_server_check_password)</span><br><span class="line">  ../auth/ntlmssp/ntlmssp_server.c:737: Checking NTLMSSP password for magesfc\magesfc failed: NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:17.329490,  2, pid=94609, effective(0, 0), real(0, 0)] ../auth/gensec/spnego.c:716(gensec_spnego_server_negTokenTarg)</span><br><span class="line">  SPNEGO login failed: NT_STATUS_ACCESS_DENIED</span><br><span class="line">--</span><br><span class="line">          UserNameMaxLen           : 0x0012 (18)</span><br><span class="line">          UserName                 : *</span><br><span class="line">              UserName                 : &#x27;magesfc&#x27;</span><br><span class="line">          WorkstationLen           : 0x0012 (18)</span><br><span class="line">          WorkstationMaxLen        : 0x0012 (18)</span><br><span class="line">--</span><br><span class="line">              NTLMRevisionCurrent      : NTLMSSP_REVISION_W2K3 (15)</span><br><span class="line">[2022/11/08 12:38:17.399753,  3, pid=94610, effective(0, 0), real(0, 0)] ../auth/ntlmssp/ntlmssp_server.c:452(ntlmssp_server_preauth)</span><br><span class="line">  Got user=[magesfc] domain=[magesfc] workstation=[magesfc-ma] len1=24 len2=242</span><br><span class="line">[2022/11/08 12:38:17.399775,  6, pid=94610, effective(0, 0), real(0, 0)] ../librpc/ndr/ndr_string.c:171(ndr_pull_string)</span><br><span class="line">  short string &#x27;&#x27;, sent with NULL termination despite NOTERM flag in IDL</span><br><span class="line">--</span><br><span class="line">  adding IPC service</span><br><span class="line">[2022/11/08 12:38:17.401428,  5, pid=94610, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_util.c:117(make_user_info_map)</span><br><span class="line">  Mapping user [magesfc]\[magesfc] from workstation [magesfc-ma]</span><br><span class="line">[2022/11/08 12:38:17.401471, 10, pid=94610, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_util.c:1563(is_trusted_domain)</span><br><span class="line">  wb_is_trusted_domain returned error: WBC_ERR_WINBIND_NOT_AVAILABLE</span><br><span class="line">--</span><br><span class="line">  no entry for trusted domain magesfc found.</span><br><span class="line">[2022/11/08 12:38:17.889144,  5, pid=94610, effective(0, 0), real(0, 0), class=auth] ../source3/auth/user_info.c:62(make_user_info)</span><br><span class="line">  attempting to make a user_info for magesfc (magesfc)</span><br><span class="line">[2022/11/08 12:38:17.889159,  5, pid=94610, effective(0, 0), real(0, 0), class=auth] ../source3/auth/user_info.c:70(make_user_info)</span><br><span class="line">  making strings for magesfc&#x27;s user_info struct</span><br><span class="line">[2022/11/08 12:38:17.889187,  5, pid=94610, effective(0, 0), real(0, 0), class=auth] ../source3/auth/user_info.c:108(make_user_info)</span><br><span class="line">  making blobs for magesfc&#x27;s user_info struct</span><br><span class="line">[2022/11/08 12:38:17.889202, 10, pid=94610, effective(0, 0), real(0, 0), class=auth] ../source3/auth/user_info.c:159(make_user_info)</span><br><span class="line">  made a user_info for magesfc (magesfc)</span><br><span class="line">[2022/11/08 12:38:17.889215,  3, pid=94610, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:178(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password:  Checking password for unmapped user [magesfc]\[magesfc]@[magesfc-ma] with the new password interface</span><br><span class="line">[2022/11/08 12:38:17.889231,  3, pid=94610, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:181(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password:  mapped user is: [magesfc]\[magesfc]@[magesfc-ma]</span><br><span class="line">[2022/11/08 12:38:17.889244, 10, pid=94610, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:190(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password: auth_context challenge created by random</span><br><span class="line">--</span><br><span class="line">  [0000] 65 4C F6 CC 8F 17 D8 3D                             eL.....= </span><br><span class="line">[2022/11/08 12:38:17.889298, 10, pid=94610, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_builtin.c:41(check_guest_security)</span><br><span class="line">  Check auth for: [magesfc]</span><br><span class="line">[2022/11/08 12:38:17.889311, 10, pid=94610, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:233(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password: guest had nothing to say</span><br><span class="line">[2022/11/08 12:38:17.889326, 10, pid=94610, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_sam.c:75(auth_samstrict_auth)</span><br><span class="line">  Check auth for: [magesfc]</span><br><span class="line">[2022/11/08 12:38:17.889340,  8, pid=94610, effective(0, 0), real(0, 0)] ../source3/lib/util.c:1206(is_myname)</span><br><span class="line">  is_myname(&quot;magesfc&quot;) returns 0</span><br><span class="line">--</span><br><span class="line">  check_ntlm_password: sam had nothing to say</span><br><span class="line">[2022/11/08 12:38:17.889396, 10, pid=94610, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_winbind.c:50(check_winbind_security)</span><br><span class="line">  Check auth for: [magesfc]</span><br><span class="line">[2022/11/08 12:38:17.889411,  4, pid=94610, effective(0, 0), real(0, 0)] ../source3/smbd/sec_ctx.c:217(push_sec_ctx)</span><br><span class="line">  push_sec_ctx(0, 0) : sec_ctx_stack_ndx = 1</span><br><span class="line">--</span><br><span class="line">  check_winbind_security: wbcAuthenticateUserEx failed: WBC_ERR_WINBIND_NOT_AVAILABLE</span><br><span class="line">[2022/11/08 12:38:17.889541, 10, pid=94610, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_domain.c:280(check_ntdomain_security)</span><br><span class="line">  Check auth for: [magesfc]</span><br><span class="line">[2022/11/08 12:38:17.889581,  5, pid=94610, effective(0, 0), real(0, 0)] ../source3/libads/sitename_cache.c:105(sitename_fetch)</span><br><span class="line">  sitename_fetch: Returning sitename for magesfc.COM: &quot;Default-First-Site-Name&quot;</span><br><span class="line">--</span><br><span class="line">                                  size                     : 0x0012 (18)</span><br><span class="line">                                  string                   : *</span><br><span class="line">                                      string                   : &#x27;magesfc&#x27;</span><br><span class="line">                              workstation: struct lsa_String</span><br><span class="line">                                  length                   : 0x0016 (22)</span><br><span class="line">--</span><br><span class="line">              result                   : NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:18.358816,  0, pid=94610, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_domain.c:225(domain_client_validate)</span><br><span class="line">  domain_client_validate: unable to validate password for user magesfc in domain magesfc to Domain controller zzew.magesfc.COM. Error was NT_STATUS_ACCESS_DENIED.</span><br><span class="line">[2022/11/08 12:38:18.387800,  5, pid=94610, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:252(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password: winbind authentication for user [magesfc] FAILED with error NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:18.387843,  2, pid=94610, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:315(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password:  Authentication for user [magesfc] -&gt; [magesfc] FAILED with error NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:18.387861,  5, pid=94610, effective(0, 0), real(0, 0)] ../source3/auth/auth_ntlmssp.c:188(auth3_check_password)</span><br><span class="line">  Checking NTLMSSP password for magesfc\magesfc failed: NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:18.387877,  5, pid=94610, effective(0, 0), real(0, 0)] ../auth/ntlmssp/ntlmssp_server.c:737(ntlmssp_server_check_password)</span><br><span class="line">  ../auth/ntlmssp/ntlmssp_server.c:737: Checking NTLMSSP password for magesfc\magesfc failed: NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:18.387894,  2, pid=94610, effective(0, 0), real(0, 0)] ../auth/gensec/spnego.c:716(gensec_spnego_server_negTokenTarg)</span><br><span class="line">  SPNEGO login failed: NT_STATUS_ACCESS_DENIED</span><br><span class="line">--</span><br><span class="line">          UserNameMaxLen           : 0x0012 (18)</span><br><span class="line">          UserName                 : *</span><br><span class="line">              UserName                 : &#x27;magesfc&#x27;</span><br><span class="line">          WorkstationLen           : 0x0012 (18)</span><br><span class="line">          WorkstationMaxLen        : 0x0012 (18)</span><br><span class="line">--</span><br><span class="line">              NTLMRevisionCurrent      : NTLMSSP_REVISION_W2K3 (15)</span><br><span class="line">[2022/11/08 12:38:18.462570,  3, pid=94611, effective(0, 0), real(0, 0)] ../auth/ntlmssp/ntlmssp_server.c:452(ntlmssp_server_preauth)</span><br><span class="line">  Got user=[magesfc] domain=[magesfc] workstation=[magesfc-ma] len1=24 len2=242</span><br><span class="line">[2022/11/08 12:38:18.462593,  6, pid=94611, effective(0, 0), real(0, 0)] ../librpc/ndr/ndr_string.c:171(ndr_pull_string)</span><br><span class="line">  short string &#x27;&#x27;, sent with NULL termination despite NOTERM flag in IDL</span><br><span class="line">--</span><br><span class="line">  adding IPC service</span><br><span class="line">[2022/11/08 12:38:18.464231,  5, pid=94611, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_util.c:117(make_user_info_map)</span><br><span class="line">  Mapping user [magesfc]\[magesfc] from workstation [magesfc-ma]</span><br><span class="line">[2022/11/08 12:38:18.464269, 10, pid=94611, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_util.c:1563(is_trusted_domain)</span><br><span class="line">  wb_is_trusted_domain returned error: WBC_ERR_WINBIND_NOT_AVAILABLE</span><br><span class="line">  no entry for trusted domain magesfc found.</span><br><span class="line">[2022/11/08 12:38:19.826023,  5, pid=94617, effective(0, 0), real(0, 0), class=auth] ../source3/auth/user_info.c:62(make_user_info)</span><br><span class="line">  attempting to make a user_info for magesfc (magesfc)</span><br><span class="line">[2022/11/08 12:38:19.826038,  5, pid=94617, effective(0, 0), real(0, 0), class=auth] ../source3/auth/user_info.c:70(make_user_info)</span><br><span class="line">  making strings for magesfc&#x27;s user_info struct</span><br><span class="line">[2022/11/08 12:38:19.826054,  5, pid=94617, effective(0, 0), real(0, 0), class=auth] ../source3/auth/user_info.c:108(make_user_info)</span><br><span class="line">  making blobs for magesfc&#x27;s user_info struct</span><br><span class="line">[2022/11/08 12:38:19.826068, 10, pid=94617, effective(0, 0), real(0, 0), class=auth] ../source3/auth/user_info.c:159(make_user_info)</span><br><span class="line">  made a user_info for magesfc (magesfc)</span><br><span class="line">[2022/11/08 12:38:19.826082,  3, pid=94617, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:178(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password:  Checking password for unmapped user [magesfc]\[magesfc]@[magesfc-ma] with the new password interface</span><br><span class="line">[2022/11/08 12:38:19.826096,  3, pid=94617, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:181(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password:  mapped user is: [magesfc]\[magesfc]@[magesfc-ma]</span><br><span class="line">[2022/11/08 12:38:19.826110, 10, pid=94617, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:190(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password: auth_context challenge created by random</span><br><span class="line">--</span><br><span class="line">  [0000] 67 B1 22 4D BE 8D FE 2A                             g.&quot;M...* </span><br><span class="line">[2022/11/08 12:38:19.826173, 10, pid=94617, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_builtin.c:41(check_guest_security)</span><br><span class="line">  Check auth for: [magesfc]</span><br><span class="line">[2022/11/08 12:38:19.826187, 10, pid=94617, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:233(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password: guest had nothing to say</span><br><span class="line">[2022/11/08 12:38:19.826201, 10, pid=94617, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_sam.c:75(auth_samstrict_auth)</span><br><span class="line">  Check auth for: [magesfc]</span><br><span class="line">[2022/11/08 12:38:19.826215,  8, pid=94617, effective(0, 0), real(0, 0)] ../source3/lib/util.c:1206(is_myname)</span><br><span class="line">  is_myname(&quot;magesfc&quot;) returns 0</span><br><span class="line">--</span><br><span class="line">  check_ntlm_password: sam had nothing to say</span><br><span class="line">[2022/11/08 12:38:19.826256, 10, pid=94617, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_winbind.c:50(check_winbind_security)</span><br><span class="line">  Check auth for: [magesfc]</span><br><span class="line">[2022/11/08 12:38:19.826270,  4, pid=94617, effective(0, 0), real(0, 0)] ../source3/smbd/sec_ctx.c:217(push_sec_ctx)</span><br><span class="line">  push_sec_ctx(0, 0) : sec_ctx_stack_ndx = 1</span><br><span class="line">--</span><br><span class="line">  check_winbind_security: wbcAuthenticateUserEx failed: WBC_ERR_WINBIND_NOT_AVAILABLE</span><br><span class="line">[2022/11/08 12:38:19.826399, 10, pid=94617, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_domain.c:280(check_ntdomain_security)</span><br><span class="line">  Check auth for: [magesfc]</span><br><span class="line">[2022/11/08 12:38:19.826426,  5, pid=94617, effective(0, 0), real(0, 0)] ../source3/libads/sitename_cache.c:105(sitename_fetch)</span><br><span class="line">  sitename_fetch: Returning sitename for magesfc.COM: &quot;Default-First-Site-Name&quot;</span><br><span class="line">--</span><br><span class="line">                                  size                     : 0x0012 (18)</span><br><span class="line">                                  string                   : *</span><br><span class="line">                                      string                   : &#x27;magesfc&#x27;</span><br><span class="line">                              workstation: struct lsa_String</span><br><span class="line">                                  length                   : 0x0016 (22)</span><br><span class="line">--</span><br><span class="line">              result                   : NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:20.315477,  0, pid=94617, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth_domain.c:225(domain_client_validate)</span><br><span class="line">  domain_client_validate: unable to validate password for user magesfc in domain magesfc to Domain controller zzew.magesfc.COM. Error was NT_STATUS_ACCESS_DENIED.</span><br><span class="line">[2022/11/08 12:38:20.344520,  5, pid=94617, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:252(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password: winbind authentication for user [magesfc] FAILED with error NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:20.344563,  2, pid=94617, effective(0, 0), real(0, 0), class=auth] ../source3/auth/auth.c:315(auth_check_ntlm_password)</span><br><span class="line">  check_ntlm_password:  Authentication for user [magesfc] -&gt; [magesfc] FAILED with error NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:20.344581,  5, pid=94617, effective(0, 0), real(0, 0)] ../source3/auth/auth_ntlmssp.c:188(auth3_check_password)</span><br><span class="line">  Checking NTLMSSP password for magesfc\magesfc failed: NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:20.344597,  5, pid=94617, effective(0, 0), real(0, 0)] ../auth/ntlmssp/ntlmssp_server.c:737(ntlmssp_server_check_password)</span><br><span class="line">  ../auth/ntlmssp/ntlmssp_server.c:737: Checking NTLMSSP password for magesfc\magesfc failed: NT_STATUS_ACCESS_DENIED</span><br><span class="line">[2022/11/08 12:38:20.344614,  2, pid=94617, effective(0, 0), real(0, 0)] ../auth/gensec/spnego.c:716(gensec_spnego_server_negTokenTarg)</span><br><span class="line">  SPNEGO login failed: NT_STATUS_ACCESS_DENIED</span><br><span class="line"></span><br></pre></td></tr></table></figure>














</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://magesfc.github.io">mage</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://magesfc.github.io/mage/0f82a538ae2222b1e1f51fa097614ce2767185b6/">https://magesfc.github.io/mage/0f82a538ae2222b1e1f51fa097614ce2767185b6/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://magesfc.github.io" target="_blank">马哥私房菜</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ubuntu/">ubuntu</a><a class="post-meta__tags" href="/tags/samba/">samba</a></div><div class="post_share"><div class="social-share" data-image="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/null" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/null" alt="支付寶"/></a><div class="post-qr-code-desc">支付寶</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/mage/faa877ef8e26557441db9099437ab98d161e5dbf/"><img class="prev-cover" src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Ubuntu学习笔记之ubuntu加入Windows的AD域使用SSSD和Realm的方式</div></div></a></div><div class="next-post pull-right"><a href="/mage/06aebecf548b5dba3ab91ec2c3f47a8645651694/"><img class="next-cover" src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Ubuntu学习笔记之分区详解之LVM</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/mage/366dd9cc15501eafd99f5bb2caf374c4d193767d/" title="Ubuntu学习笔记之ubuntu创建samba共享目录"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">Ubuntu学习笔记之ubuntu创建samba共享目录</div></div></a></div><div><a href="/mage/0092c74723dc205077d9e5927bb577a5995af9be/" title="Ubuntu学习笔记之ubuntu加入Windows的AD域使用Samba和Winbind的方式"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">Ubuntu学习笔记之ubuntu加入Windows的AD域使用Samba和Winbind的方式</div></div></a></div><div><a href="/mage/34e4d0939638b865838f594d333311f5fce82bca/" title="ELK学习之elasticsearch的安装之Ubuntu上安装elasticsearch"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">ELK学习之elasticsearch的安装之Ubuntu上安装elasticsearch</div></div></a></div><div><a href="/mage/6018e727e97bd487ee0f5b15648a257010d6c4e3/" title="ELK学习之elasticsearch的安装之Ubuntu上安装kibana"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">ELK学习之elasticsearch的安装之Ubuntu上安装kibana</div></div></a></div><div><a href="/mage/d98e027b6b2926e6955f7d6fb21ccb408c1319ac/" title="Ubuntu学习笔记之BackupYourSystem使用tar命令"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">Ubuntu学习笔记之BackupYourSystem使用tar命令</div></div></a></div><div><a href="/mage/35bdc5bde6c79f7d9baa28f71b48588bac55bf8a/" title="Ubuntu学习笔记之hide-process-from-other-user"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">Ubuntu学习笔记之hide-process-from-other-user</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">mage</div><div class="author-info__description"> 这里是 马哥 的个人博客 </div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">167</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">185</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">34</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mamh2021"><i class="fab fa-github"></i><span>GitHub</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/mamh2021" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B0%83%E8%AF%95samba"><span class="toc-number">1.</span> <span class="toc-text">调试samba</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">2.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Introduction%EF%BC%88%E4%BB%8B%E7%BB%8D%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">Introduction（介绍）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#How-to-file%EF%BC%88%E5%A6%82%E4%BD%95%E5%AE%9A%E4%BD%8D%E5%93%AA%E4%B8%AA%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">How to file（如何定位哪个）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Samba-as-a-client%EF%BC%88samba%E4%BD%9C%E4%B8%BA%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9D%A5%E4%BD%BF%E7%94%A8%EF%BC%89"><span class="toc-number">5.</span> <span class="toc-text">Samba as a client（samba作为客户端来使用）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Samba-as-a-server%EF%BC%88samba%E4%BD%9C%E4%B8%BA%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%9D%A5%E4%BD%BF%E7%94%A8%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">Samba as a server（samba作为服务端来使用）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Install-x2F-upgrade-failure%EF%BC%88%E5%AE%89%E8%A3%85%E3%80%81%E5%8D%87%E7%BA%A7%E6%97%B6%E5%80%99%E6%8A%A5%E9%94%99%EF%BC%89"><span class="toc-number">7.</span> <span class="toc-text">Install&#x2F;upgrade failure（安装、升级时候报错）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#How-to-Triage%EF%BC%88%E5%A6%82%E4%BD%95%E8%AF%86%E5%88%AB%E9%94%99%E8%AF%AF%E5%88%86%E7%B1%BB%EF%BC%89"><span class="toc-number">8.</span> <span class="toc-text">How to Triage（如何识别错误分类）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Stock-Reply%EF%BC%88%E5%9B%9E%E5%A4%8D%EF%BC%89"><span class="toc-number">9.</span> <span class="toc-text">Stock Reply（回复）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Non-bugs%EF%BC%88%E6%B2%A1%E6%9C%89bug%EF%BC%9F%EF%BC%89"><span class="toc-number">10.</span> <span class="toc-text">Non-bugs（没有bug？）</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%97%A5%E5%BF%97"><span class="toc-number">11.</span> <span class="toc-text">报错日志</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%9E%90%EF%BC%9A"><span class="toc-number">11.1.</span> <span class="toc-text">分析：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9Asamba%E7%9A%84%E7%89%88%E6%9C%AC"><span class="toc-number">11.2.</span> <span class="toc-text">确定samba的版本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%96%E5%BE%97samba%E7%9A%84%E6%BA%90%E7%A0%81%E7%9A%84%E7%89%88%E6%9C%AC%E5%8F%B7"><span class="toc-number">11.3.</span> <span class="toc-text">取得samba的源码的版本号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="toc-number">11.4.</span> <span class="toc-text">下载源代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%BE%E5%88%B0%E5%AF%B9%E5%BA%94%E7%9A%84%E6%8A%A5%E9%94%99%E6%97%A5%E5%BF%97%E8%A1%8C%E7%9A%84%E4%BB%A3%E7%A0%81-source3-x2F-auth-x2F-auth-domain-c"><span class="toc-number">11.5.</span> <span class="toc-text">找到对应的报错日志行的代码 source3&#x2F;auth&#x2F;auth_domain.c</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%9E%90-get-dc-name-%E6%96%B9%E6%B3%95-source3-x2F-libsmb-x2F-namequery-dc-c"><span class="toc-number">11.6.</span> <span class="toc-text">分析 get_dc_name 方法 source3&#x2F;libsmb&#x2F;namequery_dc.c</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ads-dc-name%E6%96%B9%E6%B3%95-source3-x2F-libsmb-x2F-namequery-dc-c"><span class="toc-number">11.7.</span> <span class="toc-text">ads_dc_name方法 source3&#x2F;libsmb&#x2F;namequery_dc.c</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rpc-dc-name"><span class="toc-number">11.8.</span> <span class="toc-text">rpc_dc_name</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#debug-level-%E8%BF%98%E5%8F%AF%E4%BB%A5%E5%A4%A7%E4%BA%8E11"><span class="toc-number">11.9.</span> <span class="toc-text">debug level 还可以大于11</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%8D%E6%AC%A1%E5%88%86%E6%9E%90%E5%88%B0-resolve-and-ping-dns%E6%96%B9%E6%B3%95%E4%B8%AD"><span class="toc-number">11.10.</span> <span class="toc-text">再次分析到 resolve_and_ping_dns方法中</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%8D%E6%AC%A1%E5%88%86%E6%9E%90%EF%BC%8C%E5%BE%97%E5%88%B0-get-sorted-dc-list-%E6%96%B9%E6%B3%95"><span class="toc-number">11.11.</span> <span class="toc-text">再次分析，得到 get_sorted_dc_list 方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E9%9D%A2%E8%B5%B0%E5%88%B0get-dc-list-%E6%96%B9%E6%B3%95%E3%80%82"><span class="toc-number">11.12.</span> <span class="toc-text">下面走到get_dc_list 方法。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97"><span class="toc-number">11.13.</span> <span class="toc-text">日志</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/mage/38b16f805c0e0bfdce028d95fdd10a0b160e9167/" title="Linux学习之文件系统btrfs文件系统"><img src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux学习之文件系统btrfs文件系统"/></a><div class="content"><a class="title" href="/mage/38b16f805c0e0bfdce028d95fdd10a0b160e9167/" title="Linux学习之文件系统btrfs文件系统">Linux学习之文件系统btrfs文件系统</a><time datetime="2022-12-05T14:37:10.000Z" title="更新于 2022-12-05 22:37:10">2022-12-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/c480dbde40d58e354795a1a408fdb8bad06fe7cc/" title="Ansible自动化运维工具之role介绍"><img src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Ansible自动化运维工具之role介绍"/></a><div class="content"><a class="title" href="/mage/c480dbde40d58e354795a1a408fdb8bad06fe7cc/" title="Ansible自动化运维工具之role介绍">Ansible自动化运维工具之role介绍</a><time datetime="2022-12-01T12:18:31.000Z" title="更新于 2022-12-01 20:18:31">2022-12-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/6118b9bf91824574204e116d5b138ffbaab72268/" title="Golang学习之struct转json"><img src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Golang学习之struct转json"/></a><div class="content"><a class="title" href="/mage/6118b9bf91824574204e116d5b138ffbaab72268/" title="Golang学习之struct转json">Golang学习之struct转json</a><time datetime="2022-11-14T06:06:32.000Z" title="更新于 2022-11-14 14:06:32">2022-11-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/9e24b8712fd7596796aa8992d2b6496d0660585a/" title="jenkins学习之记master的一次报错"><img src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="jenkins学习之记master的一次报错"/></a><div class="content"><a class="title" href="/mage/9e24b8712fd7596796aa8992d2b6496d0660585a/" title="jenkins学习之记master的一次报错">jenkins学习之记master的一次报错</a><time datetime="2022-11-11T05:29:56.000Z" title="更新于 2022-11-11 13:29:56">2022-11-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/3b62171753fddbbf78c36e3f6d7c9ba008365560/" title="Golang学习之mtail"><img src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Golang学习之mtail"/></a><div class="content"><a class="title" href="/mage/3b62171753fddbbf78c36e3f6d7c9ba008365560/" title="Golang学习之mtail">Golang学习之mtail</a><time datetime="2022-11-11T02:54:18.000Z" title="更新于 2022-11-11 10:54:18">2022-11-11</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2022 By mage</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>