<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹gerritè‡ªåŠ¨å¤‡ä»½åˆ†æ”¯ref-protectionæ’ä»¶ | é©¬å“¥ç§æˆ¿èœ</title><meta name="author" content="mage"><meta name="copyright" content="mage"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="æœ€è¿‘ç ”ç©¶äº†ä¸€ä¸ªgerritè‡ªåŠ¨å¤‡ä»½åˆ†æ”¯çš„æ’ä»¶ã€‚Ref protection ç›´è¯‘è¿‡æ¥å°±æ˜¯ å¼•ç”¨ä¿æŠ¤.ä¹Ÿå°±æ˜¯ä¿æŠ¤ gitä¸‹é¢ refs çš„ä¸€ä¸ªæ’ä»¶ 1234567891011Ref protection plugin.Protects against commits being lost by creating backups of deleted refs (or non-fast-forward">
<meta property="og:type" content="article">
<meta property="og:title" content="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹gerritè‡ªåŠ¨å¤‡ä»½åˆ†æ”¯ref-protectionæ’ä»¶">
<meta property="og:url" content="https://magesfc.github.io/mage/fdbb4b38b92cf47b0e24bc59c392393921287a2c/">
<meta property="og:site_name" content="é©¬å“¥ç§æˆ¿èœ">
<meta property="og:description" content="æœ€è¿‘ç ”ç©¶äº†ä¸€ä¸ªgerritè‡ªåŠ¨å¤‡ä»½åˆ†æ”¯çš„æ’ä»¶ã€‚Ref protection ç›´è¯‘è¿‡æ¥å°±æ˜¯ å¼•ç”¨ä¿æŠ¤.ä¹Ÿå°±æ˜¯ä¿æŠ¤ gitä¸‹é¢ refs çš„ä¸€ä¸ªæ’ä»¶ 1234567891011Ref protection plugin.Protects against commits being lost by creating backups of deleted refs (or non-fast-forward">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://t.mwm.moe/fj/">
<meta property="article:published_time" content="2022-02-23T09:47:18.000Z">
<meta property="article:modified_time" content="2022-10-31T08:56:22.000Z">
<meta property="article:author" content="mage">
<meta property="article:tag" content="android">
<meta property="article:tag" content="gerrit">
<meta property="article:tag" content="ref">
<meta property="article:tag" content="protection">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://t.mwm.moe/fj/"><link rel="shortcut icon" href="https://www.zeekrlife.com/favicon.png"><link rel="canonical" href="https://magesfc.github.io/mage/fdbb4b38b92cf47b0e24bc59c392393921287a2c/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":150,"languages":{"author":"ä½œè€…: mage","link":"é“¾æ¥: ","source":"æ¥æº: é©¬å“¥ç§æˆ¿èœ","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹gerritè‡ªåŠ¨å¤‡ä»½åˆ†æ”¯ref-protectionæ’ä»¶',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-10-31 16:56:22'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><style type="text/css">.card-announcement .social-button{margin:.6rem 0 0 0;text-align:center}.card-announcement .social-button a{display:block;background-color:var(--btn-bg);color:var(--btn-color);text-align:center;line-height:2.4;margin:4px 0}.card-announcement .social-button a:hover{background-color:var(--btn-hover-color)}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">219</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">230</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">40</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> ç›®å½•</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> ç²¾é€‰æ–‡æ¡£</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/21cfbf15/"><span> ğŸš€ å¿«é€Ÿå¼€å§‹</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/dc584b87/"><span> ğŸ“‘ ä¸»é¢˜é¡µé¢</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4aa8abbe/"><span> ğŸ›  ä¸»é¢˜é…ç½®-1</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/ceeb73f/"><span> ğŸ›  ä¸»é¢˜é…ç½®-2</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/98d20436/"><span> â“ ä¸»é¢˜é—®ç­”</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4073eda/"><span> âš¡ï¸ è¿›é˜¶æ•™ç¨‹</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/198a4240/"><span> âœ¨ æ›´æ–°æ—¥å¿—</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://butterfly.js.org/link/"><i class="fa-fw fas fa-thumbs-up"></i><span> å…¶ä»–ç¤ºä¾‹</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://t.mwm.moe/fj/')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">é©¬å“¥ç§æˆ¿èœ</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> ç›®å½•</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> ç²¾é€‰æ–‡æ¡£</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/21cfbf15/"><span> ğŸš€ å¿«é€Ÿå¼€å§‹</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/dc584b87/"><span> ğŸ“‘ ä¸»é¢˜é¡µé¢</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4aa8abbe/"><span> ğŸ›  ä¸»é¢˜é…ç½®-1</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/ceeb73f/"><span> ğŸ›  ä¸»é¢˜é…ç½®-2</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/98d20436/"><span> â“ ä¸»é¢˜é—®ç­”</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4073eda/"><span> âš¡ï¸ è¿›é˜¶æ•™ç¨‹</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/198a4240/"><span> âœ¨ æ›´æ–°æ—¥å¿—</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://butterfly.js.org/link/"><i class="fa-fw fas fa-thumbs-up"></i><span> å…¶ä»–ç¤ºä¾‹</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹gerritè‡ªåŠ¨å¤‡ä»½åˆ†æ”¯ref-protectionæ’ä»¶</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2022-02-23T09:47:18.000Z" title="å‘è¡¨äº 2022-02-23 17:47:18">2022-02-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2022-10-31T08:56:22.000Z" title="æ›´æ–°äº 2022-10-31 16:56:22">2022-10-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/android/">android</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹gerritè‡ªåŠ¨å¤‡ä»½åˆ†æ”¯ref-protectionæ’ä»¶"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="æœ€è¿‘ç ”ç©¶äº†ä¸€ä¸ªgerritè‡ªåŠ¨å¤‡ä»½åˆ†æ”¯çš„æ’ä»¶ã€‚"><a href="#æœ€è¿‘ç ”ç©¶äº†ä¸€ä¸ªgerritè‡ªåŠ¨å¤‡ä»½åˆ†æ”¯çš„æ’ä»¶ã€‚" class="headerlink" title="æœ€è¿‘ç ”ç©¶äº†ä¸€ä¸ªgerritè‡ªåŠ¨å¤‡ä»½åˆ†æ”¯çš„æ’ä»¶ã€‚"></a>æœ€è¿‘ç ”ç©¶äº†ä¸€ä¸ªgerritè‡ªåŠ¨å¤‡ä»½åˆ†æ”¯çš„æ’ä»¶ã€‚</h1><p>Ref protection ç›´è¯‘è¿‡æ¥å°±æ˜¯ å¼•ç”¨ä¿æŠ¤.ä¹Ÿå°±æ˜¯ä¿æŠ¤ gitä¸‹é¢ refs çš„ä¸€ä¸ªæ’ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Ref protection plugin.</span><br><span class="line"></span><br><span class="line">Protects against commits being lost by creating backups of deleted refs (or non-fast-forward commits) under the refs/backups/ namespace.</span><br><span class="line"></span><br><span class="line">Branch deletion protection can be disabled by setting plugin.ref-protection.protectDeleted <span class="literal">false</span> <span class="keyword">in</span> gerrit.config. Similarly, non-fast-forward update protection can be disabled with plugin.ref-protection.protectFastForward <span class="literal">false</span>.</span><br><span class="line"></span><br><span class="line">Branches under refs/heads/ that are deleted or rewritten are backed up as refs/backups/heads/branch-name-YYYYMMDD-HHmmss by default, or as sequentially increasing numbers under refs/backups/heads/branch-name/<span class="comment"># by setting plugin.ref-protection.useTimestamp false.</span></span><br><span class="line"></span><br><span class="line">Tags under refs/tags/ that are deleted are backed up (as branches) as refs/backups/tags/tag-name-YYYYMMDD-HHmmss or as sequentially increasing numbers under refs/backups/tags/branch-name/<span class="comment"># using the same plugin.ref-protection.useTimestamp setting.</span></span><br><span class="line"></span><br><span class="line">By default, the backups are created as branches. Optionally, they may be created as tags, containing information about the original ref that was changed, as well as the user that performed the change. This can be enabled by setting plugin.ref-protection.createTag <span class="literal">true</span>.</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®è¯´æ˜ æ˜¯å½“åœ¨gerritä¸Šåˆ é™¤åˆ†æ”¯&#x2F;æˆ–è€…é‡‡ç”¨äº† git å¼ºåˆ¶pushçš„æ—¶å€™ï¼Œä¼šè§¦å‘è¿™ä¸ªå¤‡ä»½åˆ†æ”¯çš„åŠ¨ä½œã€‚<br>åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°,git å¼ºåˆ¶pushçš„æ—¶å€™ä¼šæŠ¥å¦‚ä¸‹çš„é”™è¯¯ã€‚é€šè¿‡åˆ†æå‘ç°æ˜¯ git pushçš„è¿™ä¸ªè´¦å·æ²¡æœ‰<br>åœ¨ refs&#x2F;backups&#x2F;* ä¸‹é¢æœ‰ create refs çš„æƒé™ã€‚åŠ ä¸Šè¿™ä¸ªæƒé™å°±ä¸ä¼šæŠ¥é”™äº†ã€‚<br>ä¸è¿‡æ€»è§‰å¾—è¿™ä¸ªä¸åˆç†ã€‚ä½ ç®¡æˆ‘æ€ä¹ˆæ“ä½œçš„ï¼Œä½ éƒ½è¦ç»™æˆ‘å¤‡ä»½äº†å°±è¡Œäº†ã€‚</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[2019-12-31 16:23:13,294] [ReceiveCommits-1] ERROR com.googlesource.gerrit.plugins.refprotection.BackupRef : CreateBranch.Input: refs/backups/heads/test_for_20191231_162313-5130c6f4d1dd84a9eae13eca14e627db50f843bd</span><br><span class="line">[2019-12-31 16:23:13,294] [ReceiveCommits-1] ERROR com.googlesource.gerrit.plugins.refprotection.BackupRef : CreateBranch.Input: com.google.gerrit.server.project.CreateBranch$Factory</span><br><span class="line">[2019-12-31 16:23:13,294] [ReceiveCommits-1] ERROR com.googlesource.gerrit.plugins.refprotection.BackupRef : project: com.google.gerrit.server.project.ProjectResource@55f9da39</span><br><span class="line">[2019-12-31 16:23:13,297] [ReceiveCommits-1] ERROR com.googlesource.gerrit.plugins.refprotection.BackupRef : Cannot create &quot;refs/backups/heads/test_for_20191231_162313&quot;</span><br><span class="line">com.google.gerrit.extensions.restapi.AuthException: Cannot create &quot;refs/backups/heads/test_for_20191231_162313&quot;</span><br><span class="line">	at com.google.gerrit.server.project.CreateBranch.apply(CreateBranch.java:138)</span><br><span class="line">	at com.googlesource.gerrit.plugins.refprotection.BackupRef.createBackup(BackupRef.java:162)</span><br><span class="line">	at com.googlesource.gerrit.plugins.refprotection.RefUpdateListener.onEvent(RefUpdateListener.java:92)</span><br><span class="line">	at com.google.gerrit.common.ChangeHookRunner.fireEventForUnrestrictedListeners(ChangeHookRunner.java:742)</span><br><span class="line">	at com.google.gerrit.common.ChangeHookRunner.fireEvent(ChangeHookRunner.java:789)</span><br><span class="line">	at com.google.gerrit.common.ChangeHookRunner.doRefUpdatedHook(ChangeHookRunner.java:610)</span><br><span class="line">	at com.google.gerrit.server.git.ReceiveCommits.processCommands(ReceiveCommits.java:662)</span><br><span class="line">	at com.google.gerrit.server.git.AsyncReceiveCommits$Worker.run(AsyncReceiveCommits.java:89)</span><br><span class="line">	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)</span><br><span class="line">	at com.google.gerrit.server.util.RequestScopePropagator$5.call(RequestScopePropagator.java:222)</span><br><span class="line">	at com.google.gerrit.server.util.RequestScopePropagator$4.call(RequestScopePropagator.java:201)</span><br><span class="line">	at com.google.gerrit.server.util.ThreadLocalRequestScopePropagator$1.call(ThreadLocalRequestScopePropagator.java:55)</span><br><span class="line">	at com.google.gerrit.server.util.RequestScopePropagator$1.call(RequestScopePropagator.java:98)</span><br><span class="line">	at com.google.gerrit.server.util.RequestScopePropagator$2.run(RequestScopePropagator.java:131)</span><br><span class="line">	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)</span><br><span class="line">	at java.util.concurrent.FutureTask.run(FutureTask.java:266)</span><br><span class="line">	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)</span><br><span class="line">	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)</span><br><span class="line">	at com.google.gerrit.server.git.WorkQueue$Task.run(WorkQueue.java:376)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class="line">	at java.lang.Thread.run(Thread.java:748)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">åœ¨ refs/backups/* ä¸‹é¢æœ‰ create refs çš„æƒé™</span><br><span class="line">-[access &quot;refs/backups/*&quot;]</span><br><span class="line">-	create = group Administrators</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>ä¸‹é¢è¿™ä¸ªæ˜¯åœ¨gerritä¸Šåˆ é™¤åˆ†æ”¯ è§¦å‘çš„ æ‰“å°çš„æ—¥å¿—ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[2019-12-31 16:21:26,179] [HTTP-71] INFO  com.googlesource.gerrit.plugins.refprotection.RefUpdateListener : Ref Deleted: project [git/shared/tools/blog] refname [refs/heads/test4] old object <span class="built_in">id</span> [5130c6f4d1dd84a9eae13eca14e627db50f843bd]</span><br><span class="line">[2019-12-31 16:21:26,180] [HTTP-71] ERROR com.googlesource.gerrit.plugins.refprotection.BackupRef : CreateBranch.Input: refs/backups/heads/test4_for_20191231_162126-5130c6f4d1dd84a9eae13eca14e627db50f843bd</span><br><span class="line">[2019-12-31 16:21:26,180] [HTTP-71] ERROR com.googlesource.gerrit.plugins.refprotection.BackupRef : CreateBranch.Input: com.google.gerrit.server.project.CreateBranch<span class="variable">$Factory</span></span><br><span class="line">[2019-12-31 16:21:26,180] [HTTP-71] ERROR com.googlesource.gerrit.plugins.refprotection.BackupRef : project: com.google.gerrit.server.project.ProjectResource@2ad678a6</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢å‡†å¤‡é€šè¿‡æºç æ¥ è·Ÿè¸ªä¸€ä¸‹æ‰§è¡Œè¿‡ç¨‹ï¼Œçœ‹çœ‹ä¸ºå•¥ä¼šæœ‰è¿™ä¸ªåŒºåˆ«ã€‚æˆ–è€…ä¸ºå•¥ä¼šæœ‰è¿™ä¸ªæŠ¥é”™ã€‚</p>
<p>å‡†å¤‡å·¥ä½œ</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">gerrit 2.12.x ç‰ˆæœ¬</span><br><span class="line"></span><br><span class="line">ä»githubå…‹éš†æ’ä»¶æºä»£ç ã€‚å¹¶ä¸”æ£€å‡ºåˆ° 2.12çš„åˆ†æ”¯ä¸Šã€‚</span><br><span class="line">~/gerrit/plugins/ref-protection</span><br><span class="line">$ git ll</span><br><span class="line">*   3422dca - Merge branch &#x27;stable-2.11&#x27; into master                                                                                   â€” Doug Kelly (HEAD, origin/stable-2.12) - (4 å¹´ 2 ä¸ªæœˆå‰)</span><br><span class="line">|\  </span><br><span class="line">| * 0359382 - Fix buck test in standalone BUCK build                                                                                   â€” David Ostrovsky - (4 å¹´ 7 ä¸ªæœˆå‰)</span><br><span class="line">| * 31473ff - Add standalone BUCK build                                                                                                â€” David Pursehouse - (4 å¹´ 7 ä¸ªæœˆå‰)</span><br><span class="line">* | 0b80a00 - Add documentation updates                                                                                                â€” Doug Kelly - (4 å¹´ 5 ä¸ªæœˆå‰)</span><br><span class="line">* | bc23cba - Add details from original tag                                                                                            â€” Doug Kelly - (4 å¹´ 3 ä¸ªæœˆå‰)</span><br><span class="line">* | 7ca1b83 - Add ability to back up as tag                                                                                            â€” Doug Kelly - (4 å¹´ 3 ä¸ªæœˆå‰)</span><br><span class="line">* | 164b578 - Correct backup of tags                                                                                                   â€” Doug Kelly - (4 å¹´ 2 ä¸ªæœˆå‰)</span><br><span class="line">* | 241b34a - Switch to EventListener                                                                                                  â€” Doug Kelly - (4 å¹´ 3 ä¸ªæœˆå‰)</span><br><span class="line">* | 6367acf - Add configuration for backup branch names                                                                                â€” Doug Kelly - (4 å¹´ 3 ä¸ªæœˆå‰)</span><br><span class="line">* | a711e12 - Add configuration for levels of protection                                                                               â€” Doug Kelly - (4 å¹´ 3 ä¸ªæœˆå‰)</span><br><span class="line">* | 95d2f2c - Fix MissingObjectException when checking for non-ff update                                                               â€” Doug Kelly - (4 å¹´ 3 ä¸ªæœˆå‰)</span><br><span class="line">* | 007313a - Refactor backup creation to BackupRef                                                                                    â€” Doug Kelly - (4 å¹´ 6 ä¸ªæœˆå‰)</span><br><span class="line">|/  </span><br><span class="line">* 7d6c9c6 - Add missing licence headers                                                                                              â€” David Pursehouse - (4 å¹´ 7 ä¸ªæœˆå‰)</span><br><span class="line">* 9d3c6e2 - Convert to use auto-closeable Repository and RevWalk                                                                     â€” David Pursehouse - (4 å¹´ 10 ä¸ªæœˆå‰)</span><br><span class="line">* 72eebe7 - Create backup branches under refs/backups/                                                                               â€” David Pursehouse - (5 å¹´å‰)</span><br><span class="line">* ea03470 - Fix a couple of minor style nits                                                                                         â€” David Pursehouse - (5 å¹´å‰)</span><br><span class="line">* 27c081e - Add manifest entries in BUCK file                                                                                        â€” David Pursehouse - (5 å¹´å‰)</span><br><span class="line">* 3c9f593 - Handle non-fast-forward pushes                                                                                           â€” Arun Kumar - (5 å¹´å‰)</span><br><span class="line">* a17c079 - Added backup branch creation for deleted refs                                                                            â€” Arun Kumar - (6 å¹´å‰)</span><br><span class="line">* f5cf43e - Initial stub implementation                                                                                              â€” David Pursehouse - (6 å¹´å‰)</span><br><span class="line">* df617dc - Initial empty commit                                                                                                     â€” David Pursehouse - (6 å¹´å‰)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä»githubå…‹éš†gerritæºä»£ç ã€‚å¹¶ä¸”æ£€å‡ºåˆ° origin/stable-2.12 çš„åˆ†æ”¯ä¸Š</span><br><span class="line">*   84f29ff - Merge branch &#x27;stable-2.11&#x27; into stable-2.12                                                                              â€” David Pursehouse (HEAD, origin/stable-2.12) - (12 ä¸ªæœˆå‰)</span><br><span class="line">|\  </span><br><span class="line">| *   a53bbb0 - Merge branch &#x27;stable-2.10&#x27; into stable-2.11                                                                              â€” David Pursehouse (origin/stable-2.11) - (12 ä¸ªæœˆå‰)</span><br><span class="line">| |\  </span><br><span class="line">| | *   ed2d5ce - Merge branch &#x27;stable-2.9&#x27; into stable-2.10                                                                               â€” David Pursehouse (origin/stable-2.10) - (12 ä¸ªæœˆå‰)</span><br><span class="line">| | |\  </span><br><span class="line">| | | * 5c6e69a - Consume JGit artifacts from Maven Central                                                                                â€” David Pursehouse (origin/stable-2.9) - (12 ä¸ªæœˆå‰)</span><br><span class="line">| | * | 51a1fa3 - Add release notes for Gerrit v2.10.8                                                                                     â€” Luca Milanesio - (12 ä¸ªæœˆå‰)</span><br><span class="line">| | * |   8943b0c - Merge branch &#x27;stable-2.9&#x27; into stable-2.10                                                                               â€” Luca Milanesio - (12 ä¸ªæœˆå‰)</span><br><span class="line">| | |\ \  </span><br><span class="line">| | | |/  </span><br><span class="line">| | | * decc35e - Add release notes for Gerrit v2.9.5                                                                                      â€” Luca Milanesio - (12 ä¸ªæœˆå‰)</span><br><span class="line">| | | * 2434df4 - Set version to 2.9.5                                                                                                     â€” Luca Milanesio (tag: v2.9.5) - (12 ä¸ªæœˆå‰)</span><br><span class="line">| | * | b5290de - Set version to 2.10.8                                                                                                    â€” Luca Milanesio (tag: v2.10.8) - (12 ä¸ªæœˆå‰)</span><br><span class="line">| * | | ec3ba0c - Set version to 2.11.12                                                                                                   â€” Luca Milanesio (tag: v2.11.12) - (12 ä¸ªæœˆå‰)</span><br><span class="line">* | | | 57ceed8 - Set version to 2.12.9                                                                                                    â€” Luca Milanesio (tag: v2.12.9) - (12 ä¸ªæœˆå‰)</span><br><span class="line">* | | |   08dd052 - Merge branch &#x27;stable-2.11&#x27; into stable-2.12                                                                              â€” Luca Milanesio - (12 ä¸ªæœˆå‰)</span><br><span class="line">|\ \ \ \  </span><br><span class="line">| |/ / /  </span><br><span class="line">| * | |   043b101 - Merge branch &#x27;stable-2.10&#x27; into stable-2.11                                                                              â€” Luca Milanesio - (12 ä¸ªæœˆå‰)</span><br><span class="line">| |\ \ \  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç¼–è¯‘gerrit 2.12.xç‰ˆæœ¬éœ€è¦ç”¨åˆ°buckå·¥å…·</span><br><span class="line"></span><br><span class="line">åœ¨githubä¸Šå…‹éš†https://github.com/facebook/buck.gitç”¨åˆ°buckå·¥å…·</span><br><span class="line"></span><br><span class="line">é€šè¿‡gerritä»£ç ä¸­çš„.buckversionæ–‡ä»¶å†³å®š buck å·¥å…·çš„ç‰ˆæœ¬ï¼Œ</span><br><span class="line">$ cat .buckversion </span><br><span class="line">1b03b4313b91b634bd604fc3487a05f877e59dee</span><br><span class="line"></span><br><span class="line">å…‹éš†å®Œæˆbuckå·¥å…·ï¼Œåˆ‡æ¢æ£€å‡ºåˆ° 1b03b4313b91b634bd604fc3487a05f877e59dee è¿™ä¸ªèŠ‚ç‚¹ã€‚</span><br><span class="line">* 1b03b43 - Add some support for running go tests.                                                                         </span><br><span class="line">* 1a6880e - Revert &quot;Add some support for running go tests.&quot;                                                                </span><br><span class="line">* 0b581a2 - C/C++: remove lex/yacc support                                                                                 </span><br><span class="line">* bd13811 - Add some support for running go tests.                                                                         </span><br><span class="line">* 8979c16 - Update to build-tools-23.0.2 in Travis                                                                         </span><br><span class="line">* 2c883f1 - Represent code sign identity fingerprint as Optional&lt;HashCode&gt;                                                 </span><br><span class="line">* f23f93e - Introduce paths-only target hash file mode                                                                     </span><br><span class="line">* 2e5ed11 - Default to BSER output from buck.py and remove JSON output parser                                              </span><br><span class="line">* c22418c - [halide] Build &quot;universal&quot; binaries for Halide libraries                                                       </span><br><span class="line">* d42cabf - Remove unexracted download artifacts                                                                           </span><br><span class="line">* f097b5e - Install the NDK to run those tests                                                                             </span><br><span class="line">* 47b9ee8 - Test Java 7 with CI as well                                                                                    </span><br><span class="line">* a7f980b - Remember Watchman warnings encountered during query so we can pass them to Watchman glob handler               </span><br><span class="line">* f1238db - Easy: Remove unused interface ProjectFilesystemWatcher</span><br><span class="line"></span><br><span class="line">ç¼–è¯‘buckå·¥å…·ï¼Œéœ€è¦antå·¥å…·ï¼Œ ä»ç½‘ä¸Šä¸‹è½½antå·¥å…·å°±è¡Œï¼Œæ·»åŠ antåˆ°ç¯å¢ƒå˜é‡ PATH</span><br><span class="line">ç„¶ååˆ° buck ç›®å½•æ‰§è¡Œ ant å‘½ä»¤ï¼Œç¼–è¯‘å‡ºæ¥ buck å·¥å…·ã€‚</span><br><span class="line"></span><br><span class="line">buckç¼–è¯‘å®Œæˆååœ¨ $HOME/bin ç›®å½•ä¸‹é¢ åˆ›å»º buck çš„è½¯è¿æ¥ã€‚</span><br><span class="line">$ ll ~/bin/buck</span><br><span class="line">lrwxrwxrwx 1 mamh mamh 29 11æœˆ 11  2018 /home/mamh/bin/buck -&gt; /work/buck/bin/buck*</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ç¼–è¯‘ gerrit å’Œ æ’ä»¶ </span><br><span class="line"></span><br><span class="line">buck build release </span><br><span class="line"></span><br><span class="line">éœ€è¦ä¿®æ”¹plugin/BUCK æ–‡ä»¶</span><br><span class="line">BASE = get_base_path()</span><br><span class="line">CORE = [</span><br><span class="line">  &#x27;commit-message-length-validator&#x27;,</span><br><span class="line">  &#x27;download-commands&#x27;,</span><br><span class="line">  &#x27;replication&#x27;,</span><br><span class="line">  &#x27;reviewnotes&#x27;,</span><br><span class="line">  &#x27;singleusergroup&#x27;,</span><br><span class="line">  &#x27;ref-protection&#x27;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">æ’ä»¶ç”Ÿæˆä½ç½®ï¼š buck-out/gen/plugins/ref-protection/ref-protection.jar</span><br><span class="line"></span><br><span class="line">æˆ–è€…ä¸ä¿®æ”¹ BUCKæ–‡ä»¶ è€Œ å€¼ç¼–è¯‘ è¿™ä¸ªæ’ä»¶æœ¬èº«</span><br><span class="line">buck build plugins/ref-protection</span><br></pre></td></tr></table></figure>

<p>æŠ¥é”™çš„åœ°æ–¹ plugins&#x2F;ref-protection&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;googlesource&#x2F;gerrit&#x2F;plugins&#x2F;refprotection&#x2F;BackupRef.java</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#125; else &#123;</span><br><span class="line">    CreateBranch.Input input = new CreateBranch.Input();</span><br><span class="line">    input.ref = backupRef;</span><br><span class="line">    // We need to parse the commit to ensure if it&#x27;s a tag, we get the</span><br><span class="line">    // commit the tag points to!</span><br><span class="line">    input.revision = ObjectId.toString(revWalk.parseCommit(ObjectId.fromString(event.refUpdate.oldRev)).getId());</span><br><span class="line">    log.error(&quot;CreateBranch.Input: &quot; + String.format(&quot;%s-%s&quot;,input.ref, input.revision));</span><br><span class="line">    try &#123;</span><br><span class="line">        log.error(&quot;CreateBranch.Input: &quot;+ createBranchFactory);</span><br><span class="line">        log.error(&quot;project: &quot; +  project);</span><br><span class="line">        createBranchFactory.create(backupRef).apply(project, input);</span><br><span class="line">    &#125; catch (BadRequestException | AuthException | ResourceConflictException | IOException e) &#123;</span><br><span class="line">        log.error(e.getMessage(), e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡æ‰“å° RefControl å¯¹è±¡,æˆ‘ä»¬å‘ç°ä¸¤ç§æ“ä½œ() æ—¶å€™çš„ RefControl å¯¹è±¡åŸºæœ¬ä¸Šæ²¡å•¥å·®å¼‚</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">RefControl&#123;</span><br><span class="line">projectControl=</span><br><span class="line">	ProjectControl&#123;</span><br><span class="line">		uploadGroups=</span><br><span class="line">		[global%3ARegistered-Users, global%3AAnonymous-Users], receiveGroups=[global%3ARegistered-Users]</span><br><span class="line">		, canonicalWebUrl=&#x27;http://gerrit.example.com:8080/&#x27;</span><br><span class="line">		, user=IdentifiedUser[account 1000000]</span><br><span class="line">		, state=com.google.gerrit.server.project.ProjectState@151533ed</span><br><span class="line">		, repoManager=com.google.gerrit.server.git.LocalDiskRepositoryManager@63fa17dc</span><br><span class="line">		, changeControlFactory=com.google.gerrit.server.project.ChangeControl$AssistedFactory</span><br><span class="line">		, permissionFilter=com.google.gerrit.server.project.PermissionCollection$Factory@2b652749</span><br><span class="line">		, contributorAgreements=[]</span><br><span class="line">		, tagCache=com.google.gerrit.server.git.TagCache@57e993dd</span><br><span class="line">		, changeCache=com.google.gerrit.server.git.SearchingChangeCacheImpl@6b5f5896</span><br><span class="line">		, allSections=[com.google.gerrit.server.project.SectionMatcher@4119ca1d, </span><br><span class="line">						com.google.gerrit.server.project.SectionMatcher@5093a140, </span><br><span class="line">						com.google.gerrit.server.project.SectionMatcher@4f92e3c2,</span><br><span class="line">						com.google.gerrit.server.project.SectionMatcher@3bfc8530, </span><br><span class="line">						com.google.gerrit.server.project.SectionMatcher@34bae970]</span><br><span class="line">		, localSections=null</span><br><span class="line">		, labelTypes=null</span><br><span class="line">		, declaredOwner=null</span><br><span class="line">	&#125;</span><br><span class="line">, refName=&#x27;refs/backups/heads/test5_for_20200109_181945&#x27;</span><br><span class="line">, relevant=PermissionCollection&#123;rules=&#123;read=[group Administrators, group Anonymous Users]&#125;, overridden=&#123;&#125;, ruleProps=&#123;group Administrators=ProjectRef&#123;project=All-Projects, ref=refs/*&#125;, group Anonymous Users=ProjectRef&#123;project=All-Projects, ref=refs/*&#125;&#125;, perUser=false&#125;</span><br><span class="line">, effective=&#123;&#125;</span><br><span class="line">, owner=null</span><br><span class="line">, canForgeAuthor=null</span><br><span class="line">, canForgeCommitter=null</span><br><span class="line">, isVisible=null</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">RefControl&#123;</span><br><span class="line">projectControl=</span><br><span class="line">	ProjectControl&#123;</span><br><span class="line">	uploadGroups=[global%3ARegistered-Users, global%3AAnonymous-Users], receiveGroups=[global%3ARegistered-Users]</span><br><span class="line">		, canonicalWebUrl=&#x27;http://gerrit.example.com:8080/&#x27;</span><br><span class="line">		, user=IdentifiedUser[account 1000000]</span><br><span class="line">		, state=com.google.gerrit.server.project.ProjectState@151533ed</span><br><span class="line">		, repoManager=com.google.gerrit.server.git.LocalDiskRepositoryManager@63fa17dc</span><br><span class="line">		, changeControlFactory=com.google.gerrit.server.project.ChangeControl$AssistedFactory</span><br><span class="line">		, permissionFilter=com.google.gerrit.server.project.PermissionCollection$Factory@2b652749</span><br><span class="line">		, contributorAgreements=[]</span><br><span class="line">		, tagCache=com.google.gerrit.server.git.TagCache@57e993dd</span><br><span class="line">		, changeCache=com.google.gerrit.server.git.SearchingChangeCacheImpl@6b5f5896</span><br><span class="line">		, allSections=[com.google.gerrit.server.project.SectionMatcher@4119ca1d, </span><br><span class="line">					com.google.gerrit.server.project.SectionMatcher@5093a140,</span><br><span class="line">					com.google.gerrit.server.project.SectionMatcher@4f92e3c2,</span><br><span class="line">					com.google.gerrit.server.project.SectionMatcher@3bfc8530, </span><br><span class="line">					com.google.gerrit.server.project.SectionMatcher@34bae970]</span><br><span class="line">		, localSections=null</span><br><span class="line">		, labelTypes=null</span><br><span class="line">		, declaredOwner=null</span><br><span class="line">	&#125;</span><br><span class="line">, refName=&#x27;refs/backups/heads/test5_for_20200109_182142&#x27;</span><br><span class="line">, relevant=PermissionCollection&#123;rules=&#123;read=[group Administrators, group Anonymous Users]&#125;, overridden=&#123;&#125;, ruleProps=&#123;group Administrators=ProjectRef&#123;project=All-Projects, ref=refs/*&#125;, group ; Users=ProjectRef&#123;project=All-Projects, ref=refs/*&#125;&#125;, perUser=false&#125;</span><br><span class="line">, effective=&#123;&#125;</span><br><span class="line">, owner=null</span><br><span class="line">, canForgeAuthor=null</span><br><span class="line">, canForgeCommitter=null</span><br><span class="line">, isVisible=null</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æ˜¯åœ¨gerritä¸Šæ“ä½œåˆ é™¤åˆ†æ”¯çš„æ—¥å¿—</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[2020-01-09 18:43:32,983] [HTTP-62] INFO  com.google.gerrit.server.project.CreateBranch : ===========================================</span><br><span class="line">[2020-01-09 18:43:32,985] [HTTP-62] INFO  com.google.gerrit.server.project.RefControl : ReviewDb = com.google.gerrit.reviewdb.server.ReviewDb_Schema_GwtOrm$$20@188ac92c</span><br><span class="line">[2020-01-09 18:43:32,985] [HTTP-62] INFO  com.google.gerrit.server.project.RefControl : RevWalk = org.eclipse.jgit.revwalk.ObjectWalk@41980182</span><br><span class="line">[2020-01-09 18:43:32,985] [HTTP-62] INFO  com.google.gerrit.server.project.RefControl : RevObject = commit 2f335d90bca227f7c8d115990081c5dcf6be5ac5 1573610871 -----p</span><br><span class="line">[2020-01-09 18:43:32,985] [HTTP-62] INFO  com.google.gerrit.server.project.RefControl : if (object instanceof RevCommit) &#123; start</span><br><span class="line">[2020-01-09 18:43:32,985] [HTTP-62] INFO  com.google.gerrit.server.project.RefControl : (admin || (owner &amp;&amp; !isBlocked(Permission.CREATE))) </span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>ä¸‹é¢æ˜¯ å¼ºåˆ¶ pushè¾“å‡ºçš„æ—¥å¿—</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[2020-01-09 18:44:32,117] [ReceiveCommits-2] INFO  com.google.gerrit.server.project.CreateBranch : ===========================================</span><br><span class="line">[2020-01-09 18:44:32,118] [ReceiveCommits-2] INFO  com.google.gerrit.server.project.RefControl : ReviewDb = com.google.gerrit.reviewdb.server.ReviewDb_Schema_GwtOrm$$20@7b303c26</span><br><span class="line">[2020-01-09 18:44:32,118] [ReceiveCommits-2] INFO  com.google.gerrit.server.project.RefControl : RevWalk = org.eclipse.jgit.revwalk.ObjectWalk@17c09ed9</span><br><span class="line">[2020-01-09 18:44:32,118] [ReceiveCommits-2] INFO  com.google.gerrit.server.project.RefControl : RevObject = commit 2f335d90bca227f7c8d115990081c5dcf6be5ac5 1573610871 -----p</span><br><span class="line">[2020-01-09 18:44:32,118] [ReceiveCommits-2] INFO  com.google.gerrit.server.project.RefControl : if (object instanceof RevCommit) &#123; start</span><br><span class="line">[2020-01-09 18:44:32,118] [ReceiveCommits-2] INFO  com.google.gerrit.server.project.RefControl : else if (!canPerform(Permission.CREATE)) </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç»§ç»­è¿½è¸ªä»£ç </p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">é€šè¿‡ä¹‹å‰ pushæ—¶å€™æŠ¥é”™ æˆ‘è¿½è¸ªåˆ° è¿™é‡Œ plugins/ref-protection/src/main/java/com/googlesource/gerrit/plugins/refprotection/BackupRef.java</span><br><span class="line">try &#123;</span><br><span class="line">    createBranchFactory.create(backupRef).apply(project, input);</span><br><span class="line">&#125; catch (BadRequestException | AuthException | ResourceConflictException | IOException e) &#123;</span><br><span class="line">    log.error(e.getMessage(), e);</span><br><span class="line">&#125;</span><br><span class="line">          </span><br><span class="line">ç»§ç»­è¿½è¸ªä»£ç æ‰§è¡Œæ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ gerrit-server/src/main/java/com/google/gerrit/server/project/CreateBranch.java ä¸­çš„apply()æ–¹æ³•å¤„</span><br><span class="line">æŠ¥é”™çš„åœ°æ–¹ ç›´æ¥æ‰¾åˆ°è¿™ä¸ªå¤„</span><br><span class="line">rw.reset();</span><br><span class="line">if (!refControl.canCreate(db.get(), rw, object)) &#123;</span><br><span class="line">    throw new AuthException(&quot;Cannot create \&quot;&quot; + ref + &quot;\&quot;&quot;);</span><br><span class="line">&#125;</span><br><span class="line">åˆ°è¿™é‡Œæ‰¾åˆ°äº† æŠ¥é”™çš„åœ°æ–¹, ä¹Ÿå°±æ˜¯ifåˆ¤æ–­è¿‡å ä¸»åŠ¨ æŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸,åˆ°è¿™é‡Œçš„ä»£ç éƒ½ä¸å±äº æ’ä»¶çš„ä»£ç äº†.</span><br><span class="line">[2020-01-09 18:44:32,119] [ReceiveCommits-2] ERROR com.googlesource.gerrit.plugins.refprotection.BackupRef : Cannot create &quot;refs/backups/heads/test5_for_20200109_184432&quot;</span><br><span class="line">com.google.gerrit.extensions.restapi.AuthException: Cannot create &quot;refs/backups/heads/test5_for_20200109_184432&quot;</span><br><span class="line">	at com.google.gerrit.server.project.CreateBranch.apply(CreateBranch.java:144)</span><br><span class="line">	at com.googlesource.gerrit.plugins.refprotection.BackupRef.createBackup(BackupRef.java:166)</span><br><span class="line">	at com.googlesource.gerrit.plugins.refprotection.RefUpdateListener.onEvent(RefUpdateListener.java:103)</span><br><span class="line">	at com.google.gerrit.common.ChangeHookRunner.fireEventForUnrestrictedListeners(ChangeHookRunner.java:742)</span><br><span class="line">	at com.google.gerrit.common.ChangeHookRunner.fireEvent(ChangeHookRunner.java:789)</span><br><span class="line">	at com.google.gerrit.common.ChangeHookRunner.doRefUpdatedHook(ChangeHookRunner.java:610)</span><br><span class="line">	at com.google.gerrit.server.git.ReceiveCommits.processCommands(ReceiveCommits.java:662)</span><br><span class="line">	at com.google.gerrit.server.git.AsyncReceiveCommits$Worker.run(AsyncReceiveCommits.java:89)</span><br><span class="line">	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)</span><br><span class="line">	at com.google.gerrit.server.util.RequestScopePropagator$5.call(RequestScopePropagator.java:222)</span><br><span class="line">	at com.google.gerrit.server.util.RequestScopePropagator$4.call(RequestScopePropagator.java:201)</span><br><span class="line">	at com.google.gerrit.server.util.ThreadLocalRequestScopePropagator$1.call(ThreadLocalRequestScopePropagator.java:55)</span><br><span class="line">	at com.google.gerrit.server.util.RequestScopePropagator$1.call(RequestScopePropagator.java:98)</span><br><span class="line">	at com.google.gerrit.server.util.RequestScopePropagator$2.run(RequestScopePropagator.java:131)</span><br><span class="line">	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)</span><br><span class="line">	at java.util.concurrent.FutureTask.run(FutureTask.java:266)</span><br><span class="line">	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)</span><br><span class="line">	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)</span><br><span class="line">	at com.google.gerrit.server.git.WorkQueue$Task.run(WorkQueue.java:376)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class="line">	at java.lang.Thread.run(Thread.java:748)</span><br></pre></td></tr></table></figure>


<p>ç»§ç»­è¿½è¸ªä»£ç </p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">ç»§ç»­è¿½è¸ªä»£ç  refControl.canCreate(db.get(), rw, object) çš„æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">ç»§ç»­å®šä½,å‘ç°åœ¨ refControl.canCreate() æ–¹æ³• ä¸­ ä¸¤ç§æ“ä½œ() æœ‰ä¸åŒäº†. ä¸€ä¸ªè¿”å›äº†false,ä¸€ä¸ªè¿”å›true.</span><br><span class="line"></span><br><span class="line">æˆ‘ä»¬åœ¨  canCreate() æ–¹æ³•ä¸­ åŠ ä¸Š æ—¥å¿—è¾“å‡º ä»è€Œåˆ¤æ–­ return true/false æ˜¯ åœ¨å“ªé‡Œæ‰§è¡Œçš„return.</span><br><span class="line">if (object instanceof RevCommit) &#123;</span><br><span class="line">    log.info(&quot;if (object instanceof RevCommit) &#123; start&quot;);</span><br><span class="line">    if (admin || (owner &amp;&amp; !isBlocked(Permission.CREATE))) &#123;</span><br><span class="line">        // Admin or project owner; bypass visibility check.</span><br><span class="line">        log.info(&quot;(admin || (owner &amp;&amp; !isBlocked(Permission.CREATE))) &quot;); ä¸‹é¢æ˜¯åœ¨gerritä¸Šæ“ä½œåˆ é™¤åˆ†æ”¯çš„æ—¥å¿—</span><br><span class="line">        return true;</span><br><span class="line">    &#125; else if (!canPerform(Permission.CREATE)) &#123;     </span><br><span class="line">        log.info(&quot;else if (!canPerform(Permission.CREATE)) &quot;);   å¼ºåˆ¶ pushè¾“å‡ºçš„æ—¥å¿—</span><br><span class="line">        return false;</span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">åˆ°è¿™é‡Œæ‰¾åˆ°äº†</span><br><span class="line">ä¸€ç§æƒ…å†µèµ°åˆ°äº† if (admin || (owner &amp;&amp; !isBlocked(Permission.CREATE))) &#123; åˆ¤æ–­,ç„¶åç›´æ¥è¿”å›trueäº†.</span><br><span class="line"></span><br><span class="line">å¦å¤–ä¸€ç§æƒ…å†µèµ°åˆ°äº† &#125; else if (!canPerform(Permission.CREATE)) &#123; åˆ¤æ–­,  ç„¶åç›´æ¥è¿”å› false äº†.</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>ä¸‹é¢å°±è¦åˆ†æ ä¸ºä»€ä¹ˆä¸¤ç§æ“ä½œ èµ°çš„ ä¸åŒçš„ if else è¯­å¥äº†</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">æˆ‘ä»¬åœ¨  canCreate() æ–¹æ³•ä¸­ ç»§ç»­åŠ ä¸Šæ›´å¤šçš„  æ—¥å¿—è¾“å‡º</span><br><span class="line"></span><br><span class="line">public boolean canCreate(ReviewDb db, RevWalk rw, RevObject object) &#123;</span><br><span class="line">    log.info(&quot;ReviewDb = &quot; + db);</span><br><span class="line">    log.info(&quot;RevWalk = &quot; + rw);</span><br><span class="line">    log.info(&quot;RevObject = &quot; + object);</span><br><span class="line"></span><br><span class="line">    log.info(&quot;getUser() = &quot; + getUser()); //IdentifiedUser[account 1000000]</span><br><span class="line">    log.info(&quot;getUser().getAccessPath() = &quot; + getUser().getAccessPath());</span><br><span class="line">    log.info(&quot;getUser().getCapabilities().canAdministrateServer() = &quot; + getUser().getCapabilities().canAdministrateServer());</span><br><span class="line"></span><br><span class="line">    if (!canWrite()) &#123;</span><br><span class="line">        log.info(&quot;canWrite = &quot; + canWrite());</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    boolean owner;</span><br><span class="line">    boolean admin;</span><br><span class="line">    switch (getUser().getAccessPath()) &#123;</span><br><span class="line">        case REST_API:</span><br><span class="line">        case JSON_RPC:</span><br><span class="line">        case UNKNOWN:</span><br><span class="line">            owner = isOwner();</span><br><span class="line">            admin = getUser().getCapabilities().canAdministrateServer();</span><br><span class="line">            break;</span><br><span class="line"></span><br><span class="line">        default:</span><br><span class="line">            owner = false;</span><br><span class="line">            admin = false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">ä¸‹é¢æ˜¯åœ¨gerritä¸Šç›´æ¥æ“ä½œçš„è¾“å‡ºæ—¥å¿—</span><br><span class="line">[2020-01-09 19:55:35,726] [HTTP-64] INFO  com.google.gerrit.server.project.RefControl : ReviewDb = com.google.gerrit.reviewdb.server.ReviewDb_Schema_GwtOrm$$20@3ca80f6c</span><br><span class="line">[2020-01-09 19:55:35,726] [HTTP-64] INFO  com.google.gerrit.server.project.RefControl : RevWalk = org.eclipse.jgit.revwalk.ObjectWalk@7594c212</span><br><span class="line">[2020-01-09 19:55:35,726] [HTTP-64] INFO  com.google.gerrit.server.project.RefControl : RevObject = commit c620bcc00a0cefbfcb760ca4185dd0269b9bb409 1573610856 -----p</span><br><span class="line">[2020-01-09 19:55:35,726] [HTTP-64] INFO  com.google.gerrit.server.project.RefControl : getUser() = IdentifiedUser[account 1000000]</span><br><span class="line">[2020-01-09 19:55:35,726] [HTTP-64] INFO  com.google.gerrit.server.project.RefControl : getUser().getAccessPath() = REST_API</span><br><span class="line">[2020-01-09 19:55:35,726] [HTTP-64] INFO  com.google.gerrit.server.project.RefControl : getUser().getCapabilities().canAdministrateServer() = true</span><br><span class="line">[2020-01-09 19:55:35,726] [HTTP-64] INFO  com.google.gerrit.server.project.RefControl : if (object instanceof RevCommit) &#123; start</span><br><span class="line">[2020-01-09 19:55:35,726] [HTTP-64] INFO  com.google.gerrit.server.project.RefControl : (admin || (owner &amp;&amp; !isBlocked(Permission.CREATE))) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[2020-01-09 19:56:12,372] [HTTP-71] INFO  com.google.gerrit.server.project.RefControl : ReviewDb = com.google.gerrit.reviewdb.server.ReviewDb_Schema_GwtOrm$$20@739b8695</span><br><span class="line">[2020-01-09 19:56:12,372] [HTTP-71] INFO  com.google.gerrit.server.project.RefControl : RevWalk = org.eclipse.jgit.revwalk.ObjectWalk@98832ac</span><br><span class="line">[2020-01-09 19:56:12,372] [HTTP-71] INFO  com.google.gerrit.server.project.RefControl : RevObject = commit 5130c6f4d1dd84a9eae13eca14e627db50f843bd 1577691879 -----p</span><br><span class="line">[2020-01-09 19:56:12,372] [HTTP-71] INFO  com.google.gerrit.server.project.RefControl : getUser() = IdentifiedUser[account 1000000]</span><br><span class="line">[2020-01-09 19:56:12,372] [HTTP-71] INFO  com.google.gerrit.server.project.RefControl : getUser().getAccessPath() = REST_API</span><br><span class="line">[2020-01-09 19:56:12,372] [HTTP-71] INFO  com.google.gerrit.server.project.RefControl : getUser().getCapabilities().canAdministrateServer() = true</span><br><span class="line">[2020-01-09 19:56:12,372] [HTTP-71] INFO  com.google.gerrit.server.project.RefControl : if (object instanceof RevCommit) &#123; start</span><br><span class="line">[2020-01-09 19:56:12,372] [HTTP-71] INFO  com.google.gerrit.server.project.RefControl : (admin || (owner &amp;&amp; !isBlocked(Permission.CREATE))) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ä¸‹é¢æ˜¯é‡‡ç”¨git pushè¾“å‡ºçš„æ—¥å¿—</span><br><span class="line">[2020-01-09 19:56:44,187] [ReceiveCommits-1] INFO  com.google.gerrit.server.project.RefControl : ReviewDb = com.google.gerrit.reviewdb.server.ReviewDb_Schema_GwtOrm$$20@45bc3d47</span><br><span class="line">[2020-01-09 19:56:44,187] [ReceiveCommits-1] INFO  com.google.gerrit.server.project.RefControl : RevWalk = org.eclipse.jgit.revwalk.RevWalk@368252f1</span><br><span class="line">[2020-01-09 19:56:44,188] [ReceiveCommits-1] INFO  com.google.gerrit.server.project.RefControl : RevObject = commit c620bcc00a0cefbfcb760ca4185dd0269b9bb409 1573610856 -----p</span><br><span class="line">[2020-01-09 19:56:44,188] [ReceiveCommits-1] INFO  com.google.gerrit.server.project.RefControl : getUser() = IdentifiedUser[account 1000000]</span><br><span class="line">[2020-01-09 19:56:44,188] [ReceiveCommits-1] INFO  com.google.gerrit.server.project.RefControl : getUser().getAccessPath() = GIT</span><br><span class="line">[2020-01-09 19:56:44,188] [ReceiveCommits-1] INFO  com.google.gerrit.server.project.RefControl : getUser().getCapabilities().canAdministrateServer() = true</span><br><span class="line">[2020-01-09 19:56:44,188] [ReceiveCommits-1] INFO  com.google.gerrit.server.project.RefControl : if (object instanceof RevCommit) &#123; start</span><br><span class="line">[2020-01-09 19:56:44,188] [ReceiveCommits-1] INFO  com.google.gerrit.server.project.RefControl : else if (canUpdate())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[2020-01-09 19:57:36,970] [ReceiveCommits-2] INFO  com.google.gerrit.server.project.RefControl : ReviewDb = com.google.gerrit.reviewdb.server.ReviewDb_Schema_GwtOrm$$20@6d1c1e42</span><br><span class="line">[2020-01-09 19:57:36,970] [ReceiveCommits-2] INFO  com.google.gerrit.server.project.RefControl : RevWalk = org.eclipse.jgit.revwalk.ObjectWalk@281e8d85</span><br><span class="line">[2020-01-09 19:57:36,970] [ReceiveCommits-2] INFO  com.google.gerrit.server.project.RefControl : RevObject = commit 2f335d90bca227f7c8d115990081c5dcf6be5ac5 1573610871 -----p</span><br><span class="line">[2020-01-09 19:57:36,970] [ReceiveCommits-2] INFO  com.google.gerrit.server.project.RefControl : getUser() = IdentifiedUser[account 1000000]</span><br><span class="line">[2020-01-09 19:57:36,970] [ReceiveCommits-2] INFO  com.google.gerrit.server.project.RefControl : getUser().getAccessPath() = GIT</span><br><span class="line">[2020-01-09 19:57:36,970] [ReceiveCommits-2] INFO  com.google.gerrit.server.project.RefControl : getUser().getCapabilities().canAdministrateServer() = true</span><br><span class="line">[2020-01-09 19:57:36,970] [ReceiveCommits-2] INFO  com.google.gerrit.server.project.RefControl : if (object instanceof RevCommit) &#123; start</span><br><span class="line">[2020-01-09 19:57:36,970] [ReceiveCommits-2] INFO  com.google.gerrit.server.project.RefControl : else if (!canPerform(Permission.CREATE)) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">é€šè¿‡æ—¥å¿—åˆ†æ æˆ‘ä»¬å‘ç° </span><br><span class="line"> getUser().getAccessPath() = GIT </span><br><span class="line"> getUser().getAccessPath() = REST_API</span><br><span class="line">è¿™ä¸ª2ä¸ä¸€æ ·äº†</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç»§ç»­åŠ æ—¥å¿—åˆ†æ</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[2020-01-09 20:08:27,868] [HTTP-62] INFO  com.google.gerrit.server.project.RefControl : ReviewDb = com.google.gerrit.reviewdb.server.ReviewDb_Schema_GwtOrm$$20@42530bd7</span><br><span class="line">[2020-01-09 20:08:27,868] [HTTP-62] INFO  com.google.gerrit.server.project.RefControl : RevWalk = org.eclipse.jgit.revwalk.ObjectWalk@2a04d30b</span><br><span class="line">[2020-01-09 20:08:27,868] [HTTP-62] INFO  com.google.gerrit.server.project.RefControl : RevObject = commit c620bcc00a0cefbfcb760ca4185dd0269b9bb409 1573610856 -----p</span><br><span class="line">[2020-01-09 20:08:27,868] [HTTP-62] INFO  com.google.gerrit.server.project.RefControl : getUser() = IdentifiedUser[account 1000000]</span><br><span class="line">[2020-01-09 20:08:27,868] [HTTP-62] INFO  com.google.gerrit.server.project.RefControl : getUser().getAccessPath() = REST_API</span><br><span class="line">[2020-01-09 20:08:27,868] [HTTP-62] INFO  com.google.gerrit.server.project.RefControl : getUser().getCapabilities().canAdministrateServer() = true</span><br><span class="line">[2020-01-09 20:08:27,869] [HTTP-62] INFO  com.google.gerrit.server.project.RefControl : owner = true</span><br><span class="line">[2020-01-09 20:08:27,869] [HTTP-62] INFO  com.google.gerrit.server.project.RefControl : admin = true</span><br><span class="line">[2020-01-09 20:08:27,869] [HTTP-62] INFO  com.google.gerrit.server.project.RefControl : if (object instanceof RevCommit) &#123; start</span><br><span class="line">[2020-01-09 20:08:27,869] [HTTP-62] INFO  com.google.gerrit.server.project.RefControl : (admin || (owner &amp;&amp; !isBlocked(Permission.CREATE))) </span><br><span class="line"></span><br><span class="line">[2020-01-09 20:08:53,799] [HTTP-64] INFO  com.google.gerrit.server.project.RefControl : ReviewDb = com.google.gerrit.reviewdb.server.ReviewDb_Schema_GwtOrm$$20@2996426b</span><br><span class="line">[2020-01-09 20:08:53,799] [HTTP-64] INFO  com.google.gerrit.server.project.RefControl : RevWalk = org.eclipse.jgit.revwalk.ObjectWalk@68e4f072</span><br><span class="line">[2020-01-09 20:08:53,799] [HTTP-64] INFO  com.google.gerrit.server.project.RefControl : RevObject = commit c620bcc00a0cefbfcb760ca4185dd0269b9bb409 1573610856 -----p</span><br><span class="line">[2020-01-09 20:08:53,799] [HTTP-64] INFO  com.google.gerrit.server.project.RefControl : getUser() = IdentifiedUser[account 1000000]</span><br><span class="line">[2020-01-09 20:08:53,800] [HTTP-64] INFO  com.google.gerrit.server.project.RefControl : getUser().getAccessPath() = REST_API</span><br><span class="line">[2020-01-09 20:08:53,800] [HTTP-64] INFO  com.google.gerrit.server.project.RefControl : getUser().getCapabilities().canAdministrateServer() = true</span><br><span class="line">[2020-01-09 20:08:53,800] [HTTP-64] INFO  com.google.gerrit.server.project.RefControl : owner = true</span><br><span class="line">[2020-01-09 20:08:53,800] [HTTP-64] INFO  com.google.gerrit.server.project.RefControl : admin = true</span><br><span class="line">[2020-01-09 20:08:53,800] [HTTP-64] INFO  com.google.gerrit.server.project.RefControl : if (object instanceof RevCommit) &#123; start</span><br><span class="line">[2020-01-09 20:08:53,800] [HTTP-64] INFO  com.google.gerrit.server.project.RefControl : (admin || (owner &amp;&amp; !isBlocked(Permission.CREATE))) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[2020-01-09 20:09:29,898] [ReceiveCommits-1] INFO  com.google.gerrit.server.project.RefControl : ReviewDb = com.google.gerrit.reviewdb.server.ReviewDb_Schema_GwtOrm$$20@70fac7b8</span><br><span class="line">[2020-01-09 20:09:29,898] [ReceiveCommits-1] INFO  com.google.gerrit.server.project.RefControl : RevWalk = org.eclipse.jgit.revwalk.ObjectWalk@385a985b</span><br><span class="line">[2020-01-09 20:09:29,898] [ReceiveCommits-1] INFO  com.google.gerrit.server.project.RefControl : RevObject = commit 2f335d90bca227f7c8d115990081c5dcf6be5ac5 1573610871 -----p</span><br><span class="line">[2020-01-09 20:09:29,898] [ReceiveCommits-1] INFO  com.google.gerrit.server.project.RefControl : getUser() = IdentifiedUser[account 1000000]</span><br><span class="line">[2020-01-09 20:09:29,898] [ReceiveCommits-1] INFO  com.google.gerrit.server.project.RefControl : getUser().getAccessPath() = GIT</span><br><span class="line">[2020-01-09 20:09:29,899] [ReceiveCommits-1] INFO  com.google.gerrit.server.project.RefControl : getUser().getCapabilities().canAdministrateServer() = true</span><br><span class="line">[2020-01-09 20:09:29,899] [ReceiveCommits-1] INFO  com.google.gerrit.server.project.RefControl : default owner = false</span><br><span class="line">[2020-01-09 20:09:29,899] [ReceiveCommits-1] INFO  com.google.gerrit.server.project.RefControl : default admin = false</span><br><span class="line">[2020-01-09 20:09:29,899] [ReceiveCommits-1] INFO  com.google.gerrit.server.project.RefControl : if (object instanceof RevCommit) &#123; start</span><br><span class="line">[2020-01-09 20:09:29,899] [ReceiveCommits-1] INFO  com.google.gerrit.server.project.RefControl : else if (!canPerform(Permission.CREATE)) </span><br><span class="line"></span><br><span class="line">æœ€ç»ˆæˆ‘ä»¬å¯ä»¥å®šä½åˆ°è¿™é‡Œ </span><br><span class="line">boolean owner;</span><br><span class="line">boolean admin;</span><br><span class="line">switch (getUser().getAccessPath()) &#123;</span><br><span class="line">    case REST_API:</span><br><span class="line">    case JSON_RPC:</span><br><span class="line">    case UNKNOWN:</span><br><span class="line">        owner = isOwner();</span><br><span class="line">        admin = getUser().getCapabilities().canAdministrateServer();</span><br><span class="line">        log.info(&quot;owner = &quot; + owner);</span><br><span class="line">        log.info(&quot;admin = &quot; + admin);</span><br><span class="line">        break;</span><br><span class="line"></span><br><span class="line">    default:</span><br><span class="line"></span><br><span class="line">        owner = false;</span><br><span class="line">        admin = false;</span><br><span class="line">        log.info(&quot;default owner = &quot; + owner);</span><br><span class="line">        log.info(&quot;default admin = &quot; + admin);</span><br><span class="line">&#125;</span><br><span class="line">è¿™ä¸ªswitchæ²¡æœ‰åˆ¤æ–­ ç­‰äº GIT çš„è¿™ç§æƒ…å†µ,è€Œæ˜¯ç›´æ¥èµ°åˆ°äº†default,è¿™æ ·å°±ä¼šå¯¼è‡´ owernå’Œadminéƒ½æ˜¯falseäº†.</span><br><span class="line">ä¹Ÿå°±ä¼šæŠ¥æ²¡æœ‰æƒé™åˆ›å»ºrefs/backups/*åˆ†æ”¯äº†.è§£å†³æ–¹æ³•æ˜¯ è¯•ç€ åœ¨æ’ä»¶ é‚£è¾¹ æŠŠ getUser().getAccessPath()</span><br><span class="line">çš„ç±»å‹ æ”¹æˆ REST_API. ç„¶å æœ€å¥½èƒ½æŠŠ ä»…åœ¨pushæ“ä½œçš„æ—¶å€™ user æ”¹æˆ admin è´¦å·.ä¸€èˆ¬çš„gerrit ç®¡ç†å‘˜ ä¼š</span><br><span class="line">æœ‰ åˆ›å»º refs/backups/* çš„æƒé™çš„.å…¶ä¸­è¿™é‡Œæˆ‘ä¸€è‡´è§‰å¾— è¿™ä¸ªæ’ä»¶ åšçš„ä¸åˆç†. æ—¢ç„¶æ˜¯å¤‡ä»½åˆ†æ”¯,ä¸ç®¡è°æ¥æ“ä½œ,</span><br><span class="line">ä½ æ’ä»¶éƒ½åº”è¯¥ç»™æˆ‘å¤‡ä»½ä¸Šçš„.è¿™ä¸ªæ’ä»¶çš„å®‰è£…ä¹Ÿæ˜¯åœ¨ç®¡ç†å‘˜æƒ…å†µä¸‹é¢æ‰èƒ½å®‰è£…çš„. ä½ å¤‡ä»½åˆ†æ”¯è¿˜åˆ¤æ–­ æœ‰æ²¡æœ‰æƒé™å¤‡ä»½å°±å¤ªä¸åˆç†äº†.</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆæˆ‘ç»™å‡ºäº†ä¸€ä¸ªä¿®æ”¹æ”¾å•Š,å¯ä»¥å‚è€ƒ<br><a target="_blank" rel="noopener" href="https://github.com/mamh-java/plugins_ref-protection/tree/mamh-2.12.7">https://github.com/mamh-java/plugins_ref-protection/tree/mamh-2.12.7</a></p>
<p>ä¸‹é¢æ˜¯ ä¿®æ”¹å å‡ ç§æ“ä½œçš„æ—¥å¿—è¾“å‡º</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">git push fast forwardçš„æ“ä½œ</span><br><span class="line">[2020-01-10 17:39:35,744] [ReceiveCommits-1] not isRefDeleted or not NonFastForward: project [git/shared/tools/blog] refname [refs/heads/master1] oldRev [17b185ee7ee879242f38f8200c9855f530c5329b] newRev [bc071c0e21cad2a09c998af15b7b6ea90e5908a8]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">git push  non fast forwardçš„æ“ä½œ</span><br><span class="line">[2020-01-10 17:40:01,026] [ReceiveCommits-1] this user want to delete ref or no fast forward update ref: IdentifiedUser[account 1000003]</span><br><span class="line">[2020-01-10 17:40:01,026] [ReceiveCommits-1] Ref Deleted: project [git/shared/tools/blog] refname [refs/heads/master1] oldRev [bc071c0e21cad2a09c998af15b7b6ea90e5908a8] newRev [17b185ee7ee879242f38f8200c9855f530c5329b]</span><br><span class="line">[2020-01-10 17:40:01,027] [ReceiveCommits-1] Ref  Backup: project [git/shared/tools/blog] refname [refs/heads/backup/master1_20200110_174001] oldRev [bc071c0e21cad2a09c998af15b7b6ea90e5908a8] newRev [17b185ee7ee879242f38f8200c9855f530c5329b]</span><br><span class="line">[2020-01-10 17:40:01,045] [ReceiveCommits-1] not a relevant ref: project [git/shared/tools/blog] refname [refs/heads/backup/master1_20200110_174001] oldRev [0000000000000000000000000000000000000000] newRev [bc071c0e21cad2a09c998af15b7b6ea90e5908a8]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">git push åˆ é™¤åˆ†æ”¯çš„æ“ä½œ</span><br><span class="line">[2020-01-10 17:40:39,882] [ReceiveCommits-2] this user want to delete ref or no fast forward update ref: IdentifiedUser[account 1000003]</span><br><span class="line">[2020-01-10 17:40:39,882] [ReceiveCommits-2] Ref Deleted: project [git/shared/tools/blog] refname [refs/heads/master1] oldRev [17b185ee7ee879242f38f8200c9855f530c5329b] newRev [0000000000000000000000000000000000000000]</span><br><span class="line">[2020-01-10 17:40:39,883] [ReceiveCommits-2] Ref  Backup: project [git/shared/tools/blog] refname [refs/heads/backup/master1_20200110_174039] oldRev [17b185ee7ee879242f38f8200c9855f530c5329b] newRev [0000000000000000000000000000000000000000]</span><br><span class="line">[2020-01-10 17:40:39,890] [ReceiveCommits-2] not a relevant ref: project [git/shared/tools/blog] refname [refs/heads/backup/master1_20200110_174039] oldRev [0000000000000000000000000000000000000000] newRev [17b185ee7ee879242f38f8200c9855f530c5329b]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gerritç½‘é¡µä¸Šåˆ›å»ºåˆ†æ”¯è¾“å…¥çš„æ—¥å¿—</span><br><span class="line">[2020-01-10 17:42:24,059] [HTTP-65] not a relevant ref: project [git/shared/tools/blog] refname [refs/heads/sm8250_mp_zero] oldRev [0000000000000000000000000000000000000000] newRev [4fef20ecde1f67b20de9a4434bdbca568ffcb763]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gerritç½‘é¡µä¸Šåˆ é™¤åˆ†æ”¯çš„æ—¥å¿—</span><br><span class="line">[2020-01-10 17:42:44,435] [HTTP-63] this user want to delete ref or no fast forward update ref: IdentifiedUser[account 1000000]</span><br><span class="line">[2020-01-10 17:42:44,435] [HTTP-63] Ref Deleted: project [git/shared/tools/blog] refname [refs/heads/sm8250_mp_zero_20200110] oldRev [4fef20ecde1f67b20de9a4434bdbca568ffcb763] newRev [0000000000000000000000000000000000000000]</span><br><span class="line">[2020-01-10 17:42:44,435] [HTTP-63] Ref  Backup: project [git/shared/tools/blog] refname [refs/heads/backup/sm8250_mp_zero_20200110_20200110_174244] oldRev [4fef20ecde1f67b20de9a4434bdbca568ffcb763] newRev [0000000000000000000000000000000000000000]</span><br><span class="line">[2020-01-10 17:42:44,443] [HTTP-63] not a relevant ref: project [git/shared/tools/blog] refname [refs/heads/backup/sm8250_mp_zero_20200110_20200110_174244] oldRev [0000000000000000000000000000000000000000] newRev [4fef20ecde1f67b20de9a4434bdbca568ffcb763]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





















</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://magesfc.github.io">mage</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://magesfc.github.io/mage/fdbb4b38b92cf47b0e24bc59c392393921287a2c/">https://magesfc.github.io/mage/fdbb4b38b92cf47b0e24bc59c392393921287a2c/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://magesfc.github.io" target="_blank">é©¬å“¥ç§æˆ¿èœ</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/android/">android</a><a class="post-meta__tags" href="/tags/gerrit/">gerrit</a><a class="post-meta__tags" href="/tags/ref/">ref</a><a class="post-meta__tags" href="/tags/protection/">protection</a></div><div class="post_share"><div class="social-share" data-image="https://t.mwm.moe/fj/" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> æ‰“èµ</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/null" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/null" alt="æ”¯ä»˜å¯¶"/></a><div class="post-qr-code-desc">æ”¯ä»˜å¯¶</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/mage/45fd28bfb59ce78db2a647f34a31e83ae9bb24e1/"><img class="prev-cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹gerritä»£ç æœåŠ¡å™¨æ­å»º</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/mage/9f11362bb48e38171ec1992629522ab39976a878/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹gerritä»£ç æœåŠ¡å™¨ä¹‹sshé˜Ÿåˆ—è¯¦è§£"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹gerritä»£ç æœåŠ¡å™¨ä¹‹sshé˜Ÿåˆ—è¯¦è§£</div></div></a></div><div><a href="/mage/8ac00d53eb291c161df9a3d30ccaca66be48f13c/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹gerritä¿®æ”¹projectè·¯å¾„"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹gerritä¿®æ”¹projectè·¯å¾„</div></div></a></div><div><a href="/mage/e2cc5e300708461bde262aaae49a064be28321d2/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹gerritæƒé™ç®¡ç†"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹gerritæƒé™ç®¡ç†</div></div></a></div><div><a href="/mage/b1cf003423f7ac158b861abd5a96522cbd2fae86/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹gerritçš„sshå‘½ä»¤è¡Œå·¥å…·"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹gerritçš„sshå‘½ä»¤è¡Œå·¥å…·</div></div></a></div><div><a href="/mage/4ffe00a009758049d18e75751a7dcc4ee3a21ef9/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹gerritå®‰è£…githubæ’ä»¶"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹gerritå®‰è£…githubæ’ä»¶</div></div></a></div><div><a href="/mage/037b07ff16870d51848a2e4b1a21052b80988d7d/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹å®‰è£…gerritä»£ç æœåŠ¡å™¨"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹å®‰è£…gerritä»£ç æœåŠ¡å™¨</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">mage</div><div class="author-info__description"> è¿™é‡Œæ˜¯ é©¬å“¥ çš„ä¸ªäººåšå®¢ </div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">219</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">230</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">40</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mamh2021"><i class="fab fa-github"></i><span>GitHub</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/mamh2021" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%80%E8%BF%91%E7%A0%94%E7%A9%B6%E4%BA%86%E4%B8%80%E4%B8%AAgerrit%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BD%E5%88%86%E6%94%AF%E7%9A%84%E6%8F%92%E4%BB%B6%E3%80%82"><span class="toc-number">1.</span> <span class="toc-text">æœ€è¿‘ç ”ç©¶äº†ä¸€ä¸ªgerritè‡ªåŠ¨å¤‡ä»½åˆ†æ”¯çš„æ’ä»¶ã€‚</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/mage/2a9ef50014df49410b7232170f2a33410e557f9e/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“repoæ”¯æŒå¤šçº¿ç¨‹å»checkoutçš„"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“repoæ”¯æŒå¤šçº¿ç¨‹å»checkoutçš„"/></a><div class="content"><a class="title" href="/mage/2a9ef50014df49410b7232170f2a33410e557f9e/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“repoæ”¯æŒå¤šçº¿ç¨‹å»checkoutçš„">Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“repoæ”¯æŒå¤šçº¿ç¨‹å»checkoutçš„</a><time datetime="2023-10-03T14:27:48.000Z" title="æ›´æ–°äº 2023-10-03 22:27:48">2023-10-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/57c6d6d47f27965a3b16751908caacdc6eea440c/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹è‡ªåŠ¨abandonå¾ˆä¹…ä¹‹å‰çš„å¤„äºopençš„patch"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹è‡ªåŠ¨abandonå¾ˆä¹…ä¹‹å‰çš„å¤„äºopençš„patch"/></a><div class="content"><a class="title" href="/mage/57c6d6d47f27965a3b16751908caacdc6eea440c/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹è‡ªåŠ¨abandonå¾ˆä¹…ä¹‹å‰çš„å¤„äºopençš„patch">Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹è‡ªåŠ¨abandonå¾ˆä¹…ä¹‹å‰çš„å¤„äºopençš„patch</a><time datetime="2023-10-03T14:26:24.000Z" title="æ›´æ–°äº 2023-10-03 22:26:24">2023-10-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/e405c9d59f8b11b211eff5302fecd36de161171e/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹Androidç¼–è¯‘ç¯å¢ƒæ­å»º"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹Androidç¼–è¯‘ç¯å¢ƒæ­å»º"/></a><div class="content"><a class="title" href="/mage/e405c9d59f8b11b211eff5302fecd36de161171e/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹Androidç¼–è¯‘ç¯å¢ƒæ­å»º">Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹Androidç¼–è¯‘ç¯å¢ƒæ­å»º</a><time datetime="2023-10-03T14:25:36.000Z" title="æ›´æ–°äº 2023-10-03 22:25:36">2023-10-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/f9af26d5f35c7f0b5996dd16b21cfaf6b5bbed6b/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“é«˜é€škernelçš„æ„å»ºä¸ºä»€ä¹ˆæœ‰2ä¸ª-j å‚æ•°"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“é«˜é€škernelçš„æ„å»ºä¸ºä»€ä¹ˆæœ‰2ä¸ª-j å‚æ•°"/></a><div class="content"><a class="title" href="/mage/f9af26d5f35c7f0b5996dd16b21cfaf6b5bbed6b/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“é«˜é€škernelçš„æ„å»ºä¸ºä»€ä¹ˆæœ‰2ä¸ª-j å‚æ•°">Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“é«˜é€škernelçš„æ„å»ºä¸ºä»€ä¹ˆæœ‰2ä¸ª-j å‚æ•°</a><time datetime="2023-10-03T14:14:57.000Z" title="æ›´æ–°äº 2023-10-03 22:14:57">2023-10-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/c1853b7677473f4bdbbbae48ee66216a0f4bc493/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“å…³äºAndroidBoard.mkå’ŒAndroidProducts.mk"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“å…³äºAndroidBoard.mkå’ŒAndroidProducts.mk"/></a><div class="content"><a class="title" href="/mage/c1853b7677473f4bdbbbae48ee66216a0f4bc493/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“å…³äºAndroidBoard.mkå’ŒAndroidProducts.mk">Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“å…³äºAndroidBoard.mkå’ŒAndroidProducts.mk</a><time datetime="2023-10-03T13:56:35.000Z" title="æ›´æ–°äº 2023-10-03 21:56:35">2023-10-03</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://t.mwm.moe/fj/')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By mage</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>