<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Jenkins插件学习之active-choices-plugin | 马哥私房菜</title><meta name="author" content="mage"><meta name="copyright" content="mage"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="今天介绍一个插件  active-choices-plugin级联参数    选择一个参数， 可以让另外一个参数选项 动态变化，  The plug-in includes the following parameter types: Active Choices Parameter Active Choices Reactive Parameter Active Choices Reactive">
<meta property="og:type" content="article">
<meta property="og:title" content="Jenkins插件学习之active-choices-plugin">
<meta property="og:url" content="https://magesfc.github.io/mage/b4e9b6e07862c8137db0ffc0b3db25339cc8633a/">
<meta property="og:site_name" content="马哥私房菜">
<meta property="og:description" content="今天介绍一个插件  active-choices-plugin级联参数    选择一个参数， 可以让另外一个参数选项 动态变化，  The plug-in includes the following parameter types: Active Choices Parameter Active Choices Reactive Parameter Active Choices Reactive">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://t.mwm.moe/fj/">
<meta property="article:published_time" content="2023-08-06T01:47:25.000Z">
<meta property="article:modified_time" content="2023-08-06T01:47:25.000Z">
<meta property="article:author" content="mage">
<meta property="article:tag" content="plugin">
<meta property="article:tag" content="jenkins">
<meta property="article:tag" content="active">
<meta property="article:tag" content="choices">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://t.mwm.moe/fj/"><link rel="shortcut icon" href="https://www.zeekrlife.com/favicon.png"><link rel="canonical" href="https://magesfc.github.io/mage/b4e9b6e07862c8137db0ffc0b3db25339cc8633a/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: mage","link":"链接: ","source":"来源: 马哥私房菜","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Jenkins插件学习之active-choices-plugin',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-08-06 09:47:25'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><style type="text/css">.card-announcement .social-button{margin:.6rem 0 0 0;text-align:center}.card-announcement .social-button a{display:block;background-color:var(--btn-bg);color:var(--btn-color);text-align:center;line-height:2.4;margin:4px 0}.card-announcement .social-button a:hover{background-color:var(--btn-hover-color)}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">216</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">231</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">40</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 精选文档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/21cfbf15/"><span> 🚀 快速开始</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/dc584b87/"><span> 📑 主题页面</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4aa8abbe/"><span> 🛠 主题配置-1</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/ceeb73f/"><span> 🛠 主题配置-2</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/98d20436/"><span> ❓ 主题问答</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4073eda/"><span> ⚡️ 进阶教程</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/198a4240/"><span> ✨ 更新日志</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://butterfly.js.org/link/"><i class="fa-fw fas fa-thumbs-up"></i><span> 其他示例</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://t.mwm.moe/fj/')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">马哥私房菜</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 精选文档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/21cfbf15/"><span> 🚀 快速开始</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/dc584b87/"><span> 📑 主题页面</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4aa8abbe/"><span> 🛠 主题配置-1</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/ceeb73f/"><span> 🛠 主题配置-2</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/98d20436/"><span> ❓ 主题问答</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4073eda/"><span> ⚡️ 进阶教程</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/198a4240/"><span> ✨ 更新日志</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://butterfly.js.org/link/"><i class="fa-fw fas fa-thumbs-up"></i><span> 其他示例</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Jenkins插件学习之active-choices-plugin</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-08-06T01:47:25.000Z" title="发表于 2023-08-06 09:47:25">2023-08-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-08-06T01:47:25.000Z" title="更新于 2023-08-06 09:47:25">2023-08-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/jenkins/">jenkins</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Jenkins插件学习之active-choices-plugin"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="今天介绍一个插件-active-choices-plugin"><a href="#今天介绍一个插件-active-choices-plugin" class="headerlink" title="今天介绍一个插件  active-choices-plugin"></a>今天介绍一个插件  active-choices-plugin</h1><h1 id="级联参数"><a href="#级联参数" class="headerlink" title="级联参数"></a>级联参数</h1><pre><code>    选择一个参数， 可以让另外一个参数选项 动态变化，
</code></pre>
<p>The plug-in includes the following parameter types:</p>
<pre><code>Active Choices Parameter
Active Choices Reactive Parameter
Active Choices Reactive Reference Parameter
</code></pre>
<h2 id="我自己魔改的"><a href="#我自己魔改的" class="headerlink" title="我自己魔改的"></a>我自己魔改的</h2><pre><code>    1， 仿照 extensible-choice-parameter-plugin 插件修改的。提供了几个 ChoiceListProvider 类型的class供选择。 
     本来是3个类型的 Parameter 的。现在改成一个，其他的都用 provicer 提供

    2. 支持流水线：activeChoiceProvider， cascadeChoiceProvider， referenceChoiceProvider
    3. 参数名改掉了， Active Choices Parameter 保持。  
    Active Choices Reactive Parameter 改成 CascadeChoiceProvider。
    Active Choices Reactive Reference Parameter 改成 ReferenceChoiceProvider
    4. 前2种用的多，利用前面2种类型 实现 级联参数。

    5. 源码仓库： https://github.com/mamh-java/active-choices-plugin/commits/uno-choice-2.5.7-for-jenkins-2.249.3
</code></pre>
<p>特别说明：</p>
<pre><code>    修改后的版本都在 我司生成环境使用多年了。
</code></pre>
<h1 id="参考例子"><a href="#参考例子" class="headerlink" title="参考例子"></a>参考例子</h1><h2 id="定义-参数-PLATFORM"><a href="#定义-参数-PLATFORM" class="headerlink" title="定义 参数 PLATFORM"></a>定义 参数 PLATFORM</h2><p>定义第一个参数 PLATFORM 返回 高通新片平台名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 配置在 job 中的 PLATFORM 参数处.</span><br><span class="line"> * 直接返回的是目前的3个平台名称,后续增加新的平台,就在这个return 后面新增就行.</span><br><span class="line"> *</span><br><span class="line"> * 使用方式要么把整个脚本文件内容 配置到jenkins工程中,要么保存为一个文件,放到jenkins master</span><br><span class="line"> * 服务器上面, 必须是jenkins master 服务器上的一个文件路径, 不是slave服务器上的.然后jenkins</span><br><span class="line"> * 工程中配置这样的:</span><br><span class="line"> * evaluate(new File(&quot;/$JENKINS_HOME/groovy/paramsplatform.groovy&quot;))</span><br><span class="line"> *</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def execGitCommand(gitDir, gitcmd)&#123;</span><br><span class="line">    def command=&quot;git -C $&#123;gitDir&#125; $&#123;gitcmd&#125;&quot;</span><br><span class="line">    def proc = command.execute()</span><br><span class="line">    proc.waitFor()</span><br><span class="line">    println &quot;process git $&#123;gitcmd&#125; exit code: $&#123;proc.exitValue()&#125;&quot;</span><br><span class="line">    println &quot;stdErr: $&#123;proc.err.text&#125;&quot;</span><br><span class="line">    println &quot;stdOut: $&#123;proc.in.text&#125;&quot;  // 这些打印会在 /var/log/jenkins/jenkins.log 日志文件中保存</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 首先 更新 编译脚本参考，这个在 页面选择 PLATFORM 这个job的时候就会被调用。</span><br><span class="line">// 更新这个的目的 是 获取 编译脚本中的 配置文件的，因为我们的编译是按照分支命名的一个一个的配置文件。</span><br><span class="line">execGitCommand(&quot;$JENKINS_HOME/《你的编译脚本配置目录》&quot;, &quot;fetch --all&quot;)</span><br><span class="line">execGitCommand(&quot;$JENKINS_HOME/《你的编译脚本配置目录》&quot;, &quot;checkout origin/master&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 目前的几个平台,后续增加新的平台,就在这个return 后面新增就行</span><br><span class="line">return [平台名列表，这里省略。。。。, &quot;sdm845&quot;] </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="定义联动参数-branch"><a href="#定义联动参数-branch" class="headerlink" title="定义联动参数 branch"></a>定义联动参数 branch</h2><p>定义第二个 联动参数 ，就是 PLATFORM 选择那个，这个 第二个 参数会变化的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 配置在 job 中的 BRANCH 参数处.</span><br><span class="line"> * 通过 选择不同的 PLATFORM 值 来过滤 对应的 branch 值. 也就是过滤 config </span><br><span class="line"> * 目录下面的子目录的. 后续添加了新的平台,新的子目录 根据需要修改这个脚本文件.和 工程配置.</span><br><span class="line"> *</span><br><span class="line"> * 使用方式要么把整个脚本文件内容 配置到jenkins工程中,要么保存为一个文件,放到jenkins master</span><br><span class="line"> * 服务器上面, 必须是jenkins master 服务器上的一个文件路径, 不是slave服务器上的.然后jenkins</span><br><span class="line"> * 工程中配置这样的:</span><br><span class="line"> * </span><br><span class="line"> * evaluate(new File(&quot;$JENKINS_HOME/groovy/paramsbranch.groovy&quot;))</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def getAllBranchList(configDir)&#123;</span><br><span class="line">    def dir = new File(configDir) </span><br><span class="line">    def branchList=[]</span><br><span class="line">    dir.eachDir&#123;directory-&gt;</span><br><span class="line">        def branch = directory.getName().trim()</span><br><span class="line">        if(!&quot;common&quot;.equals(branch))&#123;</span><br><span class="line">            branchList &lt;&lt; branch</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    branchList = branchList.sort &#123;a,b -&gt;</span><br><span class="line">        return b[-8..-1].compareTo(a[-8..-1])</span><br><span class="line">    &#125;</span><br><span class="line">    return branchList</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def filterAllBranchList(branchList, filterList)&#123;</span><br><span class="line">    def brList = []</span><br><span class="line">    branchList.each &#123;br-&gt;</span><br><span class="line">        filterList.each &#123;filter-&gt;</span><br><span class="line">            if(br.startsWith(filter))&#123;</span><br><span class="line">                brList &lt;&lt; br</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; //end filterList.each &#123;filter-&gt;</span><br><span class="line">    &#125; //end branchList.each &#123;br-&gt;</span><br><span class="line">    return brList</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 获取 配置文件目录 现 所有 分支名， 每个配置目录名 就是一个 分支名。</span><br><span class="line">// 分支名 有的是 平台开头的，有的是 产品开头的，所以要用 filterAllBranchList  过滤出来分支名</span><br><span class="line">// branchList 是 所有配置的 分支，包括全部平台的</span><br><span class="line"></span><br><span class="line">def branchList = getAllBranchList(&quot;$JENKINS_HOME/《你的编译脚本配置目录》/config&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if (PLATFORM.equals(&quot;sdm845&quot;)) &#123;</span><br><span class="line">    return filterAllBranchList(branchList, [&quot;sdm845&quot;, &quot;产品名&quot;, &quot;产品名&quot;])</span><br><span class="line">    。。。。。。</span><br><span class="line">    。。。。。。省略其他的判断</span><br><span class="line">    。。。。。。</span><br><span class="line">    。。。。。。</span><br><span class="line">    。。。。。。</span><br><span class="line">    。。。。。。</span><br><span class="line">&#125; else if (PLATFORM.equals(&quot;qm8150&quot;)) &#123;</span><br><span class="line">    return filterAllBranchList(branchList, [&quot;qm8550&quot;, &quot;产品名&quot;])</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    return [&quot;nobranchelse&quot;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="流水线脚本中如何使用"><a href="#流水线脚本中如何使用" class="headerlink" title="流水线脚本中如何使用"></a>流水线脚本中如何使用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">        activeChoice choiceListProvider: activeChoiceProvider(</span><br><span class="line">                choiceType: &#x27;PT_SINGLE_SELECT&#x27;,</span><br><span class="line">                filterLength: 1,</span><br><span class="line">                filterable: false,</span><br><span class="line">                script: groovyScript(</span><br><span class="line">                    fallbackScript: [classpath: [], sandbox: false,</span><br><span class="line">                        script: &#x27;&#x27;&#x27;//之前的free job中是这么配置的</span><br><span class="line">return [&quot;默认 值&quot;]</span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">                    ],</span><br><span class="line">                    script: [classpath: [], sandbox: false,</span><br><span class="line">                        script: &#x27;&#x27;&#x27;//之前的free job中是这么配置的</span><br><span class="line">evaluate(new File(&quot;$JENKINS_HOME/groovy/paramsplatform.groovy&quot;))</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">                    ]</span><br><span class="line">                ) // end  groovyScript()</span><br><span class="line">            ), description: &#x27;平台名称&#x27;, name: &#x27;PLATFORM&#x27;, randomName: &#x27;choice-parameter-4163896451437017&#x27;</span><br><span class="line"></span><br><span class="line">        activeChoice choiceListProvider: cascadeChoiceProvider(</span><br><span class="line">                choiceType: &#x27;PT_SINGLE_SELECT&#x27;,</span><br><span class="line">                filterLength: 3,</span><br><span class="line">                filterable: true,</span><br><span class="line">                referencedParameters: &#x27;ANDROID_PLATFORM&#x27;,</span><br><span class="line">                script: groovyScript(</span><br><span class="line">                    fallbackScript: [classpath: [], sandbox: false,</span><br><span class="line">                        script: &#x27;&#x27;&#x27;//之前的free job中是这么配置的</span><br><span class="line">return [&quot;nobranch&quot;]</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">                    ],</span><br><span class="line">                    script: [classpath: [], sandbox: false,</span><br><span class="line">                        script: &#x27;&#x27;&#x27;//之前的free job中是这么配置的</span><br><span class="line">evaluate(new File(&quot;$JENKINS_HOME/groovy/paramsbranch.groovy&quot;))</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">                    ]</span><br><span class="line">                ) // end  groovyScript()</span><br><span class="line">        ), description: &#x27;分支名称&#x27;, name: &#x27;BRANCH&#x27;, randomName: &#x27;choice-parameter-4164756292852419&#x27;</span><br></pre></td></tr></table></figure>
<p>流水线脚本 不会 写 可以 使用 jenkins 上 带的 Declarative Directive Generator 通过界面 配置好需要的值如何生成 代码片段。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://magesfc.github.io">mage</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://magesfc.github.io/mage/b4e9b6e07862c8137db0ffc0b3db25339cc8633a/">https://magesfc.github.io/mage/b4e9b6e07862c8137db0ffc0b3db25339cc8633a/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://magesfc.github.io" target="_blank">马哥私房菜</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/plugin/">plugin</a><a class="post-meta__tags" href="/tags/jenkins/">jenkins</a><a class="post-meta__tags" href="/tags/active/">active</a><a class="post-meta__tags" href="/tags/choices/">choices</a></div><div class="post_share"><div class="social-share" data-image="https://t.mwm.moe/fj/" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/null" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/null" alt="支付寶"/></a><div class="post-qr-code-desc">支付寶</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/mage/5c93124b4c040139d4fb0e9d2a5e01c1374ffe84/"><img class="prev-cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Jenkins插件学习之build-history-metrics-plugin</div></div></a></div><div class="next-post pull-right"><a href="/mage/90f5e930f954a602b5d31b10ed2d3b7a07992bd1/"><img class="next-cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Jenkins插件学习之active_directory_plugin之DNS查询</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/mage/ab174ea7e3ac9f6e437fd8f083dd04b6740bcbcb/" title="Jenkins插件学习之active_directory_plugin之登录慢的问题"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-06</div><div class="title">Jenkins插件学习之active_directory_plugin之登录慢的问题</div></div></a></div><div><a href="/mage/90f5e930f954a602b5d31b10ed2d3b7a07992bd1/" title="Jenkins插件学习之active_directory_plugin之DNS查询"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-06</div><div class="title">Jenkins插件学习之active_directory_plugin之DNS查询</div></div></a></div><div><a href="/mage/d27afbb737c1842b57e5bfdba3665b8e6bd9cc65/" title="Jenkins学习之plugin安装"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-06</div><div class="title">Jenkins学习之plugin安装</div></div></a></div><div><a href="/mage/31ee9bb288e1a8313b167cb42fafeba6235cc09a/" title="Jenkins插件学习之Console-Tail-Plugin"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-06</div><div class="title">Jenkins插件学习之Console-Tail-Plugin</div></div></a></div><div><a href="/mage/5c93124b4c040139d4fb0e9d2a5e01c1374ffe84/" title="Jenkins插件学习之build-history-metrics-plugin"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-06</div><div class="title">Jenkins插件学习之build-history-metrics-plugin</div></div></a></div><div><a href="/mage/da170026c4ab9db846d1317ffdba146472154390/" title="Jenkins插件学习之build-user-vars-plugin"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-06</div><div class="title">Jenkins插件学习之build-user-vars-plugin</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">mage</div><div class="author-info__description"> 这里是 马哥 的个人博客 </div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">216</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">231</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">40</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mamh2021"><i class="fab fa-github"></i><span>GitHub</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/mamh2021" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%8A%E5%A4%A9%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%AA%E6%8F%92%E4%BB%B6-active-choices-plugin"><span class="toc-number">1.</span> <span class="toc-text">今天介绍一个插件  active-choices-plugin</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BA%A7%E8%81%94%E5%8F%82%E6%95%B0"><span class="toc-number">2.</span> <span class="toc-text">级联参数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%88%91%E8%87%AA%E5%B7%B1%E9%AD%94%E6%94%B9%E7%9A%84"><span class="toc-number">2.1.</span> <span class="toc-text">我自己魔改的</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E4%BE%8B%E5%AD%90"><span class="toc-number">3.</span> <span class="toc-text">参考例子</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-%E5%8F%82%E6%95%B0-PLATFORM"><span class="toc-number">3.1.</span> <span class="toc-text">定义 参数 PLATFORM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E8%81%94%E5%8A%A8%E5%8F%82%E6%95%B0-branch"><span class="toc-number">3.2.</span> <span class="toc-text">定义联动参数 branch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E6%B0%B4%E7%BA%BF%E8%84%9A%E6%9C%AC%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8"><span class="toc-number">3.3.</span> <span class="toc-text">流水线脚本中如何使用</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/mage/edbed262a0a32c8f4fd97861532b8e9753584e2b/" title="Docker源码学习之docker-version命令"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker源码学习之docker-version命令"/></a><div class="content"><a class="title" href="/mage/edbed262a0a32c8f4fd97861532b8e9753584e2b/" title="Docker源码学习之docker-version命令">Docker源码学习之docker-version命令</a><time datetime="2023-09-28T00:03:49.000Z" title="更新于 2023-09-28 08:03:49">2023-09-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/eee219318da0b6a390e2e2d9c27459533c760b0c/" title="Docker源码学习之docker-run命令"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker源码学习之docker-run命令"/></a><div class="content"><a class="title" href="/mage/eee219318da0b6a390e2e2d9c27459533c760b0c/" title="Docker源码学习之docker-run命令">Docker源码学习之docker-run命令</a><time datetime="2023-09-27T23:25:21.000Z" title="更新于 2023-09-28 07:25:21">2023-09-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/3b60ed21ee8f255c62e0e848435d5648d347b465/" title="Docker源码学习之如何源码编译docker"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker源码学习之如何源码编译docker"/></a><div class="content"><a class="title" href="/mage/3b60ed21ee8f255c62e0e848435d5648d347b465/" title="Docker源码学习之如何源码编译docker">Docker源码学习之如何源码编译docker</a><time datetime="2023-09-27T22:57:30.000Z" title="更新于 2023-09-28 06:57:30">2023-09-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/b4b2fa67751f76c0312672abefffd8eb6e41c702/" title="Docker源码学习之docker-names-generator"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker源码学习之docker-names-generator"/></a><div class="content"><a class="title" href="/mage/b4b2fa67751f76c0312672abefffd8eb6e41c702/" title="Docker源码学习之docker-names-generator">Docker源码学习之docker-names-generator</a><time datetime="2023-09-27T14:01:38.000Z" title="更新于 2023-09-27 22:01:38">2023-09-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/145f51d0e22fead4fc7b2a02f114a5766064789d/" title="Docker源码学习之容器的随机的名字怎么来的y"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker源码学习之容器的随机的名字怎么来的y"/></a><div class="content"><a class="title" href="/mage/145f51d0e22fead4fc7b2a02f114a5766064789d/" title="Docker源码学习之容器的随机的名字怎么来的y">Docker源码学习之容器的随机的名字怎么来的y</a><time datetime="2023-09-26T14:32:47.000Z" title="更新于 2023-09-26 22:32:47">2023-09-26</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://t.mwm.moe/fj/')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By mage</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>