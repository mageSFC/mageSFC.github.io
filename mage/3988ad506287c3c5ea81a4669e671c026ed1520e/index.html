<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹æ€»ä½“ä»‹ç»æ€»ç»“ | é©¬å“¥ç§æˆ¿èœ</title><meta name="author" content="mage"><meta name="copyright" content="mage"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ansible1 ansibleæ¦‚è¿°ä»‹ç»æ¥è‡ª https:&#x2F;&#x2F;www.cnblogs.com&#x2F;keerya&#x2F;p&#x2F;7987886.html 1.0 ansible æ˜¯ä»€ä¹ˆï¼Ÿ ansibleæ˜¯æ–°å‡ºç°çš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼ŒåŸºäºPythonå¼€å‘ï¼Œé›†åˆäº†ä¼—å¤šè¿ç»´å·¥å…·ï¼ˆpuppetã€chefã€funcã€fabric)çš„ä¼˜ç‚¹ï¼Œå®ç°äº†æ‰¹é‡ç³»ç»Ÿé…ç½®ã€æ‰¹é‡ç¨‹åºéƒ¨ç½²ã€æ‰¹é‡è¿è¡Œå‘½ä»¤ç­‰åŠŸèƒ½ã€‚ansibleæ˜¯åŸºäº paramik">
<meta property="og:type" content="article">
<meta property="og:title" content="Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹æ€»ä½“ä»‹ç»æ€»ç»“">
<meta property="og:url" content="https://magesfc.github.io/mage/3988ad506287c3c5ea81a4669e671c026ed1520e/">
<meta property="og:site_name" content="é©¬å“¥ç§æˆ¿èœ">
<meta property="og:description" content="ansible1 ansibleæ¦‚è¿°ä»‹ç»æ¥è‡ª https:&#x2F;&#x2F;www.cnblogs.com&#x2F;keerya&#x2F;p&#x2F;7987886.html 1.0 ansible æ˜¯ä»€ä¹ˆï¼Ÿ ansibleæ˜¯æ–°å‡ºç°çš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼ŒåŸºäºPythonå¼€å‘ï¼Œé›†åˆäº†ä¼—å¤šè¿ç»´å·¥å…·ï¼ˆpuppetã€chefã€funcã€fabric)çš„ä¼˜ç‚¹ï¼Œå®ç°äº†æ‰¹é‡ç³»ç»Ÿé…ç½®ã€æ‰¹é‡ç¨‹åºéƒ¨ç½²ã€æ‰¹é‡è¿è¡Œå‘½ä»¤ç­‰åŠŸèƒ½ã€‚ansibleæ˜¯åŸºäº paramik">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://t.mwm.moe/fj/">
<meta property="article:published_time" content="2022-04-04T03:38:43.000Z">
<meta property="article:modified_time" content="2022-10-31T08:45:25.000Z">
<meta property="article:author" content="mage">
<meta property="article:tag" content="ansible">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://t.mwm.moe/fj/"><link rel="shortcut icon" href="https://www.zeekrlife.com/favicon.png"><link rel="canonical" href="https://magesfc.github.io/mage/3988ad506287c3c5ea81a4669e671c026ed1520e/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":150,"languages":{"author":"ä½œè€…: mage","link":"é“¾æ¥: ","source":"æ¥æº: é©¬å“¥ç§æˆ¿èœ","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹æ€»ä½“ä»‹ç»æ€»ç»“',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-10-31 16:45:25'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><style type="text/css">.card-announcement .social-button{margin:.6rem 0 0 0;text-align:center}.card-announcement .social-button a{display:block;background-color:var(--btn-bg);color:var(--btn-color);text-align:center;line-height:2.4;margin:4px 0}.card-announcement .social-button a:hover{background-color:var(--btn-hover-color)}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">217</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">233</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">40</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> ç›®å½•</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> ç²¾é€‰æ–‡æ¡£</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/21cfbf15/"><span> ğŸš€ å¿«é€Ÿå¼€å§‹</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/dc584b87/"><span> ğŸ“‘ ä¸»é¢˜é¡µé¢</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4aa8abbe/"><span> ğŸ›  ä¸»é¢˜é…ç½®-1</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/ceeb73f/"><span> ğŸ›  ä¸»é¢˜é…ç½®-2</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/98d20436/"><span> â“ ä¸»é¢˜é—®ç­”</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4073eda/"><span> âš¡ï¸ è¿›é˜¶æ•™ç¨‹</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/198a4240/"><span> âœ¨ æ›´æ–°æ—¥å¿—</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://butterfly.js.org/link/"><i class="fa-fw fas fa-thumbs-up"></i><span> å…¶ä»–ç¤ºä¾‹</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://t.mwm.moe/fj/')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">é©¬å“¥ç§æˆ¿èœ</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> ç›®å½•</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> ç²¾é€‰æ–‡æ¡£</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/21cfbf15/"><span> ğŸš€ å¿«é€Ÿå¼€å§‹</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/dc584b87/"><span> ğŸ“‘ ä¸»é¢˜é¡µé¢</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4aa8abbe/"><span> ğŸ›  ä¸»é¢˜é…ç½®-1</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/ceeb73f/"><span> ğŸ›  ä¸»é¢˜é…ç½®-2</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/98d20436/"><span> â“ ä¸»é¢˜é—®ç­”</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4073eda/"><span> âš¡ï¸ è¿›é˜¶æ•™ç¨‹</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/198a4240/"><span> âœ¨ æ›´æ–°æ—¥å¿—</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://butterfly.js.org/link/"><i class="fa-fw fas fa-thumbs-up"></i><span> å…¶ä»–ç¤ºä¾‹</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹æ€»ä½“ä»‹ç»æ€»ç»“</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2022-04-04T03:38:43.000Z" title="å‘è¡¨äº 2022-04-04 11:38:43">2022-04-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2022-10-31T08:45:25.000Z" title="æ›´æ–°äº 2022-10-31 16:45:25">2022-10-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ansible/">ansible</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹æ€»ä½“ä»‹ç»æ€»ç»“"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="ansible"><a href="#ansible" class="headerlink" title="ansible"></a>ansible</h1><h1 id="1-ansibleæ¦‚è¿°ä»‹ç»"><a href="#1-ansibleæ¦‚è¿°ä»‹ç»" class="headerlink" title="1 ansibleæ¦‚è¿°ä»‹ç»"></a>1 ansibleæ¦‚è¿°ä»‹ç»</h1><p>æ¥è‡ª <a target="_blank" rel="noopener" href="https://www.cnblogs.com/keerya/p/7987886.html">https://www.cnblogs.com/keerya/p/7987886.html</a></p>
<p>1.0 ansible æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>ansibleæ˜¯æ–°å‡ºç°çš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼ŒåŸºäºPythonå¼€å‘ï¼Œé›†åˆäº†ä¼—å¤šè¿ç»´å·¥å…·ï¼ˆpuppetã€chefã€funcã€fabric)çš„ä¼˜ç‚¹ï¼Œå®ç°äº†æ‰¹é‡ç³»ç»Ÿé…ç½®ã€æ‰¹é‡ç¨‹åºéƒ¨ç½²ã€æ‰¹é‡è¿è¡Œå‘½ä»¤ç­‰åŠŸèƒ½ã€‚<br>ansibleæ˜¯åŸºäº paramiko å¼€å‘çš„,å¹¶ä¸”åŸºäºæ¨¡å—åŒ–å·¥ä½œï¼Œæœ¬èº«æ²¡æœ‰æ‰¹é‡éƒ¨ç½²çš„èƒ½åŠ›ã€‚çœŸæ­£å…·æœ‰æ‰¹é‡éƒ¨ç½²çš„æ˜¯ansibleæ‰€è¿è¡Œçš„æ¨¡å—ï¼Œansibleåªæ˜¯æä¾›ä¸€ç§æ¡†æ¶ã€‚ansibleä¸éœ€è¦åœ¨è¿œç¨‹ä¸»æœºä¸Šå®‰è£…client&#x2F;agentsï¼Œå› ä¸ºå®ƒä»¬æ˜¯åŸºäºsshæ¥å’Œè¿œ<br>ç¨‹ä¸»æœºé€šè®¯çš„ã€‚ansibleç›®å‰å·²ç»å·²ç»è¢«çº¢å¸½å®˜æ–¹æ”¶è´­ï¼Œæ˜¯è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¸­å¤§å®¶è®¤å¯åº¦æœ€é«˜çš„ï¼Œå¹¶ä¸”ä¸Šæ‰‹å®¹æ˜“ï¼Œå­¦ä¹ ç®€å•ã€‚æ˜¯æ¯ä½è¿ç»´å·¥ç¨‹å¸ˆå¿…é¡»æŒæ¡çš„æŠ€èƒ½ä¹‹ä¸€ã€‚</p>
<p>1.1ansible ç‰¹ç‚¹</p>
<pre><code>éƒ¨ç½²ç®€å•ï¼Œåªéœ€åœ¨ä¸»æ§ç«¯éƒ¨ç½²Ansibleç¯å¢ƒï¼Œè¢«æ§ç«¯æ— éœ€åšä»»ä½•æ“ä½œï¼›
é»˜è®¤ä½¿ç”¨SSHåè®®å¯¹è®¾å¤‡è¿›è¡Œç®¡ç†ï¼›
æœ‰å¤§é‡å¸¸è§„è¿ç»´æ“ä½œæ¨¡å—ï¼Œå¯å®ç°æ—¥å¸¸ç»å¤§éƒ¨åˆ†æ“ä½œï¼›
é…ç½®ç®€å•ã€åŠŸèƒ½å¼ºå¤§ã€æ‰©å±•æ€§å¼ºï¼›
æ”¯æŒAPIåŠè‡ªå®šä¹‰æ¨¡å—ï¼Œå¯é€šè¿‡Pythonè½»æ¾æ‰©å±•ï¼›
é€šè¿‡Playbooksæ¥å®šåˆ¶å¼ºå¤§çš„é…ç½®ã€çŠ¶æ€ç®¡ç†ï¼›
è½»é‡çº§ï¼Œæ— éœ€åœ¨å®¢æˆ·ç«¯å®‰è£…agentï¼Œæ›´æ–°æ—¶ï¼Œåªéœ€åœ¨æ“ä½œæœºä¸Šè¿›è¡Œä¸€æ¬¡æ›´æ–°å³å¯ï¼›
æä¾›ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€æ“ä½œæ€§å¼ºçš„Webç®¡ç†ç•Œé¢å’ŒREST APIæ¥å£â€”â€”AWXå¹³å°ã€‚
</code></pre>
<p>1.2ansible æ¶æ„å›¾</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://images2017.cnblogs.com/blog/1204916/201712/1204916-20171205163000628-69838828.png" alt="ansibleæ¶æ„å›¾"></p>
<p>ä¸Šå›¾ä¸­æˆ‘ä»¬çœ‹åˆ°çš„ä¸»è¦æ¨¡å—å¦‚ä¸‹ï¼š</p>
<pre><code>Ansibleï¼šAnsibleæ ¸å¿ƒç¨‹åºã€‚
HostInventoryï¼šè®°å½•ç”±Ansibleç®¡ç†çš„ä¸»æœºä¿¡æ¯ï¼ŒåŒ…æ‹¬ç«¯å£ã€å¯†ç ã€ipç­‰ã€‚
Playbooksï¼šâ€œå‰§æœ¬â€YAMLæ ¼å¼æ–‡ä»¶ï¼Œå¤šä¸ªä»»åŠ¡å®šä¹‰åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå®šä¹‰ä¸»æœºéœ€è¦è°ƒç”¨å“ªäº›æ¨¡å—æ¥å®Œæˆçš„åŠŸèƒ½ã€‚
CoreModulesï¼šæ ¸å¿ƒæ¨¡å—ï¼Œä¸»è¦æ“ä½œæ˜¯é€šè¿‡è°ƒç”¨æ ¸å¿ƒæ¨¡å—æ¥å®Œæˆç®¡ç†ä»»åŠ¡ã€‚
CustomModulesï¼šè‡ªå®šä¹‰æ¨¡å—ï¼Œå®Œæˆæ ¸å¿ƒæ¨¡å—æ— æ³•å®Œæˆçš„åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§è¯­è¨€ã€‚
ConnectionPluginsï¼šè¿æ¥æ’ä»¶ï¼ŒAnsibleå’ŒHosté€šä¿¡ä½¿ç”¨
</code></pre>
<p>1.3ansible ä»»åŠ¡æ‰§è¡Œæ¨¡å¼</p>
<p>Ansible ç³»ç»Ÿç”±æ§åˆ¶ä¸»æœºå¯¹è¢«ç®¡èŠ‚ç‚¹çš„æ“ä½œæ–¹å¼å¯åˆ†ä¸ºä¸¤ç±»ï¼Œå³adhocå’Œplaybookï¼š</p>
<pre><code>ad-hocæ¨¡å¼(ç‚¹å¯¹ç‚¹æ¨¡å¼)
ã€€ã€€ä½¿ç”¨å•ä¸ªæ¨¡å—ï¼Œæ”¯æŒæ‰¹é‡æ‰§è¡Œå•æ¡å‘½ä»¤ã€‚ad-hoc å‘½ä»¤æ˜¯ä¸€ç§å¯ä»¥å¿«é€Ÿè¾“å…¥çš„å‘½ä»¤ï¼Œè€Œä¸”ä¸éœ€è¦ä¿å­˜èµ·æ¥çš„å‘½ä»¤ã€‚å°±ç›¸å½“äºbashä¸­çš„ä¸€å¥è¯shellã€‚
playbookæ¨¡å¼(å‰§æœ¬æ¨¡å¼)
ã€€ã€€æ˜¯Ansibleä¸»è¦ç®¡ç†æ–¹å¼ï¼Œä¹Ÿæ˜¯AnsibleåŠŸèƒ½å¼ºå¤§çš„å…³é”®æ‰€åœ¨ã€‚playbooké€šè¿‡å¤šä¸ªtaské›†åˆå®Œæˆä¸€ç±»åŠŸèƒ½ï¼Œå¦‚WebæœåŠ¡çš„å®‰è£…éƒ¨ç½²ã€æ•°æ®åº“æœåŠ¡å™¨çš„æ‰¹é‡å¤‡ä»½ç­‰ã€‚å¯ä»¥ç®€å•åœ°æŠŠplaybookç†è§£ä¸ºé€šè¿‡ç»„åˆå¤šæ¡ad-hocæ“ä½œçš„é…ç½®æ–‡ä»¶ã€‚
</code></pre>
<p>1.4ansible æ‰§è¡Œæµç¨‹</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://images2017.cnblogs.com/blog/1204916/201712/1204916-20171205162615738-1292598736.png" alt="ansibleæ¶æ„å›¾"></p>
<p>ç®€å•ç†è§£å°±æ˜¯Ansibleåœ¨è¿è¡Œæ—¶ï¼Œ é¦–å…ˆè¯»å–ansible.cfgä¸­çš„é…ç½®ï¼Œ æ ¹æ®è§„åˆ™è·å–Inventoryä¸­çš„ç®¡ç†ä¸»æœºåˆ—è¡¨ï¼Œ å¹¶è¡Œçš„åœ¨è¿™äº›ä¸»æœºä¸­æ‰§è¡Œé…ç½®çš„ä»»åŠ¡ï¼Œ æœ€åç­‰å¾…æ‰§è¡Œè¿”å›çš„ç»“æœã€‚</p>
<p>1.5ansible å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹</p>
<pre><code>åŠ è½½è‡ªå·±çš„é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤/etc/ansible/ansible.cfgï¼›
æŸ¥æ‰¾å¯¹åº”çš„ä¸»æœºé…ç½®æ–‡ä»¶ï¼Œæ‰¾åˆ°è¦æ‰§è¡Œçš„ä¸»æœºæˆ–è€…ç»„ï¼›
åŠ è½½è‡ªå·±å¯¹åº”çš„æ¨¡å—æ–‡ä»¶ï¼Œå¦‚ commandï¼›
é€šè¿‡ansibleå°†æ¨¡å—æˆ–å‘½ä»¤ç”Ÿæˆå¯¹åº”çš„ä¸´æ—¶pyæ–‡ä»¶(pythonè„šæœ¬)ï¼Œ å¹¶å°†è¯¥æ–‡ä»¶ä¼ è¾“è‡³è¿œç¨‹æœåŠ¡å™¨ï¼›
å¯¹åº”æ‰§è¡Œç”¨æˆ·çš„å®¶ç›®å½•çš„.ansible/tmp/XXX/XXX.PYæ–‡ä»¶ï¼›
ç»™æ–‡ä»¶ +x æ‰§è¡Œæƒé™ï¼›
æ‰§è¡Œå¹¶è¿”å›ç»“æœï¼›
åˆ é™¤ä¸´æ—¶pyæ–‡ä»¶ï¼Œsleep 0é€€å‡ºï¼›
</code></pre>
<p>æ¥è‡ª <a target="_blank" rel="noopener" href="https://www.cnblogs.com/xuwymm/p/15157466.html">https://www.cnblogs.com/xuwymm/p/15157466.html</a></p>
<p>1.0 ansibleæ¦‚è¿°</p>
<pre><code>Ansible æ˜¯ä¸€ä¸ª IT è‡ªåŠ¨åŒ–çš„â€œé…ç½®ç®¡ç†â€å·¥å…·ï¼Œè‡ªåŠ¨åŒ–ä¸»è¦ä½“ç°åœ¨ Ansible é›†æˆäº†ä¸°å¯Œæ¨¡å—ï¼Œä»¥åŠå¼ºå¤§çš„åŠŸèƒ½ç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªå‘½ä»¤è¡Œå®Œæˆä¸€ç³»åˆ—çš„æ“ä½œã€‚è¿›è€Œèƒ½å‡å°‘æˆ‘ä»¬é‡å¤æ€§çš„å·¥ä½œï¼Œä»¥æé«˜å·¥ä½œçš„æ•ˆç‡ã€‚
åˆ›å§‹äººï¼ŒMichael DeHaan(Cobbler ä¸ Func çš„ä½œè€…)ã€‚
2015-10-17ï¼ŒRed Hatå®£å¸ƒæ”¶è´­ã€‚
</code></pre>
<p>1.1 ansibleçš„åŠŸèƒ½</p>
<pre><code>æ‰¹é‡æ‰§è¡Œè¿œç¨‹å‘½ä»¤ï¼Œå¯ä»¥å¯¹Nå¤šå°ä¸»æœºåŒæ—¶è¿›è¡Œå‘½ä»¤çš„æ‰§è¡Œã€‚
æ‰¹é‡é…ç½®è½¯ä»¶æœåŠ¡ï¼Œå¯ä»¥è¿›è¡Œè‡ªåŠ¨åŒ–çš„æ–¹å¼é…ç½®å’Œç®¡ç†æœåŠ¡ã€‚
å®ç°è½¯ä»¶å¼€å‘åŠŸèƒ½ï¼Œ jumpserver åº•å±‚ä½¿ç”¨ ansible æ¥å®ç°çš„è‡ªåŠ¨åŒ–ç®¡ç†ã€‚
ç¼–æ’é«˜çº§çš„ITä»»åŠ¡ï¼Œ Ansible çš„ Playbook æ˜¯ä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼Œå¯ä»¥ç”¨æ¥æç»˜ä¸€å¥— IT æ¶æ„ã€‚
</code></pre>
<p>1.2 ansibleçš„ç‰¹æ€§</p>
<pre><code>å®¹æ˜“å­¦ä¹ ï¼šæ— ä»£ç†ï¼ŒåŸºäºSSHå®ç°ï¼Œä¸åƒ saltstackæ—¢è¦å­¦å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ï¼Œè¿˜éœ€è¦å­¦ä¹ å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¸­é—´é€šè®¯åè®®ï¼›
æ“ä½œçµæ´»ï¼š Ansible æœ‰è¾ƒå¤šçš„æ¨¡å—ï¼Œæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½ã€ playbook åˆ™æä¾›ç±»ä¼¼äºç¼–ç¨‹è¯­è¨€çš„å¤æ‚åŠŸèƒ½ï¼›
ç®€å•æ˜“ç”¨ï¼šä½“ç°åœ¨ Ansible ä¸€ä¸ªå‘½ä»¤å¯ä»¥å®Œæˆå¾ˆå¤šäº‹æƒ…ï¼›
å®‰å…¨å¯é ï¼šå› ä¸º Ansible ä½¿ç”¨äº† SSH åè®®è¿›è¡Œé€šè®¯ï¼Œæ—¢ç¨³å®šä¹Ÿå®‰å…¨ï¼›
ç§»æ¤æ€§é«˜ï¼šå¯ä»¥å°†å†™å¥½çš„ playbook æ‹·è´è‡³ä»»æ„æœºå™¨è¿›è¡Œæ‰§è¡Œï¼›
å¹‚ç­‰æ€§ï¼šä¸€ä¸ªä»»åŠ¡æ‰§è¡Œ1éå’Œæ‰§è¡Œnéæ•ˆæœä¸€æ ·ï¼Œä¸ä¼šå› ä¸ºé‡å¤æ‰§è¡Œå¸¦æ¥æ„å¤–æƒ…å†µï¼›
</code></pre>
<p>1.3 ansibleçš„æ¶æ„<br><a target="_blank" rel="noopener" href="https://img2020.cnblogs.com/blog/2367894/202108/2367894-20210818163717051-274279688.png">https://img2020.cnblogs.com/blog/2367894/202108/2367894-20210818163717051-274279688.png</a></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://img2020.cnblogs.com/blog/2367894/202108/2367894-20210818163717051-274279688.png" alt="ansibleåŸºæœ¬æ¶æ„"></p>
<pre><code>ANSIBLE PLAYBOOKSï¼šä»»åŠ¡å‰§æœ¬ï¼ˆä»»åŠ¡é›†)ï¼Œç¼–æ’å®šä¹‰Ansibleä»»åŠ¡é›†çš„é…ç½®æ–‡ä»¶ï¼Œç”±Ansibleé¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œé€šå¸¸æ˜¯JSONæ ¼å¼çš„YAMLæ–‡ä»¶;

INVENTORYï¼šAnsibleç®¡ç†ä¸»æœºçš„æ¸…å•/etc/anaible/hosts;

MODULESï¼šAnsibleæ‰§è¡Œå‘½ä»¤çš„åŠŸèƒ½æ¨¡å—ï¼Œå¤šæ•°ä¸ºå†…ç½®æ ¸å¿ƒæ¨¡å—ï¼Œä¹Ÿå¯è‡ªå®šä¹‰;

PLUGINSï¼šæ¨¡å—åŠŸèƒ½çš„è¡¥å……ï¼Œå¦‚è¿æ¥ç±»å‹æ’ä»¶ã€å¾ªç¯æ’ä»¶ã€å˜é‡æ’ä»¶ã€è¿‡æ»¤æ’ä»¶ç­‰ï¼Œè¯¥åŠŸèƒ½ä¸å¸¸ç”¨;

APIï¼šä¾›ç¬¬ä¸‰æ–¹ç¨‹åºè°ƒç”¨çš„åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£;

Ansibleä¸»è¦æ“ä½œå¯¹è±¡ï¼šHOSTSä¸»æœºï¼Œä¸»æœºç»„å’ŒNETWORKINGç½‘ç»œè®¾å¤‡;
</code></pre>
<p>åˆ©ç”¨ansibleå®ç°ç®¡ç†çš„æ–¹å¼ï¼š</p>
<pre><code>Ad-Hoc
å³æ‰§è¡Œå•æ¡çš„ansibleå‘½ä»¤ï¼Œä¸»è¦ç”¨äºä¸´æ—¶å‘½ä»¤ä½¿ç”¨åœºæ™¯ï¼›

Ansible-playbook
ä¸»è¦ç”¨äºé•¿æœŸè§„åˆ’å¥½çš„ï¼Œå¤§å‹é¡¹ç›®çš„åœºæ™¯ï¼Œéœ€è¦æœ‰å‰æçš„è§„åˆ’ï¼›

æ‰§è¡Œè¿‡ç¨‹ï¼š
å°†å·²æœ‰ç¼–æ’å¥½çš„ä»»åŠ¡é›†å†™å…¥Ansible-Playbook

é€šè¿‡ansible-playbookå‘½ä»¤åˆ†æ‹†ä»»åŠ¡é›†è‡³é€æ¡ansibleå‘½ä»¤ï¼ŒæŒ‰é¢„å®šè§„åˆ™é€æ¡æ‰§è¡Œã€‚
</code></pre>
<p>1.4 ansibleæ³¨æ„äº‹é¡¹</p>
<pre><code>æ‰§è¡Œansibleçš„ä¸»æœºä¸€èˆ¬ç§°ä¸ºä¸»æ§ç«¯ï¼Œä¸­æ§ï¼Œmasteræˆ–å ¡å’æœºï¼›
ä¸»æ§ç«¯Pythonç‰ˆæœ¬éœ€è¦2.6æˆ–ä»¥ä¸Šï¼›
è¢«æ§ç«¯Pythonç‰ˆæœ¬å°äº2.4éœ€è¦å®‰è£…python-simplejsonï¼›
è¢«æ§ç«¯å¦‚å¼€å¯SELinuxéœ€è¦å®‰è£…libselinux-pythonï¼›
windowsä¸èƒ½åšä¸ºä¸»æ§ç«¯ï¼›
å»ºè®®ä½¿ç”¨sshçš„ç§˜é’¥éªŒè¯æ–¹å¼ç®¡ç†è¢«æ§ä¸»æœºï¼›
</code></pre>
<p>æ¥è‡ª <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c82737b5485c">https://www.jianshu.com/p/c82737b5485c</a></p>
<p>ansibleæ˜¯ä¸€ç§è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·,åŸºäºparamikoå¼€å‘çš„,å¹¶ä¸”åŸºäºæ¨¡å—åŒ–å·¥ä½œï¼ŒAnsibleæ˜¯ä¸€ç§é›†æˆITç³»ç»Ÿçš„é…ç½®ç®¡ç†ã€åº”ç”¨éƒ¨ç½²ã€æ‰§è¡Œç‰¹å®šä»»åŠ¡çš„å¼€æºå¹³å°ï¼Œå®ƒæ˜¯åŸºäºpythonè¯­è¨€ï¼Œç”±Paramikoå’ŒPyYAMLä¸¤ä¸ªå…³é”®æ¨¡å—æ„å»ºã€‚é›†åˆäº†ä¼—å¤šè¿ç»´å·¥å…·çš„ä¼˜ç‚¹ï¼Œå®ç°äº†æ‰¹é‡ç³»ç»Ÿé…ç½®ã€æ‰¹é‡ç¨‹åºéƒ¨ç½²ã€æ‰¹é‡è¿è¡Œå‘½ä»¤ç­‰åŠŸèƒ½.ansibleæ˜¯åŸºäºæ¨¡å—å·¥ä½œçš„,æœ¬èº«æ²¡æœ‰æ‰¹é‡éƒ¨ç½²çš„èƒ½åŠ›.çœŸæ­£å…·æœ‰æ‰¹é‡éƒ¨ç½²çš„æ˜¯ansibleæ‰€è¿è¡Œçš„æ¨¡å—ï¼Œansibleåªæ˜¯æä¾›ä¸€ç§æ¡†æ¶.ansibleä¸éœ€è¦åœ¨è¿œç¨‹ä¸»æœºä¸Šå®‰è£…client&#x2F;agentsï¼Œå› ä¸ºå®ƒä»¬æ˜¯åŸºäºsshæ¥å’Œè¿œç¨‹ä¸»æœºé€šè®¯çš„.</p>
<p>1.1 ansibleåŸºæœ¬æ¶æ„<br>ansibleç³»ç»Ÿç”±æ§åˆ¶ä¸»æœºå’Œè¢«ç®¡ç†ä¸»æœºç»„æˆ,æ§åˆ¶ä¸»æœºä¸æ”¯æŒwindowså¹³å°</p>
<p><a target="_blank" rel="noopener" href="https://upload-images.jianshu.io/upload_images/6078939-1799907d732a3e87.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/885/format/webp">https://upload-images.jianshu.io/upload_images/6078939-1799907d732a3e87.png?imageMogr2/auto-orient/strip|imageView2/2/w/885/format/webp</a></p>
<p><img src= "/img/loading.gif" data-lazy-src="https://upload-images.jianshu.io/upload_images/6078939-1799907d732a3e87.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/885/format/webp" alt="ansibleåŸºæœ¬æ¶æ„"></p>
<pre><code>æ ¸å¿ƒ: ansible
Core Modules: ansibleè‡ªå¸¦çš„æ¨¡å—
Custom Modules: æ ¸å¿ƒæ¨¡å—åŠŸèƒ½ä¸è¶³æ—¶,ç”¨æˆ·å¯ä»¥æ·»åŠ æ‰©å±•æ¨¡å—
Plugins: é€šè¿‡æ’ä»¶æ¥å®ç°è®°å½•æ—¥å¿—,å‘é€é‚®ä»¶æˆ–å…¶ä»–åŠŸèƒ½
Playbooks: å‰§æœ¬,YAMLæ ¼å¼æ–‡ä»¶ï¼Œå¤šä¸ªä»»åŠ¡å®šä¹‰åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå®šä¹‰ä¸»æœºéœ€è¦è°ƒç”¨å“ªäº›æ¨¡å—æ¥å®Œæˆçš„åŠŸèƒ½
Connectior Plugins: ansibleåŸºäºè¿æ¥æ’ä»¶è¿æ¥åˆ°å„ä¸ªä¸»æœºä¸Š,é»˜è®¤æ˜¯ä½¿ç”¨ssh
Host Inventory: è®°å½•ç”±Ansibleç®¡ç†çš„ä¸»æœºä¿¡æ¯ï¼ŒåŒ…æ‹¬ç«¯å£ã€å¯†ç ã€ipç­‰
</code></pre>
<p>1.2 ansibleç‰¹ç‚¹</p>
<p>éƒ¨ç½²ç®€å•, åªéœ€è¦åœ¨æ§åˆ¶ä¸»æœºä¸Šéƒ¨ç½²ansibleç¯å¢ƒ,è¢«æ§åˆ¶ç«¯ä¸Šåªè¦æ±‚å®‰è£…sshå’Œpython 2.5ä»¥ä¸Šç‰ˆæœ¬,è¿™ä¸ªå¯¹äºç±»unixç³»ç»Ÿæ¥è¯´ç›¸å½“ä¸æ— éœ€é…ç½®.</p>
<pre><code>no angents: è¢«ç®¡æ§èŠ‚ç‚¹æ— éœ€å®‰è£…agent
no server: æ— æœåŠ¡ç«¯,ä½¿ç”¨æ˜¯ç›´æ¥è°ƒç”¨å‘½å
modules in any languages: åŸºäºæ¨¡å—å·¥ä½œ, å¯ä»¥ä½¿ç”¨ä»»æ„è¯­è¨€å¼€å‘æ¨¡å—
æ˜“è¯»çš„è¯­æ³•: åŸºäºyamlè¯­æ³•ç¼–å†™playbook
åŸºäºæ¨é€æ¨¡å¼: ä¸åŒäºpuppetçš„æ‹‰å–æ¨¡å¼,ç›´æ¥ç”±è°ƒç”¨è€…æ§åˆ¶å˜æ›´åœ¨æœåŠ¡å™¨ä¸Šå‘ç”Ÿçš„æ—¶é—´
æ¨¡å—æ˜¯å¹‚ç­‰æ€§çš„:å®šä¹‰çš„ä»»åŠ¡å·²å­˜åœ¨åˆ™ä¸ä¼šåšä»»ä½•äº‹æƒ…,æ„å‘³ç€åœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šå¤šæ¬¡æ‰§è¡ŒåŒä¸€ä¸ªplaybookæ˜¯å®‰å…¨çš„
</code></pre>
<p>1.3 ansibleç¨‹åºç›®å½•ç»“æ„:</p>
<pre><code>é…ç½®æ–‡ä»¶: /etc/ansible/
æ‰§è¡Œæ–‡ä»¶ç›®å½•: /usr/bin/
libä¾èµ–åº“: /usr/lib/python2.7/site-packages/ansible/
helpæ–‡ä»¶: /usr/lib/python2.7/site-packages/ansible
</code></pre>
<p>2.ansibleä»»åŠ¡æ‰§è¡Œ</p>
<p>2.1 ansibleä»»åŠ¡æ‰§è¡Œæ¨¡å¼</p>
<p>Ansibleä»»åŠ¡æ‰§è¡Œæ¨¡å¼åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§:</p>
<pre><code>ad-hocæ¨¡å¼(ç‚¹å¯¹ç‚¹æ¨¡å—)  ä½¿ç”¨å•ä¸ªæ¨¡å—,æ”¯æŒæ‰¹é‡æ‰§è¡Œå•æ¡å‘½ä»¤,ç›¸å½“ä¸åœ¨bashä¸­æ‰§è¡Œä¸€å¥shellå‘½ä»¤
playbookæ¨¡å¼(å‰§æœ¬æ¨¡å¼)  ansibleä¸»è¦çš„ç®¡ç†æ–¹å¼,é€šè¿‡å¤šä¸ªtaskçš„é›†åˆå®Œæˆä¸€ç±»åŠŸèƒ½,å¯ä»¥ç†è§£ä¸ºå¤šä¸ªad-hocçš„é…ç½®æ–‡ä»¶
</code></pre>
<p>2.2 ansibleæ‰§è¡Œæµç¨‹:</p>
<p><img src= "/img/loading.gif" data-lazy-src="https://upload-images.jianshu.io/upload_images/6078939-2d6e5a817186480d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/547/format/webp" alt="ansibleæ‰§è¡Œæµç¨‹"></p>
<h1 id="2-ansibleä½¿ç”¨å®‰è£…"><a href="#2-ansibleä½¿ç”¨å®‰è£…" class="headerlink" title="2 ansibleä½¿ç”¨å®‰è£…"></a>2 ansibleä½¿ç”¨å®‰è£…</h1><pre><code>Ansible æ˜¯ä¸€ç§å®‰è£…åœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šçš„æ— ä»£ç†è‡ªåŠ¨åŒ–å·¥å…·ã€‚
Ansible æ˜¯ä¸€ä¸ªæ— ä»£ç†è‡ªåŠ¨åŒ–å·¥å…·ï¼Œæ‚¨å¯ä»¥å®‰è£…åœ¨æ§åˆ¶èŠ‚ç‚¹ä¸Šã€‚
Ansible ä»æ§åˆ¶èŠ‚ç‚¹è¿œç¨‹ç®¡ç†æœºå™¨å’Œå…¶ä»–è®¾å¤‡ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œé€šè¿‡ SSH åè®®)ã€‚ 
è¦å®‰è£… Ansible ä»¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ï¼Œåªéœ€åœ¨ä¸€å°æœºå™¨ä¸Šå®‰è£… Ansible åŒ…ï¼ˆå¾ˆå®¹æ˜“å°±æ˜¯ä¸€å°ç¬”è®°æœ¬ç”µè„‘)ã€‚ æ‚¨ä¸éœ€è¦å®‰è£…æ•°æ®åº“æˆ–è¿è¡Œä»»ä½•å®ˆæŠ¤ç¨‹åºã€‚ Ansible å¯ä»¥ä»ä¸€ä¸ªæ§åˆ¶èŠ‚ç‚¹ç®¡ç†ä¸€æ•´å¥—è¿œç¨‹æœºå™¨ã€‚ 

æ§åˆ¶èŠ‚ç‚¹éœ€è¦ å®‰è£… python å’Œå¯¹åº”çš„ ansible å·¥å…·

è¢«æ§åˆ¶èŠ‚ç‚¹éœ€è¦ python
å°½ç®¡æ‚¨çš„æ‰˜ç®¡èŠ‚ç‚¹ä¸Šä¸éœ€è¦å®ˆæŠ¤è¿›ç¨‹ï¼Œä½†æ‚¨ç¡®å®éœ€è¦ä¸€ç§ Ansible ä¸å®ƒä»¬è¿›è¡Œé€šä¿¡çš„æ–¹å¼ã€‚ å¯¹äºå¤§å¤šæ•°å—ç®¡èŠ‚ç‚¹ï¼ŒAnsible é€šè¿‡ SSH å»ºç«‹è¿æ¥å¹¶ä½¿ç”¨ SFTP ä¼ è¾“æ¨¡å—ã€‚ å¦‚æœ SSH æœ‰æ•ˆä½† SFTP åœ¨æ‚¨çš„æŸäº›å—ç®¡èŠ‚ç‚¹ä¸Šä¸å¯ç”¨ï¼Œæ‚¨å¯ä»¥åœ¨ ansible.cfg ä¸­åˆ‡æ¢åˆ° SCPã€‚ å¯¹äºä»»ä½•å¯ä»¥è¿è¡Œ Python çš„æœºå™¨æˆ–è®¾å¤‡ï¼Œæ‚¨è¿˜éœ€è¦ Python 2ï¼ˆç‰ˆæœ¬ 2.6 æˆ–æ›´é«˜ç‰ˆæœ¬)æˆ– Python 3ï¼ˆç‰ˆæœ¬ 3.5 æˆ–æ›´é«˜ç‰ˆæœ¬)ã€‚ 
</code></pre>
<p>1 ç¼–è¯‘å®‰è£… </p>
<p>ansibleä¾èµ–äºPython 2.6æˆ–æ›´é«˜çš„ç‰ˆæœ¬ã€paramikoã€PyYAMLåŠJinja2ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># yum -y install python-jinja2 PyYAML python-paramiko python-babel python-crypto</span><br><span class="line"># tar xf ansible-1.5.4.tar.gz</span><br><span class="line"># cd ansible-1.5.4</span><br><span class="line"># python setup.py build</span><br><span class="line"># python setup.py install</span><br><span class="line"># mkdir /etc/ansible</span><br><span class="line"># cp -r examples/* /etc/ansible</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>2 Ubuntuä¸Šå®‰è£…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ sudo apt update</span><br><span class="line">$ sudo apt install software-properties-common</span><br><span class="line">$ sudo add-apt-repository --yes --update ppa:ansible/ansible</span><br><span class="line">$ sudo apt install ansible</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Ubuntuä¸Šå®‰è£…20.04ä¸Šé¢å®‰è£…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ansible@ansible:~$ sudo apt install ansible</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree</span><br><span class="line">Reading state information... Done</span><br><span class="line">The following additional packages will be installed:</span><br><span class="line">  ieee-data python3-argcomplete python3-crypto python3-dnspython python3-jmespath python3-kerberos python3-libcloud python3-lockfile python3-netaddr python3-ntlm-auth python3-requests-kerberos python3-requests-ntlm python3-selinux python3-winrm python3-xmltodict</span><br><span class="line">Suggested packages:</span><br><span class="line">  cowsay sshpass python-lockfile-doc ipython3 python-netaddr-docs</span><br><span class="line">The following NEW packages will be installed:</span><br><span class="line">  ansible ieee-data python3-argcomplete python3-crypto python3-dnspython python3-jmespath python3-kerberos python3-libcloud python3-lockfile python3-netaddr python3-ntlm-auth python3-requests-kerberos python3-requests-ntlm python3-selinux python3-winrm python3-xmltodict</span><br><span class="line">0 upgraded, 16 newly installed, 0 to remove and 132 not upgraded.</span><br><span class="line">Need to get 9,644 kB of archives.</span><br><span class="line">After this operation, 90.2 MB of additional disk space will be used.</span><br><span class="line">Do you want to continue? [Y/n]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ansible@ansible:~$ ansible --version</span><br><span class="line">ansible 2.9.6</span><br><span class="line">  config file = /etc/ansible/ansible.cfg</span><br><span class="line">  configured module search path = [&#x27;/home/ansible/.ansible/plugins/modules&#x27;, &#x27;/usr/share/ansible/plugins/modules&#x27;]</span><br><span class="line">  ansible python module location = /usr/lib/python3/dist-packages/ansible</span><br><span class="line">  executable location = /usr/bin/ansible</span><br><span class="line">  python version = 3.8.10 (default, Sep 28 2021, 16:10:42) [GCC 9.3.0]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>3 conda ç¯å¢ƒä¸‹å®‰è£…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">bin/conda create --name ansible python=3.8  # åˆ›å»ºä¸ª 3.8çš„pythonè™šæ‹Ÿç¯å¢ƒ</span><br><span class="line"></span><br><span class="line">bin/conda install -n ansible -c conda-forge ansible  # å®‰è£… ansible æ¨¡å—</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>4centos ä¸Šå®‰è£…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> # wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br><span class="line"> # yum install ansible</span><br><span class="line">Installed:</span><br><span class="line">  ansible.noarch 0:2.9.23-1.el7</span><br><span class="line"> </span><br><span class="line">Dependency Installed:</span><br><span class="line">  PyYAML.x86_64 0:3.10-11.el7                libyaml.x86_64 0:0.1.4-11.el7_0                                 python-babel.noarch 0:0.9.6-8.el7          </span><br><span class="line">  python-backports.x86_64 0:1.0-8.el7        python-backports-ssl_match_hostname.noarch 0:3.5.0.1-1.el7      python-cffi.x86_64 0:1.6.0-5.el7           </span><br><span class="line">  python-enum34.noarch 0:1.0.4-1.el7         python-idna.noarch 0:2.4-1.el7                                  python-ipaddress.noarch 0:1.0.16-2.el7     </span><br><span class="line">  python-jinja2.noarch 0:2.7.2-4.el7         python-markupsafe.x86_64 0:0.11-10.el7                          python-paramiko.noarch 0:2.1.1-9.el7       </span><br><span class="line">  python-ply.noarch 0:3.4-11.el7             python-pycparser.noarch 0:2.14-1.el7                            python-setuptools.noarch 0:0.9.8-7.el7     </span><br><span class="line">  python-six.noarch 0:1.9.0-2.el7            python2-cryptography.x86_64 0:1.7.2-2.el7                       python2-httplib2.noarch 0:0.18.1-3.el7     </span><br><span class="line">  python2-jmespath.noarch 0:0.9.4-2.el7      python2-pyasn1.noarch 0:0.1.9-7.el7                            </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>5pipå®‰è£…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pipæ˜¯å®‰è£…pythonçš„å·¥å…·ã€‚</span><br><span class="line"></span><br><span class="line"># yum install python3 python3-devel python3-pip - y</span><br><span class="line"># pip3 install --upgrade pip -i https://pypi.douban.com/simple/ </span><br><span class="line"># pip3 install ansible -i https://pypi.douban.com/simple/ </span><br><span class="line"># /usr/local/bin/ansible --version</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹ansibleçš„å®‰è£…ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬ä»¥åŠå„ç§æ–‡ä»¶çš„è·¯å¾„</span><br><span class="line"># ansible --version</span><br><span class="line">ansible 2.9.23</span><br><span class="line">  config file = /etc/ansible/ansible.cfg</span><br><span class="line">  configured module search path = [u&#x27;/root/.ansible/plugins/modules&#x27;, u&#x27;/usr/share/ansible/plugins/modules&#x27;]</span><br><span class="line">  ansible python module location = /usr/lib/python2.7/site-packages/ansible</span><br><span class="line">  executable location = /usr/bin/ansible</span><br><span class="line">  python version = 2.7.5 (default, Apr  2 2020, 13:16:51) [GCC 4.8.5 20150623 (Red Hat 4.8.5-39)]</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ansibleå®‰è£…åä¿®æ”¹é…ç½®æ–‡ä»¶</p>
<p>ansibleä¸æˆ‘ä»¬å…¶ä»–çš„æœåŠ¡åœ¨è¿™ä¸€ç‚¹ä¸Šæœ‰å¾ˆå¤§ä¸åŒï¼Œè¿™é‡Œçš„é…ç½®æ–‡ä»¶æŸ¥æ‰¾æ˜¯ä»å¤šä¸ªåœ°æ–¹æ‰¾çš„ï¼Œé¡ºåºå¦‚ä¸‹ï¼š</p>
<pre><code>æ£€æŸ¥ç¯å¢ƒå˜é‡ANSIBLE_CONFIGæŒ‡å‘çš„è·¯å¾„æ–‡ä»¶(export ANSIBLE_CONFIG=/etc/ansible.cfg)ï¼›
~/.ansible.cfgï¼Œæ£€æŸ¥å½“å‰ç›®å½•ä¸‹çš„ansible.cfgé…ç½®æ–‡ä»¶ï¼›
/etc/ansible.cfgæ£€æŸ¥etcç›®å½•çš„é…ç½®æ–‡ä»¶ã€‚
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Ansible çš„é…ç½®æ–‡ä»¶å¯ä»¥å­˜æ”¾åœ¨ä»»ä½•ä½ç½®ï¼Œä½†é…ç½®æ–‡ä»¶æœ‰è¯»å–é¡ºåºï¼ŒæŸ¥æ‰¾é¡ºåºå¦‚ä¸‹ï¼š</span><br><span class="line">        æœ€å…ˆæŸ¥æ‰¾ $ANSIBLE_CONFIG å˜é‡ï¼›</span><br><span class="line">        å…¶æ¬¡æŸ¥æ‰¾å½“å‰é¡¹ç›®ç›®å½•ä¸‹ $PWD/ansible.cfgï¼›</span><br><span class="line">        ç„¶åæŸ¥æ‰¾ç”¨æˆ·å®¶ç›®å½•ä¸‹çš„ $HOME/.ansible.cfgï¼›</span><br><span class="line">        æœ€åæŸ¥æ‰¾ /etc/ansible/ansible.cfgï¼›</span><br></pre></td></tr></table></figure>

<p>ansible çš„é…ç½®æ–‡ä»¶ä¸º&#x2F;etc&#x2F;ansible&#x2F;ansible.cfgï¼Œä¸»é…ç½®æ–‡ä»¶ï¼Œé…ç½® ansible å·¥ä½œç‰¹æ€§.ansible æœ‰è®¸å¤šå‚æ•°ï¼Œä¸‹é¢æˆ‘ä»¬åˆ—å‡ºä¸€äº›å¸¸è§çš„å‚æ•°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">inventory = /etc/ansible/hosts		#è¿™ä¸ªå‚æ•°è¡¨ç¤ºèµ„æºæ¸…å•inventoryæ–‡ä»¶çš„ä½ç½®</span><br><span class="line">library = /usr/share/ansible		#æŒ‡å‘å­˜æ”¾Ansibleæ¨¡å—çš„ç›®å½•ï¼Œæ”¯æŒå¤šä¸ªç›®å½•æ–¹å¼ï¼Œåªè¦ç”¨å†’å·ï¼ˆï¼š)éš”å¼€å°±å¯ä»¥</span><br><span class="line">forks = 5		#å¹¶å‘è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º5</span><br><span class="line">sudo_user = root		#è®¾ç½®é»˜è®¤æ‰§è¡Œå‘½ä»¤çš„ç”¨æˆ·</span><br><span class="line">remote_port = 22		#æŒ‡å®šè¿æ¥è¢«ç®¡èŠ‚ç‚¹çš„ç®¡ç†ç«¯å£ï¼Œé»˜è®¤ä¸º22ç«¯å£ï¼Œå»ºè®®ä¿®æ”¹ï¼Œèƒ½å¤Ÿæ›´åŠ å®‰å…¨</span><br><span class="line">host_key_checking = False		#è®¾ç½®æ˜¯å¦æ£€æŸ¥SSHä¸»æœºçš„å¯†é’¥ï¼Œå€¼ä¸ºTrue/Falseã€‚å…³é—­åç¬¬ä¸€æ¬¡è¿æ¥ä¸ä¼šæç¤ºé…ç½®å®ä¾‹</span><br><span class="line">timeout = 60		#è®¾ç½®SSHè¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºç§’</span><br><span class="line">log_path = /var/log/ansible.log		#æŒ‡å®šä¸€ä¸ªå­˜å‚¨ansibleæ—¥å¿—çš„æ–‡ä»¶ï¼ˆé»˜è®¤ä¸è®°å½•æ—¥å¿—)</span><br></pre></td></tr></table></figure>
<p>ansible çš„ä¸»é…ç½®æ–‡ä»¶å­˜åœ¨ &#x2F;etc&#x2F;anible&#x2F;ansible.cfg ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†çš„é…ç½®å†…å®¹æ— éœ€è¿›è¡Œä¿®æ”¹ï¼›</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[defaults]</span><br><span class="line">#inventory = /etc/ansible/hosts  </span><br><span class="line">`ä¸»æœºæ¸…å•é…ç½®æ–‡ä»¶`</span><br><span class="line">#library = /usr/share/my_modules/  </span><br><span class="line">`åº“æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼Œå­˜æ”¾æ¨¡å—`</span><br><span class="line">#module_utils   = /usr/share/my_module_utils/  </span><br><span class="line">`ç”¨åˆ°çš„utilså·¥å…·å­˜æ”¾ç›®å½•`</span><br><span class="line">#remote_tmp = $HOME/.ansible/tmp</span><br><span class="line">`ä¸´æ—¶pyå‘½ä»¤æ–‡ä»¶å­˜æ”¾åœ¨è¿œç¨‹ä¸»æœºç›®å½•ï¼Œå…ˆæŠŠansibleæ‰§è¡Œçš„æŒ‡ä»¤ï¼Œå…ˆç”Ÿæˆpyç¨‹åºï¼Œç„¶åæ”¾åœ¨æœ¬åœ°çš„ç›®å½•é‡Œï¼Œç„¶åå†ç”¨sshåè®®ï¼Œå°†ç”Ÿæˆçš„pyç¨‹åºå¤åˆ¶åˆ°è¢«ç®¡ç†çš„æœºå™¨remote_tmpç›®å½•ä¸‹ï¼Œå¤åˆ¶è¿‡å»åï¼Œæ‹¿å‡ºæ¥æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæ¯•åä¼šå°†è¯¥ç¨‹åºåˆ é™¤`</span><br><span class="line">#local_tmp = $HOME/.ansible/tmp </span><br><span class="line">`æœ¬æœºçš„ä¸´æ—¶å‘½ä»¤æ‰§è¡Œç›®å½•`</span><br><span class="line">#forks = 5 #</span><br><span class="line">`é»˜è®¤å¹¶å‘æ•°`</span><br><span class="line">#poll_interval  = 15 </span><br><span class="line">`æ¯éš”15ç§’å»æŸ¥çœ‹å¯¹æ–¹çš„çŠ¶æ€`</span><br><span class="line">#sudo_user = root </span><br><span class="line">`é»˜è®¤sudo ç”¨æˆ· `</span><br><span class="line">#ask_sudo_pass = True </span><br><span class="line">#ask_pass = True</span><br><span class="line">`æ¯æ¬¡æ‰§è¡Œansibleå‘½ä»¤æ˜¯å¦è¯¢é—®sshå¯†ç `</span><br><span class="line">#remote_port = 22</span><br><span class="line">`å®¢æˆ·ç«¯çš„sshç«¯å£`</span><br><span class="line">#host_key_checking = False  </span><br><span class="line">`æ£€æŸ¥å¯¹åº”æœåŠ¡å™¨çš„host_keyï¼Œå»ºè®®å–æ¶ˆæ³¨é‡Šï¼Œç”¨äºå–æ¶ˆç¬¬ä¸€æ¬¡è¿æ¥é—®yes|noï¼Œè‹¥è®¾ç½®ä¸ºtrueï¼Œåˆ™æ²¡æœ‰è¾“å…¥è¿‡yes|noçš„ä¸»æœºä¸èƒ½ä½¿ç”¨ansibleç®¡ç†ã€‚</span><br><span class="line">#log_path=/var/log/ansible.log </span><br><span class="line">`æ—¥å¿—æ–‡ä»¶ï¼Œå»ºè®®å–æ¶ˆæ³¨é‡Šï¼Œå¯ä»¥è®°å½•æ—¥å¿—`</span><br><span class="line"></span><br><span class="line">[privilege_escalation] #å¦‚æœæ˜¯æ™®é€šç”¨æˆ·åˆ™éœ€è¦é…ç½®ææƒ </span><br><span class="line">#become=True </span><br><span class="line">#become_method=sudo </span><br><span class="line">#become_user=root </span><br><span class="line">#become_ask_pass=False</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æˆ‘çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘æ¯”è¾ƒå–œæ¬¢ä¿®æ”¹çš„å‡ ä¸ªé€‰é¡¹ï¼Œåœ¨è‡ªå·±çš„homeç›®å½•ä¸‹é¢é…ç½®ä¸ª .ansible.cfg æ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[defaults]           </span><br><span class="line">inventory       = ./hosts            #è¿™æ ·å†™å°±æ˜¯ è´¦å· home ç›®å½•ä¸‹é¢</span><br><span class="line">remote_tmp      = /tmp/ansibletmpr</span><br><span class="line">local_tmp       = /tmp/ansibletmpl</span><br><span class="line">remote_user = ansible           # è¿™æ ·è¦è®¾ç½®ä¸€ä¸‹ï¼Œä¸ç„¶ssh è¿æ¥è¢«æ§èŠ‚ç‚¹ éƒ½æ˜¯ä»¥ jenkins è´¦å·å»è¿æ¥äº†          </span><br><span class="line">executable = /bin/bash </span><br><span class="line">[ssh_connection]   </span><br><span class="line">control_path_dir = /tmp/ansibletmpl/cp                           </span><br><span class="line">control_path = %(directory)s/ansible-ssh-%%h-%%p-%%r</span><br></pre></td></tr></table></figure>


<h1 id="ansibleä¸»æœºæ¸…å•inventoryä»‹ç»"><a href="#ansibleä¸»æœºæ¸…å•inventoryä»‹ç»" class="headerlink" title="ansibleä¸»æœºæ¸…å•inventoryä»‹ç»"></a>ansibleä¸»æœºæ¸…å•inventoryä»‹ç»</h1><p>åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æåˆ°äº†èµ„æºæ¸…å•ï¼Œè¿™ä¸ªæ¸…å•å°±æ˜¯æˆ‘ä»¬çš„ä¸»æœºæ¸…å•ï¼Œé‡Œé¢ä¿å­˜çš„æ˜¯ä¸€äº› ansible éœ€è¦è¿æ¥ç®¡ç†çš„ä¸»æœºåˆ—è¡¨ã€‚æˆ‘ä»¬å¯ä»¥æ¥çœ‹çœ‹ä»–çš„å®šä¹‰æ–¹å¼ï¼š</p>
<p>1ã€ ç›´æ¥æŒ‡æ˜ä¸»æœºåœ°å€æˆ–ä¸»æœºåï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">## green.example.com#</span><br><span class="line"># blue.example.com#</span><br><span class="line"># 192.168.100.1</span><br><span class="line"># 192.168.100.10</span><br></pre></td></tr></table></figure>

<p>2ã€ å®šä¹‰ä¸€ä¸ªä¸»æœºç»„[ç»„å]æŠŠåœ°å€æˆ–ä¸»æœºååŠ è¿›å»</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[mysql_test]</span><br><span class="line">192.168.253.159</span><br><span class="line">192.168.253.160</span><br><span class="line">192.168.253.153</span><br><span class="line"></span><br><span class="line">å¯ä»¥å°†åŒä¸€ä¸ªä¸»æœºåŒæ—¶å½’å¹¶åˆ°å¤šä¸ªä¸åŒçš„ç»„ä¸­ï¼Œå¦‚192.168.169.129åŒæ—¶å­˜åœ¨äº[web]ä¸[app]ä¸­ï¼š</span><br><span class="line"></span><br><span class="line">[web]</span><br><span class="line">192.168.169.128</span><br><span class="line">192.168.169.129</span><br><span class="line">[app]</span><br><span class="line">192.168.169.130</span><br><span class="line">192.168.169.129</span><br><span class="line"></span><br><span class="line">æ”¯æŒä¸»æœºåå†™æ³•ï¼Œå¹¶ä¸”æ”¯æŒé€šé…ç¬¦ï¼š</span><br><span class="line">[web]</span><br><span class="line">www[01:50].example.com       &lt;==æ”¯æŒé€šé…ç¬¦åŒ¹é…www01 www02 ...www50</span><br><span class="line"></span><br><span class="line">å½“å¦‚è‹¥ç›®æ ‡ä¸»æœºä½¿ç”¨äº†éé»˜è®¤çš„SSHç«¯å£ï¼Œè¿˜å¯ä»¥åœ¨ä¸»æœºåç§°ä¹‹åä½¿ç”¨å†’å·åŠ ç«¯å£å·æ¥æ ‡æ˜ï¼š</span><br><span class="line">[web]</span><br><span class="line">www.example.com:2222</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ä½¿ç”¨åŸºäºç”¨æˆ·åå¯†ç çš„æ–¹å¼è¿æ¥è¢«æ§ä¸»æœºï¼Œå¯ä»¥åœ¨ä¸»æœºæ¸…å•ä¸­å®šä¹‰è¢«æ§ä¸»æœºçš„ç”¨æˆ·åå¯†ç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[webservers] </span><br><span class="line">10.0.0.31 ansible_ssh_port=22 ansible_ssh_user=root ansible_ssh_pass=&#x27;123456&#x27; </span><br><span class="line">10.0.0.41 ansible_ssh_port=22 ansible_ssh_user=root ansible_ssh_pass=&#x27;123456&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">(ansible) ansible@jenkins-master:~$ cat tools/ansible/inventory.conf</span><br><span class="line"># This is the default ansible &#x27;hosts&#x27; file.</span><br><span class="line">#</span><br><span class="line"># It should live in /etc/ansible/hosts</span><br><span class="line">#</span><br><span class="line">#   - Comments begin with the &#x27;#&#x27; character</span><br><span class="line">#   - Blank lines are ignored</span><br><span class="line">#   - Groups of hosts are delimited by [header] elements</span><br><span class="line">#   - You can enter hostnames or ip addresses</span><br><span class="line">#   - A hostname/ip can be a member of multiple groups</span><br><span class="line"></span><br><span class="line"># Ex 1: Ungrouped hosts, specify before any group headers:</span><br><span class="line"></span><br><span class="line">## green.example.com</span><br><span class="line">## blue.example.com</span><br><span class="line">## 192.168.100.1</span><br><span class="line">## 192.168.100.10</span><br><span class="line"></span><br><span class="line"># Ex 2: A collection of hosts belonging to the &#x27;webservers&#x27; group:</span><br><span class="line"></span><br><span class="line">## [webservers]</span><br><span class="line">## alpha.example.org</span><br><span class="line">## beta.example.org</span><br><span class="line">## 192.168.1.100</span><br><span class="line">## 192.168.1.110</span><br><span class="line"></span><br><span class="line"># If you have multiple hosts following a pattern, you can specify</span><br><span class="line"># them like this:</span><br><span class="line"></span><br><span class="line">## www[001:006].example.com</span><br><span class="line"></span><br><span class="line"># Ex 3: A collection of database servers in the &#x27;dbservers&#x27; group:</span><br><span class="line"></span><br><span class="line">## [dbservers]</span><br><span class="line">##</span><br><span class="line">## db01.intranet.mydomain.net</span><br><span class="line">## db02.intranet.mydomain.net</span><br><span class="line">## 10.25.1.56</span><br><span class="line">## 10.25.1.57</span><br><span class="line"></span><br><span class="line"># Here&#x27;s another example of host ranges, this time there are no</span><br><span class="line"># leading 0s:</span><br><span class="line"></span><br><span class="line">## db-[99:101]-node.example.com</span><br><span class="line"></span><br><span class="line">[bf]</span><br><span class="line">192.168.xxxxxx.[31:45]</span><br><span class="line">192.168.xxxxxx.[31:48]</span><br><span class="line"></span><br><span class="line">[gb]</span><br><span class="line">192.168.xxxxxx.[46:90]</span><br><span class="line"></span><br><span class="line">[app]</span><br><span class="line">192.168.xxxxxx.101</span><br><span class="line">192.168.xxxxxx.98</span><br><span class="line">192.168.xxxxxx.99</span><br><span class="line"></span><br><span class="line">[bfdocker]</span><br><span class="line">192.168.xxxxxx.[93:97]</span><br><span class="line">[anbf]</span><br><span class="line">192.168.xxxxxx.[98:100]</span><br><span class="line"></span><br><span class="line">[rmsh]</span><br><span class="line">192.168.xxxxxx.[111:142]</span><br><span class="line">192.168.xxxxxx.[145:150]</span><br><span class="line"></span><br><span class="line">[rmnj]</span><br><span class="line">192.168.xxxxxx.[211:217]</span><br><span class="line">[rmsz]</span><br><span class="line">192.168.xxxxxx.[171:176]</span><br><span class="line"></span><br><span class="line">[core]</span><br><span class="line">192.168.xxxxxx.xxx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>




<h1 id="ansible-å¸¸ç”¨å‘½ä»¤ä»‹ç»"><a href="#ansible-å¸¸ç”¨å‘½ä»¤ä»‹ç»" class="headerlink" title="ansible å¸¸ç”¨å‘½ä»¤ä»‹ç»"></a>ansible å¸¸ç”¨å‘½ä»¤ä»‹ç»</h1><p>0.æ€»è§ˆä»‹ç»</p>
<pre><code>/usr/bin/ansibleã€€ã€€Ansibe AD-Hoc ä¸´æ—¶å‘½ä»¤æ‰§è¡Œå·¥å…·ï¼Œå¸¸ç”¨äºä¸´æ—¶å‘½ä»¤çš„æ‰§è¡Œ
/usr/bin/ansible-doc ã€€ã€€Ansible æ¨¡å—åŠŸèƒ½æŸ¥çœ‹å·¥å…·
/usr/bin/ansible-galaxyã€€ã€€ä¸‹è½½/ä¸Šä¼ ä¼˜ç§€ä»£ç æˆ–Rolesæ¨¡å— çš„å®˜ç½‘å¹³å°ï¼ŒåŸºäºç½‘ç»œçš„
/usr/bin/ansible-playbookã€€ã€€Ansible å®šåˆ¶è‡ªåŠ¨åŒ–çš„ä»»åŠ¡é›†ç¼–æ’å·¥å…·
/usr/bin/ansible-pullã€€ã€€Ansibleè¿œç¨‹æ‰§è¡Œå‘½ä»¤çš„å·¥å…·ï¼Œæ‹‰å–é…ç½®è€Œéæ¨é€é…ç½®ï¼ˆä½¿ç”¨è¾ƒå°‘ï¼Œæµ·é‡æœºå™¨æ—¶ä½¿ç”¨ï¼Œå¯¹è¿ç»´çš„æ¶æ„èƒ½åŠ›è¦æ±‚è¾ƒé«˜)
/usr/bin/ansible-vaultã€€ã€€Ansible æ–‡ä»¶åŠ å¯†å·¥å…·
/usr/bin/ansible-consoleã€€ã€€AnsibleåŸºäºLinux Consobleç•Œé¢å¯ä¸ç”¨æˆ·äº¤äº’çš„å‘½ä»¤æ‰§è¡Œå·¥å…·
å…¶ä¸­ï¼Œæˆ‘ä»¬æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯/usr/bin/ansibleå’Œ/usr/bin/ansible-playbookã€‚

ansible-doc å‘½ä»¤å¸¸ç”¨äºè·å–æ¨¡å—ä¿¡æ¯åŠå…¶ä½¿ç”¨å¸®åŠ©ï¼Œä¸€èˆ¬ç”¨æ³•å¦‚ä¸‹ï¼š
ansible-doc -l				#è·å–å…¨éƒ¨æ¨¡å—çš„ä¿¡æ¯
ansible-doc -s MOD_NAME		#è·å–æŒ‡å®šæ¨¡å—çš„ä½¿ç”¨å¸®åŠ©
</code></pre>
<p>1.ansible å‘½ä»¤è¯¦è§£</p>
<p>ansible å‘½ä»¤è¯¦è§£ã€€ã€€å‘½ä»¤çš„å…·ä½“æ ¼å¼å¦‚ä¸‹ï¼šc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">    ansible &lt;host-pattern&gt; [-f forks] [-m module_name] [-a args]</span><br><span class="line"></span><br><span class="line">-a MODULE_ARGSã€€ã€€ã€€#æ¨¡å—çš„å‚æ•°ï¼Œå¦‚æœæ‰§è¡Œé»˜è®¤COMMANDçš„æ¨¡å—ï¼Œå³æ˜¯å‘½ä»¤å‚æ•°ï¼Œå¦‚ï¼š â€œdateâ€ï¼Œâ€œpwdâ€ç­‰ç­‰</span><br><span class="line">-kï¼Œ--ask-pass	#ask for SSH passwordã€‚ç™»å½•å¯†ç ï¼Œæç¤ºè¾“å…¥SSHå¯†ç è€Œä¸æ˜¯å‡è®¾åŸºäºå¯†é’¥çš„éªŒè¯</span><br><span class="line">--ask-su-pass	#ask for su passwordã€‚suåˆ‡æ¢å¯†ç </span><br><span class="line">-Kï¼Œ--ask-sudo-pass	#ask for sudo passwordã€‚æç¤ºå¯†ç ä½¿ç”¨sudoï¼Œsudoè¡¨ç¤ºææƒæ“ä½œ</span><br><span class="line">--ask-vault-pass	#ask for vault passwordã€‚å‡è®¾æˆ‘ä»¬è®¾å®šäº†åŠ å¯†çš„å¯†ç ï¼Œåˆ™ç”¨è¯¥é€‰é¡¹è¿›è¡Œè®¿é—®</span><br><span class="line">-B SECONDS	#åå°è¿è¡Œè¶…æ—¶æ—¶é—´</span><br><span class="line">-C	#æ¨¡æ‹Ÿè¿è¡Œç¯å¢ƒå¹¶è¿›è¡Œé¢„è¿è¡Œï¼Œå¯ä»¥è¿›è¡ŒæŸ¥é”™æµ‹è¯•</span><br><span class="line">-c CONNECTION	#è¿æ¥ç±»å‹ä½¿ç”¨</span><br><span class="line">-f FORKS	#å¹¶è¡Œä»»åŠ¡æ•°ï¼Œé»˜è®¤ä¸º5</span><br><span class="line">-i INVENTORY	#æŒ‡å®šä¸»æœºæ¸…å•çš„è·¯å¾„ï¼Œé»˜è®¤ä¸º/etc/ansible/hosts</span><br><span class="line">--list-hosts	#æŸ¥çœ‹æœ‰å“ªäº›ä¸»æœºç»„</span><br><span class="line">-m MODULE_NAME	#æ‰§è¡Œæ¨¡å—çš„åå­—ï¼Œé»˜è®¤ä½¿ç”¨ command æ¨¡å—ï¼Œæ‰€ä»¥å¦‚æœæ˜¯åªæ‰§è¡Œå•ä¸€å‘½ä»¤å¯ä»¥ä¸ç”¨ -må‚æ•°</span><br><span class="line">-o	#å‹ç¼©è¾“å‡ºï¼Œå°è¯•å°†æ‰€æœ‰ç»“æœåœ¨ä¸€è¡Œè¾“å‡ºï¼Œä¸€èˆ¬é’ˆå¯¹æ”¶é›†å·¥å…·ä½¿ç”¨</span><br><span class="line">-S	#ç”¨ su å‘½ä»¤</span><br><span class="line">-R SU_USER	#æŒ‡å®š su çš„ç”¨æˆ·ï¼Œé»˜è®¤ä¸º root ç”¨æˆ·</span><br><span class="line">-s	#ç”¨ sudo å‘½ä»¤</span><br><span class="line">-U SUDO_USER	#æŒ‡å®š sudo åˆ°å“ªä¸ªç”¨æˆ·ï¼Œé»˜è®¤ä¸º root ç”¨æˆ·</span><br><span class="line">-T TIMEOUT	#æŒ‡å®š ssh é»˜è®¤è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º10sï¼Œä¹Ÿå¯åœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹</span><br><span class="line">-u REMOTE_USER	#è¿œç¨‹ç”¨æˆ·ï¼Œé»˜è®¤ä¸º root ç”¨æˆ·</span><br><span class="line">-v	#æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼ŒåŒæ—¶æ”¯æŒ-vvvï¼Œ-vvvvå¯æŸ¥çœ‹æ›´è¯¦ç»†ä¿¡æ¯</span><br></pre></td></tr></table></figure>

<p>ansible-doc å‘½ä»¤å¸¸ç”¨äºè·å–æ¨¡å—ä¿¡æ¯åŠå…¶ä½¿ç”¨å¸®åŠ©ï¼Œä¸€èˆ¬ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># ansible-doc</span><br><span class="line">Usage: ansible-doc [options] [module...]</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -h, --help            show this help message and exitã€€ã€€# æ˜¾ç¤ºå‘½ä»¤å‚æ•°APIæ–‡æ¡£</span><br><span class="line">  -l, --list            List available modulesã€€ã€€#åˆ—å‡ºå¯ç”¨çš„æ¨¡å—</span><br><span class="line">  -M MODULE_PATH, --module-path=MODULE_PATHã€€ã€€#æŒ‡å®šæ¨¡å—çš„è·¯å¾„</span><br><span class="line">                        specify path(s) to module library (default=None)</span><br><span class="line">  -s, --snippet         Show playbook snippet for specified module(s)ã€€ã€€#æ˜¾ç¤ºplaybookåˆ¶å®šæ¨¡å—çš„ç”¨æ³•</span><br><span class="line">  -v, --verbose         verbose mode (-vvv for more, -vvvv to enableã€€ã€€# æ˜¾ç¤ºansible-docçš„ç‰ˆæœ¬å·æŸ¥çœ‹æ¨¡å—åˆ—è¡¨ï¼š</span><br><span class="line">                        connection debugging)</span><br><span class="line">  --version             show program&#x27;s version number and exit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹shellæ¨¡å—çš„å¸®åŠ©ä¿¡æ¯ï¼š</span><br><span class="line">ansible-doc shell </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹æ¨¡å—çš„ç®€è¦è¯´æ˜ï¼Œä¸»è¦åŒ…æ‹¬ç”¨æ³•å’Œé€‰é¡¹ï¼š</span><br><span class="line">ansible-doc -s shell</span><br><span class="line"></span><br><span class="line">æŸ¥çœ‹ansibleå…±åŠ è½½äº†å¤šå°‘æ¨¡å—ï¼š</span><br><span class="line">ansible-doc -l | wc -l</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>ansible-playbook åŠŸèƒ½ï¼šç”¨äºæ‰§è¡Œé…ç½®å¥½çš„å‰§æœ¬ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook &lt;filename.yml&gt; ... [options]</span><br><span class="line"></span><br><span class="line">-Cï¼Œ--check 	åªæ£€æµ‹å¯èƒ½ä¼šå‘ç”Ÿçš„æ”¹å˜ï¼Œä½†ä¸çœŸæ­£æ‰§è¡Œæ“ä½œ</span><br><span class="line">--list-hosts 	åˆ—å‡ºè¿è¡Œä»»åŠ¡çš„ä¸»æœº</span><br><span class="line">--limit ä¸»æœºåˆ—è¡¨ 	åªé’ˆå¯¹ä¸»æœºåˆ—è¡¨ä¸­çš„ä¸»æœºæ‰§è¡Œ</span><br><span class="line">-v 	æ˜¾ç¤ºè¿‡ç¨‹ -vv -vvv æ›´è¯¦ç»†</span><br><span class="line">--syntax-check 	æ£€æŸ¥è¯­æ³•</span><br><span class="line">-e 	å‘playbookå‘½ä»¤ä¸­ä¼ é€’å˜é‡</span><br><span class="line">-i 	æŒ‡å®šinventoryä¸»æœºæ¸…å•æ–‡ä»¶ï¼Œé»˜è®¤ä¸º/etc/ansible/roles</span><br><span class="line"></span><br><span class="line">#åªæ£€æµ‹</span><br><span class="line">ansible-playbook file.yml --check</span><br><span class="line"></span><br><span class="line">#æ‰§è¡Œå‰§æœ¬</span><br><span class="line">ansible-playbook file.yml</span><br><span class="line"></span><br><span class="line">#æ‰§è¡Œå‰§æœ¬ï¼Œåªé’ˆå¯¹hostsä¸­çš„websrvsç»„</span><br><span class="line">ansible-playbook file.yml --limit websrvss</span><br></pre></td></tr></table></figure>

<p>ansible-galaxy ä¸»è¦åŠŸèƒ½ï¼šç®¡ç†ä» <a target="_blank" rel="noopener" href="https://galaxy.ansible.com/">https://galaxy.ansible.com</a> ä¸‹è½½çš„å„ç§roles</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„galaxy</span><br><span class="line">ansible-galaxy list</span><br><span class="line"># /root/.ansible/roles</span><br><span class="line">- geerlingguy.apache, 3.1.4</span><br><span class="line"># /usr/share/ansible/roles</span><br><span class="line"># /etc/ansible/roles</span><br><span class="line"></span><br><span class="line">å®‰è£…galaxy</span><br><span class="line"> ansible-galaxy install geerlingguy.apache</span><br><span class="line">- downloading role &#x27;apache&#x27;, owned by geerlingguy</span><br><span class="line">- downloading role from https://github.com/geerlingguy/ansible-role-apache/archive/3.1.4.tar.gz</span><br><span class="line">- extracting geerlingguy.apache to /root/.ansible/roles/geerlingguy.apache</span><br><span class="line">- geerlingguy.apache (3.1.4) was installed successfully</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">åˆ é™¤galaxy</span><br><span class="line">ansible-galaxy remove geerlingguy.apache</span><br><span class="line">- successfully removed geerlingguy.apache</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ansible-console 2.0+æ–°å¢ï¼Œå¯äº¤äº’æ‰§è¡Œå‘½ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">ansible-console</span><br><span class="line"></span><br><span class="line">Welcome to the ansible console.</span><br><span class="line">Type help or ? to list commands.</span><br><span class="line"></span><br><span class="line">root@all (2)[f:5]# forks 5     &lt;==è®¾ç½®å¹¶å‘æ•°</span><br><span class="line"></span><br><span class="line">root@all (2)[f:5]# cd NginxWebs   &lt;==åˆ‡æ¢ä¸»æœºç»„</span><br><span class="line"></span><br><span class="line">root@NginxWebs (2)[f:5]# list   &lt;==åˆ—å‡ºä¸»æœºç»„çš„æˆå‘˜</span><br><span class="line">192.168.20.22</span><br><span class="line">192.168.20.23</span><br><span class="line"></span><br><span class="line">root@NginxWebs (2)[f:5]# shell df  &lt;==ç›´æ¥è¾“å…¥æ¨¡å—å’ŒæœåŠ¡åï¼Œä¸éœ€è¦åŠ -må’Œ-a</span><br><span class="line">192.168.20.23 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">Filesystem              1K-blocks    Used Available Use% Mounted on</span><br><span class="line">devtmpfs                   485896       0    485896   0% /dev</span><br><span class="line">tmpfs                      497840       0    497840   0% /dev/shm</span><br><span class="line">tmpfs                      497840    7864    489976   2% /run</span><br><span class="line">tmpfs                      497840       0    497840   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/centos-root  52403200 3284320  49118880   7% /</span><br><span class="line">/dev/sda1                 1038336  139940    898396  14% /boot</span><br><span class="line">/dev/mapper/centos-home 154057220  119636 153937584   1% /data</span><br><span class="line">tmpfs                       99572       0     99572   0% /run/user/0</span><br><span class="line">192.168.20.22 | CHANGED | rc=0 &gt;&gt;</span><br><span class="line">Filesystem              1K-blocks    Used Available Use% Mounted on</span><br><span class="line">devtmpfs                   485896       0    485896   0% /dev</span><br><span class="line">tmpfs                      497840       0    497840   0% /dev/shm</span><br><span class="line">tmpfs                      497840    7924    489916   2% /run</span><br><span class="line">tmpfs                      497840       0    497840   0% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/centos-root  52403200 3338584  49064616   7% /</span><br><span class="line">/dev/sda1                 1038336  139940    898396  14% /boot</span><br><span class="line">/dev/mapper/centos-home 154057220  202628 153854592   1% /data</span><br><span class="line">tmpfs                       99572       0     99572   0% /run/user/0</span><br><span class="line"></span><br><span class="line">root@NginxWebs (2)[f:5]# help    &lt;==åˆ—å‡ºæ‰€æœ‰çš„å†…ç½®å‘½ä»¤</span><br><span class="line"></span><br><span class="line">Documented commands (type help &lt;topic&gt;):</span><br><span class="line">========================================</span><br><span class="line">EOF</span><br><span class="line">a10</span><br><span class="line">a10_server</span><br><span class="line">a10_server_axapi3</span><br><span class="line">a10_service_group</span><br><span class="line">a10_virtual_server</span><br><span class="line">accelerate</span><br><span class="line">aci</span><br><span class="line">......</span><br><span class="line"></span><br></pre></td></tr></table></figure>


</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://magesfc.github.io">mage</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://magesfc.github.io/mage/3988ad506287c3c5ea81a4669e671c026ed1520e/">https://magesfc.github.io/mage/3988ad506287c3c5ea81a4669e671c026ed1520e/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://magesfc.github.io" target="_blank">é©¬å“¥ç§æˆ¿èœ</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ansible/">ansible</a></div><div class="post_share"><div class="social-share" data-image="https://t.mwm.moe/fj/" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> æ‰“èµ</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/null" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/null" alt="æ”¯ä»˜å¯¶"/></a><div class="post-qr-code-desc">æ”¯ä»˜å¯¶</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/mage/c17549d1cd4516fc242a8551d78cc1754d69a33e/"><img class="prev-cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹å¸¸ç”¨çš„æ¨¡å—</div></div></a></div><div class="next-post pull-right"><a href="/mage/531887d5e7eb014078dd6f2951d13500e0551ca5/"><img class="next-cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹playbookä»‹ç»</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/mage/9797fe175c0183a6563e7397692d780ecf683a6f/" title="Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹ansible-resources"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-16</div><div class="title">Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹ansible-resources</div></div></a></div><div><a href="/mage/531887d5e7eb014078dd6f2951d13500e0551ca5/" title="Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹playbookä»‹ç»"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-04</div><div class="title">Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹playbookä»‹ç»</div></div></a></div><div><a href="/mage/c480dbde40d58e354795a1a408fdb8bad06fe7cc/" title="Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹roleä»‹ç»"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-01</div><div class="title">Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹roleä»‹ç»</div></div></a></div><div><a href="/mage/a0bfcc2b49b5167196ecf1ed7f20f9eb180d9a43/" title="Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹synchronizeæ¨¡å—å­¦ä¹ "><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-13</div><div class="title">Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹synchronizeæ¨¡å—å­¦ä¹ </div></div></a></div><div><a href="/mage/c17549d1cd4516fc242a8551d78cc1754d69a33e/" title="Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹å¸¸ç”¨çš„æ¨¡å—"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-04</div><div class="title">Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹å¸¸ç”¨çš„æ¨¡å—</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">mage</div><div class="author-info__description"> è¿™é‡Œæ˜¯ é©¬å“¥ çš„ä¸ªäººåšå®¢ </div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">217</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">233</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">40</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mamh2021"><i class="fab fa-github"></i><span>GitHub</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/mamh2021" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ansible"><span class="toc-number">1.</span> <span class="toc-text">ansible</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-ansible%E6%A6%82%E8%BF%B0%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.</span> <span class="toc-text">1 ansibleæ¦‚è¿°ä»‹ç»</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-ansible%E4%BD%BF%E7%94%A8%E5%AE%89%E8%A3%85"><span class="toc-number">3.</span> <span class="toc-text">2 ansibleä½¿ç”¨å®‰è£…</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ansible%E4%B8%BB%E6%9C%BA%E6%B8%85%E5%8D%95inventory%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.</span> <span class="toc-text">ansibleä¸»æœºæ¸…å•inventoryä»‹ç»</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ansible-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E4%BB%8B%E7%BB%8D"><span class="toc-number">5.</span> <span class="toc-text">ansible å¸¸ç”¨å‘½ä»¤ä»‹ç»</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/mage/ee6e53b9fbe2f10991d150675f0b88ed427b1150/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹repo-diffmanifestsæºç åˆ†æ"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹repo-diffmanifestsæºç åˆ†æ"/></a><div class="content"><a class="title" href="/mage/ee6e53b9fbe2f10991d150675f0b88ed427b1150/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹repo-diffmanifestsæºç åˆ†æ">Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹repo-diffmanifestsæºç åˆ†æ</a><time datetime="2024-05-18T03:58:53.000Z" title="æ›´æ–°äº 2024-05-18 11:58:53">2024-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/a52bd2f9ab320c603de205368472b5caa19b7207/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹repo-syncæºç åˆ†æ"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹repo-syncæºç åˆ†æ"/></a><div class="content"><a class="title" href="/mage/a52bd2f9ab320c603de205368472b5caa19b7207/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹repo-syncæºç åˆ†æ">Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹repo-syncæºç åˆ†æ</a><time datetime="2024-05-18T02:15:08.000Z" title="æ›´æ–°äº 2024-05-18 10:15:08">2024-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/0bd8125569ad5e0222f4ca4e90e626be2ee24c26/" title="Jenkinså­¦ä¹ ä¹‹DataBoundConstructorå’ŒDataBoundSetter"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Jenkinså­¦ä¹ ä¹‹DataBoundConstructorå’ŒDataBoundSetter"/></a><div class="content"><a class="title" href="/mage/0bd8125569ad5e0222f4ca4e90e626be2ee24c26/" title="Jenkinså­¦ä¹ ä¹‹DataBoundConstructorå’ŒDataBoundSetter">Jenkinså­¦ä¹ ä¹‹DataBoundConstructorå’ŒDataBoundSetter</a><time datetime="2024-03-31T06:28:23.000Z" title="æ›´æ–°äº 2024-03-31 14:28:23">2024-03-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/4b00a873b39948044a79c7e53eedd63d7af0bfa6/" title="Dockerå­¦ä¹ ä¹‹å®‰è£…docker-swarmé›†ç¾¤"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Dockerå­¦ä¹ ä¹‹å®‰è£…docker-swarmé›†ç¾¤"/></a><div class="content"><a class="title" href="/mage/4b00a873b39948044a79c7e53eedd63d7af0bfa6/" title="Dockerå­¦ä¹ ä¹‹å®‰è£…docker-swarmé›†ç¾¤">Dockerå­¦ä¹ ä¹‹å®‰è£…docker-swarmé›†ç¾¤</a><time datetime="2024-03-31T06:28:19.000Z" title="æ›´æ–°äº 2024-03-31 14:28:19">2024-03-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/44f033ce59a71a67f64e3c2e330151f82f8754f4/" title="Jenkinså­¦ä¹ ä¹‹masteræœåŠ¡å™¨å®‰è£…ä½¿ç”¨dockerå®‰è£…"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Jenkinså­¦ä¹ ä¹‹masteræœåŠ¡å™¨å®‰è£…ä½¿ç”¨dockerå®‰è£…"/></a><div class="content"><a class="title" href="/mage/44f033ce59a71a67f64e3c2e330151f82f8754f4/" title="Jenkinså­¦ä¹ ä¹‹masteræœåŠ¡å™¨å®‰è£…ä½¿ç”¨dockerå®‰è£…">Jenkinså­¦ä¹ ä¹‹masteræœåŠ¡å™¨å®‰è£…ä½¿ç”¨dockerå®‰è£…</a><time datetime="2024-03-24T03:25:01.000Z" title="æ›´æ–°äº 2024-03-24 11:25:01">2024-03-24</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://t.mwm.moe/fj/')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2024 By mage</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>