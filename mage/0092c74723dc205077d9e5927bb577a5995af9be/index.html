<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Ubuntu学习笔记之ubuntu加入Windows的AD域使用Samba和Winbind的方式 | 马哥私房菜</title><meta name="author" content="mage"><meta name="copyright" content="mage"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ubuntu加入Windows的AD域 Integrate Ubuntu 16.04 to AD as a Domain Member with Samba and Winbind – Part 8 Step 1: Initial Configurations to Join Ubuntu to Samba4 AD1.首先要修改好自己电脑的hostname，可以使用hostnamectl命令或者直">
<meta property="og:type" content="article">
<meta property="og:title" content="Ubuntu学习笔记之ubuntu加入Windows的AD域使用Samba和Winbind的方式">
<meta property="og:url" content="https://magesfc.github.io/mage/0092c74723dc205077d9e5927bb577a5995af9be/">
<meta property="og:site_name" content="马哥私房菜">
<meta property="og:description" content="ubuntu加入Windows的AD域 Integrate Ubuntu 16.04 to AD as a Domain Member with Samba and Winbind – Part 8 Step 1: Initial Configurations to Join Ubuntu to Samba4 AD1.首先要修改好自己电脑的hostname，可以使用hostnamectl命令或者直">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://t.mwm.moe/fj/">
<meta property="article:published_time" content="2022-02-23T09:47:21.000Z">
<meta property="article:modified_time" content="2022-02-23T09:47:21.000Z">
<meta property="article:author" content="mage">
<meta property="article:tag" content="ubuntu">
<meta property="article:tag" content="samba">
<meta property="article:tag" content="windows">
<meta property="article:tag" content="ad">
<meta property="article:tag" content="winbind">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://t.mwm.moe/fj/"><link rel="shortcut icon" href="https://www.zeekrlife.com/favicon.png"><link rel="canonical" href="https://magesfc.github.io/mage/0092c74723dc205077d9e5927bb577a5995af9be/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: mage","link":"链接: ","source":"来源: 马哥私房菜","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Ubuntu学习笔记之ubuntu加入Windows的AD域使用Samba和Winbind的方式',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-02-23 17:47:21'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><style type="text/css">.card-announcement .social-button{margin:.6rem 0 0 0;text-align:center}.card-announcement .social-button a{display:block;background-color:var(--btn-bg);color:var(--btn-color);text-align:center;line-height:2.4;margin:4px 0}.card-announcement .social-button a:hover{background-color:var(--btn-hover-color)}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">223</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">242</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">40</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 精选文档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/21cfbf15/"><span> 🚀 快速开始</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/dc584b87/"><span> 📑 主题页面</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4aa8abbe/"><span> 🛠 主题配置-1</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/ceeb73f/"><span> 🛠 主题配置-2</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/98d20436/"><span> ❓ 主题问答</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4073eda/"><span> ⚡️ 进阶教程</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/198a4240/"><span> ✨ 更新日志</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://butterfly.js.org/link/"><i class="fa-fw fas fa-thumbs-up"></i><span> 其他示例</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://t.mwm.moe/fj/')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">马哥私房菜</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> 目录</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> 精选文档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/21cfbf15/"><span> 🚀 快速开始</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/dc584b87/"><span> 📑 主题页面</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4aa8abbe/"><span> 🛠 主题配置-1</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/ceeb73f/"><span> 🛠 主题配置-2</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/98d20436/"><span> ❓ 主题问答</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4073eda/"><span> ⚡️ 进阶教程</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/198a4240/"><span> ✨ 更新日志</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://butterfly.js.org/link/"><i class="fa-fw fas fa-thumbs-up"></i><span> 其他示例</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Ubuntu学习笔记之ubuntu加入Windows的AD域使用Samba和Winbind的方式</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-02-23T09:47:21.000Z" title="发表于 2022-02-23 17:47:21">2022-02-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-23T09:47:21.000Z" title="更新于 2022-02-23 17:47:21">2022-02-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ubuntu/">ubuntu</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Ubuntu学习笔记之ubuntu加入Windows的AD域使用Samba和Winbind的方式"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>ubuntu加入Windows的AD域</p>
<p>Integrate Ubuntu 16.04 to AD as a Domain Member with Samba and Winbind – Part 8</p>
<h1 id="Step-1-Initial-Configurations-to-Join-Ubuntu-to-Samba4-AD"><a href="#Step-1-Initial-Configurations-to-Join-Ubuntu-to-Samba4-AD" class="headerlink" title="Step 1: Initial Configurations to Join Ubuntu to Samba4 AD"></a>Step 1: Initial Configurations to Join Ubuntu to Samba4 AD</h1><p>1.首先要修改好自己电脑的hostname，可以使用hostnamectl命令或者直接编辑&#x2F;etc&#x2F;hostname 文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># hostnamectl set-hostname your_machine_short_name</span><br><span class="line"></span><br><span class="line">$ cat /etc/hostname  </span><br><span class="line">mamh-PC</span><br><span class="line"></span><br><span class="line">$ hostnamectl                           </span><br><span class="line">   Static hostname: mamh-PC</span><br><span class="line">         Icon name: computer-desktop</span><br><span class="line">           Chassis: desktop</span><br><span class="line">        Machine ID: 4165ee77f3a840b880478065c5624a98</span><br><span class="line">           Boot ID: 0b179497ee0a4ffdb5d5a1a288693fa9</span><br><span class="line">  Operating System: Ubuntu 16.04.6 LTS</span><br><span class="line">            Kernel: Linux 4.18.0-15-generic</span><br><span class="line">      Architecture: x86-64</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2.然后一个重要的步骤是设置好ip。尤其是DNS 。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p>3.最后是重启网络，或者重启电脑。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart networking.service</span><br><span class="line"></span><br><span class="line">ping -c2 your_domain_name</span><br></pre></td></tr></table></figure>
<p>4.最后一个步骤是安装时间同步服务器ntpdate</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install ntpdate</span><br><span class="line">$ sudo ntpdate -q your_domain_name</span><br><span class="line">$ sudo ntpdate your_domain_name</span><br></pre></td></tr></table></figure>

<p>5.安装所需要的软件包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install samba krb5-config krb5-user winbind libpam-winbind libnss-winbind</span><br></pre></td></tr></table></figure>
<p>安装Kerberos软件时候会提示让你输入default realm，这里输入company.com，全部大写。<br>6.测试  Kerberos authentication  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># kinit ad_admin_user</span><br><span class="line"># klist</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Step-2-Join-Ubuntu-to-Samba4-AD-DC"><a href="#Step-2-Join-Ubuntu-to-Samba4-AD-DC" class="headerlink" title="Step 2: Join Ubuntu to Samba4 AD DC"></a>Step 2: Join Ubuntu to Samba4 AD DC</h1><p>7.The first step in integrating the Ubuntu machine into the Samba4 Active Directory domain is to edit Samba configuration file.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># mv /etc/samba/smb.conf /etc/samba/smb.conf.initial</span><br><span class="line"># nano /etc/samba/smb.conf</span><br><span class="line"></span><br><span class="line">[global]</span><br><span class="line">        workgroup = TECMINT</span><br><span class="line">        realm = TECMINT.LAN</span><br><span class="line">        netbios name = ubuntu</span><br><span class="line">        security = ADS</span><br><span class="line">        dns forwarder = 192.168.1.1</span><br><span class="line"></span><br><span class="line">idmap config * : backend = tdb        </span><br><span class="line">idmap config *:range = 50000-1000000</span><br><span class="line">	</span><br><span class="line">   template homedir = /home/%D/%U</span><br><span class="line">   template shell = /bin/bash</span><br><span class="line">   winbind use default domain = true</span><br><span class="line">   winbind offline logon = false</span><br><span class="line">   winbind nss info = rfc2307</span><br><span class="line">   winbind enum users = yes</span><br><span class="line">   winbind enum groups = yes</span><br><span class="line"></span><br><span class="line">  vfs objects = acl_xattr</span><br><span class="line">  map acl inherit = Yes</span><br><span class="line">  store dos attributes = Yes</span><br></pre></td></tr></table></figure>
<p>Replace workgroup, realm, netbios name and dns forwarder variables with your own custom settings.<br>The winbind use default domain parameter causes winbind service to treat any unqualified AD usernames as users of the AD. You should omit this parameter if you have local system accounts names which overlap AD accounts.</p>
<p>8.Now you should restart all samba daemons and stop and remove unnecessary services and enable samba services system-wide by issuing the below commands.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl restart smbd nmbd winbind</span><br><span class="line">$ sudo systemctl stop samba-ad-dc</span><br><span class="line">$ sudo systemctl enable smbd nmbd winbind</span><br></pre></td></tr></table></figure>



<p>9.Join Ubuntu machine to Samba4 AD DC by issuing the following command. Use the name of an AD DC account with administrator privileges in order for the binding to realm to work as expected.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo net ads join -U ad_admin_user</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>10.通过Windows 域控服务器上我们可以看到computer下面已经有mamh-pc这台电脑了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Step-3-Configure-AD-Accounts-Authentication"><a href="#Step-3-Configure-AD-Accounts-Authentication" class="headerlink" title="Step 3: Configure AD Accounts Authentication"></a>Step 3: Configure AD Accounts Authentication</h1><p>11.为了能够使用域账号登录我们的电脑，你需要配置一些东西的<br> 首先配置的是nss服务，也就是The Name Service Switch (NSS)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /etc/nsswitch.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ cat /etc/nsswitch.conf                 </span><br><span class="line"># /etc/nsswitch.conf</span><br><span class="line">#</span><br><span class="line"># Example configuration of GNU Name Service Switch functionality.</span><br><span class="line"># If you have the `glibc-doc-reference&#x27; and `info&#x27; packages installed, try:</span><br><span class="line"># `info libc &quot;Name Service Switch&quot;&#x27; for information about this file.</span><br><span class="line"></span><br><span class="line">passwd:         compat winbind  	#这里需要修改，行尾多加了个　winbind　</span><br><span class="line">group:          compat winbind		#这里需要修改，行尾多加了个　winbind</span><br><span class="line">shadow:         compat winbind		#这里需要修改，行尾多加了个　winbind</span><br><span class="line">gshadow:        files</span><br><span class="line"></span><br><span class="line">hosts:          files mdns4_minimal [NOTFOUND=return] dns</span><br><span class="line">networks:       files</span><br><span class="line"></span><br><span class="line">protocols:      db files</span><br><span class="line">services:       db files</span><br><span class="line">ethers:         db files</span><br><span class="line">rpc:            db files</span><br><span class="line"></span><br><span class="line">netgroup:       nis</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>12.测试是否加入域控成功，能否获取到用户和组</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ wbinfo -u</span><br><span class="line">$ wbinfo -g</span><br></pre></td></tr></table></figure>
<p>wbinfo - Query information from winbind daemon,这个命令是查询winbind中的信息的，<br>如果加入成功，会列出所有用户名和用户组。也就是域控里面的用户名和组。</p>
<p>13.同样的也需要测试　</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo getent passwd| grep your_domain_user</span><br><span class="line">$ sudo getent group|grep &#x27;domain admins&#x27;</span><br></pre></td></tr></table></figure>

<p>14.In order to authenticate on Ubuntu machine with domain accounts you need to run pam-auth-update command with root privileges and add all the entries required for winbind service and to automatically create home directories for each domain account at the first login.<br>配置一下登录时候自动创建home目录。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pam-auth-update</span><br><span class="line"></span><br><span class="line">  |  Pluggable Authentication Modules (PAM) determine how authentication,         │  </span><br><span class="line">  │ authorization, and password changing are handled on the system, as well as    │  </span><br><span class="line">  │ allowing configuration of additional actions to take when starting user       │  </span><br><span class="line">  │ sessions.                                                                     │  </span><br><span class="line">  │                                                                               │  </span><br><span class="line">  │ Some PAM module packages provide profiles that can be used to automatically   │  </span><br><span class="line">  │ adjust the behavior of all PAM-using applications on the system.  Please      │  </span><br><span class="line">  │ indicate which of these behaviors you wish to enable.                         │  </span><br><span class="line">  │                                                                               │  </span><br><span class="line">  │ PAM profiles to enable:                                                       │  </span><br><span class="line">  │                                                                               │  </span><br><span class="line">  │    [*] Unix authentication                                                    │  </span><br><span class="line">  │    [*] Winbind NT/Active Directory authentication                             │  </span><br><span class="line">  │    [*] Register user sessions in the systemd control group hierarchy          │  </span><br><span class="line">  │    [*] Create home directory on login  把这个勾上，这里都勾选，然后按确定     │  </span><br><span class="line">  │    [*] GNOME Keyring Daemon - Login keyring management                        │  </span><br><span class="line">  │                                                                               │  </span><br><span class="line">  │                                                                               │  </span><br><span class="line">  │                     &lt;确定&gt;                       &lt;取消&gt;     </span><br></pre></td></tr></table></figure>


<p>15.在Ubuntu系统上你需要手动修改 &#x2F;etc&#x2F;pam.d&#x2F;common-account 文件，添加如下一行，然后才能实现登录自动创建家目录<br>把use_authtok的那行注释，添加如下一行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session    required    pam_mkhomedir.so    skel=/etc/skel/    umask=0022</span><br></pre></td></tr></table></figure>
<p>16.为了能使用修改域用户密码需要修改 &#x2F;etc&#x2F;pam.d&#x2F;common-password 文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># password	[success=1 default=ignore]	pam_winbind.so use_authtok try_first_pass</span><br><span class="line">password       [success=1 default=ignore]      pam_winbind.so try_first_pass</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>17.使用域账号登录Ubuntu，然后验证ID。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ su - your_ad_user</span><br><span class="line"></span><br><span class="line">#使用我的域账号来登录ubuntu</span><br><span class="line">$ su - mamh.ma</span><br><span class="line">密码： </span><br><span class="line">mamh.ma@mamh-PC:~$ id</span><br><span class="line">uid=50224(mamh.ma) </span><br><span class="line">gid=50004(domain users) </span><br><span class="line">组=50004(domain users),27(sudo),50000(BUILTIN\administrators),50001(BUILTIN\users),50005(denied rodc password replication group),50006(pptp client),50007(vpn-oa),50008(产品中心),50009(admin_scm),50010(vpn-all),50011(vpn-qbyy),50012(软件部),50013(数据中心),50014(domain admins),50015(pptp client长期),50016(server开发部),50017(company)</span><br><span class="line"></span><br><span class="line">mamh.ma@mamh-PC:~$ pwd</span><br><span class="line">/home/mamh.ma</span><br><span class="line"></span><br><span class="line"># 使用另外一个同事账号登录</span><br><span class="line">$ su - mage  </span><br><span class="line">密码： </span><br><span class="line">正在创建文件夹 “/home/mage”。</span><br><span class="line">mage@mamh-PC:~$ id</span><br><span class="line">uid=50225(mage) gid=50004(domain users) 组=50004(domain users),50000(BUILTIN\administrators),50001(BUILTIN\users),50005(denied rodc password replication group),50006(pptp client),50007(vpn-oa),50008(产品中心),50009(admin_scm),50010(vpn-all),50011(vpn-qbyy),50012(软件部),50013(数据中心),50014(domain admins),50015(pptp client长期),50016(server开发部),50017(company)</span><br><span class="line">mage@mamh-PC:~$ </span><br><span class="line">mage@mamh-PC:~$ pwd</span><br><span class="line">/home/mage</span><br><span class="line">mage@mamh-PC:~$ exit</span><br><span class="line">注销</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>18.使域账号有root权限。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo usermod -aG sudo your_domain_user</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>19.使某个与群组有root权限。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">%YOUR_DOMAIN\your_domain\  group       		 ALL=(ALL:ALL) ALL</span><br><span class="line"></span><br><span class="line">%company\\domain\ admins ALL=(ALL:ALL) ALL</span><br><span class="line"></span><br><span class="line">“domain admins&quot;  这个是与群组中的组名，这里使用\反斜线来加到空格前面转义。</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>20.如果你是带图形界面，你需要配置LightDM  &#x2F;usr&#x2F;share&#x2F;lightdm&#x2F;lightdm.conf.d&#x2F;50-ubuntu.conf file, 加入下面2行，然后重启。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">greeter-show-manual-login=true</span><br><span class="line">greeter-hide-users=true</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>It should now be able to perform logins on Ubuntu Desktop with a domain account using either your_domain_username or <a href="mailto:&#x79;&#111;&#117;&#x72;&#x5f;&#100;&#111;&#x6d;&#x61;&#105;&#x6e;&#x5f;&#x75;&#x73;&#x65;&#114;&#x6e;&#x61;&#x6d;&#101;&#64;&#121;&#111;&#x75;&#114;&#x5f;&#x64;&#111;&#x6d;&#97;&#105;&#x6e;&#x2e;&#116;&#x6c;&#x64;">&#x79;&#111;&#117;&#x72;&#x5f;&#100;&#111;&#x6d;&#x61;&#105;&#x6e;&#x5f;&#x75;&#x73;&#x65;&#114;&#x6e;&#x61;&#x6d;&#101;&#64;&#121;&#111;&#x75;&#114;&#x5f;&#x64;&#111;&#x6d;&#97;&#105;&#x6e;&#x2e;&#116;&#x6c;&#x64;</a> or your_domain\your_domain_username format.</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://magesfc.github.io">mage</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://magesfc.github.io/mage/0092c74723dc205077d9e5927bb577a5995af9be/">https://magesfc.github.io/mage/0092c74723dc205077d9e5927bb577a5995af9be/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://magesfc.github.io" target="_blank">马哥私房菜</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ubuntu/">ubuntu</a><a class="post-meta__tags" href="/tags/samba/">samba</a><a class="post-meta__tags" href="/tags/windows/">windows</a><a class="post-meta__tags" href="/tags/ad/">ad</a><a class="post-meta__tags" href="/tags/winbind/">winbind</a></div><div class="post_share"><div class="social-share" data-image="https://t.mwm.moe/fj/" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/null" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/null" alt="支付寶"/></a><div class="post-qr-code-desc">支付寶</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/mage/2b79139b936cd1db08d4688a6b499ddedf7d91a5/"><img class="prev-cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Ubuntu学习笔记之test-disk-IO-performance</div></div></a></div><div class="next-post pull-right"><a href="/mage/15e3768fedf3bdac989bd413a9e837ffd6b8951c/"><img class="next-cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Ubuntu实用技巧之ubuntu20.04安装synergy</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/mage/faa877ef8e26557441db9099437ab98d161e5dbf/" title="Ubuntu学习笔记之ubuntu加入Windows的AD域使用SSSD和Realm的方式"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">Ubuntu学习笔记之ubuntu加入Windows的AD域使用SSSD和Realm的方式</div></div></a></div><div><a href="/mage/366dd9cc15501eafd99f5bb2caf374c4d193767d/" title="Ubuntu学习笔记之ubuntu创建samba共享目录"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">Ubuntu学习笔记之ubuntu创建samba共享目录</div></div></a></div><div><a href="/mage/0f82a538ae2222b1e1f51fa097614ce2767185b6/" title="Ubuntu学习笔记之调试Samba"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">Ubuntu学习笔记之调试Samba</div></div></a></div><div><a href="/mage/34e4d0939638b865838f594d333311f5fce82bca/" title="ELK学习之elasticsearch的安装之Ubuntu上安装elasticsearch"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">ELK学习之elasticsearch的安装之Ubuntu上安装elasticsearch</div></div></a></div><div><a href="/mage/6018e727e97bd487ee0f5b15648a257010d6c4e3/" title="ELK学习之elasticsearch的安装之Ubuntu上安装kibana"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">ELK学习之elasticsearch的安装之Ubuntu上安装kibana</div></div></a></div><div><a href="/mage/d98e027b6b2926e6955f7d6fb21ccb408c1319ac/" title="Ubuntu学习笔记之BackupYourSystem使用tar命令"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">Ubuntu学习笔记之BackupYourSystem使用tar命令</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">mage</div><div class="author-info__description"> 这里是 马哥 的个人博客 </div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">223</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">242</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">40</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mamh2021"><i class="fab fa-github"></i><span>GitHub</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/mamh2021" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Step-1-Initial-Configurations-to-Join-Ubuntu-to-Samba4-AD"><span class="toc-number">1.</span> <span class="toc-text">Step 1: Initial Configurations to Join Ubuntu to Samba4 AD</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Step-2-Join-Ubuntu-to-Samba4-AD-DC"><span class="toc-number">2.</span> <span class="toc-text">Step 2: Join Ubuntu to Samba4 AD DC</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Step-3-Configure-AD-Accounts-Authentication"><span class="toc-number">3.</span> <span class="toc-text">Step 3: Configure AD Accounts Authentication</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/mage/53776646b88e8b3c368d34d9936b880421441770/" title="Linux学习之bash学习之在bash中Quoting的解释"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux学习之bash学习之在bash中Quoting的解释"/></a><div class="content"><a class="title" href="/mage/53776646b88e8b3c368d34d9936b880421441770/" title="Linux学习之bash学习之在bash中Quoting的解释">Linux学习之bash学习之在bash中Quoting的解释</a><time datetime="2024-03-23T10:41:42.000Z" title="更新于 2024-03-23 18:41:42">2024-03-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/0158e8186f0827d0b00df276735e46e876749b88/" title="Linux学习之bash学习之在bash中=和=~的区别"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux学习之bash学习之在bash中=和=~的区别"/></a><div class="content"><a class="title" href="/mage/0158e8186f0827d0b00df276735e46e876749b88/" title="Linux学习之bash学习之在bash中=和=~的区别">Linux学习之bash学习之在bash中=和=~的区别</a><time datetime="2024-03-23T10:00:34.000Z" title="更新于 2024-03-23 18:00:34">2024-03-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/29b1dee9b6336ea01be4716d95ecfbad663018d6/" title="Linux学习之bash学习之几个特殊变量"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux学习之bash学习之几个特殊变量"/></a><div class="content"><a class="title" href="/mage/29b1dee9b6336ea01be4716d95ecfbad663018d6/" title="Linux学习之bash学习之几个特殊变量">Linux学习之bash学习之几个特殊变量</a><time datetime="2024-03-23T09:51:41.000Z" title="更新于 2024-03-23 17:51:41">2024-03-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/8578f837ae5bc22b09842c0f84ac8860bb13a393/" title="Linux学习之常用的github仓库"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux学习之常用的github仓库"/></a><div class="content"><a class="title" href="/mage/8578f837ae5bc22b09842c0f84ac8860bb13a393/" title="Linux学习之常用的github仓库">Linux学习之常用的github仓库</a><time datetime="2024-03-23T09:41:50.000Z" title="更新于 2024-03-23 17:41:50">2024-03-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/d09beb62ca31e9a0cf278d3ff1a8795bc551ec06/" title="Linux学习之文件系统zfs性能优化"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux学习之文件系统zfs性能优化"/></a><div class="content"><a class="title" href="/mage/d09beb62ca31e9a0cf278d3ff1a8795bc551ec06/" title="Linux学习之文件系统zfs性能优化">Linux学习之文件系统zfs性能优化</a><time datetime="2024-03-23T09:40:51.000Z" title="更新于 2024-03-23 17:40:51">2024-03-23</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://t.mwm.moe/fj/')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2024 By mage</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>