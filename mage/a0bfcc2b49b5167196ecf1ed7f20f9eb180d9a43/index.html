<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹synchronizeæ¨¡å—å­¦ä¹  | é©¬å“¥ç§æˆ¿èœ</title><meta name="author" content="mage"><meta name="copyright" content="mage"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹synchronizeæ¨¡å—å­¦ä¹  synchronize is a wrapper around rsync to make common tasks in your playbooks quick and easy. It is run and originates on the local host where Ansible is being run. Of co">
<meta property="og:type" content="article">
<meta property="og:title" content="Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹synchronizeæ¨¡å—å­¦ä¹ ">
<meta property="og:url" content="https://magesfc.github.io/mage/a0bfcc2b49b5167196ecf1ed7f20f9eb180d9a43/">
<meta property="og:site_name" content="é©¬å“¥ç§æˆ¿èœ">
<meta property="og:description" content="Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹synchronizeæ¨¡å—å­¦ä¹  synchronize is a wrapper around rsync to make common tasks in your playbooks quick and easy. It is run and originates on the local host where Ansible is being run. Of co">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg">
<meta property="article:published_time" content="2022-10-13T03:27:35.000Z">
<meta property="article:modified_time" content="2022-10-31T08:37:59.000Z">
<meta property="article:author" content="mage">
<meta property="article:tag" content="ansible">
<meta property="article:tag" content="synchronize">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg"><link rel="shortcut icon" href="http://www.blackshark.com/favicon.ico"><link rel="canonical" href="https://magesfc.github.io/mage/a0bfcc2b49b5167196ecf1ed7f20f9eb180d9a43/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":150,"languages":{"author":"ä½œè€…: mage","link":"é“¾æ¥: ","source":"æ¥æº: é©¬å“¥ç§æˆ¿èœ","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹synchronizeæ¨¡å—å­¦ä¹ ',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-10-31 16:37:59'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><style type="text/css">.card-announcement .social-button{margin:.6rem 0 0 0;text-align:center}.card-announcement .social-button a{display:block;background-color:var(--btn-bg);color:var(--btn-color);text-align:center;line-height:2.4;margin:4px 0}.card-announcement .social-button a:hover{background-color:var(--btn-hover-color)}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">167</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">185</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">34</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> ç›®å½•</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> ç²¾é€‰æ–‡æ¡£</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/21cfbf15/"><span> ğŸš€ å¿«é€Ÿå¼€å§‹</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/dc584b87/"><span> ğŸ“‘ ä¸»é¢˜é¡µé¢</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4aa8abbe/"><span> ğŸ›  ä¸»é¢˜é…ç½®-1</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/ceeb73f/"><span> ğŸ›  ä¸»é¢˜é…ç½®-2</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/98d20436/"><span> â“ ä¸»é¢˜é—®ç­”</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4073eda/"><span> âš¡ï¸ è¿›é˜¶æ•™ç¨‹</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/198a4240/"><span> âœ¨ æ›´æ–°æ—¥å¿—</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://butterfly.js.org/link/"><i class="fa-fw fas fa-thumbs-up"></i><span> å…¶ä»–ç¤ºä¾‹</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">é©¬å“¥ç§æˆ¿èœ</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> ç›®å½•</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> ç²¾é€‰æ–‡æ¡£</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/21cfbf15/"><span> ğŸš€ å¿«é€Ÿå¼€å§‹</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/dc584b87/"><span> ğŸ“‘ ä¸»é¢˜é¡µé¢</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4aa8abbe/"><span> ğŸ›  ä¸»é¢˜é…ç½®-1</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/ceeb73f/"><span> ğŸ›  ä¸»é¢˜é…ç½®-2</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/98d20436/"><span> â“ ä¸»é¢˜é—®ç­”</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4073eda/"><span> âš¡ï¸ è¿›é˜¶æ•™ç¨‹</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/198a4240/"><span> âœ¨ æ›´æ–°æ—¥å¿—</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://butterfly.js.org/link/"><i class="fa-fw fas fa-thumbs-up"></i><span> å…¶ä»–ç¤ºä¾‹</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹synchronizeæ¨¡å—å­¦ä¹ </h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2022-10-13T03:27:35.000Z" title="å‘è¡¨äº 2022-10-13 11:27:35">2022-10-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2022-10-31T08:37:59.000Z" title="æ›´æ–°äº 2022-10-31 16:37:59">2022-10-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/ansible/">ansible</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹synchronizeæ¨¡å—å­¦ä¹ "><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹synchronizeæ¨¡å—å­¦ä¹ </p>
<p>synchronize is a wrapper around rsync to make common tasks in your playbooks quick and easy.</p>
<p>It is run and originates on the local host where Ansible is being run.</p>
<p>Of course, you could just use the command action to call rsync yourself, but you also have to add a fair number of boilerplate options and host facts.</p>
<p>This module is not intended to provide access to the full power of rsync, but does make the most common invocations easier to implement. You still may need to call rsync directly via command or shell depending on your use case.</p>
<p>è¯¥æ¨¡å—æ˜¯ ansible.posix é›†åˆï¼ˆç‰ˆæœ¬ 1.4.0ï¼‰çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ ansible è½¯ä»¶åŒ…ï¼Œæ‚¨å¯èƒ½å·²ç»å®‰è£…äº†è¿™ä¸ªé›†åˆã€‚ å®ƒä¸åŒ…å«åœ¨ ansible-core ä¸­ã€‚ è¦æ£€æŸ¥å®ƒæ˜¯å¦å·²å®‰è£…ï¼Œè¯·è¿è¡Œ ansible-galaxy collection listã€‚</p>
<p>è¦å®‰è£…å®ƒï¼Œè¯·ä½¿ç”¨ï¼šansible-galaxy collection install ansible.posixã€‚</p>
<p>è¦åœ¨ playbook ä¸­ä½¿ç”¨å®ƒï¼Œè¯·æŒ‡å®šï¼šansible.posix.synchronizeã€‚</p>
<h1 id="é—®é¢˜1ï¼š"><a href="#é—®é¢˜1ï¼š" class="headerlink" title="é—®é¢˜1ï¼š"></a>é—®é¢˜1ï¼š</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">---                        #å›ºå®šæ ¼å¼</span><br><span class="line">- hosts: centos            # å°†è¦æ‰§è¡Œä»»åŠ¡çš„ä¸»æœºï¼Œå·²ç»åœ¨hostsæ–‡ä»¶ä¸­å®šä¹‰å¥½äº†ï¼Œå¯æ˜¯å•ä¸ªä¸»æœºæˆ–ä¸»æœºç»„</span><br><span class="line">  become: False            # åœ¨ç›®æ ‡ä¸»æœºä¸Šæ‰§è¡Œä»»åŠ¡æ—¶çš„ç”¨æˆ·èº«ä»½</span><br><span class="line">  gather_facts: False</span><br><span class="line">  vars:</span><br><span class="line">    - ansible_shell_executable: /bin/sh</span><br><span class="line">    - ansible_shell_type: sh</span><br><span class="line">  tasks:</span><br><span class="line">    - name: &quot;start categraf agent&quot;</span><br><span class="line">      shell: ls -alh</span><br><span class="line">    - name: &quot;test ping&quot;</span><br><span class="line">      ping:</span><br><span class="line">    - name: &quot;Synchronize and delete files for categraf&quot;</span><br><span class="line">      ansible.posix.synchronize:</span><br><span class="line">        src: /work/jenkins/workspace/categraf/</span><br><span class="line">        dest: categraf/</span><br><span class="line">        delete: yes</span><br><span class="line">        recursive: yes</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨æ‰§è¡Œ è¿™ä¸ªæ¨¡å—çš„æ—¶å€™ æ€»æ˜¯æŠ¥é”™ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;Could not find the shell plugin required (bash).&quot;</span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æºç åˆ†æï¼Œå‘ç° æ˜¯åœ¨  ansible&#x2F;plugins&#x2F;loader.py æ–‡ä»¶ä¸­çš„ get_shell_plugin æŠ›å‡ºçš„å¼‚å¸¸<br>shell_type&#x3D; sh executable &#x2F;bin&#x2F;bash  # è¿™ä¸ªä¸ä¼šæŠ¥é”™<br>shell_type&#x3D; bash executable &#x2F;bin&#x2F;bash # è¿™ä¸ªä¼šæŠ¥é”™çš„ï¼Œå› ä¸ºä¼šæ ¹æ®è¿™ä¸ª shell type å€¼å»æ‰¾ ansible&#x2F;plugins&#x2F;shell ä¸‹é¢çš„å“ªä¸ª æ–‡ä»¶çš„ã€‚å¦‚æœ è¿™ä¸ªç›®å½•ä¸‹é¢ å¤åˆ¶ä¸ª æ–‡ä»¶ å« bash.py çš„ä¹Ÿå°±ä¸ä¼šæŠ¥é”™äº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">def get_shell_plugin(shell_type=None, executable=None):</span><br><span class="line"></span><br><span class="line">    if not shell_type:</span><br><span class="line">        # default to sh</span><br><span class="line">        shell_type = &#x27;sh&#x27;</span><br><span class="line"></span><br><span class="line">        # mostly for backwards compat</span><br><span class="line">        if executable:</span><br><span class="line">            if isinstance(executable, string_types):</span><br><span class="line">                shell_filename = os.path.basename(executable)</span><br><span class="line">                try:</span><br><span class="line">                    shell = shell_loader.get(shell_filename)</span><br><span class="line">                except Exception:</span><br><span class="line">                    shell = None</span><br><span class="line"></span><br><span class="line">                if shell is None:</span><br><span class="line">                    for shell in shell_loader.all():</span><br><span class="line">                        if shell_filename in shell.COMPATIBLE_SHELLS:</span><br><span class="line">                            shell_type = shell.SHELL_FAMILY</span><br><span class="line">                            break</span><br><span class="line">        else:</span><br><span class="line">            raise AnsibleError(&quot;Either a shell type or a shell executable must be provided &quot;)</span><br><span class="line"></span><br><span class="line">    shell = shell_loader.get(shell_type)</span><br><span class="line">    if not shell:</span><br><span class="line">        raise AnsibleError(&quot;Could not find the shell plugin required (%s).&quot; % shell_type)</span><br><span class="line"></span><br><span class="line">    if executable:</span><br><span class="line">        setattr(shell, &#x27;executable&#x27;, executable)</span><br><span class="line"></span><br><span class="line">    return shell</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="é—®é¢˜åˆ†æ-1"><a href="#é—®é¢˜åˆ†æ-1" class="headerlink" title="é—®é¢˜åˆ†æ 1"></a>é—®é¢˜åˆ†æ 1</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">åœ¨æ‰§è¡Œ taskçš„æ—¶å€™ï¼Œ3ä¸ª task å‘ç° factå’Œ ping task éƒ½æ˜¯ shï¼Œä½†æ˜¯ Synchronize ä¸ºä»€ä¹ˆæ‰§è¡Œäº†2 æ¬¡ï¼Œç¬¬ä¸€æ¬¡æ˜¯ shï¼Œç¬¬äºŒæ¬¡ å°±æ˜¯ bashæ‹‰ï¼Ÿï¼Ÿï¼Ÿï¼Ÿæ­£å¼å› ä¸ºè¿™ç¬¬äºŒæ¬¡ å¯¼è‡´æŠ¥é”™</span><br><span class="line">TASK [Gathering Facts] *********************************************************</span><br><span class="line">sh /bin/sh</span><br><span class="line">ok: [192.168.1.105]</span><br><span class="line"></span><br><span class="line">TASK [Induce an exception to see what happens] *********************************</span><br><span class="line">sh /bin/sh</span><br><span class="line">ok: [192.168.1.105]</span><br><span class="line"></span><br><span class="line">TASK [Synchronize and delete files for categraf] *******************************</span><br><span class="line">sh /bin/sh</span><br><span class="line">bash /bin/bash</span><br></pre></td></tr></table></figure>

<h2 id="é—®é¢˜åˆ†æ-2"><a href="#é—®é¢˜åˆ†æ-2" class="headerlink" title="é—®é¢˜åˆ†æ 2"></a>é—®é¢˜åˆ†æ 2</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">åœ¨  ansible/plugins/loader.py æ–¹æ³•çš„ 846 è¡ŒåŠ ä¸Š æ‰“å° print(self.class_name, str(obj))</span><br><span class="line">ç¬¬ä¸€æ¬¡æ˜¯</span><br><span class="line">class_name ansible.plugins.connectin.ssh.Connection</span><br><span class="line">ç¬¬äºŒæ¬¡æ˜¯</span><br><span class="line">class_name ansible.plugins.connectin.local.Connection</span><br><span class="line"></span><br><span class="line">æ¯ä¸ªtaskéƒ½æ˜¯å…ˆè°ƒç”¨äº† ä¸€ä¸ª Connectionï¼Œ ç„¶åè°ƒç”¨å¯¹åº”çš„ xxxModule</span><br><span class="line"></span><br><span class="line">shell æ¨¡å—çš„ è°ƒç”¨</span><br><span class="line">TASK [start categraf agent] ****************************************************</span><br><span class="line">Connection &lt;class &#x27;ansible.plugins.connection.ssh.Connection&#x27;&gt;</span><br><span class="line">ShellModule &lt;class &#x27;ansible.plugins.shell.sh.ShellModule&#x27;&gt;</span><br><span class="line">shell_type= sh executable /bin/bash</span><br><span class="line"></span><br><span class="line">ActionModule &lt;class &#x27;ansible.plugins.action.shell.ActionModule&#x27;&gt;</span><br><span class="line">ActionModule &lt;class &#x27;ansible.plugins.action.command.ActionModule&#x27;&gt;</span><br><span class="line">changed: [192.168.1.105]</span><br><span class="line"></span><br><span class="line">pingæ¨¡å—çš„ è°ƒç”¨</span><br><span class="line">TASK [test ping] ***************************************************************</span><br><span class="line">Connection &lt;class &#x27;ansible.plugins.connection.ssh.Connection&#x27;&gt;</span><br><span class="line">ShellModule &lt;class &#x27;ansible.plugins.shell.sh.ShellModule&#x27;&gt;</span><br><span class="line">shell_type= sh executable /bin/bash</span><br><span class="line"></span><br><span class="line">ActionModule &lt;class &#x27;ansible.plugins.action.normal.ActionModule&#x27;&gt;</span><br><span class="line">ok: [192.168.1.105]</span><br><span class="line"></span><br><span class="line">1 Connection &lt;class &#x27;ansible.plugins.connection.ssh.Connection&#x27;&gt;</span><br><span class="line">1 ShellModule &lt;class &#x27;ansible.plugins.shell.sh.ShellModule&#x27;&gt;</span><br><span class="line">2 ShellModule &lt;ansible.plugins.shell.sh.ShellModule object at 0x7f39bdb239a0&gt;  è¿™é‡Œæ­£å¥½åè¿‡æ¥äº†ï¼Œç±»ä¼¼ å…¥æ ˆï¼Œå‡ºæ ˆçš„æ•ˆæœ Connection -&gt; ShellModule -&gt; ShellModule -&gt; Connection</span><br><span class="line">2 Connection &lt;ansible.plugins.connection.ssh.Connection object at 0x7f39bdb23a30&gt;</span><br><span class="line"></span><br><span class="line">1 ActionModule &lt;class &#x27;ansible.plugins.action.normal.ActionModule&#x27;&gt;</span><br><span class="line">2 ActionModule &lt;ansible.plugins.action.normal.ActionModule object at 0x7f39bdb233a0&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>ä½†æ˜¯ synchronize è¿™ä¸ªå°±æ¯”è¾ƒç‰¹æ®Šäº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">è¿™ä¸ªä¼šè°ƒç”¨2æ¬¡ Connectionï¼Œ ä¸€æ¬¡sshçš„ï¼Œå¦å¤–ä¸€æ¬¡ å˜æˆ local äº†</span><br><span class="line">TASK [Synchronize and delete files for categraf] *******************************</span><br><span class="line">Connection &lt;class &#x27;ansible.plugins.connection.ssh.Connection&#x27;&gt;  # æœ€åˆè¿™é‡Œ æˆ‘ä»¬å¾—åˆ° self._play_context.shell å’Œ self._play_context.executable åˆ†åˆ«æ˜¯  None /bin/sh</span><br><span class="line">ShellModule &lt;class &#x27;ansible.plugins.shell.sh.ShellModule&#x27;&gt;</span><br><span class="line">shell_type= sh executable /bin/bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ActionModule &lt;class &#x27;ansible_collections.ansible.posix.plugins.action.synchronize.ActionModule&#x27;&gt;  # ç»è¿‡è¿™é‡Œçš„æ—¶å€™ä¹Ÿæ˜¯ self._play_context.shell å’Œ self._play_context.executable åˆ†åˆ«æ˜¯  None /bin/shï¼Œä½†æ˜¯æ¥ç€å¾€ä¸‹çš„æ—¶å€™ åœ¨ synchronize.ActionModule çš„runæ–¹æ³•é‡Œé¢ æŠŠå®ƒæ”¹äº†ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼1</span><br><span class="line"></span><br><span class="line">Connection &lt;class &#x27;ansible.plugins.connection.local.Connection&#x27;&gt;   è¿™ä¸ªè°ƒç”¨æ˜¯ å› ä¸ºåœ¨ synchronize.ActionModule ä¸­çš„run() æ–¹æ³•é‡Œé¢ new_connection = connection_loader.get(&#x27;local&#x27;, self._play_context, new_stdin) ä¸»åŠ¨å»è°ƒç”¨äº†ä¸€ä¸ª è·å–äº†ä¸€ä¸ª æ–°çš„ Connection</span><br><span class="line">shell_type= bash executable /bin/bash</span><br><span class="line"></span><br><span class="line">fatal: [192.168.1.105]: FAILED! =&gt; &#123;&quot;msg&quot;: &quot;Could not find the shell plugin required (bash).&quot;&#125;</span><br><span class="line"></span><br><span class="line">ShellModule &lt;class &#x27;ansible.plugins.shell.sh.ShellModule&#x27;&gt; # å¦‚æœä¸å¤±è´¥ï¼Œåç»­ä¼šæ‰§è¡Œè¿™ä¸ª</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">é€šè¿‡è¿½è¸ª æˆ‘ä»¬ å‘ç°  self._play_context ä¸­æœ‰é—®é¢˜ï¼š</span><br><span class="line"></span><br><span class="line">è¿™ä¸ª self._play_context æ˜¯ ä»  ssh.Connection ä¼ è¿‡æ¥çš„ &lt;ansible.playbook.play_context.PlayContext object at 0x7fdd6f7b40a0&gt;ï¼Œ</span><br><span class="line">ç„¶åä¼ ç»™åˆ°äº† synchronize.ActionModule çš„initæ–¹æ³•é‡Œé¢ã€‚</span><br><span class="line">åœ¨ .synchronize.ActionModule çš„runæ–¹æ³•é‡Œé¢ å®ƒè‡ªå·±æœ‰ä¿®æ”¹äº† å‡ ä¸ª self._play_context,ä¸­çš„å˜é‡çš„å€¼ self._play_context.shell å’Œ self._play_context.executable</span><br><span class="line">ç„¶ååœ¨ è°ƒç”¨ connection_loader.get(&#x27;local&#x27;, self._play_context, new_stdin)  æ—¶å€™ å°±ä¼ å…¥äº† self._play_context</span><br><span class="line"></span><br><span class="line">é€šè¿‡æ‰“å° __init__æ–¹æ³•ä¸­çš„  self._play_context.shell å’Œ self._play_context.executable å€¼åˆ†åˆ«æ˜¯ï¼š None  å’Œ /bin/sh</span><br><span class="line">é€šè¿‡æ‰“å° run æ–¹æ³•æœ€å¼€å§‹çš„æ—¶å€™ self._play_context.shell å’Œ self._play_context.executable å€¼åˆ†åˆ«æ˜¯ï¼š   None /bin/sh</span><br><span class="line">é€šè¿‡æ‰“å° run æ–¹æ³•è°ƒç”¨ connection_loader.get(&#x27;local&#x27;, self._play_context, new_stdin) ä¹‹å‰çš„ æ—¶å€™ å€¼åˆ†åˆ«æ˜¯ï¼š    bash /bin/bash</span><br><span class="line"></span><br><span class="line">å¯ä»¥å‘ç° è¿™é‡Œç¡®å®æ˜¯ åœ¨  synchronize.ActionModule  çš„ run() æ–¹æ³•ä¸­æŠŠè¿™2ä¸ª self._play_context.shell å’Œ self._play_context.executable å€¼é‡æ–°ä¿®æ”¹äº† </span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æ˜¯é»˜è®¤çš„ä»£ç ã€‚å¯ä»¥å‘ç° </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">if not use_delegate and remote_transport:</span><br><span class="line">    # Create a connection to localhost to run rsync on</span><br><span class="line">    new_stdin = self._connection._new_stdin</span><br><span class="line"></span><br><span class="line">    # Unlike port, there can be only one shell</span><br><span class="line">    localhost_shell = None</span><br><span class="line">    for host in C.LOCALHOST:   # è¿™é‡Œæ˜¯ä» &#x27;127.0.0.1&#x27;, &#x27;localhost&#x27;, &#x27;::1&#x27;è¿™ä¸ª3ä¸ªä¸»æœºé…ç½®å‚æ•°ä¸­è·å– C.MAGIC_VARIABLE_MAPPING[&#x27;shell&#x27;]=ansible_shell_type çš„ï¼Œè¿™3ä¸ªä¸»æœºä¸­è‚¯å®šæ˜¯æ²¡å•ç‹¬é…ç½®</span><br><span class="line">        localhost_vars = task_vars[&#x27;hostvars&#x27;].get(host, &#123;&#125;)</span><br><span class="line">        for shell_var in C.MAGIC_VARIABLE_MAPPING[&#x27;shell&#x27;]:</span><br><span class="line">            localhost_shell = localhost_vars.get(shell_var, None)</span><br><span class="line">            if localhost_shell:</span><br><span class="line">                break</span><br><span class="line">        if localhost_shell:</span><br><span class="line">            break</span><br><span class="line">    else:</span><br><span class="line">        localhost_shell = os.path.basename(C.DEFAULT_EXECUTABLE)  # ä¸Šé¢çš„ æ²¡æœ‰ è·å–åˆ° å°±ä» ansible.cfg æ–‡ä»¶ä¸­çš„è¿™ä¸ªexecutable=/bin/bash</span><br><span class="line">    self._play_context.shell = localhost_shell  # æœ€ç»ˆå°±æ˜¯è¿™é‡Œ æ²¡äº‹å¤šå» èµ‹å€¼äº†è¿™ä¸ªå€¼å¯¼è‡´äº† æŠ¥é”™</span><br><span class="line"></span><br><span class="line">    # Unlike port, there can be only one executable</span><br><span class="line">    localhost_executable = None</span><br><span class="line">    for host in C.LOCALHOST:</span><br><span class="line">        localhost_vars = task_vars[&#x27;hostvars&#x27;].get(host, &#123;&#125;)</span><br><span class="line">        for executable_var in C.MAGIC_VARIABLE_MAPPING[&#x27;executable&#x27;]:</span><br><span class="line">            localhost_executable = localhost_vars.get(executable_var, None)</span><br><span class="line">            if localhost_executable:</span><br><span class="line">                break</span><br><span class="line">        if localhost_executable:</span><br><span class="line">            break</span><br><span class="line">    else:</span><br><span class="line">        localhost_executable = C.DEFAULT_EXECUTABLE</span><br><span class="line">    self._play_context.executable = localhost_executable</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ç»è¿‡æˆ‘ä»¬çš„ä¿®å¤ï¼Œæˆ‘ä»¬ä¸ç„¶å®ƒä» DEFAULT_EXECUTABLE è·å–è¿™ä¸ªå€¼ï¼Œä¼˜å…ˆä» å‰§æœ¬çš„yamlæ–‡ä»¶ä¸­è·å–ï¼Œå¦‚æœæ²¡æœ‰å†ç”¨é»˜è®¤çš„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">if not use_delegate and remote_transport:</span><br><span class="line">    # Create a connection to localhost to run rsync on</span><br><span class="line">    new_stdin = self._connection._new_stdin</span><br><span class="line"></span><br><span class="line">    # Unlike port, there can be only one shell</span><br><span class="line">    localhost_shell = None</span><br><span class="line">    for host in C.LOCALHOST:</span><br><span class="line">        localhost_vars = task_vars[&#x27;hostvars&#x27;].get(host, &#123;&#125;)</span><br><span class="line">        for shell_var in C.MAGIC_VARIABLE_MAPPING[&#x27;shell&#x27;]:  # è¿™é‡Œæ˜¯ä» &#x27;127.0.0.1&#x27;, &#x27;localhost&#x27;, &#x27;::1&#x27;è¿™ä¸ª3ä¸ªä¸»æœºé…ç½®å‚æ•°ä¸­è·å– C.MAGIC_VARIABLE_MAPPING[&#x27;shell&#x27;]=ansible_shell_type çš„ï¼Œè¿™3ä¸ªä¸»æœºä¸­è‚¯å®šæ˜¯æ²¡å•ç‹¬é…ç½®è¿™ä¸ªå˜é‡çš„</span><br><span class="line">            localhost_shell = localhost_vars.get(shell_var, None)</span><br><span class="line">            if localhost_shell:</span><br><span class="line">                break</span><br><span class="line">        if localhost_shell:</span><br><span class="line">            break</span><br><span class="line">    else:</span><br><span class="line">        for shell_var in C.MAGIC_VARIABLE_MAPPING[&#x27;shell&#x27;]: # ansible_shell_type</span><br><span class="line">            localhost_shell = task_vars.get(shell_var, None)</span><br><span class="line">            if localhost_shell:</span><br><span class="line">                break</span><br><span class="line">        if not localhost_shell: #ä» task vars é‡Œé¢è·å–ï¼Œè¿™é‡Œæ˜¯ å‰§æœ¬ä¸­ ç‰¹æ„æŒ‡å®šäº†ï¼Œå¦‚æœæ²¡æœ‰å†å»ä½¿ç”¨ é»˜è®¤çš„ ansible.cfg æ–‡ä»¶ä¸­çš„è¿™ä¸ªexecutable</span><br><span class="line">            localhost_shell = os.path.basename(C.DEFAULT_EXECUTABLE) #  ansible.cfg æ–‡ä»¶ä¸­çš„è¿™ä¸ªexecutable=/bin/bash</span><br><span class="line">    self._play_context.shell = localhost_shell</span><br><span class="line"></span><br><span class="line">    # Unlike port, there can be only one executable</span><br><span class="line">    localhost_executable = None</span><br><span class="line">    for host in C.LOCALHOST:</span><br><span class="line">        localhost_vars = task_vars[&#x27;hostvars&#x27;].get(host, &#123;&#125;)</span><br><span class="line">        for executable_var in C.MAGIC_VARIABLE_MAPPING[&#x27;executable&#x27;]: #  # è¿™é‡Œæ˜¯ä» &#x27;127.0.0.1&#x27;, &#x27;localhost&#x27;, &#x27;::1&#x27;è¿™ä¸ª3ä¸ªä¸»æœºé…ç½®å‚æ•°ä¸­è·å– C.MAGIC_VARIABLE_MAPPING[&#x27;executable&#x27;]=ansible_shell_executable çš„ï¼Œè¿™3ä¸ªä¸»æœºä¸­è‚¯å®šæ˜¯æ²¡å•ç‹¬é…ç½®è¿™ä¸ªå˜é‡çš„</span><br><span class="line">            localhost_executable = localhost_vars.get(executable_var, None)</span><br><span class="line">            if localhost_executable:</span><br><span class="line">                break</span><br><span class="line">        if localhost_executable:</span><br><span class="line">            break</span><br><span class="line">    else:</span><br><span class="line">        for executable_var in C.MAGIC_VARIABLE_MAPPING[&#x27;executable&#x27;]: # ansible_shell_executable</span><br><span class="line">            localhost_executable = task_vars.get(executable_var, None)</span><br><span class="line">            if localhost_executable:</span><br><span class="line">                break</span><br><span class="line">        if not localhost_executable:</span><br><span class="line">            localhost_executable = C.DEFAULT_EXECUTABLE  #  ansible.cfg æ–‡ä»¶ä¸­çš„è¿™ä¸ªexecutable=/bin/bash</span><br><span class="line">    self._play_context.executable = localhost_executable</span><br><span class="line">    print(&quot;run2: &quot;, self._play_context.shell , self._play_context.executable)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>pull çš„ä¾‹å­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># /usr/bin/rsync --delay-updates -F --compress --archive --rsh=&#x27;/usr/bin/ssh -S none -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null&#x27; --out-format=&#x27;&lt;&lt;CHANGED&gt;&gt;%i %n%L&#x27; mage@192.168.1.105:/tmp/hsperfdata_mamh/ /tmp/hsperfdata/</span><br><span class="line">    - name: Synchronization of two paths both on the control machine</span><br><span class="line">      ansible.posix.synchronize:</span><br><span class="line">        src: /tmp/hsperfdata_mamh/</span><br><span class="line">        dest: /tmp/hsperfdata/</span><br><span class="line">        mode: pull</span><br><span class="line"></span><br><span class="line">æœ¬åœ°æ‰§è¡Œ playbook å‘½ä»¤çš„æœºå™¨ä¸Šä¼šæœ‰å¦‚ä¸‹è¿›ç¨‹</span><br><span class="line">  â”‚       â”œâ”€python,31664 -u /home/mamh/work/github/ansible-ansible/bin/ansible-playbook -i /home/mamh/work/aais/tools/ansible/inventory.conf /home/mamh/work/aais/tools/ansible/categraf.yaml</span><br><span class="line">  â”‚       â”‚   â”œâ”€python,31671 -u /home/mamh/work/github/ansible-ansible/bin/ansible-playbook -i /home/mamh/work/aais/tools/ansible/inventory.conf /home/mamh/work/aais/tools/ansible/categraf.yaml</span><br><span class="line">  â”‚       â”‚   â”‚   â””â”€bash,31681 -c /home/conda/envs/python3.8/bin/python /tmp/mamh/ansibletmpl/ansible-local-3166456lt3s78/ansible-tmp-1665713880.6339345-31671-178074395576684/AnsiballZ_synchronize.py &amp;&amp; sleep 0</span><br><span class="line">  â”‚       â”‚   â”‚       â””â”€python,31682 /tmp/mamh/ansibletmpl/ansible-local-3166456lt3s78/ansible-tmp-1665713880.6339345-31671-178074395576684/AnsiballZ_synchronize.py</span><br><span class="line">  â”‚       â”‚   â”‚           â””â”€rsync,31683 --delay-updates -F --compress --archive --rsh=/usr/bin/ssh -S none -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null --out-format=&lt;&lt;CHANGED&gt;&gt;%i %n%L mage@192.168.1.105:/tmp/hsperfdata_mamh/ /tmp/hsperfdata/</span><br><span class="line">  â”‚       â”‚   â”‚               â”œâ”€rsync,31691 --delay-updates -F --compress --archive --rsh=/usr/bin/ssh -S none -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null --out-format=&lt;&lt;CHANGED&gt;&gt;%i %n%L mage@192.168.1.105:/tmp/hsperfdata_mamh/ /tmp/hsperfdata/</span><br><span class="line">  â”‚       â”‚   â”‚               â””â”€ssh,31684 -S none -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -l mage 192.168.1.105 rsync --server --sender -logDtprze.LsfxC . /tmp/hsperfdata_mamh/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">å¯¹åº”çš„è¿œç«¯æœåŠ¡å™¨ä¸Šæœ‰å¦‚ä¸‹è¿›ç¨‹ï¼š</span><br><span class="line">  â”‚   â””â”€sshd,154588</span><br><span class="line">  â”‚       â””â”€sshd,154592</span><br><span class="line">  â”‚           â””â”€rsync,154593 --server --sender -logDtprze.LsfxC . /tmp/hsperfdata_mamh/</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>push çš„ä¾‹å­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># /usr/bin/rsync --delay-updates -F --compress --archive --rsh=&#x27;/usr/bin/ssh -S none -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null&#x27; --out-format=&#x27;&lt;&lt;CHANGED&gt;&gt;%i %n%L&#x27; /tmp/hsperfdata_mamh/ mage@192.168.1.105:/tmp/hsperfdata/</span><br><span class="line">    - name: Synchronization of two paths both on the control machine</span><br><span class="line">      ansible.posix.synchronize:</span><br><span class="line">        src: /tmp/hsperfdata_mamh/</span><br><span class="line">        dest: /tmp/hsperfdata/</span><br><span class="line">        mode: push</span><br><span class="line">        </span><br><span class="line">é»˜è®¤æ²¡æœ‰é…ç½® delegate_toçš„ éƒ½æ˜¯åœ¨ å½“å‰ æ‰§è¡Œ playbook å‘½ä»¤çš„æœºå™¨ä¸Šæ‰§è¡Œçš„ã€‚</span><br><span class="line"></span><br><span class="line">è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</span><br><span class="line">æ‰§è¡Œåˆ° lib/ansible_collections/ansible/posix/plugins/action/synchronize.py æ–‡ä»¶ä¸­ run() æ–¹æ³•ï¼Œ</span><br><span class="line">            new_stdin = self._connection._new_stdin</span><br><span class="line">            new_connection = connection_loader.get(&#x27;local&#x27;, self._play_context, new_stdin)</span><br><span class="line">            self._connection = new_connection</span><br><span class="line">é€šè¿‡ä¸Šé¢çš„ ä»£ç  ä»æ–° å¼„ä¸ª localçš„ _connectionï¼Œ è¿™æ ·å°±ä¼šåœ¨æœ¬æœº æ‰§è¡Œäº†ã€‚            </span><br><span class="line">åé¢è°ƒç”¨éƒ½è¿™é‡Œ        </span><br><span class="line">        result.update(self._execute_module(&#x27;ansible.posix.synchronize&#x27;, module_args=_tmp_args, task_vars=task_vars))</span><br><span class="line">è¿›å…¥åˆ° _execute_module æ–¹æ³•ä¸­  lib/ansible/plugins/action/__init__.py ä¸­çš„ _execute_module</span><br><span class="line">æ”¹æ–¹æ³•ä¼šæ‹¼æ¥å‡ºæ¥ä¸€ä¸ª cmd æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¦‚ä¸‹ï¼š</span><br><span class="line">&#x27;/home/conda/envs/python3.8/bin/python /tmp/mamh/ansibletmpl/ansible-local-3029657nhez0k/ansible-tmp-1665712649.202284-30307-156158933036685/AnsiballZ_synchronize.py&#x27;</span><br><span class="line">åé¢ä¼šè°ƒç”¨ï¼š</span><br><span class="line">         res = self._low_level_execute_command(cmd, sudoable=sudoable, in_data=in_data)</span><br><span class="line">ç„¶åç›´æ¥å°± æ‰§è¡Œäº† cmd å‘½ä»¤äº†ã€‚         </span><br><span class="line">æœ¬åœ°æœºå™¨ä¸Šå°±ä¼šæœ‰ä¸ªè¿™æ ·çš„ è¿›ç¨‹ï¼š</span><br><span class="line">  â”‚       â”œâ”€python,31570 -u /home/mamh/work/github/ansible-ansible/bin/ansible-playbook -i /home/mamh/work/aais/tools/ansible/inventory.conf /home/mamh/work/aais/tools/ansible/categraf.yaml</span><br><span class="line">  â”‚       â”‚   â”œâ”€python,31577 -u /home/mamh/work/github/ansible-ansible/bin/ansible-playbook -i /home/mamh/work/aais/tools/ansible/inventory.conf /home/mamh/work/aais/tools/ansible/categraf.yaml</span><br><span class="line">  â”‚       â”‚   â”‚   â””â”€bash,31587 -c /home/conda/envs/python3.8/bin/python /tmp/mamh/ansibletmpl/ansible-local-31570uqrgmtd8/ansible-tmp-1665713765.2156665-31577-964977609392/AnsiballZ_synchronize.py &amp;&amp; sleep 0</span><br><span class="line">  â”‚       â”‚   â”‚       â””â”€python,31588 /tmp/mamh/ansibletmpl/ansible-local-31570uqrgmtd8/ansible-tmp-1665713765.2156665-31577-964977609392/AnsiballZ_synchronize.py</span><br><span class="line">  â”‚       â”‚   â”‚           â””â”€rsync,31589 --delay-updates -F --compress --archive --rsh=/usr/bin/ssh -S none -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null --out-format=&lt;&lt;CHANGED&gt;&gt;%i %n%L /tmp/hsperfdata_mamh/ mage@192.168.1.105:/tmp/hsperfdata/</span><br><span class="line">  â”‚       â”‚   â”‚               â””â”€ssh,31590 -S none -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -l mage 192.168.1.105 rsync --server -logDtprze.iLsfxC --log-format=%i --delay-updates . /tmp/hsperfdata/</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>delegate_to ä¾‹å­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"># /usr/bin/rsync --delay-updates -F --compress --archive --rsh=&#x27;/usr/bin/ssh -S none -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null&#x27; --out-format=&#x27;&lt;&lt;CHANGED&gt;&gt;%i %n%L&#x27; /tmp/hsperfdata_mamh/ mage@192.168.1.105:/tmp/hsperfdata/    </span><br><span class="line">    - name: Synchronization of two paths both on the control machine</span><br><span class="line">      ansible.posix.synchronize:</span><br><span class="line">        src: /tmp/hsperfdata_mamh/</span><br><span class="line">        dest: /tmp/hsperfdata/</span><br><span class="line">      delegate_to: localhost  # </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># /usr/bin/rsync --delay-updates -F --compress --archive --rsh=&#x27;/usr/bin/ssh -S none -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null&#x27; --out-format=&#x27;&lt;&lt;CHANGED&gt;&gt;%i %n%L&#x27; /tmp/hsperfdata_mamh/ mage@192.168.1.105:/tmp/hsperfdata/</span><br><span class="line">    - name: Synchronization of two paths both on the control machine</span><br><span class="line">      ansible.posix.synchronize:</span><br><span class="line">        src: /tmp/hsperfdata_mamh/</span><br><span class="line">        dest: /tmp/hsperfdata/</span><br><span class="line">      delegate_to: 192.168.1.106  # è¿™æ ·æ‰§è¡Œçš„æ—¶å€™å®é™…æ˜¯åœ¨ 12.106 è¿™å°æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„ rsync å‘½ä»¤ï¼Œ è¿™ä¸ªtask æ‰§è¡Œ host æ˜¯ 192.168.1.105ï¼Œé‡‡ç”¨çš„pushæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯ è¿™é‡ŒæŠŠ 12.106 ä¸Šçš„æ–‡ä»¶ pushåˆ° 12.105 ä¸Šäº†ã€‚playbookæ‰§è¡Œçš„æœºå™¨ä¹Ÿä¸æ˜¯è¿™2å°ï¼Œæ˜¯æˆ‘æœ¬åœ°çš„ä¸€å° 61.75è¿™ä¸ªã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">åœ¨12.106 æœåŠ¡å™¨ä¸Šå¦‚ä¸‹è¿›ç¨‹</span><br><span class="line">â”‚   â””â”€sshd,83521</span><br><span class="line">â”‚       â””â”€sshd,83525</span><br><span class="line">â”‚           â””â”€bash,83526 -c /usr/bin/python3 /tmp/mage/ansibletmpr/ansible-tmp-1665645007.8448188-6693-24565751160851/AnsiballZ_synchronize.py &amp;&amp; sleep 0</span><br><span class="line">â”‚               â””â”€python3,83527 /tmp/mage/ansibletmpr/ansible-tmp-1665645007.8448188-6693-24565751160851/AnsiballZ_synchronize.py</span><br><span class="line">â”‚                   â””â”€rsync,83529 --delay-updates -F --compress --archive --rsh=/usr/bin/ssh -S none -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null --out-format=&lt;&lt;CHANGED&gt;&gt;%i %n%L /tmp/hsperfdata_mamh/ mage@192.168.1.105:/tmp/hsperfdata/</span><br><span class="line">â”‚                       â””â”€ssh,83530 -S none -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -l mage 192.168.1.105 rsync --server -logDtprze.iLsfxCIvu --log-format=%i --delay-updates . /tmp/hsperfdata/</span><br><span class="line"></span><br><span class="line">åœ¨ 12.105 æœåŠ¡å™¨ä¸Šå¦‚ä¸‹è¿›ç¨‹ï¼Œè¿™ä¸ªæ˜¯ rsync åŒæ­¥çš„ç›®æ ‡æœºå™¨</span><br><span class="line">  â”‚   â””â”€sshd,147613</span><br><span class="line">  â”‚       â””â”€sshd,147617</span><br><span class="line">  â”‚           â””â”€rsync,147618 --server -logDtprze.iLsfxCIvu --log-format=%i --delay-updates . /tmp/hsperfdata/</span><br><span class="line">  â”‚               â””â”€rsync,147619 --server -logDtprze.iLsfxCIvu --log-format=%i --delay-updates . /tmp/hsperfdata/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æ‰§è¡Œ playbook å‘½ä»¤æœºå™¨ä¸Š å¦‚ä¸‹è¿›ç¨‹ï¼š</span><br><span class="line">â”‚       â”œâ”€python,6667 -u /home/mamh/work/github/ansible-ansible/bin/ansible-playbook -i /home/mamh/work/aais/tools/ansible/inventory.conf /home/mamh/work/aais/tools/ansible/categraf.yaml -v</span><br><span class="line">â”‚       â”‚   â”œâ”€python,6693 -u /home/mamh/work/github/ansible-ansible/bin/ansible-playbook -i /home/mamh/work/aais/tools/ansible/inventory.conf /home/mamh/work/aais/tools/ansible/categraf.yaml -v</span><br><span class="line">â”‚       â”‚   â”‚   â””â”€ssh,6700 -o KbdInteractiveAuthentication=no -o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey -o PasswordAuthentication=no -o User=&quot;mage&quot; -o ConnectTimeout=10 -tt 192.168.1.106 /bin/bash -c &#x27;/usr/bin/python3 /tmp/mage/ansibletmpr/ansible-tmp-1665645007.8448188-6693-24565751160851/AnsiballZ_synchronize.py &amp;&amp; sleep 0&#x27;</span><br><span class="line">â”‚       â”‚   â””â”€&#123;python&#125;,6673</span><br><span class="line"></span><br><span class="line">playbook å‘½ä»¤æœºå™¨ä¸Š æ‰§è¡Œï¼Œç„¶åä¼šåœ¨ 12.106 ä¸Šå¤åˆ¶ä¸€ä¸ª AnsiballZ_synchronize.py æ–‡ä»¶</span><br><span class="line">é€šè¿‡è¿™ä¸ªæ–‡ä»¶ è°ƒç”¨äº† rsync å‘½ä»¤ã€‚</span><br><span class="line">åœ¨  ansible/plugins/action/__init__.py ä¸­çš„ _execute_module æ–¹æ³•ä¸­æœ‰ä¸ª å¤åˆ¶ è¿™ä¸ª  AnsiballZ_synchronize.py æ–‡ä»¶ æ–‡ä»¶çš„æ–¹æ³•è°ƒç”¨ï¼Œè¿™ä¸ªå–è‡ªpingæ¨¡å—è°ƒè¯•æ—¶å€™çœ‹åˆ°çš„ï¼Œä¼°è®¡å…¶ä»–æ¨¡å—ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚</span><br><span class="line">if module_style == &#x27;binary&#x27;:</span><br><span class="line">self._transfer_file(module_path, remote_module_path)</span><br><span class="line">else:</span><br><span class="line">self._transfer_data(remote_module_path, module_data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># /usr/bin/rsync --delay-updates -F --compress --archive --out-format=&#x27;&lt;&lt;CHANGED&gt;&gt;%i %n%L&#x27; /tmp/105_src/ /tmp/105_dst/</span><br><span class="line">    - name: Synchronization of two paths both on the control machine</span><br><span class="line">      ansible.posix.synchronize:</span><br><span class="line">        src: /tmp/105_src/</span><br><span class="line">        dest: /tmp/105_dst/</span><br><span class="line">      delegate_to: 192.168.1.105  è¿™é‡ŒæŠŠ delegate_toçš„ipæ”¹æˆ192.168.1.15ï¼Œ è¿™æ ·æ‰§è¡Œ rsync å‘½ä»¤çš„æœåŠ¡å™¨æ˜¯ 12.105ï¼Œ éœ€è¦ pushåˆ°çš„ç›®æ ‡ æœåŠ¡å™¨ä¹Ÿæ˜¯ 12.105. è¿™å°±ç›¸å½“äºï¼Œåœ¨12.105 æœåŠ¡å™¨ æœ¬åœ° è‡ªå·± æ‰§è¡Œ rsyncï¼Œä¹Ÿå°±æ˜¯ä»æœ¬åœ°ä¸€ä¸ªç›®å½•å¤åˆ¶åˆ°æœ¬åœ°å¦å¤–ä¸€ä¸ªç›®å½•ã€‚</span><br><span class="line">åœ¨ 12.105 ä¸Š ä¼šæœ‰å¦‚ä¸‹è¿›ç¨‹ï¼š</span><br><span class="line">  â”‚   â””â”€sshd,148680</span><br><span class="line">  â”‚       â””â”€sshd,148684</span><br><span class="line">  â”‚           â””â”€bash,148685 -c /usr/bin/python3 /tmp/mage/ansibletmpr/ansible-tmp-1665645894.8538651-7370-177548815339364/AnsiballZ_synchronize.py &amp;&amp; sleep 0</span><br><span class="line">  â”‚               â””â”€python3,148686 /tmp/mage/ansibletmpr/ansible-tmp-1665645894.8538651-7370-177548815339364/AnsiballZ_synchronize.py</span><br><span class="line">  â”‚                   â””â”€rsync,148688 --delay-updates -F --compress --archive --out-format=&lt;&lt;CHANGED&gt;&gt;%i %n%L /tmp/105_src/ /tmp/105_dst/</span><br><span class="line">  â”‚                       â””â”€rsync,148689 --delay-updates -F --compress --archive --out-format=&lt;&lt;CHANGED&gt;&gt;%i %n%L /tmp/105_src/ /tmp/105_dst/</span><br><span class="line">  â”‚                           â””â”€rsync,148690 --delay-updates -F --compress --archive --out-format=&lt;&lt;CHANGED&gt;&gt;%i %n%L /tmp/105_src/ /tmp/105_dst/</span><br><span class="line"></span><br><span class="line">```      </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># å…¶ä»–</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>&#x2F;home&#x2F;mamh&#x2F;work&#x2F;github&#x2F;ansible-ansible&#x2F;lib&#x2F;ansible&#x2F;executor&#x2F;task_queue_manager.py<br>321è¡Œ<br>            play_return &#x3D; strategy.run(iterator, play_context)  # å…¥å£æ‰§è¡Œ taskçš„åœ°æ–¹</p>
<p>&#x2F;home&#x2F;mamh&#x2F;work&#x2F;github&#x2F;ansible-ansible&#x2F;lib&#x2F;ansible&#x2F;plugins&#x2F;strategy&#x2F;linear.py</p>
<p>315è¡Œ<br>                        self._queue_task(host, task, task_vars, play_context)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>â”œâ”€ansible-playboo,257412 &#x2F;home&#x2F;conda&#x2F;envs&#x2F;ansible&#x2F;bin&#x2F;ansible-playbook -i &#x2F;work&#x2F;jenkins&#x2F;workspace&#x2F;mage-auto-devops&#x2F;aais&#x2F;tools&#x2F;ansible&#x2F;inventory.conf -vvv &#x2F;work&#x2F;jenkins&#x2F;workspace&#x2F;mage-auto-devops&#x2F;aais&#x2F;tools&#x2F;ansible&#x2F;categraf.yaml<br>â”‚   â””â”€sh,257426 -c &#x2F;bin&#x2F;sh -c â€˜&#x2F;home&#x2F;conda&#x2F;envs&#x2F;ansible&#x2F;bin&#x2F;python &#x2F;tmp&#x2F;jenkins&#x2F;ansibletmpl&#x2F;ansible-local-257296rnz0q177&#x2F;ansible-tmp-1665562937.9518697-257412-178133226040161&#x2F;AnsiballZ_synchronize.py &amp;&amp; sleep 0â€™<br>â”‚       â””â”€sh,257427 -c &#x2F;home&#x2F;conda&#x2F;envs&#x2F;ansible&#x2F;bin&#x2F;python &#x2F;tmp&#x2F;jenkins&#x2F;ansibletmpl&#x2F;ansible-local-257296rnz0q177&#x2F;ansible-tmp-1665562937.9518697-257412-178133226040161&#x2F;AnsiballZ_synchronize.py &amp;&amp; sleep 0<br>â”‚           â””â”€python,257428 &#x2F;tmp&#x2F;jenkins&#x2F;ansibletmpl&#x2F;ansible-local-257296rnz0q177&#x2F;ansible-tmp-1665562937.9518697-257412-178133226040161&#x2F;AnsiballZ_synchronize.py<br>â”‚               â””â”€rsync,257429 â€“delay-updates -F â€“compress â€“delete-after â€“archive â€“rsh&#x3D;&#x2F;usr&#x2F;bin&#x2F;ssh -S none -o StrictHostKeyChecking&#x3D;no -o UserKnownHostsFile&#x3D;&#x2F;dev&#x2F;null â€“out-format&#x3D;&lt;<CHANGED>&gt;%i %n%L &#x2F;work&#x2F;jenkins&#x2F;workspace&#x2F;categraf&#x2F; <a href="mailto:&#109;&#x61;&#x67;&#101;&#x40;&#49;&#57;&#x32;&#x2e;&#x31;&#54;&#56;&#46;&#x31;&#x2e;&#x31;&#54;&#48;">&#109;&#x61;&#x67;&#101;&#x40;&#49;&#57;&#x32;&#x2e;&#x31;&#54;&#56;&#46;&#x31;&#x2e;&#x31;&#54;&#48;</a>:categraf&#x2F;<br>â”‚                   â””â”€ssh,257430 -S none -o StrictHostKeyChecking&#x3D;no -o UserKnownHostsFile&#x3D;&#x2F;dev&#x2F;null -l mage 192.168.1.160 rsync â€“server -logDtprze.iLsfxC â€“log-format&#x3D;%i â€“delete-after â€“delay-updates . categraf&#x2F;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>task_vars[â€˜ansible_shell_executableâ€™]<br>task_vars[â€˜ansible_shell_typeâ€™]<br>task_vars[â€˜inventory_hostnameâ€™]  â€˜192.168.1.105â€™</p>
<p>ä¼šå¾ªç¯è¿™3ä¸ªï¼Œç„¶åè·å–å¯¹åº”çš„ hostvars å€¼<br>LOCALHOST &#x3D; (â€˜127.0.0.1â€™, â€˜localhostâ€™, â€˜::1â€™)</p>
<p>task_vars[â€˜hostvarsâ€™]</p>
<p>loader.py<br>817 è¡Œ<br>        plugin_load_context &#x3D; self.find_plugin_with_context(name, collection_list&#x3D;collection_list)  # collection_list&#x3D;Noneï¼Œ name&#x3D;bash<br>        if not plugin_load_context.resolved or not plugin_load_context.plugin_resolved_path:</p>
<p>å½“æ˜¯ bashçš„æ—¶å€™ plugin_load_context.plugin_resolved_path è¿™ä¸ªæ˜¯ Noneï¼Œå¯¼è‡´è¿™ä¸ªif è¿›å»äº†ã€‚<br>å¦‚æœæ˜¯ sh  çš„æ—¶å€™è¿™ä¸ªå°±æ˜¯ â€˜&#x2F;home&#x2F;mamh&#x2F;work&#x2F;github&#x2F;ansible-ansible&#x2F;lib&#x2F;ansible&#x2F;plugins&#x2F;shell&#x2F;sh.pyâ€™<br>å¦‚æœæ˜¯ cmd çš„æ—¶å€™è¿™ä¸ªå°±æ˜¯ â€˜&#x2F;home&#x2F;mamh&#x2F;work&#x2F;github&#x2F;ansible-ansible&#x2F;lib&#x2F;ansible&#x2F;plugins&#x2F;shell&#x2F;cmd.pyâ€™  å¯ä»¥å‘ç° è¿™ä¸ªå˜é‡ å†³å®š ç”¨ ansible&#x2F;plugins&#x2F;shell ä¸‹é¢çš„å“ªä¸ª æ–‡ä»¶äº†ã€‚</p>
<p>åé¢å°±çœ‹è¿™ä¸ªé‡Œé¢ æ€ä¹ˆæŸ¥æ‰¾è¿™ä¸ª æ’ä»¶çš„ï¼Ÿï¼Ÿï¼Ÿ<br>        plugin_load_context &#x3D; self.find_plugin_with_context(name, collection_list&#x3D;collection_list)  # collection_list&#x3D;Noneï¼Œ name&#x3D;bash</p>
<pre><code>
</code></pre>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://magesfc.github.io">mage</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://magesfc.github.io/mage/a0bfcc2b49b5167196ecf1ed7f20f9eb180d9a43/">https://magesfc.github.io/mage/a0bfcc2b49b5167196ecf1ed7f20f9eb180d9a43/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://magesfc.github.io" target="_blank">é©¬å“¥ç§æˆ¿èœ</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ansible/">ansible</a><a class="post-meta__tags" href="/tags/synchronize/">synchronize</a></div><div class="post_share"><div class="social-share" data-image="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> æ‰“èµ</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/null" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/null" alt="æ”¯ä»˜å¯¶"/></a><div class="post-qr-code-desc">æ”¯ä»˜å¯¶</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/mage/9797fe175c0183a6563e7397692d780ecf683a6f/"><img class="prev-cover" src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹ansible-resources</div></div></a></div><div class="next-post pull-right"><a href="/mage/11746f2e578549a6bef3af02d587fa65f8a9b7ab/"><img class="next-cover" src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Nightingaleå­¦ä¹ ä¹‹å®‰è£…éƒ¨ç½²</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/mage/9797fe175c0183a6563e7397692d780ecf683a6f/" title="Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹ansible-resources"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-16</div><div class="title">Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹ansible-resources</div></div></a></div><div><a href="/mage/531887d5e7eb014078dd6f2951d13500e0551ca5/" title="Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹playbookä»‹ç»"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-04</div><div class="title">Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹playbookä»‹ç»</div></div></a></div><div><a href="/mage/c480dbde40d58e354795a1a408fdb8bad06fe7cc/" title="Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹roleä»‹ç»"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-01</div><div class="title">Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹roleä»‹ç»</div></div></a></div><div><a href="/mage/3988ad506287c3c5ea81a4669e671c026ed1520e/" title="Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹æ€»ä½“ä»‹ç»æ€»ç»“"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-04</div><div class="title">Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹æ€»ä½“ä»‹ç»æ€»ç»“</div></div></a></div><div><a href="/mage/c17549d1cd4516fc242a8551d78cc1754d69a33e/" title="Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹å¸¸ç”¨çš„æ¨¡å—"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-04</div><div class="title">Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹å¸¸ç”¨çš„æ¨¡å—</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">mage</div><div class="author-info__description"> è¿™é‡Œæ˜¯ é©¬å“¥ çš„ä¸ªäººåšå®¢ </div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">167</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">185</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">34</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mamh2021"><i class="fab fa-github"></i><span>GitHub</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/mamh2021" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%97%AE%E9%A2%981%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">é—®é¢˜1ï¼š</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90-1"><span class="toc-number">1.1.</span> <span class="toc-text">é—®é¢˜åˆ†æ 1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90-2"><span class="toc-number">1.2.</span> <span class="toc-text">é—®é¢˜åˆ†æ 2</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/mage/c480dbde40d58e354795a1a408fdb8bad06fe7cc/" title="Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹roleä»‹ç»"><img src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹roleä»‹ç»"/></a><div class="content"><a class="title" href="/mage/c480dbde40d58e354795a1a408fdb8bad06fe7cc/" title="Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹roleä»‹ç»">Ansibleè‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ä¹‹roleä»‹ç»</a><time datetime="2022-12-01T12:18:31.000Z" title="æ›´æ–°äº 2022-12-01 20:18:31">2022-12-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/6118b9bf91824574204e116d5b138ffbaab72268/" title="Golangå­¦ä¹ ä¹‹structè½¬json"><img src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Golangå­¦ä¹ ä¹‹structè½¬json"/></a><div class="content"><a class="title" href="/mage/6118b9bf91824574204e116d5b138ffbaab72268/" title="Golangå­¦ä¹ ä¹‹structè½¬json">Golangå­¦ä¹ ä¹‹structè½¬json</a><time datetime="2022-11-14T06:06:32.000Z" title="æ›´æ–°äº 2022-11-14 14:06:32">2022-11-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/9e24b8712fd7596796aa8992d2b6496d0660585a/" title="jenkinså­¦ä¹ ä¹‹è®°masterçš„ä¸€æ¬¡æŠ¥é”™"><img src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="jenkinså­¦ä¹ ä¹‹è®°masterçš„ä¸€æ¬¡æŠ¥é”™"/></a><div class="content"><a class="title" href="/mage/9e24b8712fd7596796aa8992d2b6496d0660585a/" title="jenkinså­¦ä¹ ä¹‹è®°masterçš„ä¸€æ¬¡æŠ¥é”™">jenkinså­¦ä¹ ä¹‹è®°masterçš„ä¸€æ¬¡æŠ¥é”™</a><time datetime="2022-11-11T05:29:56.000Z" title="æ›´æ–°äº 2022-11-11 13:29:56">2022-11-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/3b62171753fddbbf78c36e3f6d7c9ba008365560/" title="Golangå­¦ä¹ ä¹‹mtail"><img src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Golangå­¦ä¹ ä¹‹mtail"/></a><div class="content"><a class="title" href="/mage/3b62171753fddbbf78c36e3f6d7c9ba008365560/" title="Golangå­¦ä¹ ä¹‹mtail">Golangå­¦ä¹ ä¹‹mtail</a><time datetime="2022-11-11T02:54:18.000Z" title="æ›´æ–°äº 2022-11-11 10:54:18">2022-11-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/f7b2ae126d593c93046cbf03febb201f10fef861/" title="Golangå­¦ä¹ ä¹‹ç±»å‹è½¬æ¢"><img src= "/img/loading.gif" data-lazy-src="https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Golangå­¦ä¹ ä¹‹ç±»å‹è½¬æ¢"/></a><div class="content"><a class="title" href="/mage/f7b2ae126d593c93046cbf03febb201f10fef861/" title="Golangå­¦ä¹ ä¹‹ç±»å‹è½¬æ¢">Golangå­¦ä¹ ä¹‹ç±»å‹è½¬æ¢</a><time datetime="2022-11-08T13:52:36.000Z" title="æ›´æ–°äº 2022-11-08 21:52:36">2022-11-08</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://office-1256119282.file.myqcloud.com/2022/official-web/cdn/20220301/pc_bg_05.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2022 By mage</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>