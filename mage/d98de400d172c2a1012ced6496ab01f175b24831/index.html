<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Linuxå­¦ä¹ ä¹‹æ–‡ä»¶ç³»ç»Ÿzfsæ–‡ä»¶ç³»ç»Ÿ | é©¬å“¥ç§æˆ¿èœ</title><meta name="author" content="mage"><meta name="copyright" content="mage"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="ZFSï¼ˆZettabyte File Systemï¼‰ä¸€ä¸ªæ‰“ç ´è¿‡å»æ€ç»´çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ˜¯ Sun Microsystemsè¿™å®¶å…¬å¸æ‰€å¼€å‘å‡ºæ¥çš„å…¨æ–°å‹æ€æ–‡ä»¶ç³»ç»Ÿï¼Œå› ä¸ºLicenseçš„é—®é¢˜æ‰€ä»¥ç›®å‰åªæœ‰åœ¨Solarisã€Macã€BSDä¸Šçœ‹å¾—åˆ°ï¼ŒZFSæ˜¯128bitçš„æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œå®ƒåˆ°åº•æœ‰å¤šå¼ºå‘¢ï¼Ÿåˆ«å†ç­‰å¾…äº†é©¬ä¸Šç”¨äº†ä½ å°±çŸ¥é“ï¼Œåªèƒ½è¯´ZFSçœŸæ˜¯ä¸€ä¸ªä¸Šå¸èµç»™ITäººå‘˜çš„å¥½ç¤¼ç‰©ã€‚  ä¸ºä»€ä¹ˆé€‰æ‹© ZFS ZFS éå¸¸çš„ä¼˜ç§€">
<meta property="og:type" content="article">
<meta property="og:title" content="Linuxå­¦ä¹ ä¹‹æ–‡ä»¶ç³»ç»Ÿzfsæ–‡ä»¶ç³»ç»Ÿ">
<meta property="og:url" content="https://magesfc.github.io/mage/d98de400d172c2a1012ced6496ab01f175b24831/">
<meta property="og:site_name" content="é©¬å“¥ç§æˆ¿èœ">
<meta property="og:description" content="ZFSï¼ˆZettabyte File Systemï¼‰ä¸€ä¸ªæ‰“ç ´è¿‡å»æ€ç»´çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ˜¯ Sun Microsystemsè¿™å®¶å…¬å¸æ‰€å¼€å‘å‡ºæ¥çš„å…¨æ–°å‹æ€æ–‡ä»¶ç³»ç»Ÿï¼Œå› ä¸ºLicenseçš„é—®é¢˜æ‰€ä»¥ç›®å‰åªæœ‰åœ¨Solarisã€Macã€BSDä¸Šçœ‹å¾—åˆ°ï¼ŒZFSæ˜¯128bitçš„æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œå®ƒåˆ°åº•æœ‰å¤šå¼ºå‘¢ï¼Ÿåˆ«å†ç­‰å¾…äº†é©¬ä¸Šç”¨äº†ä½ å°±çŸ¥é“ï¼Œåªèƒ½è¯´ZFSçœŸæ˜¯ä¸€ä¸ªä¸Šå¸èµç»™ITäººå‘˜çš„å¥½ç¤¼ç‰©ã€‚  ä¸ºä»€ä¹ˆé€‰æ‹© ZFS ZFS éå¸¸çš„ä¼˜ç§€">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://t.mwm.moe/fj/">
<meta property="article:published_time" content="2022-02-23T09:47:21.000Z">
<meta property="article:modified_time" content="2022-02-23T09:47:21.000Z">
<meta property="article:author" content="mage">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="zfs">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://t.mwm.moe/fj/"><link rel="shortcut icon" href="https://www.zeekrlife.com/favicon.png"><link rel="canonical" href="https://magesfc.github.io/mage/d98de400d172c2a1012ced6496ab01f175b24831/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":400},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: {"limitCount":150,"languages":{"author":"ä½œè€…: mage","link":"é“¾æ¥: ","source":"æ¥æº: é©¬å“¥ç§æˆ¿èœ","info":"è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Linuxå­¦ä¹ ä¹‹æ–‡ä»¶ç³»ç»Ÿzfsæ–‡ä»¶ç³»ç»Ÿ',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-02-23 17:47:21'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><style type="text/css">.card-announcement .social-button{margin:.6rem 0 0 0;text-align:center}.card-announcement .social-button a{display:block;background-color:var(--btn-bg);color:var(--btn-color);text-align:center;line-height:2.4;margin:4px 0}.card-announcement .social-button a:hover{background-color:var(--btn-hover-color)}</style><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">217</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">233</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">40</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> ç›®å½•</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> ç²¾é€‰æ–‡æ¡£</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/21cfbf15/"><span> ğŸš€ å¿«é€Ÿå¼€å§‹</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/dc584b87/"><span> ğŸ“‘ ä¸»é¢˜é¡µé¢</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4aa8abbe/"><span> ğŸ›  ä¸»é¢˜é…ç½®-1</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/ceeb73f/"><span> ğŸ›  ä¸»é¢˜é…ç½®-2</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/98d20436/"><span> â“ ä¸»é¢˜é—®ç­”</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4073eda/"><span> âš¡ï¸ è¿›é˜¶æ•™ç¨‹</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/198a4240/"><span> âœ¨ æ›´æ–°æ—¥å¿—</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://butterfly.js.org/link/"><i class="fa-fw fas fa-thumbs-up"></i><span> å…¶ä»–ç¤ºä¾‹</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://t.mwm.moe/fj/')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">é©¬å“¥ç§æˆ¿èœ</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> ç›®å½•</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-book"></i><span> ç²¾é€‰æ–‡æ¡£</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/21cfbf15/"><span> ğŸš€ å¿«é€Ÿå¼€å§‹</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/dc584b87/"><span> ğŸ“‘ ä¸»é¢˜é¡µé¢</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4aa8abbe/"><span> ğŸ›  ä¸»é¢˜é…ç½®-1</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/ceeb73f/"><span> ğŸ›  ä¸»é¢˜é…ç½®-2</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/98d20436/"><span> â“ ä¸»é¢˜é—®ç­”</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/4073eda/"><span> âš¡ï¸ è¿›é˜¶æ•™ç¨‹</span></a></li><li><a class="site-page child" target="_blank" rel="noopener" href="https://butterfly.js.org/posts/198a4240/"><span> âœ¨ æ›´æ–°æ—¥å¿—</span></a></li></ul></div><div class="menus_item"><a class="site-page" target="_blank" rel="noopener" href="https://butterfly.js.org/link/"><i class="fa-fw fas fa-thumbs-up"></i><span> å…¶ä»–ç¤ºä¾‹</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Linuxå­¦ä¹ ä¹‹æ–‡ä»¶ç³»ç»Ÿzfsæ–‡ä»¶ç³»ç»Ÿ</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2022-02-23T09:47:21.000Z" title="å‘è¡¨äº 2022-02-23 17:47:21">2022-02-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2022-02-23T09:47:21.000Z" title="æ›´æ–°äº 2022-02-23 17:47:21">2022-02-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/linux/">linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Linuxå­¦ä¹ ä¹‹æ–‡ä»¶ç³»ç»Ÿzfsæ–‡ä»¶ç³»ç»Ÿ"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p> ZFSï¼ˆZettabyte File Systemï¼‰ä¸€ä¸ªæ‰“ç ´è¿‡å»æ€ç»´çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ˜¯ Sun Microsystemsè¿™å®¶å…¬å¸æ‰€å¼€å‘å‡ºæ¥çš„å…¨æ–°å‹æ€æ–‡ä»¶ç³»ç»Ÿï¼Œå› ä¸ºLicenseçš„é—®é¢˜æ‰€ä»¥ç›®å‰åªæœ‰åœ¨Solarisã€Macã€BSDä¸Šçœ‹å¾—åˆ°ï¼ŒZFSæ˜¯128bitçš„æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œå®ƒåˆ°åº•æœ‰å¤šå¼ºå‘¢ï¼Ÿåˆ«å†ç­‰å¾…äº†é©¬ä¸Šç”¨äº†ä½ å°±çŸ¥é“ï¼Œåªèƒ½è¯´ZFSçœŸæ˜¯ä¸€ä¸ªä¸Šå¸èµç»™ITäººå‘˜çš„å¥½ç¤¼ç‰©ã€‚ </p>
<h2 id="ä¸ºä»€ä¹ˆé€‰æ‹©-ZFS"><a href="#ä¸ºä»€ä¹ˆé€‰æ‹©-ZFS" class="headerlink" title="ä¸ºä»€ä¹ˆé€‰æ‹© ZFS"></a>ä¸ºä»€ä¹ˆé€‰æ‹© ZFS</h2><blockquote>
<p>ZFS éå¸¸çš„ä¼˜ç§€ã€‚è¿™æ˜¯ä¸€ä¸ªçœŸæ­£ç°ä»£çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå†…ç½®çš„åŠŸèƒ½å¯¹äºå¤„ç†å¤§é‡çš„æ•°æ®å¾ˆæœ‰æ„ä¹‰ã€‚<br>ZFS æ¶ˆé™¤äº†å»ºç«‹ä¼ ç»Ÿ RAID é˜µåˆ—ï¼ˆç‹¬ç«‹ç£ç›˜å†—ä½™é˜µåˆ—ï¼‰çš„éœ€è¦ã€‚ ç›¸åï¼Œæ‚¨å¯ä»¥åˆ›å»º ZFS æ± ï¼Œç”šè‡³å¯ä»¥éšæ—¶å°†é©±åŠ¨å™¨æ·»åŠ åˆ°è¿™äº›æ± ä¸­ã€‚ ZFS æ± çš„è¡Œä¸ºæ“ä½œä¸ RAID å‡ ä¹å®Œå…¨ç›¸åŒï¼Œä½†åŠŸèƒ½å†…ç½®äºæ–‡ä»¶ç³»ç»Ÿä¸­ã€‚<br>ZFS ä¹Ÿå¯ä»¥æ›¿ä»£ LVM ï¼ˆé€»è¾‘ç›˜å·ç®¡ç†ï¼‰ï¼Œä½¿æ‚¨èƒ½å¤ŸåŠ¨æ€åœ°è¿›è¡Œåˆ†åŒºå’Œç®¡ç†åˆ†åŒºï¼Œè€Œæ— éœ€å¤„ç†åº•å±‚çš„ç»†èŠ‚ï¼Œä¹Ÿä¸å¿…æ‹…å¿ƒç›¸å…³çš„é£é™©ã€‚<br>è¿™ä¹Ÿæ˜¯ä¸€ä¸ª CoW ï¼ˆå†™æ—¶å¤åˆ¶ï¼‰æ–‡ä»¶ç³»ç»Ÿã€‚ è¿™é‡Œä¸ä¼šæåŠå¤ªå¤šçš„æŠ€æœ¯æ€§ï¼Œè¿™æ„å‘³ç€ ZFS å¯ä»¥ä¿æŠ¤æ‚¨çš„æ•°æ®å…å—é€æ¸æŸåçš„å½±å“ã€‚ ZFS ä¼šåˆ›å»ºæ–‡ä»¶çš„æ ¡éªŒå’Œï¼Œå¹¶å…è®¸æ‚¨å°†è¿™äº›æ–‡ä»¶å›æ»šåˆ°ä»¥å‰çš„å·¥ä½œç‰ˆæœ¬ã€‚</p>
</blockquote>
<h2 id="å®‰è£…-ZFS"><a href="#å®‰è£…-ZFS" class="headerlink" title="å®‰è£… ZFS"></a>å®‰è£… ZFS</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">åœ¨ Ubuntu ä¸Šå®‰è£… ZFS éå¸¸ç®€å•ï¼Œä½†å¯¹äº æœ€æ–°ç‰ˆæœ¬æ¥è¯´ï¼Œè¿™ä¸ª ç¨æœ‰ä¸åŒã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ubuntu 16.04 LTS</span></span><br><span class="line">sudo apt install zfs</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ubuntu 17.04 åŠä»¥å</span></span><br><span class="line">sudo apt install zfsutils</span><br></pre></td></tr></table></figure>

<h2 id="zfs-ä¸­çš„-æ± ï¼Œé›†ï¼Œå·æœ¯è¯­"><a href="#zfs-ä¸­çš„-æ± ï¼Œé›†ï¼Œå·æœ¯è¯­" class="headerlink" title="zfs ä¸­çš„ æ± ï¼Œé›†ï¼Œå·æœ¯è¯­"></a>zfs ä¸­çš„ æ± ï¼Œé›†ï¼Œå·æœ¯è¯­</h2><p>ZFSæœ‰ä¸‰ä¸ªæ¦‚å¿µï¼š</p>
<ol>
<li><p>Zæ±  - zpool</p>
</li>
<li><p>Zé›† - dataset</p>
</li>
<li><p>Zå· - volume</p>
</li>
</ol>
<p>Zæ±   <code>zpool create local /dev/sdb /dev/sdc /dev/sdd /dev/sde</code> è¿™å°±åˆ›å»ºäº†ä¸€ä¸ªåå«localçš„Zæ± ï¼ŒZæ± æœ‰å¦‚ä¸‹ç±»å‹:raid1ï¼Œraid0ï¼Œ raid5ï¼Œraid6 ç­‰ã€‚</p>
<p>Zé›† å½“ä¸€ä¸ªZæ± åˆ›å»ºå‡ºæ¥ï¼Œé™„å¸¦æœ‰ä¸€ä¸ªåŒåçš„Zé›†ä¹Ÿåˆ›å»ºå‡ºæ¥äº†ï¼Œè¿™é‡Œå°±æ˜¯ å« local è¿™ä¸ªã€‚æ³¨æ„è¿™ä¸ªZé›†æŒ‚è½½åœ¨&#x2F;local, è¿™ä¸ªç›®å½•å¯ä»¥åšä¸€ä¸ªæ­£å¸¸çš„ç›®å½•æ¥ç”¨ï¼Œå¯ä»¥åœ¨Zé›†ä¸Šåˆ›å»ºæ–°çš„Zé›†ï¼š<code>zfs create local/data</code></p>
<p>Zå· åˆ›å»ºZå·ï¼š<code>zfs create -V 10G local/vda</code>  Zå·æ˜¯ä¸€ä¸ªå—è®¾å¤‡ï¼Œå¯ä»¥æŒ‰éœ€è¦åˆ†åŒºï¼Œæ ¼å¼åŒ–ï¼š<code>mkfs.xfs /dev/zvol/local/vda</code></p>
<h2 id="åˆ›å»ºæ± "><a href="#åˆ›å»ºæ± " class="headerlink" title="åˆ›å»ºæ± "></a>åˆ›å»ºæ± </h2><p>åœ¨ ZFS ä¸­ï¼Œæ± å¤§è‡´ç›¸å½“äº RAID ã€‚ å®ƒä»¬å¾ˆçµæ´»ä¸”æ˜“äºæ“ä½œã€‚<br><img src= "/img/loading.gif" data-lazy-src="https://img-blog.csdnimg.cn/20210219170121875.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21taDE5ODkxMTEz,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>RAID0</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#RAID0 åªæ˜¯æŠŠä½ çš„ç¡¬ç›˜é›†ä¸­åˆ°ä¸€ä¸ªæ± å­é‡Œé¢ï¼Œå°±åƒä¸€ä¸ªå·¨å¤§çš„é©±åŠ¨å™¨ä¸€æ ·ã€‚ å®ƒå¯ä»¥æé«˜ä½ çš„é©±åŠ¨å™¨é€Ÿåº¦ï¼Œä½†æ˜¯å¦‚æœä½ çš„é©±åŠ¨å™¨æœ‰æŸåï¼Œä½ å¯èƒ½ä¼šå¤±ä¸¢å¤±æ•°æ®ã€‚</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo zpool create your-pool /dev/sdc /dev/sdd</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>RAID1ï¼ˆé•œåƒï¼‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ‚¨å¯ä»¥åœ¨ ZFS ä¸­ä½¿ç”¨ mirror å…³é”®å­—æ¥å®ç° RAID1 åŠŸèƒ½ã€‚ RAID1 ä¼šåˆ›å»ºä¸€ä¸ªä¸€å¯¹ä¸€çš„é©±åŠ¨å™¨å‰¯æœ¬ã€‚ è¿™æ„å‘³ç€æ‚¨çš„æ•°æ®ä¸€ç›´åœ¨å¤‡ä»½ã€‚ å®ƒä¹Ÿæé«˜äº†æ€§èƒ½ã€‚ å½“ç„¶ï¼Œä½ å°†ä¸€åŠçš„å­˜å‚¨ç©ºé—´ç”¨äºäº†å¤åˆ¶ã€‚</span><br><span class="line"></span><br><span class="line">sudo zpool create your-pool mirror /dev/sdc /dev/sdd</span><br></pre></td></tr></table></figure>
<p>RAID5&#x2F;RAIDZ1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ZFS å°† RAID5 åŠŸèƒ½å®ç°ä¸º RAIDZ1ã€‚ RAID5 è¦æ±‚é©±åŠ¨å™¨è‡³å°‘æ˜¯ 3 ä¸ªã€‚</span><br><span class="line">å¹¶å…è®¸æ‚¨é€šè¿‡å°†å¤‡ä»½å¥‡å¶æ ¡éªŒæ•°æ®å†™å…¥é©±åŠ¨å™¨ç©ºé—´çš„ 1/nï¼ˆn æ˜¯é©±åŠ¨å™¨æ•°ï¼‰ï¼Œç•™ä¸‹çš„æ˜¯å¯ç”¨çš„å­˜å‚¨ç©ºé—´ã€‚</span><br><span class="line">å¦‚æœä¸€ä¸ªé©±åŠ¨å™¨å‘ç”Ÿæ•…éšœï¼Œé˜µåˆ—ä»å°†ä¿æŒè”æœºçŠ¶æ€ï¼Œä½†åº”å°½å¿«æ›´æ¢å‘ç”Ÿæ•…éšœçš„é©±åŠ¨å™¨ã€‚</span><br><span class="line"></span><br><span class="line">sudo zpool create your-pool raidz1 /dev/sdc /dev/sdd /dev/sde</span><br></pre></td></tr></table></figure>
<p>RAID6&#x2F;RAIDZ2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RAID6 ä¸ RAID5 å‡ ä¹å®Œå…¨ç›¸åŒï¼Œä½†å®ƒè‡³å°‘éœ€è¦å››ä¸ªé©±åŠ¨å™¨ã€‚ å®ƒå°†å¥‡å¶æ ¡éªŒæ•°æ®åŠ å€ï¼Œæœ€å¤šå…è®¸ä¸¤ä¸ªé©±åŠ¨å™¨æŸåï¼Œè€Œä¸ä¼šå¯¼è‡´é˜µåˆ—å…³é—­ã€‚</span><br><span class="line"></span><br><span class="line">sudo zpool create your-pool raidz2 /dev/sdc /dev/sdd /dev/sde /dev/sdf</span><br></pre></td></tr></table></figure>
<p>RAIDZ3<br>3å¥‡å¶æ ¡éªŒä½ï¼Œå…è®¸åœ¨ä¸¢å¤±æ•°æ®ä¹‹å‰å‘ç”Ÿ3ä¸ªç£ç›˜æ•…éšœï¼Œæ€§èƒ½ä¸RAIDZ2å’ŒRAIDZç±»ä¼¼ã€‚ä¾‹å¦‚ï¼Œåˆ›å»º3å¥‡å¶æ ¡éªŒ6 VDEVæ± ï¼š </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zpool create example raidz3 /dev/sdb /dev/sdc /dev/sdd /dev/sde /dev/sdf /dev/sdg</span><br></pre></td></tr></table></figure>

<p>RAID10ï¼ˆæ¡å¸¦åŒ–é•œåƒï¼‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">RAID10 æ—¨åœ¨é€šè¿‡æ•°æ®æ¡å¸¦åŒ–æé«˜å­˜å–é€Ÿåº¦å’Œæ•°æ®å†—ä½™æ¥æˆä¸ºä¸€ä¸ªä¸¤å…¨å…¶ç¾çš„è§£å†³æ–¹æ¡ˆã€‚ ä½ è‡³å°‘éœ€è¦å››ä¸ªé©±åŠ¨å™¨ï¼Œä½†åªèƒ½ä½¿ç”¨ä¸€åŠçš„ç©ºé—´ã€‚ æ‚¨å¯ä»¥é€šè¿‡åœ¨åŒä¸€ä¸ªæ± ä¸­åˆ›å»ºä¸¤ä¸ªé•œåƒæ¥åˆ›å»º RAID10 ä¸­çš„æ± ã€‚</span><br><span class="line"></span><br><span class="line">sudo zpool create your-pool mirror /dev/sdc /dev/sdd mirror /dev/sde /dev/sdf</span><br><span class="line">æˆ–è€…</span><br><span class="line">sudo zpool create example mirror /dev/sdb /dev/sdc</span><br><span class="line">sudo zpool add example mirror /dev/sdd /dev/sde</span><br></pre></td></tr></table></figure>
<p>åµŒå¥—RAIDZ ï¼ˆRAID50, RAID60ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo zpool create example raidz /dev/sdb /dev/sdc /dev/sdd /dev/sde</span><br><span class="line">$ sudo zpool add example raidz /dev/sdf /dev/sdg /dev/sdh /dev/sdi</span><br></pre></td></tr></table></figure>




<h2 id="æ± çš„æ“ä½œ"><a href="#æ± çš„æ“ä½œ" class="headerlink" title="æ± çš„æ“ä½œ"></a>æ± çš„æ“ä½œ</h2><p>è¿˜æœ‰ä¸€äº›ç®¡ç†å·¥å…·ï¼Œä¸€æ—¦ä½ åˆ›å»ºäº†ä½ çš„æ± ï¼Œä½ å°±å¿…é¡»ä½¿ç”¨å®ƒä»¬æ¥æ“ä½œã€‚ é¦–å…ˆï¼Œæ£€æŸ¥ä½ çš„æ± çš„çŠ¶æ€ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zpool status</span><br></pre></td></tr></table></figure>
<p>å½“ä½ æ›´æ–° ZFS æ—¶ï¼Œä½ ä¹Ÿéœ€è¦æ›´æ–°ä½ çš„æ± ã€‚ å½“æ‚¨æ£€æŸ¥å®ƒä»¬çš„çŠ¶æ€æ—¶ï¼Œæ‚¨çš„æ± ä¼šé€šçŸ¥æ‚¨ä»»ä½•æ›´æ–°ã€‚ è¦æ›´æ–°æ± ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zpool upgrade your-pool</span><br></pre></td></tr></table></figure>
<p>ä½ ä¹Ÿå¯ä»¥æ›´æ–°å…¨éƒ¨æ± ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zpool upgrade -a</span><br></pre></td></tr></table></figure>
<p>æ‚¨ä¹Ÿå¯ä»¥éšæ—¶å°†é©±åŠ¨å™¨æ·»åŠ åˆ°æ± ä¸­ã€‚ å‘Šè¯‰ zpool æ± çš„åç§°å’Œé©±åŠ¨å™¨çš„ä½ç½®ï¼Œå®ƒä¼šå¤„ç†å¥½ä¸€åˆ‡ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zpool add your-pool /dev/sdx</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ‚¨æƒ³ç ´åæ± ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zpool destroy pool-name</span><br></pre></td></tr></table></figure>
<h2 id="ZIL-ZFS-Intent-Log"><a href="#ZIL-ZFS-Intent-Log" class="headerlink" title="ZIL (ZFS Intent Log)"></a>ZIL (ZFS Intent Log)</h2><blockquote>
<p>ZIL æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªç¡¬ç›˜ï¼Œæ­£å¸¸æƒ…å†µä¸‹ä½¿ç”¨ssdçš„ç£ç›˜ï¼ŒZILèƒ½è®°å½•æ‰€æœ‰çš„å†™æ“ä½œï¼Œç„¶åå†™åˆ°ZIL çš„ç£ç›˜ï¼Œå› ä¸ºzfs copy on writeçš„æœºåˆ¶ï¼ŒZILå®é™…çš„å­˜å‚¨ä¿¡æ¯å¾ˆå°, åªä¿å­˜ä¿®æ”¹çš„æ•°æ®ï¼Œæˆ–è€…æ˜¯æ•°æ®å—çš„å¤–éƒ¨æŒ‡é’ˆ, å‡å¦‚ä½ å†™å…¥ä¸€ä¸ªå¤§çš„æ•°æ®æ–‡ä»¶ï¼Œå¦‚æœè®¾ç½®logbias&#x3D;troughput, é‚£ä¹ˆè¿™ä¸ªæ‰€æœ‰çš„å†™æ“ä½œæ˜¯ç›´æ¥åˆ°data poolçš„ä¸ç»è¿‡ZIL, ZILä¸­åªä¿å­˜æ•°æ®çš„æŒ‡é’ˆ, æ‰€ä»¥è¯´å¦‚æœè®¾ç½®logbias&#x3D;troughput,é‚£ä¹ˆä½¿ç”¨ç‹¬ç«‹çš„ZILè®¾å¤‡æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ å¦‚æœlogbias&#x3D;latencyï¼Œç”±äºzfså¯¹zilçš„ä½¿ç”¨æœ‰é˜ˆå€¼é™åˆ¶, ä¾‹å¦‚å•æ¬¡æäº¤çš„å†™è¶…è¿‡é˜ˆå€¼åˆ™ç›´æ¥å†™data pool, å¦åˆ™ä¼šå†™å…¥ZILä¹‹åsyncåˆ°data poolã€‚è¿™ä¸ªé˜ˆå€¼æ˜¯é€šè¿‡è®¾ç½®zfs_immediate_write_sz (&#x2F;etc&#x2F;systemæ–‡ä»¶)çš„å¤§å°æ¥ç¡®å®šã€‚æ‰€æœ‰çš„è¿™äº›å‚æ•°çš„è°ƒæ•´è¦æ›´æ®ä½ çš„å…·ä½“åº”ç”¨åœºæ™¯æ¥ç¡®å®šã€‚</p>
</blockquote>
<blockquote>
<p>ZFS æ–‡ä»¶ç³»ç»Ÿä¹Ÿæœ‰ç±»ä¼¼æ•°æ®åº“çš„é‡åšæ—¥å¿—ï¼Œè¢«ç§°ä¸º ZFS Intent Log ï¼Œç®€ç§° ZIL, è¿˜æœ‰ä¸ªæœ¯è¯­ï¼Œè¢«ç§°ä¸º Separate Intent Log, ç®€ç§° SLOGï¼Œæ˜¯æŒ‡å­˜å‚¨ ZILæ—¥å¿—çš„ç‹¬ç«‹çš„è®¾å¤‡ï¼Œ æ‰‹å†Œä¸Šæåˆ°ä½¿ç”¨ ZIL å¯ä»¥æé«˜æ–‡ä»¶ç³»ç»Ÿæ€§èƒ½ï¼Œè¿˜èƒ½å¤Ÿç”¨æ¥æ¢å¤æ–‡ä»¶ç³»ç»Ÿ</p>
</blockquote>
<blockquote>
<p>è¿™é‡Œå¦‚æœæˆ‘ä»¬ä¸æ·»åŠ ç‹¬ç«‹ZILè®¾å¤‡ï¼Œå®é™…ä¸Špoolé‡Œé¢çš„æ•°æ®ç›˜ä¸Šä¹Ÿä¼šåˆZILçš„å­˜å‚¨, åªè¦æ˜¯ZFS sync&#x3D;standard, å€¼å¾—ä¸€æçš„æ˜¯sync&#x3D;alwaysçš„è¯ï¼Œæ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿçš„transactionæ˜¯ç›´æ¥å†™åˆ°data pool.</p>
</blockquote>
<blockquote>
<p>åŒæ­¥å†™æ“ä½œå‡å°‘å¯¹æ•´ä¸ªdata poolçš„IOPSå½±å“, ä½¿ç”¨ssdåšZILå¯ç”¨é™ä½åŒæ­¥å†™çš„å»¶è¿Ÿ, è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼ŒNFS&#x2F;ISCSI Target&#x2F;OLTP Databaseç­‰éƒ½æ˜¯åŒæ­¥å†™ï¼Œè¿™é‡Œä¼šå¤§å¤§æå‡æ€§èƒ½ã€‚</p>
</blockquote>
<p>ç¨å¾®æ€»ç»“ä¸‹ï¼š</p>
<pre><code>ZILæä¾›äº†æ–­ç”µæƒ…å†µä¸‹çš„æ•°æ®ä¿æŠ¤ã€‚
åœ¨æ¯æ¬¡åŒæ­¥å†™å‘ç”Ÿçš„æƒ…å†µä¸‹é¿å…æ›´æ–°æ•´ä¸ªç£ç›˜çš„data structure.
å¤§é‡çš„åŒæ­¥å†™æ“ä½œä¼šå¢åŠ äº†æ•´ä¸ªdata poolçš„IOPSçš„å‹åŠ›ï¼Œæ‰€æœ‰éœ€è¦ä½¿ç”¨ç‹¬ç«‹çš„ZILè®¾å¤‡ã€‚
é€šè¿‡SSDä½œä¸ºç‹¬ç«‹ZILè®¾å¤‡å¯ä»¥åŠ é€ŸåŒæ­¥å†™ã€‚ç”šè‡³æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªSSDå°†ZILåšæˆMirror,é˜²æ­¢å•ç›˜çš„å¤±æ•ˆã€‚
å¦‚æœä½ çš„data poolæ˜¯å…¨SSDçš„ï¼Œåˆæ²¡æœ‰ç‹¬ç«‹çš„ZILè®¾å¤‡ï¼Œå¯ä»¥ç›´æ¥å°†logbias=throughputã€‚
</code></pre>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">For example, to add a SSDs to the pool <span class="string">&#x27;mypool&#x27;</span>, use: </span><br><span class="line">$ sudo zpool add mypool <span class="built_in">log</span> /dev/sdg -f</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯å­˜æ”¾logçš„ç¡¬ç›˜è‹¥æŸåæœ‰å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œå¦‚æœä¸èƒ½æ¥å—è¿™ä¸ªé£é™©çš„è¯è€ƒè™‘ç»™logç›˜åšæˆmirroræ¨¡å¼ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤‡æ³¨ï¼š ç»™ mypool æ± å¢åŠ  SLOG è®¾å¤‡ï¼Œå¹¶ä¸” sda1 , sda2 åšæˆé•œåƒã€‚ </span></span><br><span class="line">$ sudo zpool add mypool <span class="built_in">log</span> mirror /dev/sda1 /dev/sda2</span><br><span class="line"></span><br><span class="line">$ sudo zpool add ftp-pool <span class="built_in">log</span> mirror /dev/sda /dev/sdb</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="ZFS-Cache-Drives-æ‹¿-SSD-åšå¿«å–"><a href="#ZFS-Cache-Drives-æ‹¿-SSD-åšå¿«å–" class="headerlink" title="ZFS Cache Drives æ‹¿ SSD åšå¿«å–"></a>ZFS Cache Drives æ‹¿ SSD åšå¿«å–</h2><p> é«˜é€Ÿç¼“å­˜è®¾å¤‡åœ¨ä¸»å†…å­˜å’Œç£ç›˜ä¹‹é—´æä¾›äº†ä¸€ä¸ªé¢å¤–çš„é«˜é€Ÿç¼“å­˜å±‚ã€‚å®ƒä»¬å¯¹äºæé«˜ä¸»è¦æ˜¯é™æ€æ•°æ®çš„éšæœºè¯»å–æ€§èƒ½ç‰¹åˆ«æœ‰ç”¨ã€‚ </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Fox example, to add a cache drive /dev/sdh to the pool <span class="string">&#x27;mypool&#x27;</span>, use:</span><br><span class="line"></span><br><span class="line">$ sudo zpool add mypool cache /dev/sdh -f</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€šè¿‡ zpool add åŠ ä¸Šä¸€é¡† SSD ç¡¬ç›˜ä½œç‚ºå¿«å–ä½¿ç”¨ (å…³éµå­—æ˜¯ cache)ï¼š</span></span><br><span class="line">$ sudo zpool add ftp-pool cache /dev/disk/by-id/ata-INTEL_SSDSC2BB240G7_PHD12345ABC</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="ZFSä¸æ•°æ®å»é‡"><a href="#ZFSä¸æ•°æ®å»é‡" class="headerlink" title="ZFSä¸æ•°æ®å»é‡"></a>ZFSä¸æ•°æ®å»é‡</h2><p> ä»€ä¹ˆæ˜¯Deduplication?<br>Deduplicationæ˜¯æ¶ˆé™¤é‡å¤æ•°æ®çš„è¿‡ç¨‹ã€‚å»é‡è¿‡ç¨‹å¯ä»¥åŸºäºfile-levelæ–‡ä»¶çº§ï¼Œblock-levelå—çº§æˆ–è€…byte-levelå­—èŠ‚çº§ã€‚ä½¿ç”¨éå¸¸é«˜å¯èƒ½æ€§çš„hashç®—æ³•æ¥å”¯ä¸€æ ‡è¯†æ•°æ®å—ï¼ˆæ–‡ä»¶ï¼Œå—ï¼Œå­—èŠ‚ï¼‰ã€‚å½“ä½¿ç”¨å®‰å…¨hashï¼Œä¾‹å¦‚SHA256æ—¶ï¼Œhashç¢°æ’çš„å¯èƒ½æ€§ä¸º2çš„256æ¬¡æ–¹ï¼Œ2^256 &#x3D; 10\67 æˆ–è€…è¡¨ç¤ºä¸º0.00000000000000000000000000000000000000000000000000000000000000000000000000001ã€‚</p>
<p>é€‰æ‹©å“ªä¸ªç­‰çº§çš„å»é‡ï¼Œfiles,blocks,bytes?<br>æ•°æ®å¯ä»¥åœ¨æ–‡ä»¶çº§ï¼Œå—çº§ï¼Œå­—èŠ‚çº§è¢«å»é‡ã€‚<br>æ–‡ä»¶çº§çš„å»é‡å¯¹æ–‡ä»¶ä½œä¸ºæ•´ä½“æ¥è®¡ç®—hashç­¾åï¼Œå¦‚æœå¤„ç†çš„æ˜¯è‡ªç„¶çš„æ–‡ä»¶ï¼Œåˆ™æ­¤æ–¹æ³•éœ€è¦çš„æ¶ˆè€—æœ€å°ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯å¯¹æ–‡ä»¶çš„ä»»ä½•ä¿®æ”¹éƒ½éœ€è¦é‡æ–°è®¡ç®—æ–‡ä»¶çš„hashç­¾åï¼Œå³å¯¹æ–‡ä»¶çš„ä»»ä½•ä¿®æ”¹ï¼Œå°†ä½¿å¾—æ­¤æ–‡ä»¶ä¹‹å‰èŠ‚çº¦çš„ç©ºé—´æ¶ˆå¤±ï¼Œå› ä¸ºä¸¤ä¸ªæ–‡ä»¶å°†ä¸å†ç›¸åŒã€‚æ­¤ä¸­æ–¹æ³•æ¯”è¾ƒé€‚åˆç±»ä¼¼äºæ–‡ä»¶JPEGï¼ŒMPEGï¼Œä½†æ˜¯å¯¹äºåƒè™šæ‹Ÿæœºé•œåƒï¼ˆå¤§æ–‡ä»¶ï¼‰æ–‡ä»¶å°†æ— æ•ˆï¼Œå› ä¸ºå³ä½¿ä»–ä»¬åªæ˜¯å¾ˆå°çš„ä¸€éƒ¨åˆ†ä¸åŒï¼Œä½†æ˜¯æ–‡ä»¶çº§åˆ«ä»–ä»¬å°†æ˜¯ä¸åŒçš„æ–‡ä»¶ã€‚<br>å—çº§åˆ«çš„å»é‡ï¼ˆç›¸åŒå¤§å°çš„å—ï¼‰ï¼Œç›¸æ¯”æ–‡ä»¶çº§çš„å»é‡ï¼Œéœ€è¦æ›´å¤šçš„è®¡ç®—æ¶ˆè€—ï¼Œä½†æ˜¯ä»–èƒ½å¤Ÿå¾ˆå¥½åœ°å¯¹åƒè™šæ‹Ÿæœºé•œåƒç±»ä¼¼çš„å¤§æ–‡ä»¶å»é‡ã€‚å¤§éƒ¨åˆ†çš„è™šæ‹Ÿæœºé•œåƒæ–‡ä»¶æ˜¯é‡å¤æ•°æ®ï¼Œä¾‹å¦‚é•œåƒæ–‡ä»¶ä¸­çš„æ“ä½œç³»ç»Ÿéƒ¨åˆ†ã€‚ä½¿ç”¨å—çº§çš„å»é‡å°†ä½¿å¾—åªæœ‰é•œåƒç‰¹åˆ«çš„æ•°æ®æ‰å ç”¨é¢å¤–çš„ç©ºé—´ï¼Œç›¸åŒçš„æ•°æ®å°†å…±äº«ã€‚<br>å­—èŠ‚çº§åˆ«çš„å»é‡ï¼Œå°†éœ€è¦æ›´å¤šçš„è®¡ç®—æ¶ˆè€—æ¥å†³å®šé‡å¤æ•°æ®çš„å¼€å§‹å’Œç»“æŸåŒºåŸŸï¼Œä¸ç®¡æ€ä¹ˆè¯´ï¼Œæ­¤æ–¹æ³•å¯¹mailæœåŠ¡å™¨æ¥è¯´æ˜¯ç†æƒ³çš„é€‰æ‹©ï¼Œä¾‹å¦‚ä¸€ä¸ªé‚®ä»¶çš„é™„ä»¶å¯èƒ½å‡ºç°å¾ˆå¤šæ¬¡ï¼Œä½†æ˜¯ä½¿ç”¨å—çº§åˆ«å»é‡æ—¶ä»–ä»¬å¹¶ä¸èƒ½è¢«ä¼˜åŒ–ã€‚æ­¤ç±»å‹çš„å»é‡ä¸€èˆ¬ç”¨æ¥ä¸€äº›åº”ç”¨ç¨‹åºçš„å»é‡ä¸­ï¼Œä¾‹å¦‚exchangeserverï¼Œå› ä¸ºåº”ç”¨ç¨‹åºçŸ¥é“ä»–ç®¡ç†çš„æ•°æ®ï¼Œå¯ä»¥åœ¨å†…éƒ¨å®¹æ˜“åœ°å»é‡ã€‚<br>ZFSæä¾›äº†å—çº§åˆ«çš„å»é‡æŠ€æœ¯ï¼Œæ­¤ç§æŠ€æœ¯æ›´é€‚åˆé€šç”¨çš„æƒ…å†µã€‚ä¸”ZFSä½¿ç”¨SHA256æ¥è®¡ç®—hashç­¾åã€‚</p>
<p>ä»€ä¹ˆæ—¶å€™å»é‡ï¼Œç°åœ¨è¿˜æ˜¯å°†æ¥ï¼Ÿ<br>é™¤äº†ä»¥ä¸Šæè¿°çš„æ–‡ä»¶çº§ï¼Œå—çº§ï¼Œå­—èŠ‚çº§çš„åŒºåˆ«å¤–ï¼Œå»é‡è¿˜å¯ä»¥åˆ†ä¸ºåŒæ­¥ï¼ˆå®æ—¶æˆ–å†…ç½®ï¼‰å’Œå¼‚æ­¥ï¼ˆæ‰¹å¤„ç†æˆ–ç¦»çº¿å¤„ç†ï¼‰ã€‚åœ¨åŒæ­¥å»é‡ä¸­ï¼Œé‡å¤æ–‡ä»¶åœ¨å‡ºç°çš„æ—¶å€™å³è¢«å»é™¤ï¼Œåœ¨å¼‚æ­¥å»é‡ä¸­ï¼Œæ–‡ä»¶å·²ç»å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œç„¶åé€šè¿‡åç»­çš„å¤„ç†æ¥å»é‡ï¼ˆä¾‹å¦‚åœ¨å¤œé—´æ¥å¤„ç†ï¼‰ã€‚å¼‚æ­¥å»é‡å…¸å‹åœ°è¢«ç”¨åœ¨æ‹¥æœ‰æœ‰é™çš„cpuå’Œå¤šçº¿ç¨‹çš„å­˜å‚¨ç³»ç»Ÿï¼Œæœ€å°åŒ–å¯¹æ—¥å¸¸å·¥ä½œçš„å½±å“ã€‚ä½†æ˜¯å¦‚æœcpuçš„æ€§èƒ½è¶³å¤Ÿï¼ŒåŒæ­¥å»é‡æ˜¯æ¨èçš„æ–¹æ³•ï¼Œå› ä¸ºé¿å…äº†æ— ç”¨çš„ç£ç›˜çš„å†™æ“ä½œã€‚</p>
<p>å¦‚ä½•ä½¿ç”¨ZFSçš„å»é‡</p>
<p>ä½¿ç”¨éå¸¸çš„ç®€å•ï¼Œå¦‚æœä½ æœ‰å­˜å‚¨æ± tankï¼Œä½ éœ€è¦å¯¹tankä½¿ç”¨zfsï¼Œåˆ™è®¾ç½®ä¸ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zfs <span class="built_in">set</span> dedup=on tank</span><br><span class="line"></span><br><span class="line">zfs <span class="built_in">set</span> dedup=on <span class="built_in">local</span></span><br><span class="line">zfs <span class="built_in">set</span> compress=lz4 <span class="built_in">local</span></span><br></pre></td></tr></table></figure>

<p>æ˜¯å¦éœ€è¦ZFSçš„å»é‡çš„æƒè¡¡</p>
<p>ä¸»è¦è¿˜æ˜¯å–å†³äºä½ çš„æ•°æ®ã€‚å¦‚æœä½ çš„æ•°æ®ç¡®å®ä¸åŒ…å«é‡å¤ï¼Œåˆ™å¼€å¯å»é‡åŠŸèƒ½åˆ™ä¼šå¸¦æ¥é¢å¤–çš„å¼€é”€ä¸”æ²¡æœ‰ä»»ä½•çš„å¥½å¤„ã€‚ä½†æ˜¯å¦‚æœä½ çš„æ•°æ®åŒ…å«é‡å¤ï¼Œåˆ™ä½¿ç”¨zfsçš„å»é‡å¯ä»¥èŠ‚çº¦ç©ºé—´è€Œä¸”æé«˜æ€§èƒ½ã€‚èŠ‚çº¦ç©ºé—´æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œæ€§èƒ½çš„æé«˜æ˜¯å› ä¸ºå‡å°‘äº†é‡å¤æ•°æ®çš„å†™ç£ç›˜æ¶ˆè€—å’Œå†…å­˜é¡µçš„ç½®æ¢ã€‚</p>
<p>å¤§éƒ¨åˆ†çš„å­˜å‚¨ç¯å¢ƒéƒ½æ˜¯å¤šç§æ•°æ®çš„æ··åˆï¼Œzfsæ”¯æŒå¯¹æœ‰é‡å¤çš„éƒ¨åˆ†å¼€å¯å»é‡æ“ä½œï¼Œä¾‹å¦‚ä½ çš„å­˜å‚¨æ± åŒ…å«äº†homeç›®å½•ï¼Œè™šæ‹Ÿæœºé•œåƒç›®å½•ï¼Œæºä»£ç ç›®å½•ã€‚æ­¤æ—¶ä½ å¯ä»¥è®¾ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">zfs <span class="built_in">set</span> dedup=off tank/home</span><br><span class="line"></span><br><span class="line">zfs <span class="built_in">set</span> dedup=on tank/vm</span><br><span class="line"></span><br><span class="line">zfs <span class="built_in">set</span> dedup=on tank/src</span><br></pre></td></tr></table></figure>

<p>ä¿¡ä»»æˆ–éªŒè¯</p>
<p>å¦‚æœä¸¤ä¸ªæ•°æ®çš„hashç›¸åŒï¼Œæˆ‘ä»¬åˆ™è®¤ä¸ºä¸¤ä¸ªæ•°æ®æ˜¯åŒä¸€ä¸ªæ•°æ®ï¼Œhashä¾‹å¦‚SHA256ï¼Œä¸¤ä¸ªä¸åŒæ•°æ®hashç›¸åŒçš„å¯èƒ½æ€§ä¸º1&#x2F;2^256ï¼Œ æ˜¯ä¸ªå¾ˆå°çš„æ¦‚ç‡ã€‚å½“ç„¶zfsä¹Ÿæä¾›äº†éªŒè¯çš„é€‰é¡¹ï¼Œæ­¤é€‰é¡¹å¯¹ä¸¤ä¸ªæ•°æ®è¿›è¡Œå…¨æ¯”è¾ƒæ¥ç¡®å®šä»–ä»¬æ˜¯å¦ç›¸åŒï¼Œå¦‚æœä¸ç›¸åŒåˆ™å¤„ç†ï¼ŒæŒ‡å®šverifyçš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zfs <span class="built_in">set</span> dedup=verify tank</span><br></pre></td></tr></table></figure>

<p>hashçš„é€‰æ‹©</p>
<p>å› ä¸ºä¸åŒç§ç±»çš„hashæ‰€éœ€è¦çš„è¿ç®—ä¹Ÿä¸ç›¸åŒï¼Œä¸€ç§æ¨èçš„æ–¹æ³•æ˜¯ä½¿ç”¨è¾ƒå¼±çš„hashï¼ˆéœ€è¦çš„è¿ç®—è¾ƒå°‘ï¼‰åŠ verifyæ¥æä¾›å¿«é€Ÿçš„å»é‡ï¼Œzfså¯¹åº”çš„é€‰é¡¹ä¸º:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zfs <span class="built_in">set</span> dedup=fletcher4,verify tank</span><br></pre></td></tr></table></figure>
<p>ä¸åƒSHA256ï¼Œfletcher4ä¸èƒ½è¢«ä¿¡ä»»ä¸ºæ— ç¢°æ’ï¼Œåªé€‚åˆä¸verifyä¸€èµ·ä½¿ç”¨ï¼Œverifyæ¥ç¡®ä¿ç¢°æ’çš„å¤„ç†ã€‚æ€»çš„æ¥è¯´æ€§èƒ½ç›¸å¯¹è¦å¥½äº›ã€‚</p>
<p>é€šå¸¸å¦‚æœä¸ç¡®å®šå“ªç§çš„hashçš„æ•ˆç‡è·Ÿé«˜çš„è¯ï¼Œå³ä½¿ç”¨é»˜è®¤çš„è®¾ç½®dedup&#x3D;on</p>
<p>æ‰©å±•æ€§å’Œæ•ˆç‡</p>
<p>å¤§éƒ¨åˆ†çš„å»é‡æ–¹æ¡ˆéƒ½åªèƒ½é’ˆå¯¹æœ‰é™çš„æ•°æ®ï¼Œä¸€èˆ¬åœ¨TBç­‰çº§ï¼Œå› ä¸ºä»–ä»¬éœ€è¦å»é‡æ•°æ®è¡¨å¸¸é©»åœ¨å†…å­˜ã€‚ZFSå¯¹æ•°æ®å¤§å¤§å°æ²¡æœ‰é™åˆ¶ï¼Œå¯ä»¥å¤„ç†PBçº§çš„æ•°æ®ã€‚ä½†æ˜¯å¦‚æœå»é‡æ•°æ®è¡¨å¸¸é©»å†…å­˜çš„è¯ï¼Œæ€§èƒ½æ¯”è¾ƒå¥½ã€‚</p>
<h2 id="ZFSä¸æ•°æ®å‹ç¼©"><a href="#ZFSä¸æ•°æ®å‹ç¼©" class="headerlink" title="ZFSä¸æ•°æ®å‹ç¼©"></a>ZFSä¸æ•°æ®å‹ç¼©</h2><p>ä»€ä¹ˆæ˜¯ZFSå‹ç¼©ï¼Ÿ<br>ZFSä¸­çš„å‹ç¼©æ˜¯ä¸€ä¸ªéå¸¸ç®€æ´çš„ç‰¹æ€§ï¼šå®ƒå¯ä»¥åŠ¨æ€å‹ç¼©æ–‡ä»¶ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨æœ‰é™çš„å­˜å‚¨ç©ºé—´å­˜å‚¨æ›´å¤šçš„æ•°æ®ã€‚</p>
<p>ä¸ºä»€ä¹ˆä½¿ç”¨ZFSå‹ç¼©ï¼Ÿ<br>æ˜¾ç„¶ï¼ŒZFSå‹ç¼©çš„æœ€å¤§å¥½å¤„æ˜¯å¯ä»¥èŠ‚çœç›¸å½“å¤šçš„ç©ºé—´ã€‚ä½ çš„æœåŠ¡å™¨æˆ–æ¡Œé¢ä¸Šçš„å¤§æ–‡ä»¶å¯èƒ½ä¼šå‹ç¼©å¾—å¾ˆå¥½ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦æµªè´¹ç©ºé—´å‘¢ï¼Ÿ</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›éå¸¸é€‚åˆZFSå‹ç¼©åœºæ™¯çš„æ–‡ä»¶ï¼š<br>æ–°OSç‰ˆæœ¬çš„ISOæ˜ åƒï¼ˆä¸çŸ¥é“æ‚¨çš„æƒ…å†µï¼Œä½†æˆ‘å‡ ä¹æ¯å¤©éƒ½ä¸‹è½½ï¼‰<br>VirtualBoxã€KVMæˆ–ä»»ä½•å…¶ä»–è§£å†³æ–¹æ¡ˆçš„VMæ˜ åƒ<br>Dockerå®¹å™¨é•œåƒ<br>å¤§é‡åº”ç”¨ç¨‹åºæˆ–æœåŠ¡å™¨æ—¥å¿— </p>
<p>ä¸ºä»€ä¹ˆç¦ç”¨å‹ç¼©ï¼Ÿ<br>åƒæ‰€æœ‰å¥½ä¸œè¥¿ä¸€æ ·ï¼ŒZFSå‹ç¼©ä¹Ÿæœ‰æˆæœ¬ï¼Œç‰¹åˆ«æ˜¯å‹ç¼©å’Œè§£å‹ç¼©ZFSæ•°æ®éœ€è¦é¢å¤–çš„CPUå‘¨æœŸã€‚æˆ‘å¯¹è¿™ä¸€ç‚¹çš„çœ‹æ³•æ˜¯ï¼Œåœ¨æ¡Œé¢ç³»ç»Ÿä¸Šï¼ŒZFSå‹ç¼©ç»å¯¹æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¸»æ„-æ‚¨å¾ˆå°‘ä¼šå°†CPUçš„æœ€å¤§åŒ–æ‰©å±•åˆ°ZFSå‹ç¼©å¯ä»¥æ³¨æ„åˆ°çš„ç¨‹åº¦ï¼Œä½†ä¼˜åŒ–å®è´µçš„SSDå­˜å‚¨ç©ºé—´çš„å¥½å¤„æ˜¯å·¨å¤§çš„ã€‚<br>åœ¨è¾ƒå°çš„ç³»ç»Ÿä¸Šï¼Œæ¯”å¦‚æˆ‘çš„ä¸€äº›ç”¨äºè¿œç¨‹RSyslogçš„åµŒå…¥å¼æœåŠ¡å™¨ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªç ´åè€…ï¼šè¿›å…¥çš„æ—¥å¿—æ•°é‡å¯èƒ½ä¼šé«˜åˆ°è¶…å‡ºèˆ’é€‚æ°´å¹³çš„CPUä½¿ç”¨ç‡å³°å€¼ã€‚</p>
<p>å¦‚ä½•æ£€æŸ¥ZFSå‹ç¼© </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">$ zfs get all work/share/sean |grep compress</span><br><span class="line">work/share/sean  compressratio         4.32x                  -</span><br><span class="line">work/share/sean  compression           lz4                    inherited from work/share</span><br><span class="line">work/share/sean  refcompressratio      4.32x </span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹é¢æ˜¯æ²¡æœ‰å¼€å¯å‹ç¼©åŠŸèƒ½çš„æ˜¾ç¤ºç»“æœ</span></span><br><span class="line">$ zfs get all newvol | grep compress</span><br><span class="line">work compressratio         1.00x                  -</span><br><span class="line">work compression           off                    <span class="built_in">local</span></span><br><span class="line">work refcompressratio      1.00x                  -</span><br></pre></td></tr></table></figure>

<p>å¦‚ä½•å¼€å¯ZFSå‹ç¼©ï¼Ÿ<br> ZFSæœ‰å¤šç§å‹ç¼©ç®—æ³•ï¼š<br>gzip - standard UNIX compression.<br>gzip-N - selects a specific gzip level. gzip-1 provides the fastest gzip compression. gzip-9 provides the best data compression. gzip-6 is the default.<br>lz4 - provides better compression with lower CPU overhead  è¿™ç§æ˜¯æ¯”è¾ƒé€šç”¨ï¼Œå¸¸ç”¨çš„ã€‚<br>lzjb - optimized for performance while providing decent compression<br>zle - zero length encoding is useful for datasets with large blocks of zeros</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¯”è¾ƒå¸¸ç”¨çš„ æ˜¯ lz4 è¿™ä¸ªï¼Œ</span></span><br><span class="line"></span><br><span class="line">$ zfs <span class="built_in">set</span> compression=lz4 newvol</span><br><span class="line"></span><br><span class="line">$ zfs <span class="built_in">set</span> compress=lz4 pool/fs</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å¦‚ä½•ç¦ç”¨ZFSå‹ç¼©ï¼Ÿ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@server:~ <span class="comment"># zfs set compression=off newvol</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å‹ç¼©åªå¯¹æ–°ç”Ÿæˆçš„æ•°æ®æœ‰æ•ˆã€‚<br>ä¸€ä»¶éå¸¸é‡è¦çš„äº‹æƒ…ï¼šå½“æ‚¨å¯ç”¨æˆ–ç¦ç”¨ZFSå‹ç¼©æ—¶ï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰æ›´æ”¹ZFSæ–‡ä»¶ç³»ç»Ÿä¸Šçš„ä»»ä½•æ•°æ®ã€‚<br>è¿™äº›æ›´æ”¹ZFSçš„è¡Œä¸ºï¼Œæ„å‘³ç€å°†æ¥çš„ä»»ä½•æ•°æ®ä¼šç”Ÿæ•ˆï¼Œä½†å½“å‰çš„æ•°æ®å°†ä¿æŒåŸæ ·ã€‚ </p>
<h2 id="å…¶ä»–è¡¥å……"><a href="#å…¶ä»–è¡¥å……" class="headerlink" title="å…¶ä»–è¡¥å……"></a>å…¶ä»–è¡¥å……</h2><p>ä¸‹é¢åäº†3ç»„å¯¹æ¯”ï¼Œæ¥è§‚å¯Ÿ å»é‡ï¼Œå’Œå‹ç¼© æ‰“å¼€å…³é—­çš„æ•ˆæœã€‚<br>è¿™ä¸ªæ˜¯æ‰“å¼€äº† dedup&#x3D;on å»é‡å¤æ•°æ®çš„å¼€å…³çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ zpool list</span><br><span class="line">NAME   SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT</span><br><span class="line">work  10.9T   119M  10.9T        -         -     0%     0%  101.00x    ONLINE  -</span><br><span class="line"></span><br><span class="line">$ sudo zdb -b work</span><br><span class="line"></span><br><span class="line">Traversing all blocks to verify nothing leaked ...</span><br><span class="line"></span><br><span class="line">loading concrete vdev 1, metaslab 348 of 349 ...</span><br><span class="line"></span><br><span class="line">	No leaks (block sum matches space maps exactly)</span><br><span class="line"></span><br><span class="line">	bp count:                 59858</span><br><span class="line">	ganged count:                 0</span><br><span class="line">	bp logical:          7825691648      avg: 130737</span><br><span class="line">	bp physical:         7813446656      avg: 130533     compression:   1.00</span><br><span class="line">	bp allocated:       11724856320      avg: 195877     compression:   0.67</span><br><span class="line">	bp deduped:         11599872000    ref&gt;1:    590   deduplication:   1.99</span><br><span class="line">	Normal class:         124984320     used:  0.00%</span><br><span class="line"></span><br><span class="line">	additional, non-pointer bps of type 0:         32</span><br><span class="line">	Dittoed blocks on same vdev: 114</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ˜¯æ²¡æœ‰æ‰“å¼€  dedup&#x3D;on å»é‡å¤æ•°æ®çš„å¼€å…³çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ zpool list</span><br><span class="line">NAME   SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT</span><br><span class="line">work  10.9T  7.28G  10.9T        -         -     0%     0%  1.00x    ONLINE  -</span><br><span class="line"></span><br><span class="line">$ sudo zdb -b work</span><br><span class="line"></span><br><span class="line">Traversing all blocks to verify nothing leaked ...</span><br><span class="line"></span><br><span class="line">loading concrete vdev 5, metaslab 115 of 116 ...</span><br><span class="line"></span><br><span class="line">	No leaks (block sum matches space maps exactly)</span><br><span class="line"></span><br><span class="line">	bp count:                 59830</span><br><span class="line">	ganged count:                 0</span><br><span class="line">	bp logical:          7825523712      avg: 130795</span><br><span class="line">	bp physical:         7813270528      avg: 130591     compression:   1.00</span><br><span class="line">	bp allocated:        7816024064      avg: 130637     compression:   1.00</span><br><span class="line">	bp deduped:                   0    ref&gt;1:      0   deduplication:   1.00</span><br><span class="line">	Normal class:        7816024064     used:  0.07%</span><br><span class="line"></span><br><span class="line">	additional, non-pointer bps of type 0:         40</span><br></pre></td></tr></table></figure>
<p>æ‰“å¼€å»é‡å’Œå‹ç¼©çš„ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ zpool list</span><br><span class="line">NAME   SIZE  ALLOC   FREE  CKPOINT  EXPANDSZ   FRAG    CAP  DEDUP    HEALTH  ALTROOT</span><br><span class="line">work  10.9T  15.3M  10.9T        -         -     0%     0%  101.00x    ONLINE  -</span><br><span class="line"></span><br><span class="line">$ sudo zdb -b work</span><br><span class="line"></span><br><span class="line">Traversing all blocks to verify nothing leaked ...</span><br><span class="line"></span><br><span class="line">loading concrete vdev 5, metaslab 115 of 116 ...</span><br><span class="line"></span><br><span class="line">	No leaks (block sum matches space maps exactly)</span><br><span class="line"></span><br><span class="line">	bp count:                 59899</span><br><span class="line">	ganged count:                 0</span><br><span class="line">	bp logical:          7825843200      avg: 130650</span><br><span class="line">	bp physical:          948596736      avg:  15836     compression:   8.25</span><br><span class="line">	bp allocated:         951911424      avg:  15891     compression:   8.22</span><br><span class="line">	bp deduped:           936140800    ref&gt;1:    590   deduplication:   1.98</span><br><span class="line">	Normal class:          15770624     used:  0.00%</span><br><span class="line"></span><br><span class="line">	additional, non-pointer bps of type 0:         40</span><br></pre></td></tr></table></figure>

<p>é”€æ¯æ± </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo zpool destroy work</span><br></pre></td></tr></table></figure>

<p>6ä¸ªç¡¬ç›˜ï¼Œ3ä¸ªç»„æˆraid5ï¼Œç„¶ååœ¨2ç»„ç»„æˆraid0äº†ã€‚å¯ç”¨ç©ºé—´å¤§æ¦‚æ˜¯4ä¸ª2TBã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo zpool create work raidz1 /dev/sd&#123;b,c,d&#125;1</span><br><span class="line">sudo zpool add -f work raidz1 /dev/sd&#123;e,f,g&#125;1</span><br><span class="line">work            7.1T  7.3G  7.1T   1% /work</span><br></pre></td></tr></table></figure>
<p>6ä¸ªç¡¬ç›˜ï¼Œç›´æ¥ç»„æˆraid0ï¼Œ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo zpool create work /dev/sd&#123;b,c,d,e,f,g&#125;1</span><br><span class="line">work             11T  128K   11T   1% /work</span><br></pre></td></tr></table></figure>
<p>æ‰“å¼€å»é‡å’Œå‹ç¼©åŠŸèƒ½</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo zfs set dedup=on work</span><br><span class="line">$ sudo zfs set compression=lz4 work</span><br></pre></td></tr></table></figure>








</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://magesfc.github.io">mage</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://magesfc.github.io/mage/d98de400d172c2a1012ced6496ab01f175b24831/">https://magesfc.github.io/mage/d98de400d172c2a1012ced6496ab01f175b24831/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://magesfc.github.io" target="_blank">é©¬å“¥ç§æˆ¿èœ</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/linux/">linux</a><a class="post-meta__tags" href="/tags/zfs/">zfs</a></div><div class="post_share"><div class="social-share" data-image="https://t.mwm.moe/fj/" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> æ‰“èµ</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/null" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "/img/loading.gif" data-lazy-src="/null" alt="æ”¯ä»˜å¯¶"/></a><div class="post-qr-code-desc">æ”¯ä»˜å¯¶</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/mage/8d67839bb6d44eff5b49a469ceced4aac4bb004a/"><img class="prev-cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Linuxå­¦ä¹ ä¹‹task-spooleræ˜¯ä¸€ä¸ªUnixæ‰¹å¤„ç†ç³»ç»Ÿ</div></div></a></div><div class="next-post pull-right"><a href="/mage/5b96c3ed08ce6300577a1a8cd7169200600b4b1d/"><img class="next-cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Pythonå­¦ä¹ ä¹‹Anacondaå­¦ä¹ ç¬”è®°æ€»ç»“</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/mage/d09beb62ca31e9a0cf278d3ff1a8795bc551ec06/" title="Linuxå­¦ä¹ ä¹‹æ–‡ä»¶ç³»ç»Ÿzfsæ€§èƒ½ä¼˜åŒ–"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-23</div><div class="title">Linuxå­¦ä¹ ä¹‹æ–‡ä»¶ç³»ç»Ÿzfsæ€§èƒ½ä¼˜åŒ–</div></div></a></div><div><a href="/mage/bead5c222ebd755a0ea0b8165ff0663545d6c700/" title="Linuxå­¦ä¹ ä¹‹10ä¸ªæœ‰ç”¨çš„é“¾å¼æ“ä½œç¬¦åŠå…¶å®ä¾‹"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">Linuxå­¦ä¹ ä¹‹10ä¸ªæœ‰ç”¨çš„é“¾å¼æ“ä½œç¬¦åŠå…¶å®ä¾‹</div></div></a></div><div><a href="/mage/8facee0ca4bc4450ba21eea69a97fe1891c415dc/" title="Linuxå­¦ä¹ ä¹‹bashå­¦ä¹ ä¹‹bash_strict_mode"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-13</div><div class="title">Linuxå­¦ä¹ ä¹‹bashå­¦ä¹ ä¹‹bash_strict_mode</div></div></a></div><div><a href="/mage/0158e8186f0827d0b00df276735e46e876749b88/" title="Linuxå­¦ä¹ ä¹‹bashå­¦ä¹ ä¹‹åœ¨bashä¸­&#x3D;å’Œ&#x3D;~çš„åŒºåˆ«"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">Linuxå­¦ä¹ ä¹‹bashå­¦ä¹ ä¹‹åœ¨bashä¸­&#x3D;å’Œ&#x3D;~çš„åŒºåˆ«</div></div></a></div><div><a href="/mage/53776646b88e8b3c368d34d9936b880421441770/" title="Linuxå­¦ä¹ ä¹‹bashå­¦ä¹ ä¹‹åœ¨bashä¸­Quotingçš„è§£é‡Š"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-06</div><div class="title">Linuxå­¦ä¹ ä¹‹bashå­¦ä¹ ä¹‹åœ¨bashä¸­Quotingçš„è§£é‡Š</div></div></a></div><div><a href="/mage/29b1dee9b6336ea01be4716d95ecfbad663018d6/" title="Linuxå­¦ä¹ ä¹‹bashå­¦ä¹ ä¹‹å‡ ä¸ªç‰¹æ®Šå˜é‡"><img class="cover" src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-23</div><div class="title">Linuxå­¦ä¹ ä¹‹bashå­¦ä¹ ä¹‹å‡ ä¸ªç‰¹æ®Šå˜é‡</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "/img/loading.gif" data-lazy-src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">mage</div><div class="author-info__description"> è¿™é‡Œæ˜¯ é©¬å“¥ çš„ä¸ªäººåšå®¢ </div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">217</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">233</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">40</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/mamh2021"><i class="fab fa-github"></i><span>GitHub</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/mamh2021" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9-ZFS"><span class="toc-number">1.</span> <span class="toc-text">ä¸ºä»€ä¹ˆé€‰æ‹© ZFS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-ZFS"><span class="toc-number">2.</span> <span class="toc-text">å®‰è£… ZFS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#zfs-%E4%B8%AD%E7%9A%84-%E6%B1%A0%EF%BC%8C%E9%9B%86%EF%BC%8C%E5%8D%B7%E6%9C%AF%E8%AF%AD"><span class="toc-number">3.</span> <span class="toc-text">zfs ä¸­çš„ æ± ï¼Œé›†ï¼Œå·æœ¯è¯­</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%B1%A0"><span class="toc-number">4.</span> <span class="toc-text">åˆ›å»ºæ± </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B1%A0%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">5.</span> <span class="toc-text">æ± çš„æ“ä½œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ZIL-ZFS-Intent-Log"><span class="toc-number">6.</span> <span class="toc-text">ZIL (ZFS Intent Log)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ZFS-Cache-Drives-%E6%8B%BF-SSD-%E5%81%9A%E5%BF%AB%E5%8F%96"><span class="toc-number">7.</span> <span class="toc-text">ZFS Cache Drives æ‹¿ SSD åšå¿«å–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ZFS%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%8E%BB%E9%87%8D"><span class="toc-number">8.</span> <span class="toc-text">ZFSä¸æ•°æ®å»é‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ZFS%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%8E%8B%E7%BC%A9"><span class="toc-number">9.</span> <span class="toc-text">ZFSä¸æ•°æ®å‹ç¼©</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E8%A1%A5%E5%85%85"><span class="toc-number">10.</span> <span class="toc-text">å…¶ä»–è¡¥å……</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/mage/ee6e53b9fbe2f10991d150675f0b88ed427b1150/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹repo-diffmanifestsæºç åˆ†æ"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹repo-diffmanifestsæºç åˆ†æ"/></a><div class="content"><a class="title" href="/mage/ee6e53b9fbe2f10991d150675f0b88ed427b1150/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹repo-diffmanifestsæºç åˆ†æ">Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹repo-diffmanifestsæºç åˆ†æ</a><time datetime="2024-05-18T08:38:37.000Z" title="æ›´æ–°äº 2024-05-18 16:38:37">2024-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/a52bd2f9ab320c603de205368472b5caa19b7207/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹repo-syncæºç åˆ†æ"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹repo-syncæºç åˆ†æ"/></a><div class="content"><a class="title" href="/mage/a52bd2f9ab320c603de205368472b5caa19b7207/" title="Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹repo-syncæºç åˆ†æ">Androidä¸‹çš„é…ç½®ç®¡ç†ä¹‹é“ä¹‹repo-syncæºç åˆ†æ</a><time datetime="2024-05-18T02:15:08.000Z" title="æ›´æ–°äº 2024-05-18 10:15:08">2024-05-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/0bd8125569ad5e0222f4ca4e90e626be2ee24c26/" title="Jenkinså­¦ä¹ ä¹‹DataBoundConstructorå’ŒDataBoundSetter"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Jenkinså­¦ä¹ ä¹‹DataBoundConstructorå’ŒDataBoundSetter"/></a><div class="content"><a class="title" href="/mage/0bd8125569ad5e0222f4ca4e90e626be2ee24c26/" title="Jenkinså­¦ä¹ ä¹‹DataBoundConstructorå’ŒDataBoundSetter">Jenkinså­¦ä¹ ä¹‹DataBoundConstructorå’ŒDataBoundSetter</a><time datetime="2024-03-31T06:28:23.000Z" title="æ›´æ–°äº 2024-03-31 14:28:23">2024-03-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/4b00a873b39948044a79c7e53eedd63d7af0bfa6/" title="Dockerå­¦ä¹ ä¹‹å®‰è£…docker-swarmé›†ç¾¤"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Dockerå­¦ä¹ ä¹‹å®‰è£…docker-swarmé›†ç¾¤"/></a><div class="content"><a class="title" href="/mage/4b00a873b39948044a79c7e53eedd63d7af0bfa6/" title="Dockerå­¦ä¹ ä¹‹å®‰è£…docker-swarmé›†ç¾¤">Dockerå­¦ä¹ ä¹‹å®‰è£…docker-swarmé›†ç¾¤</a><time datetime="2024-03-31T06:28:19.000Z" title="æ›´æ–°äº 2024-03-31 14:28:19">2024-03-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/mage/44f033ce59a71a67f64e3c2e330151f82f8754f4/" title="Jenkinså­¦ä¹ ä¹‹masteræœåŠ¡å™¨å®‰è£…ä½¿ç”¨dockerå®‰è£…"><img src= "/img/loading.gif" data-lazy-src="https://t.mwm.moe/fj/" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Jenkinså­¦ä¹ ä¹‹masteræœåŠ¡å™¨å®‰è£…ä½¿ç”¨dockerå®‰è£…"/></a><div class="content"><a class="title" href="/mage/44f033ce59a71a67f64e3c2e330151f82f8754f4/" title="Jenkinså­¦ä¹ ä¹‹masteræœåŠ¡å™¨å®‰è£…ä½¿ç”¨dockerå®‰è£…">Jenkinså­¦ä¹ ä¹‹masteræœåŠ¡å™¨å®‰è£…ä½¿ç”¨dockerå®‰è£…</a><time datetime="2024-03-24T03:25:01.000Z" title="æ›´æ–°äº 2024-03-24 11:25:01">2024-03-24</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://t.mwm.moe/fj/')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2024 By mage</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>